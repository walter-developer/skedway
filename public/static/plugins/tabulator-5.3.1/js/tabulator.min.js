!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global="undefined"!=typeof globalThis?globalThis:global||self).Tabulator=factory()}(this,(function(){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _possibleConstructorReturn(self,call){return!call||"object"!=typeof call&&"function"!=typeof call?_assertThisInitialized(self):call}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _iterableToArray(iter){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(iter))return Array.from(iter)}function _iterableToArrayLimit(arr,i){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(arr)){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"==typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(e){throw e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=!0,didErr=!1,err;return{s:function(){it=o[Symbol.iterator]()},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(e){didErr=!0,err=e},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}var defaultOptions={debugEventsExternal:!1,debugEventsInternal:!1,debugInvalidOptions:!0,debugInvalidComponentFuncs:!0,debugInitialization:!0,debugDeprecation:!0,height:!1,minHeight:!1,maxHeight:!1,columnHeaderVertAlign:"top",popupContainer:!1,columns:[],columnDefaults:{},data:!1,autoColumns:!1,autoColumnsDefinitions:!1,nestedFieldSeparator:".",footerElement:!1,index:"id",textDirection:"auto",addRowPos:"bottom",headerVisible:!0,renderVertical:"virtual",renderHorizontal:"basic",renderVerticalBuffer:0,scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,rowFormatterPrint:null,rowFormatterClipboard:null,rowFormatterHtmlOutput:null,rowHeight:null,placeholder:!1,dataLoader:!0,dataLoaderLoading:!1,dataLoaderError:!1,dataLoaderErrorTimeout:3e3,dataSendParams:{},dataReceiveParams:{}},CoreFeature=function(){function CoreFeature(table){_classCallCheck(this,CoreFeature),this.table=table}return _createClass(CoreFeature,[{key:"reloadData",value:function reloadData(data,silent,columnsChanged){return this.table.dataLoader.load(data,void 0,void 0,void 0,silent,columnsChanged)}},{key:"langText",value:function langText(){var _this$table$modules$l;return(_this$table$modules$l=this.table.modules.localize).getText.apply(_this$table$modules$l,arguments)}},{key:"langBind",value:function langBind(){var _this$table$modules$l2;return(_this$table$modules$l2=this.table.modules.localize).bind.apply(_this$table$modules$l2,arguments)}},{key:"langLocale",value:function langLocale(){var _this$table$modules$l3;return(_this$table$modules$l3=this.table.modules.localize).getLocale.apply(_this$table$modules$l3,arguments)}},{key:"commsConnections",value:function commsConnections(){var _this$table$modules$c;return(_this$table$modules$c=this.table.modules.comms).getConnections.apply(_this$table$modules$c,arguments)}},{key:"commsSend",value:function commsSend(){var _this$table$modules$c2;return(_this$table$modules$c2=this.table.modules.comms).send.apply(_this$table$modules$c2,arguments)}},{key:"layoutMode",value:function layoutMode(){return this.table.modules.layout.getMode()}},{key:"layoutRefresh",value:function layoutRefresh(force){return this.table.modules.layout.layout(force)}},{key:"subscribe",value:function subscribe(){var _this$table$eventBus;return(_this$table$eventBus=this.table.eventBus).subscribe.apply(_this$table$eventBus,arguments)}},{key:"unsubscribe",value:function unsubscribe(){var _this$table$eventBus2;return(_this$table$eventBus2=this.table.eventBus).unsubscribe.apply(_this$table$eventBus2,arguments)}},{key:"subscribed",value:function subscribed(key){return this.table.eventBus.subscribed(key)}},{key:"subscriptionChange",value:function subscriptionChange(){var _this$table$eventBus3;return(_this$table$eventBus3=this.table.eventBus).subscriptionChange.apply(_this$table$eventBus3,arguments)}},{key:"dispatch",value:function dispatch(){var _this$table$eventBus4;return(_this$table$eventBus4=this.table.eventBus).dispatch.apply(_this$table$eventBus4,arguments)}},{key:"chain",value:function chain(){var _this$table$eventBus5;return(_this$table$eventBus5=this.table.eventBus).chain.apply(_this$table$eventBus5,arguments)}},{key:"confirm",value:function confirm(){var _this$table$eventBus6;return(_this$table$eventBus6=this.table.eventBus).confirm.apply(_this$table$eventBus6,arguments)}},{key:"dispatchExternal",value:function dispatchExternal(){var _this$table$externalE;return(_this$table$externalE=this.table.externalEvents).dispatch.apply(_this$table$externalE,arguments)}},{key:"subscribedExternal",value:function subscribedExternal(key){return this.table.externalEvents.subscribed(key)}},{key:"subscriptionChangeExternal",value:function subscriptionChangeExternal(){var _this$table$externalE2;return(_this$table$externalE2=this.table.externalEvents).subscriptionChange.apply(_this$table$externalE2,arguments)}},{key:"options",value:function options(key){return this.table.options[key]}},{key:"setOption",value:function setOption(key,value){return void 0!==value&&(this.table.options[key]=value),this.table.options[key]}},{key:"deprecationCheck",value:function deprecationCheck(oldOption,newOption){return this.table.deprecationAdvisor.check(oldOption,newOption)}},{key:"deprecationCheckMsg",value:function deprecationCheckMsg(oldOption,msg){return this.table.deprecationAdvisor.checkMsg(oldOption,msg)}},{key:"deprecationMsg",value:function deprecationMsg(msg){return this.table.deprecationAdvisor.msg(msg)}},{key:"module",value:function module(key){return this.table.module(key)}}]),CoreFeature}(),ColumnComponent=function(){function ColumnComponent(column){return _classCallCheck(this,ColumnComponent),this._column=column,this.type="ColumnComponent",new Proxy(this,{get:function get(target,name,receiver){return void 0!==target[name]?target[name]:target._column.table.componentFunctionBinder.handle("column",target._column,name)}})}return _createClass(ColumnComponent,[{key:"getElement",value:function getElement(){return this._column.getElement()}},{key:"getDefinition",value:function getDefinition(){return this._column.getDefinition()}},{key:"getField",value:function getField(){return this._column.getField()}},{key:"getTitleDownload",value:function getTitleDownload(){return this._column.getTitleDownload()}},{key:"getCells",value:function getCells(){var cells=[];return this._column.cells.forEach((function(cell){cells.push(cell.getComponent())})),cells}},{key:"isVisible",value:function isVisible(){return this._column.visible}},{key:"show",value:function show(){this._column.isGroup?this._column.columns.forEach((function(column){column.show()})):this._column.show()}},{key:"hide",value:function hide(){this._column.isGroup?this._column.columns.forEach((function(column){column.hide()})):this._column.hide()}},{key:"toggle",value:function toggle(){this._column.visible?this.hide():this.show()}},{key:"delete",value:function _delete(){return this._column.delete()}},{key:"getSubColumns",value:function getSubColumns(){var output=[];return this._column.columns.length&&this._column.columns.forEach((function(column){output.push(column.getComponent())})),output}},{key:"getParentColumn",value:function getParentColumn(){return this._column.parent instanceof Column&&this._column.parent.getComponent()}},{key:"_getSelf",value:function _getSelf(){return this._column}},{key:"scrollTo",value:function scrollTo(){return this._column.table.columnManager.scrollToColumn(this._column)}},{key:"getTable",value:function getTable(){return this._column.table}},{key:"move",value:function move(to,after){var toColumn=this._column.table.columnManager.findColumn(to);toColumn?this._column.table.columnManager.moveColumn(this._column,toColumn,after):console.warn("Move Error - No matching column found:",toColumn)}},{key:"getNextColumn",value:function getNextColumn(){var nextCol=this._column.nextColumn();return!!nextCol&&nextCol.getComponent()}},{key:"getPrevColumn",value:function getPrevColumn(){var prevCol=this._column.prevColumn();return!!prevCol&&prevCol.getComponent()}},{key:"updateDefinition",value:function updateDefinition(updates){return this._column.updateDefinition(updates)}},{key:"getWidth",value:function getWidth(){return this._column.getWidth()}},{key:"setWidth",value:function setWidth(width){var result;return result=!0===width?this._column.reinitializeWidth(!0):this._column.setWidth(width),this._column.table.columnManager.rerenderColumns(!0),result}}]),ColumnComponent}(),defaultColumnOptions={title:void 0,field:void 0,columns:void 0,visible:void 0,hozAlign:void 0,vertAlign:void 0,width:void 0,minWidth:40,maxWidth:void 0,maxInitialWidth:void 0,cssClass:void 0,variableHeight:void 0,headerVertical:void 0,headerHozAlign:void 0,editableTitle:void 0},CellComponent=function(){function CellComponent(cell){return _classCallCheck(this,CellComponent),this._cell=cell,new Proxy(this,{get:function get(target,name,receiver){return void 0!==target[name]?target[name]:target._cell.table.componentFunctionBinder.handle("cell",target._cell,name)}})}return _createClass(CellComponent,[{key:"getValue",value:function getValue(){return this._cell.getValue()}},{key:"getOldValue",value:function getOldValue(){return this._cell.getOldValue()}},{key:"getInitialValue",value:function getInitialValue(){return this._cell.initialValue}},{key:"getElement",value:function getElement(){return this._cell.getElement()}},{key:"getRow",value:function getRow(){return this._cell.row.getComponent()}},{key:"getData",value:function getData(){return this._cell.row.getData()}},{key:"getField",value:function getField(){return this._cell.column.getField()}},{key:"getColumn",value:function getColumn(){return this._cell.column.getComponent()}},{key:"setValue",value:function setValue(value,mutate){void 0===mutate&&(mutate=!0),this._cell.setValue(value,mutate)}},{key:"restoreOldValue",value:function restoreOldValue(){this._cell.setValueActual(this._cell.getOldValue())}},{key:"restoreInitialValue",value:function restoreInitialValue(){this._cell.setValueActual(this._cell.initialValue)}},{key:"checkHeight",value:function checkHeight(){this._cell.checkHeight()}},{key:"getTable",value:function getTable(){return this._cell.table}},{key:"_getSelf",value:function _getSelf(){return this._cell}}]),CellComponent}(),Cell=function(_CoreFeature){_inherits(Cell,_CoreFeature);var _super=_createSuper(Cell);function Cell(column,row){var _this;return _classCallCheck(this,Cell),(_this=_super.call(this,column.table)).table=column.table,_this.column=column,_this.row=row,_this.element=null,_this.value=null,_this.initialValue,_this.oldValue=null,_this.modules={},_this.height=null,_this.width=null,_this.minWidth=null,_this.component=null,_this.loaded=!1,_this.build(),_this}return _createClass(Cell,[{key:"build",value:function build(){this.generateElement(),this.setWidth(),this._configureCell(),this.setValueActual(this.column.getFieldValue(this.row.data)),this.initialValue=this.value}},{key:"generateElement",value:function generateElement(){this.element=document.createElement("div"),this.element.className="tabulator-cell",this.element.setAttribute("role","gridcell")}},{key:"_configureCell",value:function _configureCell(){var element=this.element,field=this.column.getField(),vertAligns={top:"flex-start",bottom:"flex-end",middle:"center"},hozAligns={left:"flex-start",right:"flex-end",center:"center"},classNames;(element.style.textAlign=this.column.hozAlign,this.column.vertAlign&&(element.style.display="inline-flex",element.style.alignItems=vertAligns[this.column.vertAlign]||"",this.column.hozAlign&&(element.style.justifyContent=hozAligns[this.column.hozAlign]||"")),field&&element.setAttribute("tabulator-field",field),this.column.definition.cssClass)&&this.column.definition.cssClass.split(" ").forEach((function(className){element.classList.add(className)}));this.dispatch("cell-init",this),this.column.visible||this.hide()}},{key:"_generateContents",value:function _generateContents(){var _this2=this,val;switch(_typeof(val=this.chain("cell-format",this,null,(function(){return _this2.element.innerHTML=_this2.value})))){case"object":if(val instanceof Node){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(val)}else this.element.innerHTML="",null!=val&&console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",val);break;case"undefined":this.element.innerHTML="";break;default:this.element.innerHTML=val}}},{key:"cellRendered",value:function cellRendered(){this.dispatch("cell-rendered",this)}},{key:"getElement",value:function getElement(containerOnly){return this.loaded||(this.loaded=!0,containerOnly||this.layoutElement()),this.element}},{key:"getValue",value:function getValue(){return this.value}},{key:"getOldValue",value:function getOldValue(){return this.oldValue}},{key:"setValue",value:function setValue(value,mutate,force){var changed;this.setValueProcessData(value,mutate,force)&&(this.dispatch("cell-value-updated",this),this.cellRendered(),this.column.definition.cellEdited&&this.column.definition.cellEdited.call(this.table,this.getComponent()),this.dispatchExternal("cellEdited",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()))}},{key:"setValueProcessData",value:function setValueProcessData(value,mutate,force){var changed=!1;return(this.value!==value||force)&&(changed=!0,mutate&&(value=this.chain("cell-value-changing",[this,value],null,value))),this.setValueActual(value),changed&&this.dispatch("cell-value-changed",this),changed}},{key:"setValueActual",value:function setValueActual(value){this.oldValue=this.value,this.value=value,this.dispatch("cell-value-save-before",this),this.column.setFieldValue(this.row.data,value),this.dispatch("cell-value-save-after",this),this.loaded&&this.layoutElement()}},{key:"layoutElement",value:function layoutElement(){this._generateContents(),this.dispatch("cell-layout",this)}},{key:"setWidth",value:function setWidth(){this.width=this.column.width,this.element.style.width=this.column.widthStyled}},{key:"clearWidth",value:function clearWidth(){this.width="",this.element.style.width=""}},{key:"getWidth",value:function getWidth(){return this.width||this.element.offsetWidth}},{key:"setMinWidth",value:function setMinWidth(){this.minWidth=this.column.minWidth,this.element.style.minWidth=this.column.minWidthStyled}},{key:"setMaxWidth",value:function setMaxWidth(){this.maxWidth=this.column.maxWidth,this.element.style.maxWidth=this.column.maxWidthStyled}},{key:"checkHeight",value:function checkHeight(){this.row.reinitializeHeight()}},{key:"clearHeight",value:function clearHeight(){this.element.style.height="",this.height=null,this.dispatch("cell-height",this,"")}},{key:"setHeight",value:function setHeight(){this.height=this.row.height,this.element.style.height=this.row.heightStyled,this.dispatch("cell-height",this,this.row.heightStyled)}},{key:"getHeight",value:function getHeight(){return this.height||this.element.offsetHeight}},{key:"show",value:function show(){this.element.style.display=this.column.vertAlign?"inline-flex":""}},{key:"hide",value:function hide(){this.element.style.display="none"}},{key:"delete",value:function _delete(){this.dispatch("cell-delete",this),!this.table.rowManager.redrawBlock&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.column.deleteCell(this),this.row.deleteCell(this),this.calcs={}}},{key:"getIndex",value:function getIndex(){return this.row.getCellIndex(this)}},{key:"getComponent",value:function getComponent(){return this.component||(this.component=new CellComponent(this)),this.component}}]),Cell}(CoreFeature),Column=function(_CoreFeature){_inherits(Column,_CoreFeature);var _super=_createSuper(Column);function Column(def,parent){var _this;return _classCallCheck(this,Column),(_this=_super.call(this,parent.table)).definition=def,_this.parent=parent,_this.type="column",_this.columns=[],_this.cells=[],_this.element=_this.createElement(),_this.contentElement=!1,_this.titleHolderElement=!1,_this.titleElement=!1,_this.groupElement=_this.createGroupElement(),_this.isGroup=!1,_this.hozAlign="",_this.vertAlign="",_this.field="",_this.fieldStructure="",_this.getFieldValue="",_this.setFieldValue="",_this.titleDownload=null,_this.titleFormatterRendered=!1,_this.mapDefinitions(),_this.setField(_this.definition.field),_this.modules={},_this.width=null,_this.widthStyled="",_this.maxWidth=null,_this.maxWidthStyled="",_this.maxInitialWidth=null,_this.minWidth=null,_this.minWidthStyled="",_this.widthFixed=!1,_this.visible=!0,_this.component=null,_this.definition.columns?(_this.isGroup=!0,_this.definition.columns.forEach((function(def,i){var newCol=new Column(def,_assertThisInitialized(_this));_this.attachColumn(newCol)})),_this.checkColumnVisibility()):parent.registerColumnField(_assertThisInitialized(_this)),_this._initialize(),_this}return _createClass(Column,[{key:"createElement",value:function createElement(){var el=document.createElement("div");switch(el.classList.add("tabulator-col"),el.setAttribute("role","columnheader"),el.setAttribute("aria-sort","none"),this.table.options.columnHeaderVertAlign){case"middle":el.style.justifyContent="center";break;case"bottom":el.style.justifyContent="flex-end"}return el}},{key:"createGroupElement",value:function createGroupElement(){var el=document.createElement("div");return el.classList.add("tabulator-col-group-cols"),el}},{key:"mapDefinitions",value:function mapDefinitions(){var defaults=this.table.options.columnDefaults;if(defaults)for(var key in defaults)void 0===this.definition[key]&&(this.definition[key]=defaults[key]);this.definition=this.table.columnManager.optionsList.generate(Column.defaultOptionList,this.definition)}},{key:"checkDefinition",value:function checkDefinition(){var _this2=this;Object.keys(this.definition).forEach((function(key){-1===Column.defaultOptionList.indexOf(key)&&console.warn("Invalid column definition option in '"+(_this2.field||_this2.definition.title)+"' column:",key)}))}},{key:"setField",value:function setField(field){this.field=field,this.fieldStructure=field?this.table.options.nestedFieldSeparator?field.split(this.table.options.nestedFieldSeparator):[field]:[],this.getFieldValue=this.fieldStructure.length>1?this._getNestedData:this._getFlatData,this.setFieldValue=this.fieldStructure.length>1?this._setNestedData:this._setFlatData}},{key:"registerColumnPosition",value:function registerColumnPosition(column){this.parent.registerColumnPosition(column)}},{key:"registerColumnField",value:function registerColumnField(column){this.parent.registerColumnField(column)}},{key:"reRegisterPosition",value:function reRegisterPosition(){this.isGroup?this.columns.forEach((function(column){column.reRegisterPosition()})):this.registerColumnPosition(this)}},{key:"_initialize",value:function _initialize(){for(var def=this.definition;this.element.firstChild;)this.element.removeChild(this.element.firstChild);def.headerVertical&&(this.element.classList.add("tabulator-col-vertical"),"flip"===def.headerVertical&&this.element.classList.add("tabulator-col-vertical-flip")),this.contentElement=this._buildColumnHeaderContent(),this.element.appendChild(this.contentElement),this.isGroup?this._buildGroupHeader():this._buildColumnHeader(),this.dispatch("column-init",this)}},{key:"_buildColumnHeader",value:function _buildColumnHeader(){var _this3=this,def=this.definition,classNames;(this.dispatch("column-layout",this),void 0!==def.visible&&(def.visible?this.show(!0):this.hide(!0)),def.cssClass)&&def.cssClass.split(" ").forEach((function(className){_this3.element.classList.add(className)}));def.field&&this.element.setAttribute("tabulator-field",def.field),this.setMinWidth(parseInt(def.minWidth)),def.maxInitialWidth&&(this.maxInitialWidth=parseInt(def.maxInitialWidth)),def.maxWidth&&this.setMaxWidth(parseInt(def.maxWidth)),this.reinitializeWidth(),this.hozAlign=this.definition.hozAlign,this.vertAlign=this.definition.vertAlign,this.titleElement.style.textAlign=this.definition.headerHozAlign}},{key:"_buildColumnHeaderContent",value:function _buildColumnHeaderContent(){var contentElement=document.createElement("div");return contentElement.classList.add("tabulator-col-content"),this.titleHolderElement=document.createElement("div"),this.titleHolderElement.classList.add("tabulator-col-title-holder"),contentElement.appendChild(this.titleHolderElement),this.titleElement=this._buildColumnHeaderTitle(),this.titleHolderElement.appendChild(this.titleElement),contentElement}},{key:"_buildColumnHeaderTitle",value:function _buildColumnHeaderTitle(){var _this4=this,def=this.definition,titleHolderElement=document.createElement("div");if(titleHolderElement.classList.add("tabulator-col-title"),def.editableTitle){var titleElement=document.createElement("input");titleElement.classList.add("tabulator-title-editor"),titleElement.addEventListener("click",(function(e){e.stopPropagation(),titleElement.focus()})),titleElement.addEventListener("change",(function(){def.title=titleElement.value,_this4.dispatchExternal("columnTitleChanged",_this4.getComponent())})),titleHolderElement.appendChild(titleElement),def.field?this.langBind("columns|"+def.field,(function(text){titleElement.value=text||def.title||"&nbsp;"})):titleElement.value=def.title||"&nbsp;"}else def.field?this.langBind("columns|"+def.field,(function(text){_this4._formatColumnHeaderTitle(titleHolderElement,text||def.title||"&nbsp;")})):this._formatColumnHeaderTitle(titleHolderElement,def.title||"&nbsp;");return titleHolderElement}},{key:"_formatColumnHeaderTitle",value:function _formatColumnHeaderTitle(el,title){var contents=this.chain("column-format",[this,title,el],null,(function(){return title}));switch(_typeof(contents)){case"object":contents instanceof Node?el.appendChild(contents):(el.innerHTML="",console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",contents));break;case"undefined":el.innerHTML="";break;default:el.innerHTML=contents}}},{key:"_buildGroupHeader",value:function _buildGroupHeader(){var _this5=this,classNames;(this.element.classList.add("tabulator-col-group"),this.element.setAttribute("role","columngroup"),this.element.setAttribute("aria-title",this.definition.title),this.definition.cssClass)&&this.definition.cssClass.split(" ").forEach((function(className){_this5.element.classList.add(className)}));this.titleElement.style.textAlign=this.definition.headerHozAlign,this.element.appendChild(this.groupElement)}},{key:"_getFlatData",value:function _getFlatData(data){return data[this.field]}},{key:"_getNestedData",value:function _getNestedData(data){for(var dataObj=data,structure=this.fieldStructure,length=structure.length,output,i=0;i<length&&(output=dataObj=dataObj[structure[i]],dataObj);i++);return output}},{key:"_setFlatData",value:function _setFlatData(data,value){this.field&&(data[this.field]=value)}},{key:"_setNestedData",value:function _setNestedData(data,value){for(var dataObj=data,structure=this.fieldStructure,length=structure.length,i=0;i<length;i++)if(i==length-1)dataObj[structure[i]]=value;else{if(!dataObj[structure[i]]){if(void 0===value)break;dataObj[structure[i]]={}}dataObj=dataObj[structure[i]]}}},{key:"attachColumn",value:function attachColumn(column){this.groupElement?(this.columns.push(column),this.groupElement.appendChild(column.getElement()),column.columnRendered()):console.warn("Column Warning - Column being attached to another column instead of column group")}},{key:"verticalAlign",value:function verticalAlign(alignment,height){var parentHeight=this.parent.isGroup?this.parent.getGroupElement().clientHeight:height||this.parent.getHeadersElement().clientHeight;this.element.style.height=parentHeight+"px",this.dispatch("column-height",this,this.element.style.height),this.isGroup&&(this.groupElement.style.minHeight=parentHeight-this.contentElement.offsetHeight+"px"),this.columns.forEach((function(column){column.verticalAlign(alignment)}))}},{key:"clearVerticalAlign",value:function clearVerticalAlign(){this.element.style.paddingTop="",this.element.style.height="",this.element.style.minHeight="",this.groupElement.style.minHeight="",this.columns.forEach((function(column){column.clearVerticalAlign()})),this.dispatch("column-height",this,"")}},{key:"getElement",value:function getElement(){return this.element}},{key:"getGroupElement",value:function getGroupElement(){return this.groupElement}},{key:"getField",value:function getField(){return this.field}},{key:"getTitleDownload",value:function getTitleDownload(){return this.titleDownload}},{key:"getFirstColumn",value:function getFirstColumn(){return this.isGroup?!!this.columns.length&&this.columns[0].getFirstColumn():this}},{key:"getLastColumn",value:function getLastColumn(){return this.isGroup?!!this.columns.length&&this.columns[this.columns.length-1].getLastColumn():this}},{key:"getColumns",value:function getColumns(traverse){var columns=[];return traverse?this.columns.forEach((function(column){columns.push(column),columns=columns.concat(column.getColumns(!0))})):columns=this.columns,columns}},{key:"getCells",value:function getCells(){return this.cells}},{key:"getTopColumn",value:function getTopColumn(){return this.parent.isGroup?this.parent.getTopColumn():this}},{key:"getDefinition",value:function getDefinition(updateBranches){var colDefs=[];return this.isGroup&&updateBranches&&(this.columns.forEach((function(column){colDefs.push(column.getDefinition(!0))})),this.definition.columns=colDefs),this.definition}},{key:"checkColumnVisibility",value:function checkColumnVisibility(){var visible=!1;this.columns.forEach((function(column){column.visible&&(visible=!0)})),visible?(this.show(),this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1)):this.hide()}},{key:"show",value:function show(silent,responsiveToggle){this.visible||(this.visible=!0,this.element.style.display="",this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach((function(cell){cell.show()})),this.isGroup||null!==this.width||this.reinitializeWidth(),this.table.columnManager.verticalAlignHeaders(),this.dispatch("column-show",this,responsiveToggle),silent||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!0),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}},{key:"hide",value:function hide(silent,responsiveToggle){this.visible&&(this.visible=!1,this.element.style.display="none",this.table.columnManager.verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach((function(cell){cell.hide()})),this.dispatch("column-hide",this,responsiveToggle),silent||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}},{key:"matchChildWidths",value:function matchChildWidths(){var childWidth=0;this.contentElement&&this.columns.length&&(this.columns.forEach((function(column){column.visible&&(childWidth+=column.getWidth())})),this.contentElement.style.maxWidth=childWidth-1+"px",this.parent.isGroup&&this.parent.matchChildWidths())}},{key:"removeChild",value:function removeChild(child){var index=this.columns.indexOf(child);index>-1&&this.columns.splice(index,1),this.columns.length||this.delete()}},{key:"setWidth",value:function setWidth(width){this.widthFixed=!0,this.setWidthActual(width)}},{key:"setWidthActual",value:function setWidthActual(width){isNaN(width)&&(width=Math.floor(this.table.element.clientWidth/100*parseInt(width))),width=Math.max(this.minWidth,width),this.maxWidth&&(width=Math.min(this.maxWidth,width)),this.width=width,this.widthStyled=width?width+"px":"",this.element.style.width=this.widthStyled,this.isGroup||this.cells.forEach((function(cell){cell.setWidth()})),this.parent.isGroup&&this.parent.matchChildWidths(),this.dispatch("column-width",this)}},{key:"checkCellHeights",value:function checkCellHeights(){var rows=[];this.cells.forEach((function(cell){cell.row.heightInitialized&&(null!==cell.row.getElement().offsetParent?(rows.push(cell.row),cell.row.clearCellHeight()):cell.row.heightInitialized=!1)})),rows.forEach((function(row){row.calcHeight()})),rows.forEach((function(row){row.setCellHeight()}))}},{key:"getWidth",value:function getWidth(){var width=0;return this.isGroup?this.columns.forEach((function(column){column.visible&&(width+=column.getWidth())})):width=this.width,width}},{key:"getHeight",value:function getHeight(){return Math.ceil(this.element.getBoundingClientRect().height)}},{key:"setMinWidth",value:function setMinWidth(minWidth){this.maxWidth&&minWidth>this.maxWidth&&(minWidth=this.maxWidth,console.warn("the minWidth ("+minWidth+"px) for column '"+this.field+"' cannot be bigger that its maxWidth ("+this.maxWidthStyled+")")),this.minWidth=minWidth,this.minWidthStyled=minWidth?minWidth+"px":"",this.element.style.minWidth=this.minWidthStyled,this.cells.forEach((function(cell){cell.setMinWidth()}))}},{key:"setMaxWidth",value:function setMaxWidth(maxWidth){this.minWidth&&maxWidth<this.minWidth&&(maxWidth=this.minWidth,console.warn("the maxWidth ("+maxWidth+"px) for column '"+this.field+"' cannot be smaller that its minWidth ("+this.minWidthStyled+")")),this.maxWidth=maxWidth,this.maxWidthStyled=maxWidth?maxWidth+"px":"",this.element.style.maxWidth=this.maxWidthStyled,this.cells.forEach((function(cell){cell.setMaxWidth()}))}},{key:"delete",value:function _delete(){var _this6=this;return new Promise((function(resolve,reject){_this6.isGroup&&_this6.columns.forEach((function(column){column.delete()})),_this6.dispatch("column-delete",_this6);for(var cellCount=_this6.cells.length,i=0;i<cellCount;i++)_this6.cells[0].delete();_this6.element.parentNode&&_this6.element.parentNode.removeChild(_this6.element),_this6.element=!1,_this6.contentElement=!1,_this6.titleElement=!1,_this6.groupElement=!1,_this6.parent.isGroup&&_this6.parent.removeChild(_this6),_this6.table.columnManager.deregisterColumn(_this6),_this6.table.columnManager.rerenderColumns(!0),resolve()}))}},{key:"columnRendered",value:function columnRendered(){this.titleFormatterRendered&&this.titleFormatterRendered(),this.dispatch("column-rendered",this)}},{key:"generateCell",value:function generateCell(row){var cell=new Cell(this,row);return this.cells.push(cell),cell}},{key:"nextColumn",value:function nextColumn(){var index=this.table.columnManager.findColumnIndex(this);return index>-1&&this._nextVisibleColumn(index+1)}},{key:"_nextVisibleColumn",value:function _nextVisibleColumn(index){var column=this.table.columnManager.getColumnByIndex(index);return!column||column.visible?column:this._nextVisibleColumn(index+1)}},{key:"prevColumn",value:function prevColumn(){var index=this.table.columnManager.findColumnIndex(this);return index>-1&&this._prevVisibleColumn(index-1)}},{key:"_prevVisibleColumn",value:function _prevVisibleColumn(index){var column=this.table.columnManager.getColumnByIndex(index);return!column||column.visible?column:this._prevVisibleColumn(index-1)}},{key:"reinitializeWidth",value:function reinitializeWidth(force){this.widthFixed=!1,void 0===this.definition.width||force||this.setWidth(this.definition.width),this.dispatch("column-width-fit-before",this),this.fitToData(force),this.dispatch("column-width-fit-after",this)}},{key:"fitToData",value:function fitToData(force){if(!this.isGroup){this.widthFixed||(this.element.style.width="",this.cells.forEach((function(cell){cell.clearWidth()})));var maxWidth=this.element.offsetWidth;if((!this.width||!this.widthFixed)&&(this.cells.forEach((function(cell){var width=cell.getWidth();width>maxWidth&&(maxWidth=width)})),maxWidth)){var setTo=maxWidth+1;this.maxInitialWidth&&!force&&(setTo=Math.min(setTo,this.maxInitialWidth)),this.setWidthActual(setTo)}}}},{key:"updateDefinition",value:function updateDefinition(updates){var _this7=this,definition;return this.isGroup?(console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns"),Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups")):this.parent.isGroup?(console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns"),Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups")):(definition=Object.assign({},this.getDefinition()),definition=Object.assign(definition,updates),this.table.columnManager.addColumn(definition,!1,this).then((function(column){return definition.field==_this7.field&&(_this7.field=!1),_this7.delete().then((function(){return column.getComponent()}))})))}},{key:"deleteCell",value:function deleteCell(cell){var index=this.cells.indexOf(cell);index>-1&&this.cells.splice(index,1)}},{key:"getComponent",value:function getComponent(){return this.component||(this.component=new ColumnComponent(this)),this.component}}]),Column}(CoreFeature);Column.defaultOptionList=defaultColumnOptions;var Helpers=function(){function Helpers(){_classCallCheck(this,Helpers)}return _createClass(Helpers,null,[{key:"elVisible",value:function elVisible(el){return!(el.offsetWidth<=0&&el.offsetHeight<=0)}},{key:"elOffset",value:function elOffset(el){var box=el.getBoundingClientRect();return{top:box.top+window.pageYOffset-document.documentElement.clientTop,left:box.left+window.pageXOffset-document.documentElement.clientLeft}}},{key:"deepClone",value:function deepClone(obj,clone){var _this=this,list=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],objectProto={}.__proto__,arrayProto=[].__proto__;clone||(clone=Object.assign(Array.isArray(obj)?[]:{},obj));var _loop=function _loop(){var subject=obj[i],match=void 0,copy=void 0;null==subject||"object"!==_typeof(subject)||subject.__proto__!==objectProto&&subject.__proto__!==arrayProto||((match=list.findIndex((function(item){return item.subject===subject})))>-1?clone[i]=list[match].copy:(copy=Object.assign(Array.isArray(subject)?[]:{},subject),list.unshift({subject:subject,copy:copy}),clone[i]=_this.deepClone(subject,copy,list)))};for(var i in obj)_loop();return clone}}]),Helpers}(),OptionsList=function(){function OptionsList(table,msgType){var defaults=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,OptionsList),this.table=table,this.msgType=msgType,this.registeredDefaults=Object.assign({},defaults)}return _createClass(OptionsList,[{key:"register",value:function register(option,value){this.registeredDefaults[option]=value}},{key:"generate",value:function generate(defaultOptions){var userOptions=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},output=Object.assign({},this.registeredDefaults);if(Object.assign(output,defaultOptions),!1!==userOptions.debugInvalidOptions||this.table.options.debugInvalidOptions)for(var key in userOptions)output.hasOwnProperty(key)||console.warn("Invalid "+this.msgType+" option:",key);for(var _key in output)_key in userOptions?output[_key]=userOptions[_key]:Array.isArray(output[_key])?output[_key]=Object.assign([],output[_key]):"object"===_typeof(output[_key])&&null!==output[_key]?output[_key]=Object.assign({},output[_key]):void 0===output[_key]&&delete output[_key];return output}}]),OptionsList}(),Renderer=function(_CoreFeature){_inherits(Renderer,_CoreFeature);var _super=_createSuper(Renderer);function Renderer(table){var _this;return _classCallCheck(this,Renderer),(_this=_super.call(this,table)).elementVertical=table.rowManager.element,_this.elementHorizontal=table.columnManager.element,_this.tableElement=table.rowManager.tableElement,_this.verticalFillMode="fit",_this}return _createClass(Renderer,[{key:"initialize",value:function initialize(){}},{key:"clearRows",value:function clearRows(){}},{key:"clearColumns",value:function clearColumns(){}},{key:"reinitializeColumnWidths",value:function reinitializeColumnWidths(columns){}},{key:"renderRows",value:function renderRows(){}},{key:"renderColumns",value:function renderColumns(){}},{key:"rerenderRows",value:function rerenderRows(callback){callback&&callback()}},{key:"rerenderColumns",value:function rerenderColumns(update,blockRedraw){}},{key:"renderRowCells",value:function renderRowCells(row){}},{key:"rerenderRowCells",value:function rerenderRowCells(row,force){}},{key:"scrollColumns",value:function scrollColumns(left,dir){}},{key:"scrollRows",value:function scrollRows(top,dir){}},{key:"resize",value:function resize(){}},{key:"scrollToRow",value:function scrollToRow(row){}},{key:"scrollToRowNearestTop",value:function scrollToRowNearestTop(row){}},{key:"visibleRows",value:function visibleRows(includingBuffer){return[]}},{key:"rows",value:function rows(){return this.table.rowManager.getDisplayRows()}},{key:"styleRow",value:function styleRow(row,index){var rowEl=row.getElement();index%2?(rowEl.classList.add("tabulator-row-even"),rowEl.classList.remove("tabulator-row-odd")):(rowEl.classList.add("tabulator-row-odd"),rowEl.classList.remove("tabulator-row-even"))}},{key:"clear",value:function clear(){this.clearRows(),this.clearColumns()}},{key:"render",value:function render(){this.renderRows(),this.renderColumns()}},{key:"rerender",value:function rerender(callback){this.rerenderRows(),this.rerenderColumns()}},{key:"scrollToRowPosition",value:function scrollToRowPosition(row,position,ifVisible){var _this2=this,rowIndex=this.rows().indexOf(row),rowEl=row.getElement(),offset=0;return new Promise((function(resolve,reject){if(rowIndex>-1){if(void 0===ifVisible&&(ifVisible=_this2.table.options.scrollToRowIfVisible),!ifVisible&&Helpers.elVisible(rowEl)&&(offset=Helpers.elOffset(rowEl).top-Helpers.elOffset(_this2.elementVertical).top)>0&&offset<_this2.elementVertical.clientHeight-rowEl.offsetHeight)return resolve(),!1;switch(void 0===position&&(position=_this2.table.options.scrollToRowPosition),"nearest"===position&&(position=_this2.scrollToRowNearestTop(row)?"top":"bottom"),_this2.scrollToRow(row),position){case"middle":case"center":_this2.elementVertical.scrollHeight-_this2.elementVertical.scrollTop==_this2.elementVertical.clientHeight?_this2.elementVertical.scrollTop=_this2.elementVertical.scrollTop+(rowEl.offsetTop-_this2.elementVertical.scrollTop)-(_this2.elementVertical.scrollHeight-rowEl.offsetTop)/2:_this2.elementVertical.scrollTop=_this2.elementVertical.scrollTop-_this2.elementVertical.clientHeight/2;break;case"bottom":_this2.elementVertical.scrollHeight-_this2.elementVertical.scrollTop==_this2.elementVertical.clientHeight?_this2.elementVertical.scrollTop=_this2.elementVertical.scrollTop-(_this2.elementVertical.scrollHeight-rowEl.offsetTop)+rowEl.offsetHeight:_this2.elementVertical.scrollTop=_this2.elementVertical.scrollTop-_this2.elementVertical.clientHeight+rowEl.offsetHeight;break;case"top":_this2.elementVertical.scrollTop=rowEl.offsetTop}resolve()}else console.warn("Scroll Error - Row not visible"),reject("Scroll Error - Row not visible")}))}}]),Renderer}(CoreFeature),BasicHorizontal=function(_Renderer){_inherits(BasicHorizontal,_Renderer);var _super=_createSuper(BasicHorizontal);function BasicHorizontal(table){return _classCallCheck(this,BasicHorizontal),_super.call(this,table)}return _createClass(BasicHorizontal,[{key:"renderRowCells",value:function renderRowCells(row){row.cells.forEach((function(cell){row.element.appendChild(cell.getElement()),cell.cellRendered()}))}},{key:"reinitializeColumnWidths",value:function reinitializeColumnWidths(columns){columns.forEach((function(column){column.reinitializeWidth()}))}}]),BasicHorizontal}(Renderer),VirtualDomHorizontal=function(_Renderer){_inherits(VirtualDomHorizontal,_Renderer);var _super=_createSuper(VirtualDomHorizontal);function VirtualDomHorizontal(table){var _this;return _classCallCheck(this,VirtualDomHorizontal),(_this=_super.call(this,table)).leftCol=0,_this.rightCol=0,_this.scrollLeft=0,_this.vDomScrollPosLeft=0,_this.vDomScrollPosRight=0,_this.vDomPadLeft=0,_this.vDomPadRight=0,_this.fitDataColAvg=0,_this.windowBuffer=200,_this.visibleRows=null,_this.initialized=!1,_this.isFitData=!1,_this.columns=[],_this}return _createClass(VirtualDomHorizontal,[{key:"initialize",value:function initialize(){this.compatibilityCheck(),this.layoutCheck(),this.vertScrollListen()}},{key:"compatibilityCheck",value:function compatibilityCheck(){var columns=this.options("columns"),frozen=!1,ok=!0;return"fitDataTable"==this.options("layout")&&(console.warn("Horizontal Virtual DOM is not compatible with fitDataTable layout mode"),ok=!1),this.options("responsiveLayout")&&(console.warn("Horizontal Virtual DOM is not compatible with responsive columns"),ok=!1),this.options("rtl")&&(console.warn("Horizontal Virtual DOM is not currently compatible with RTL text direction"),ok=!1),columns&&(frozen=columns.find((function(col){return col.frozen})))&&(console.warn("Horizontal Virtual DOM is not compatible with frozen columns"),ok=!1),ok}},{key:"layoutCheck",value:function layoutCheck(){this.isFitData=this.options("layout").startsWith("fitData")}},{key:"vertScrollListen",value:function vertScrollListen(){this.subscribe("scroll-vertical",this.clearVisRowCache.bind(this)),this.subscribe("data-refreshed",this.clearVisRowCache.bind(this))}},{key:"clearVisRowCache",value:function clearVisRowCache(){this.visibleRows=null}},{key:"renderColumns",value:function renderColumns(row,force){this.dataChange()}},{key:"scrollColumns",value:function scrollColumns(left,dir){this.scrollLeft!=left&&(this.scrollLeft=left,this.scroll(left-(this.vDomScrollPosLeft+this.windowBuffer)))}},{key:"calcWindowBuffer",value:function calcWindowBuffer(){var buffer=this.elementVertical.clientWidth;this.table.columnManager.columnsByIndex.forEach((function(column){if(column.visible){var width=column.getWidth();width>buffer&&(buffer=width)}})),this.windowBuffer=2*buffer}},{key:"rerenderColumns",value:function rerenderColumns(update,blockRedraw){var _this2=this,old={cols:this.columns,leftCol:this.leftCol,rightCol:this.rightCol},colPos=0;update&&!this.initialized||(this.clear(),this.calcWindowBuffer(),this.scrollLeft=this.elementVertical.scrollLeft,this.vDomScrollPosLeft=this.scrollLeft-this.windowBuffer,this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,this.table.columnManager.columnsByIndex.forEach((function(column){var config={};if(column.visible){var width=column.getWidth();config.leftPos=colPos,config.rightPos=colPos+width,config.width=width,_this2.isFitData&&(config.fitDataCheck=!column.modules.vdomHoz||column.modules.vdomHoz.fitDataCheck),colPos+width>_this2.vDomScrollPosLeft&&colPos<_this2.vDomScrollPosRight?(-1==_this2.leftCol&&(_this2.leftCol=_this2.columns.length,_this2.vDomPadLeft=colPos),_this2.rightCol=_this2.columns.length):-1!==_this2.leftCol&&(_this2.vDomPadRight+=width),_this2.columns.push(column),column.modules.vdomHoz=config,colPos+=width}})),this.tableElement.style.paddingLeft=this.vDomPadLeft+"px",this.tableElement.style.paddingRight=this.vDomPadRight+"px",this.initialized=!0,blockRedraw||update&&!this.reinitChanged(old)||this.reinitializeRows(),this.elementVertical.scrollLeft=this.scrollLeft)}},{key:"renderRowCells",value:function renderRowCells(row){this.initialized?this.initializeRow(row):row.cells.forEach((function(cell){row.element.appendChild(cell.getElement()),cell.cellRendered()}))}},{key:"rerenderRowCells",value:function rerenderRowCells(row,force){this.reinitializeRow(row,force)}},{key:"reinitializeColumnWidths",value:function reinitializeColumnWidths(columns){for(var i=this.leftCol;i<=this.rightCol;i++)this.columns[i].reinitializeWidth()}},{key:"deinitialize",value:function deinitialize(){this.initialized=!1}},{key:"clear",value:function clear(){this.columns=[],this.leftCol=-1,this.rightCol=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0}},{key:"dataChange",value:function dataChange(){var _this3=this,change=!1,row,rowEl;if(this.isFitData){if(this.table.columnManager.columnsByIndex.forEach((function(column){!column.definition.width&&column.visible&&(change=!0)})),change&&this.table.rowManager.getDisplayRows().length&&(this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,row=this.chain("rows-sample",[1],[],(function(){return _this3.table.rowManager.getDisplayRows()}))[0])){rowEl=row.getElement(),row.generateCells(),this.tableElement.appendChild(rowEl);for(var colEnd=0;colEnd<row.cells.length;colEnd++){var cell=row.cells[colEnd];rowEl.appendChild(cell.getElement()),cell.column.reinitializeWidth()}rowEl.parentNode.removeChild(rowEl),this.rerenderColumns(!1,!0)}}else"fitColumns"===this.options("layout")&&(this.layoutRefresh(),this.rerenderColumns(!1,!0))}},{key:"reinitChanged",value:function reinitChanged(old){var _this4=this,match=!0;return old.cols.length!==this.columns.length||old.leftCol!==this.leftCol||old.rightCol!==this.rightCol||(old.cols.forEach((function(col,i){col!==_this4.columns[i]&&(match=!1)})),!match)}},{key:"reinitializeRows",value:function reinitializeRows(){var _this5=this,rows;this.getVisibleRows().forEach((function(row){_this5.reinitializeRow(row,!0)}))}},{key:"getVisibleRows",value:function getVisibleRows(){return this.visibleRows||(this.visibleRows=this.table.rowManager.getVisibleRows()),this.visibleRows}},{key:"scroll",value:function scroll(diff){this.vDomScrollPosLeft+=diff,this.vDomScrollPosRight+=diff,Math.abs(diff)>this.windowBuffer/2?this.rerenderColumns():diff>0?(this.addColRight(),this.removeColLeft()):(this.addColLeft(),this.removeColRight())}},{key:"colPositionAdjust",value:function colPositionAdjust(start,end,diff){for(var i=start;i<end;i++){var column=this.columns[i];column.modules.vdomHoz.leftPos+=diff,column.modules.vdomHoz.rightPos+=diff}}},{key:"addColRight",value:function addColRight(){for(var _this6=this,changes=!1,working=!0,_loop=function _loop(){var column=_this6.columns[_this6.rightCol+1];column&&column.modules.vdomHoz.leftPos<=_this6.vDomScrollPosRight?(changes=!0,_this6.getVisibleRows().forEach((function(row){if("group"!==row.type){var cell=row.getCell(column);row.getElement().appendChild(cell.getElement()),cell.cellRendered()}})),_this6.fitDataColActualWidthCheck(column),_this6.rightCol++,_this6.rightCol>=_this6.columns.length-1?_this6.vDomPadRight=0:_this6.vDomPadRight-=column.getWidth()):working=!1};working;)_loop();changes&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}},{key:"addColLeft",value:function addColLeft(){for(var _this7=this,changes=!1,working=!0,_loop2=function _loop2(){var column=_this7.columns[_this7.leftCol-1];if(column)if(column.modules.vdomHoz.rightPos>=_this7.vDomScrollPosLeft){changes=!0,_this7.getVisibleRows().forEach((function(row){if("group"!==row.type){var cell=row.getCell(column);row.getElement().prepend(cell.getElement()),cell.cellRendered()}})),_this7.leftCol--,_this7.leftCol<=0?_this7.vDomPadLeft=0:_this7.vDomPadLeft-=column.getWidth();var diff=_this7.fitDataColActualWidthCheck(column);diff&&(_this7.scrollLeft=_this7.elementVertical.scrollLeft=_this7.elementVertical.scrollLeft+diff,_this7.vDomPadRight-=diff)}else working=!1;else working=!1};working;)_loop2();changes&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}},{key:"removeColRight",value:function removeColRight(){for(var _this8=this,changes=!1,working=!0,_loop3=function _loop3(){var column=_this8.columns[_this8.rightCol];column&&column.modules.vdomHoz.leftPos>_this8.vDomScrollPosRight?(changes=!0,_this8.getVisibleRows().forEach((function(row){if("group"!==row.type){var cell=row.getCell(column);try{row.getElement().removeChild(cell.getElement())}catch(ex){console.warn("Could not removeColRight",ex.message)}}})),_this8.vDomPadRight+=column.getWidth(),_this8.rightCol--):working=!1};working;)_loop3();changes&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}},{key:"removeColLeft",value:function removeColLeft(){for(var _this9=this,changes=!1,working=!0,_loop4=function _loop4(){var column=_this9.columns[_this9.leftCol];column&&column.modules.vdomHoz.rightPos<_this9.vDomScrollPosLeft?(changes=!0,_this9.getVisibleRows().forEach((function(row){if("group"!==row.type){var cell=row.getCell(column);try{row.getElement().removeChild(cell.getElement())}catch(ex){console.warn("Could not removeColLeft",ex.message)}}})),_this9.vDomPadLeft+=column.getWidth(),_this9.leftCol++):working=!1};working;)_loop4();changes&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}},{key:"fitDataColActualWidthCheck",value:function fitDataColActualWidthCheck(column){var newWidth,widthDiff;return column.modules.vdomHoz.fitDataCheck&&(column.reinitializeWidth(),(widthDiff=(newWidth=column.getWidth())-column.modules.vdomHoz.width)&&(column.modules.vdomHoz.rightPos+=widthDiff,column.modules.vdomHoz.width=newWidth,this.colPositionAdjust(this.columns.indexOf(column)+1,this.columns.length,widthDiff)),column.modules.vdomHoz.fitDataCheck=!1),widthDiff}},{key:"initializeRow",value:function initializeRow(row){if("group"!==row.type){row.modules.vdomHoz={leftCol:this.leftCol,rightCol:this.rightCol};for(var i=this.leftCol;i<=this.rightCol;i++){var column=this.columns[i];if(column&&column.visible){var cell=row.getCell(column);row.getElement().appendChild(cell.getElement()),cell.cellRendered()}}}}},{key:"reinitializeRow",value:function reinitializeRow(row,force){if("group"!==row.type&&(force||!row.modules.vdomHoz||row.modules.vdomHoz.leftCol!==this.leftCol||row.modules.vdomHoz.rightCol!==this.rightCol)){for(var rowEl=row.getElement();rowEl.firstChild;)rowEl.removeChild(rowEl.firstChild);this.initializeRow(row)}}}]),VirtualDomHorizontal}(Renderer),ColumnManager=function(_CoreFeature){_inherits(ColumnManager,_CoreFeature);var _super=_createSuper(ColumnManager);function ColumnManager(table){var _this;return _classCallCheck(this,ColumnManager),(_this=_super.call(this,table)).blockHozScrollEvent=!1,_this.headersElement=null,_this.element=null,_this.columns=[],_this.columnsByIndex=[],_this.columnsByField={},_this.scrollLeft=0,_this.optionsList=new OptionsList(_this.table,"column definition",defaultColumnOptions),_this.redrawBlock=!1,_this.redrawBlockUpdate=null,_this.renderer=null,_this}return _createClass(ColumnManager,[{key:"initialize",value:function initialize(){this.initializeRenderer(),this.headersElement=this.createHeadersElement(),this.element=this.createHeaderElement(),this.element.insertBefore(this.headersElement,this.element.firstChild),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this))}},{key:"initializeRenderer",value:function initializeRenderer(){var renderClass,renderers={virtual:VirtualDomHorizontal,basic:BasicHorizontal};(renderClass="string"==typeof this.table.options.renderHorizontal?renderers[this.table.options.renderHorizontal]:this.table.options.renderHorizontal)?(this.renderer=new renderClass(this.table,this.element,this.tableElement),this.renderer.initialize()):console.error("Unable to find matching renderer:",this.table.options.renderHorizontal)}},{key:"createHeadersElement",value:function createHeadersElement(){var el=document.createElement("div");return el.classList.add("tabulator-headers"),el.setAttribute("role","row"),el}},{key:"createHeaderElement",value:function createHeaderElement(){var el=document.createElement("div");return el.classList.add("tabulator-header"),el.setAttribute("role","rowgroup"),this.table.options.headerVisible||el.classList.add("tabulator-header-hidden"),el}},{key:"getElement",value:function getElement(){return this.element}},{key:"getHeadersElement",value:function getHeadersElement(){return this.headersElement}},{key:"scrollHorizontal",value:function scrollHorizontal(left){var hozAdjust=0,scrollWidth=this.element.scrollWidth-this.table.element.clientWidth;this.element.scrollLeft=left,left>scrollWidth?(hozAdjust=left-scrollWidth,this.element.style.marginLeft=-hozAdjust+"px"):this.element.style.marginLeft=0,this.scrollLeft=left,this.renderer.scrollColumns(left)}},{key:"generateColumnsFromRowData",value:function generateColumnsFromRowData(data){var cols=[],definitions=this.table.options.autoColumnsDefinitions,row,sorter;if(data&&data.length){for(var key in row=data[0]){var col={field:key,title:key},value=row[key];switch(_typeof(value)){case"undefined":sorter="string";break;case"boolean":sorter="boolean";break;case"object":sorter=Array.isArray(value)?"array":"string";break;default:sorter=isNaN(value)||""===value?value.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)?"alphanum":"string":"number"}col.sorter=sorter,cols.push(col)}if(definitions)switch(_typeof(definitions)){case"function":this.table.options.columns=definitions.call(this.table,cols);break;case"object":Array.isArray(definitions)?cols.forEach((function(col){var match=definitions.find((function(def){return def.field===col.field}));match&&Object.assign(col,match)})):cols.forEach((function(col){definitions[col.field]&&Object.assign(col,definitions[col.field])})),this.table.options.columns=cols}else this.table.options.columns=cols;this.setColumns(this.table.options.columns)}}},{key:"setColumns",value:function setColumns(cols,row){for(var _this2=this;this.headersElement.firstChild;)this.headersElement.removeChild(this.headersElement.firstChild);this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.dispatch("columns-loading"),cols.forEach((function(def,i){_this2._addColumn(def)})),this._reIndexColumns(),this.dispatch("columns-loaded"),this.rerenderColumns(!1,!0),this.redraw(!0)}},{key:"_addColumn",value:function _addColumn(definition,before,nextToColumn){var column=new Column(definition,this),colEl=column.getElement(),index=nextToColumn?this.findColumnIndex(nextToColumn):nextToColumn;if(nextToColumn&&index>-1){var topColumn=nextToColumn.getTopColumn(),parentIndex=this.columns.indexOf(topColumn),nextEl=topColumn.getElement();before?(this.columns.splice(parentIndex,0,column),nextEl.parentNode.insertBefore(colEl,nextEl)):(this.columns.splice(parentIndex+1,0,column),nextEl.parentNode.insertBefore(colEl,nextEl.nextSibling))}else before?(this.columns.unshift(column),this.headersElement.insertBefore(column.getElement(),this.headersElement.firstChild)):(this.columns.push(column),this.headersElement.appendChild(column.getElement()));return column.columnRendered(),column}},{key:"registerColumnField",value:function registerColumnField(col){col.definition.field&&(this.columnsByField[col.definition.field]=col)}},{key:"registerColumnPosition",value:function registerColumnPosition(col){this.columnsByIndex.push(col)}},{key:"_reIndexColumns",value:function _reIndexColumns(){this.columnsByIndex=[],this.columns.forEach((function(column){column.reRegisterPosition()}))}},{key:"verticalAlignHeaders",value:function verticalAlignHeaders(){var _this3=this,minHeight=0;this.redrawBlock||(this.columns.forEach((function(column){column.clearVerticalAlign()})),this.columns.forEach((function(column){var height=column.getHeight();height>minHeight&&(minHeight=height)})),this.columns.forEach((function(column){column.verticalAlign(_this3.table.options.columnHeaderVertAlign,minHeight)})),this.table.rowManager.adjustTableSize())}},{key:"findColumn",value:function findColumn(subject){var columns,match;return"object"!=_typeof(subject)?this.columnsByField[subject]||!1:subject instanceof Column?subject:subject instanceof ColumnComponent?subject._getSelf()||!1:"undefined"!=typeof HTMLElement&&subject instanceof HTMLElement&&(columns=[],this.columns.forEach((function(column){columns.push(column),columns=columns.concat(column.getColumns(!0))})),columns.find((function(column){return column.element===subject}))||!1)}},{key:"getColumnByField",value:function getColumnByField(field){return this.columnsByField[field]}},{key:"getColumnsByFieldRoot",value:function getColumnsByFieldRoot(root){var _this4=this,matches=[];return Object.keys(this.columnsByField).forEach((function(field){var fieldRoot;field.split(".")[0]===root&&matches.push(_this4.columnsByField[field])})),matches}},{key:"getColumnByIndex",value:function getColumnByIndex(index){return this.columnsByIndex[index]}},{key:"getFirstVisibleColumn",value:function getFirstVisibleColumn(){var index=this.columnsByIndex.findIndex((function(col){return col.visible}));return index>-1&&this.columnsByIndex[index]}},{key:"getColumns",value:function getColumns(){return this.columns}},{key:"findColumnIndex",value:function findColumnIndex(column){return this.columnsByIndex.findIndex((function(col){return column===col}))}},{key:"getRealColumns",value:function getRealColumns(){return this.columnsByIndex}},{key:"traverse",value:function traverse(callback){this.columnsByIndex.forEach((function(column,i){callback(column,i)}))}},{key:"getDefinitions",value:function getDefinitions(active){var output=[];return this.columnsByIndex.forEach((function(column){(!active||active&&column.visible)&&output.push(column.getDefinition())})),output}},{key:"getDefinitionTree",value:function getDefinitionTree(){var output=[];return this.columns.forEach((function(column){output.push(column.getDefinition(!0))})),output}},{key:"getComponents",value:function getComponents(structured){var output=[],columns;return(structured?this.columns:this.columnsByIndex).forEach((function(column){output.push(column.getComponent())})),output}},{key:"getWidth",value:function getWidth(){var width=0;return this.columnsByIndex.forEach((function(column){column.visible&&(width+=column.getWidth())})),width}},{key:"moveColumn",value:function moveColumn(from,to,after){this.moveColumnActual(from,to,after),to.element.parentNode.insertBefore(from.element,to.element),after&&to.element.parentNode.insertBefore(to.element,from.element),this.verticalAlignHeaders(),this.table.rowManager.reinitialize()}},{key:"moveColumnActual",value:function moveColumnActual(from,to,after){from.parent.isGroup?this._moveColumnInArray(from.parent.columns,from,to,after):this._moveColumnInArray(this.columns,from,to,after),this._moveColumnInArray(this.columnsByIndex,from,to,after,!0),this.rerenderColumns(!0),this.dispatch("column-moved",from,to,after),this.subscribedExternal("columnMoved")&&this.dispatchExternal("columnMoved",from.getComponent(),this.table.columnManager.getComponents())}},{key:"_moveColumnInArray",value:function _moveColumnInArray(columns,from,to,after,updateRows){var fromIndex=columns.indexOf(from),toIndex,rows=[];fromIndex>-1&&(columns.splice(fromIndex,1),(toIndex=columns.indexOf(to))>-1?after&&(toIndex+=1):toIndex=fromIndex,columns.splice(toIndex,0,from),updateRows&&(rows=(rows=this.chain("column-moving-rows",[from,to,after],null,[])||[]).concat(this.table.rowManager.rows)).forEach((function(row){if(row.cells.length){var cell=row.cells.splice(fromIndex,1)[0];row.cells.splice(toIndex,0,cell)}})))}},{key:"scrollToColumn",value:function scrollToColumn(column,position,ifVisible){var _this5=this,left=0,offset=0,adjust=0,colEl=column.getElement();return new Promise((function(resolve,reject){if(void 0===position&&(position=_this5.table.options.scrollToColumnPosition),void 0===ifVisible&&(ifVisible=_this5.table.options.scrollToColumnIfVisible),column.visible){switch(position){case"middle":case"center":adjust=-_this5.element.clientWidth/2;break;case"right":adjust=colEl.clientWidth-_this5.headersElement.clientWidth}if(!ifVisible&&(offset=colEl.offsetLeft)>0&&offset+colEl.offsetWidth<_this5.element.clientWidth)return!1;left=colEl.offsetLeft+adjust,left=Math.max(Math.min(left,_this5.table.rowManager.element.scrollWidth-_this5.table.rowManager.element.clientWidth),0),_this5.table.rowManager.scrollHorizontal(left),_this5.scrollHorizontal(left),resolve()}else console.warn("Scroll Error - Column not visible"),reject("Scroll Error - Column not visible")}))}},{key:"generateCells",value:function generateCells(row){var cells=[];return this.columnsByIndex.forEach((function(column){cells.push(column.generateCell(row))})),cells}},{key:"getFlexBaseWidth",value:function getFlexBaseWidth(){var totalWidth=this.table.element.clientWidth,fixedWidth=0;return this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(totalWidth-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),this.columnsByIndex.forEach((function(column){var width,minWidth,colWidth;column.visible&&(width=column.definition.width||0,minWidth=parseInt(column.minWidth),colWidth="string"==typeof width?width.indexOf("%")>-1?totalWidth/100*parseInt(width):parseInt(width):width,fixedWidth+=colWidth>minWidth?colWidth:minWidth)})),fixedWidth}},{key:"addColumn",value:function addColumn(definition,before,nextToColumn){var _this6=this;return new Promise((function(resolve,reject){var column=_this6._addColumn(definition,before,nextToColumn);_this6._reIndexColumns(),_this6.dispatch("column-add",definition,before,nextToColumn),"fitColumns"!=_this6.layoutMode()&&column.reinitializeWidth(),_this6.redraw(!0),_this6.table.rowManager.reinitialize(),_this6.rerenderColumns(),resolve(column)}))}},{key:"deregisterColumn",value:function deregisterColumn(column){var field=column.getField(),index;field&&delete this.columnsByField[field],(index=this.columnsByIndex.indexOf(column))>-1&&this.columnsByIndex.splice(index,1),(index=this.columns.indexOf(column))>-1&&this.columns.splice(index,1),this.verticalAlignHeaders(),this.redraw()}},{key:"rerenderColumns",value:function rerenderColumns(update,silent){this.redrawBlock?(!1===update||!0===update&&null===this.redrawBlockUpdate)&&(this.redrawBlockUpdate=update):this.renderer.rerenderColumns(update,silent)}},{key:"blockRedraw",value:function blockRedraw(){this.redrawBlock=!0,this.redrawBlockUpdate=null}},{key:"restoreRedraw",value:function restoreRedraw(){this.redrawBlock=!1,this.verticalAlignHeaders(),this.renderer.rerenderColumns(this.redrawBlockUpdate)}},{key:"redraw",value:function redraw(force){Helpers.elVisible(this.element)&&this.verticalAlignHeaders(),force&&(this.table.rowManager.resetScroll(),this.table.rowManager.reinitialize()),this.confirm("table-redrawing",force)||this.layoutRefresh(force),this.dispatch("table-redraw",force),this.table.footerManager.redraw()}}]),ColumnManager}(CoreFeature),RowComponent=function(){function RowComponent(row){return _classCallCheck(this,RowComponent),this._row=row,new Proxy(this,{get:function get(target,name,receiver){return void 0!==target[name]?target[name]:target._row.table.componentFunctionBinder.handle("row",target._row,name)}})}return _createClass(RowComponent,[{key:"getData",value:function getData(transform){return this._row.getData(transform)}},{key:"getElement",value:function getElement(){return this._row.getElement()}},{key:"getCells",value:function getCells(){var cells=[];return this._row.getCells().forEach((function(cell){cells.push(cell.getComponent())})),cells}},{key:"getCell",value:function getCell(column){var cell=this._row.getCell(column);return!!cell&&cell.getComponent()}},{key:"getIndex",value:function getIndex(){return this._row.getData("data")[this._row.table.options.index]}},{key:"getPosition",value:function getPosition(){return this._row.getPosition()}},{key:"watchPosition",value:function watchPosition(callback){return this._row.watchPosition(callback)}},{key:"delete",value:function _delete(){return this._row.delete()}},{key:"scrollTo",value:function scrollTo(){return this._row.table.rowManager.scrollToRow(this._row)}},{key:"move",value:function move(to,after){this._row.moveToRow(to,after)}},{key:"update",value:function update(data){return this._row.updateData(data)}},{key:"normalizeHeight",value:function normalizeHeight(){this._row.normalizeHeight(!0)}},{key:"_getSelf",value:function _getSelf(){return this._row}},{key:"reformat",value:function reformat(){return this._row.reinitialize()}},{key:"getTable",value:function getTable(){return this._row.table}},{key:"getNextRow",value:function getNextRow(){var row=this._row.nextRow();return row?row.getComponent():row}},{key:"getPrevRow",value:function getPrevRow(){var row=this._row.prevRow();return row?row.getComponent():row}}]),RowComponent}(),Row=function(_CoreFeature){_inherits(Row,_CoreFeature);var _super=_createSuper(Row);function Row(data,parent){var _this,type=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"row";return _classCallCheck(this,Row),(_this=_super.call(this,parent.table)).parent=parent,_this.data={},_this.type=type,_this.element=!1,_this.modules={},_this.cells=[],_this.height=0,_this.heightStyled="",_this.manualHeight=!1,_this.outerHeight=0,_this.initialized=!1,_this.heightInitialized=!1,_this.position=0,_this.positionWatchers=[],_this.component=null,_this.created=!1,_this.setData(data),_this}return _createClass(Row,[{key:"create",value:function create(){this.created||(this.created=!0,this.generateElement())}},{key:"createElement",value:function createElement(){var el=document.createElement("div");el.classList.add("tabulator-row"),el.setAttribute("role","row"),this.element=el}},{key:"getElement",value:function getElement(){return this.create(),this.element}},{key:"detachElement",value:function detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}},{key:"generateElement",value:function generateElement(){this.createElement(),this.dispatch("row-init",this)}},{key:"generateCells",value:function generateCells(){this.cells=this.table.columnManager.generateCells(this)}},{key:"initialize",value:function initialize(force){if(this.create(),!this.initialized||force){for(this.deleteCells();this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.dispatch("row-layout-before",this),this.generateCells(),this.initialized=!0,this.table.columnManager.renderer.renderRowCells(this),force&&this.normalizeHeight(),this.dispatch("row-layout",this),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent()),this.dispatch("row-layout-after",this)}else this.table.columnManager.renderer.rerenderRowCells(this)}},{key:"reinitializeHeight",value:function reinitializeHeight(){this.heightInitialized=!1,this.element&&null!==this.element.offsetParent&&this.normalizeHeight(!0)}},{key:"deinitialize",value:function deinitialize(){this.initialized=!1}},{key:"deinitializeHeight",value:function deinitializeHeight(){this.heightInitialized=!1}},{key:"reinitialize",value:function reinitialize(children){this.initialized=!1,this.heightInitialized=!1,this.manualHeight||(this.height=0,this.heightStyled=""),this.element&&null!==this.element.offsetParent&&this.initialize(!0),this.dispatch("row-relayout",this)}},{key:"calcHeight",value:function calcHeight(force){var maxHeight=0,minHeight;this.table.options.rowHeight?this.height=this.table.options.rowHeight:(minHeight=this.table.options.resizableRows?this.element.clientHeight:0,this.cells.forEach((function(cell){var height=cell.getHeight();height>maxHeight&&(maxHeight=height)})),this.height=force?Math.max(maxHeight,minHeight):this.manualHeight?this.height:Math.max(maxHeight,minHeight)),this.heightStyled=this.height?this.height+"px":"",this.outerHeight=this.element.offsetHeight}},{key:"setCellHeight",value:function setCellHeight(){this.cells.forEach((function(cell){cell.setHeight()})),this.heightInitialized=!0}},{key:"clearCellHeight",value:function clearCellHeight(){this.cells.forEach((function(cell){cell.clearHeight()}))}},{key:"normalizeHeight",value:function normalizeHeight(force){force&&!this.table.options.rowHeight&&this.clearCellHeight(),this.calcHeight(force),this.setCellHeight()}},{key:"setHeight",value:function setHeight(height,force){(this.height!=height||force)&&(this.manualHeight=!0,this.height=height,this.heightStyled=height?height+"px":"",this.setCellHeight(),this.outerHeight=this.element.offsetHeight)}},{key:"getHeight",value:function getHeight(){return this.outerHeight}},{key:"getWidth",value:function getWidth(){return this.element.offsetWidth}},{key:"deleteCell",value:function deleteCell(cell){var index=this.cells.indexOf(cell);index>-1&&this.cells.splice(index,1)}},{key:"setData",value:function setData(data){this.data=this.chain("row-data-init-before",[this,data],void 0,data),this.dispatch("row-data-init-after",this)}},{key:"updateData",value:function updateData(updatedData){var _this2=this,visible=this.element&&Helpers.elVisible(this.element),tempData={},newRowData;return new Promise((function(resolve,reject){for(var attrname in"string"==typeof updatedData&&(updatedData=JSON.parse(updatedData)),_this2.dispatch("row-data-save-before",_this2),_this2.subscribed("row-data-changing")&&(tempData=Object.assign(tempData,_this2.data),tempData=Object.assign(tempData,updatedData)),newRowData=_this2.chain("row-data-changing",[_this2,tempData,updatedData],null,updatedData))_this2.data[attrname]=newRowData[attrname];for(var _attrname in _this2.dispatch("row-data-save-after",_this2),updatedData){var columns;_this2.table.columnManager.getColumnsByFieldRoot(_attrname).forEach((function(column){var cell=_this2.getCell(column.getField());if(cell){var value=column.getFieldValue(newRowData);cell.getValue()!=value&&(cell.setValueProcessData(value),visible&&cell.cellRendered())}}))}visible?(_this2.normalizeHeight(!0),_this2.table.options.rowFormatter&&_this2.table.options.rowFormatter(_this2.getComponent())):(_this2.initialized=!1,_this2.height=0,_this2.heightStyled=""),_this2.dispatch("row-data-changed",_this2,visible,updatedData),_this2.dispatchExternal("rowUpdated",_this2.getComponent()),_this2.subscribedExternal("dataChanged")&&_this2.dispatchExternal("dataChanged",_this2.table.rowManager.getData()),resolve()}))}},{key:"getData",value:function getData(transform){return transform?this.chain("row-data-retrieve",[this,transform],null,this.data):this.data}},{key:"getCell",value:function getCell(column){var match=!1;return column=this.table.columnManager.findColumn(column),this.initialized||this.generateCells(),match=this.cells.find((function(cell){return cell.column===column}))}},{key:"getCellIndex",value:function getCellIndex(findCell){return this.cells.findIndex((function(cell){return cell===findCell}))}},{key:"findCell",value:function findCell(subject){return this.cells.find((function(cell){return cell.element===subject}))}},{key:"getCells",value:function getCells(){return this.initialized||this.generateCells(),this.cells}},{key:"nextRow",value:function nextRow(){var row;return this.table.rowManager.nextDisplayRow(this,!0)||!1}},{key:"prevRow",value:function prevRow(){var row;return this.table.rowManager.prevDisplayRow(this,!0)||!1}},{key:"moveToRow",value:function moveToRow(to,before){var toRow=this.table.rowManager.findRow(to);toRow?(this.table.rowManager.moveRowActual(this,toRow,!before),this.table.rowManager.refreshActiveData("display",!1,!0)):console.warn("Move Error - No matching row found:",to)}},{key:"delete",value:function _delete(){return this.dispatch("row-delete",this),this.deleteActual(),Promise.resolve()}},{key:"deleteActual",value:function deleteActual(blockRedraw){this.detachModules(),this.table.rowManager.deleteRow(this,blockRedraw),this.deleteCells(),this.initialized=!1,this.heightInitialized=!1,this.element=!1,this.dispatch("row-deleted",this)}},{key:"detachModules",value:function detachModules(){this.dispatch("row-deleting",this)}},{key:"deleteCells",value:function deleteCells(){for(var cellCount=this.cells.length,i=0;i<cellCount;i++)this.cells[0].delete()}},{key:"wipe",value:function wipe(){if(this.detachModules(),this.deleteCells(),this.element){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.parentNode&&this.element.parentNode.removeChild(this.element)}this.element=!1,this.modules={}}},{key:"isDisplayed",value:function isDisplayed(){return this.table.rowManager.getDisplayRows().includes(this)}},{key:"getPosition",value:function getPosition(){return!!this.isDisplayed()&&this.position}},{key:"setPosition",value:function setPosition(position){var _this3=this;position!=this.position&&(this.position=position,this.positionWatchers.forEach((function(callback){callback(_this3.position)})))}},{key:"watchPosition",value:function watchPosition(callback){this.positionWatchers.push(callback),callback(this.position)}},{key:"getGroup",value:function getGroup(){return this.modules.group||!1}},{key:"getComponent",value:function getComponent(){return this.component||(this.component=new RowComponent(this)),this.component}}]),Row}(CoreFeature),BasicVertical=function(_Renderer){_inherits(BasicVertical,_Renderer);var _super=_createSuper(BasicVertical);function BasicVertical(table){var _this;return _classCallCheck(this,BasicVertical),(_this=_super.call(this,table)).verticalFillMode="fill",_this.scrollTop=0,_this.scrollLeft=0,_this.scrollTop=0,_this.scrollLeft=0,_this}return _createClass(BasicVertical,[{key:"clearRows",value:function clearRows(){for(var element=this.tableElement;element.firstChild;)element.removeChild(element.firstChild);element.scrollTop=0,element.scrollLeft=0,element.style.minWidth="",element.style.minHeight="",element.style.display="",element.style.visibility=""}},{key:"renderRows",value:function renderRows(){var _this2=this,element=this.tableElement,onlyGroupHeaders=!0;this.rows().forEach((function(row,index){_this2.styleRow(row,index),element.appendChild(row.getElement()),row.initialize(!0),"group"!==row.type&&(onlyGroupHeaders=!1)})),element.style.minWidth=onlyGroupHeaders?this.table.columnManager.getWidth()+"px":""}},{key:"rerenderRows",value:function rerenderRows(callback){this.clearRows(),this.renderRows(),callback&&callback()}},{key:"scrollToRowNearestTop",value:function scrollToRowNearestTop(row){var rowTop=Helpers.elOffset(row.getElement()).top;return!(Math.abs(this.elementVertical.scrollTop-rowTop)>Math.abs(this.elementVertical.scrollTop+this.elementVertical.clientHeight-rowTop))}},{key:"scrollToRow",value:function scrollToRow(row){var rowEl=row.getElement();this.elementVertical.scrollTop=Helpers.elOffset(rowEl).top-Helpers.elOffset(this.elementVertical).top+this.elementVertical.scrollTop}},{key:"visibleRows",value:function visibleRows(includingBuffer){return this.rows()}}]),BasicVertical}(Renderer),VirtualDomVertical=function(_Renderer){_inherits(VirtualDomVertical,_Renderer);var _super=_createSuper(VirtualDomVertical);function VirtualDomVertical(table){var _this;return _classCallCheck(this,VirtualDomVertical),(_this=_super.call(this,table)).verticalFillMode="fill",_this.scrollTop=0,_this.scrollLeft=0,_this.vDomRowHeight=20,_this.vDomTop=0,_this.vDomBottom=0,_this.vDomScrollPosTop=0,_this.vDomScrollPosBottom=0,_this.vDomTopPad=0,_this.vDomBottomPad=0,_this.vDomMaxRenderChain=90,_this.vDomWindowBuffer=0,_this.vDomWindowMinTotalRows=20,_this.vDomWindowMinMarginRows=5,_this.vDomTopNewRows=[],_this.vDomBottomNewRows=[],_this}return _createClass(VirtualDomVertical,[{key:"clearRows",value:function clearRows(){for(var element=this.tableElement;element.firstChild;)element.removeChild(element.firstChild);element.style.paddingTop="",element.style.paddingBottom="",element.style.minHeight="",element.style.display="",element.style.visibility="",this.elementVertical.scrollTop=0,this.elementVertical.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0,this.vDomTop=0,this.vDomBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0}},{key:"renderRows",value:function renderRows(){this._virtualRenderFill()}},{key:"rerenderRows",value:function rerenderRows(callback){for(var scrollTop=this.elementVertical.scrollTop,topRow=!1,topOffset=!1,left=this.table.rowManager.scrollLeft,rows=this.rows(),i=this.vDomTop;i<=this.vDomBottom;i++)if(rows[i]){var diff=scrollTop-rows[i].getElement().offsetTop;if(!(!1===topOffset||Math.abs(diff)<topOffset))break;topOffset=diff,topRow=i}rows.forEach((function(row){row.deinitializeHeight()})),callback&&callback(),this.rows().length?this._virtualRenderFill(!1===topRow?this.rows.length-1:topRow,!0,topOffset||0):(this.clear(),this.table.rowManager._showPlaceholder()),this.scrollColumns(left)}},{key:"scrollColumns",value:function scrollColumns(left){this.table.rowManager.scrollHorizontal(left)}},{key:"scrollRows",value:function scrollRows(top,dir){var topDiff=top-this.vDomScrollPosTop,bottomDiff=top-this.vDomScrollPosBottom,margin=2*this.vDomWindowBuffer,rows=this.rows();if(this.scrollTop=top,-topDiff>margin||bottomDiff>margin){var left=this.table.rowManager.scrollLeft;this._virtualRenderFill(Math.floor(this.elementVertical.scrollTop/this.elementVertical.scrollHeight*rows.length)),this.scrollColumns(left)}else dir?(topDiff<0&&this._addTopRow(rows,-topDiff),bottomDiff<0&&(this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer?this._removeBottomRow(rows,-bottomDiff):this.vDomScrollPosBottom=this.scrollTop)):(bottomDiff>=0&&this._addBottomRow(rows,bottomDiff),topDiff>=0&&(this.scrollTop>this.vDomWindowBuffer?this._removeTopRow(rows,topDiff):this.vDomScrollPosTop=this.scrollTop))}},{key:"resize",value:function resize(){this.vDomWindowBuffer=this.table.options.renderVerticalBuffer||this.elementVertical.clientHeight}},{key:"scrollToRowNearestTop",value:function scrollToRowNearestTop(row){var rowIndex=this.rows().indexOf(row);return!(Math.abs(this.vDomTop-rowIndex)>Math.abs(this.vDomBottom-rowIndex))}},{key:"scrollToRow",value:function scrollToRow(row){var index=this.rows().indexOf(row);index>-1&&this._virtualRenderFill(index,!0)}},{key:"visibleRows",value:function visibleRows(includingBuffer){var topEdge=this.elementVertical.scrollTop,bottomEdge=this.elementVertical.clientHeight+topEdge,topFound=!1,topRow=0,bottomRow=0,rows=this.rows();if(includingBuffer)topRow=this.vDomTop,bottomRow=this.vDomBottom;else for(var i=this.vDomTop;i<=this.vDomBottom;i++)if(rows[i])if(topFound){if(!(bottomEdge-rows[i].getElement().offsetTop>=0))break;bottomRow=i}else if(topEdge-rows[i].getElement().offsetTop>=0)topRow=i;else{if(topFound=!0,!(bottomEdge-rows[i].getElement().offsetTop>=0))break;bottomRow=i}return rows.slice(topRow,bottomRow+1)}},{key:"_virtualRenderFill",value:function _virtualRenderFill(position,forceMove,offset){var element=this.tableElement,holder=this.elementVertical,topPad=0,rowsHeight=0,heightOccupied=0,topPadHeight=0,i=0,rows=this.rows(),rowsCount=rows.length,containerHeight=this.elementVertical.clientHeight;if(offset=offset||0,position=position||0){for(;element.firstChild;)element.removeChild(element.firstChild);(heightOccupied=(rowsCount-position+1)*this.vDomRowHeight)<containerHeight&&(position-=Math.ceil((containerHeight-heightOccupied)/this.vDomRowHeight))<0&&(position=0),position-=topPad=Math.min(Math.max(Math.floor(this.vDomWindowBuffer/this.vDomRowHeight),this.vDomWindowMinMarginRows),position)}else this.clear();if(rowsCount&&Helpers.elVisible(this.elementVertical)){for(this.vDomTop=position,this.vDomBottom=position-1;(rowsHeight<=containerHeight+this.vDomWindowBuffer||i<this.vDomWindowMinTotalRows)&&this.vDomBottom<rowsCount-1;){var index=this.vDomBottom+1,row=rows[index],rowHeight=0;this.styleRow(row,index),element.appendChild(row.getElement()),row.initialize(),row.heightInitialized||row.normalizeHeight(!0),rowHeight=row.getHeight(),i<topPad?topPadHeight+=rowHeight:rowsHeight+=rowHeight,rowHeight>this.vDomWindowBuffer&&(this.vDomWindowBuffer=2*rowHeight),this.vDomBottom++,i++}position?(this.vDomTopPad=forceMove?this.vDomRowHeight*this.vDomTop+offset:this.scrollTop-topPadHeight,this.vDomBottomPad=this.vDomBottom==rowsCount-1?0:Math.max(this.vDomScrollHeight-this.vDomTopPad-rowsHeight-topPadHeight,0)):(this.vDomTopPad=0,this.vDomRowHeight=Math.floor((rowsHeight+topPadHeight)/i),this.vDomBottomPad=this.vDomRowHeight*(rowsCount-this.vDomBottom-1),this.vDomScrollHeight=topPadHeight+rowsHeight+this.vDomBottomPad-containerHeight),element.style.paddingTop=this.vDomTopPad+"px",element.style.paddingBottom=this.vDomBottomPad+"px",forceMove&&(this.scrollTop=this.vDomTopPad+topPadHeight+offset-(this.elementVertical.scrollWidth>this.elementVertical.clientWidth?this.elementVertical.offsetHeight-containerHeight:0)),this.scrollTop=Math.min(this.scrollTop,this.elementVertical.scrollHeight-containerHeight),this.elementVertical.scrollWidth>this.elementVertical.offsetWidth&&forceMove&&(this.scrollTop+=this.elementVertical.offsetHeight-containerHeight),this.vDomScrollPosTop=this.scrollTop,this.vDomScrollPosBottom=this.scrollTop,holder.scrollTop=this.scrollTop,this.dispatch("render-virtual-fill")}}},{key:"_addTopRow",value:function _addTopRow(rows,fillableSpace){for(var table=this.tableElement,addedRows=[],paddingAdjust=0,index=this.vDomTop-1,i=0,working=!0;working;)if(this.vDomTop){var row=rows[index],rowHeight=void 0,initialized=void 0;row&&i<this.vDomMaxRenderChain?(rowHeight=row.getHeight()||this.vDomRowHeight,initialized=row.initialized,fillableSpace>=rowHeight?(this.styleRow(row,index),table.insertBefore(row.getElement(),table.firstChild),row.initialized&&row.heightInitialized||addedRows.push(row),row.initialize(),initialized||(rowHeight=row.getElement().offsetHeight)>this.vDomWindowBuffer&&(this.vDomWindowBuffer=2*rowHeight),fillableSpace-=rowHeight,paddingAdjust+=rowHeight,this.vDomTop--,index--,i++):working=!1):working=!1}else working=!1;for(var _i=0,_addedRows=addedRows;_i<_addedRows.length;_i++){var _row;_addedRows[_i].clearCellHeight()}this._quickNormalizeRowHeight(addedRows),paddingAdjust&&(this.vDomTopPad-=paddingAdjust,this.vDomTopPad<0&&(this.vDomTopPad=index*this.vDomRowHeight),index<1&&(this.vDomTopPad=0),table.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop-=paddingAdjust)}},{key:"_removeTopRow",value:function _removeTopRow(rows,fillableSpace){for(var removableRows=[],paddingAdjust=0,i=0,working=!0;working;){var row=rows[this.vDomTop],rowHeight=void 0;row&&i<this.vDomMaxRenderChain&&fillableSpace>=(rowHeight=row.getHeight()||this.vDomRowHeight)?(this.vDomTop++,fillableSpace-=rowHeight,paddingAdjust+=rowHeight,removableRows.push(row),i++):working=!1}for(var _i2=0,_removableRows=removableRows;_i2<_removableRows.length;_i2++){var _row2,rowEl=_removableRows[_i2].getElement();rowEl.parentNode&&rowEl.parentNode.removeChild(rowEl)}paddingAdjust&&(this.vDomTopPad+=paddingAdjust,this.tableElement.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop+=this.vDomTop?paddingAdjust:paddingAdjust+this.vDomWindowBuffer)}},{key:"_addBottomRow",value:function _addBottomRow(rows,fillableSpace){for(var table=this.tableElement,addedRows=[],paddingAdjust=0,index=this.vDomBottom+1,i=0,working=!0;working;){var row=rows[index],rowHeight=void 0,initialized=void 0;row&&i<this.vDomMaxRenderChain?(rowHeight=row.getHeight()||this.vDomRowHeight,initialized=row.initialized,fillableSpace>=rowHeight?(this.styleRow(row,index),table.appendChild(row.getElement()),row.initialized&&row.heightInitialized||addedRows.push(row),row.initialize(),initialized||(rowHeight=row.getElement().offsetHeight)>this.vDomWindowBuffer&&(this.vDomWindowBuffer=2*rowHeight),fillableSpace-=rowHeight,paddingAdjust+=rowHeight,this.vDomBottom++,index++,i++):working=!1):working=!1}for(var _i3=0,_addedRows2=addedRows;_i3<_addedRows2.length;_i3++){var _row3;_addedRows2[_i3].clearCellHeight()}this._quickNormalizeRowHeight(addedRows),paddingAdjust&&(this.vDomBottomPad-=paddingAdjust,(this.vDomBottomPad<0||index==rows.length-1)&&(this.vDomBottomPad=0),table.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom+=paddingAdjust)}},{key:"_removeBottomRow",value:function _removeBottomRow(rows,fillableSpace){for(var removableRows=[],paddingAdjust=0,i=0,working=!0;working;){var row=rows[this.vDomBottom],rowHeight=void 0;row&&i<this.vDomMaxRenderChain&&fillableSpace>=(rowHeight=row.getHeight()||this.vDomRowHeight)?(this.vDomBottom--,fillableSpace-=rowHeight,paddingAdjust+=rowHeight,removableRows.push(row),i++):working=!1}for(var _i4=0,_removableRows2=removableRows;_i4<_removableRows2.length;_i4++){var _row4,rowEl=_removableRows2[_i4].getElement();rowEl.parentNode&&rowEl.parentNode.removeChild(rowEl)}paddingAdjust&&(this.vDomBottomPad+=paddingAdjust,this.vDomBottomPad<0&&(this.vDomBottomPad=0),this.tableElement.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom-=paddingAdjust)}},{key:"_quickNormalizeRowHeight",value:function _quickNormalizeRowHeight(rows){var _iterator=_createForOfIteratorHelper(rows),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var row;_step.value.calcHeight()}}catch(err){_iterator.e(err)}finally{_iterator.f()}var _iterator2=_createForOfIteratorHelper(rows),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _row5;_step2.value.setCellHeight()}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}}]),VirtualDomVertical}(Renderer),RowManager=function(_CoreFeature){_inherits(RowManager,_CoreFeature);var _super=_createSuper(RowManager);function RowManager(table){var _this;return _classCallCheck(this,RowManager),(_this=_super.call(this,table)).element=_this.createHolderElement(),_this.tableElement=_this.createTableElement(),_this.heightFixer=_this.createTableElement(),_this.placeholder=null,_this.placeholderContents=null,_this.firstRender=!1,_this.renderMode="virtual",_this.fixedHeight=!1,_this.rows=[],_this.activeRowsPipeline=[],_this.activeRows=[],_this.activeRowsCount=0,_this.displayRows=[],_this.displayRowsCount=0,_this.scrollTop=0,_this.scrollLeft=0,_this.redrawBlock=!1,_this.redrawBlockRestoreConfig=!1,_this.redrawBlockRenderInPosition=!1,_this.dataPipeline=[],_this.displayPipeline=[],_this.renderer=null,_this}return _createClass(RowManager,[{key:"createHolderElement",value:function createHolderElement(){var el=document.createElement("div");return el.classList.add("tabulator-tableholder"),el.setAttribute("tabindex",0),el}},{key:"createTableElement",value:function createTableElement(){var el=document.createElement("div");return el.classList.add("tabulator-table"),el.setAttribute("role","rowgroup"),el}},{key:"initializePlaceholder",value:function initializePlaceholder(){if("string"==typeof this.table.options.placeholder){var el=document.createElement("div");el.classList.add("tabulator-placeholder");var contents=document.createElement("div");contents.classList.add("tabulator-placeholder-contents"),contents.innerHTML=this.table.options.placeholder,el.appendChild(contents),this.placeholderContents=contents,this.placeholder=el}}},{key:"getElement",value:function getElement(){return this.element}},{key:"getTableElement",value:function getTableElement(){return this.tableElement}},{key:"initialize",value:function initialize(){var _this2=this;this.initializePlaceholder(),this.initializeRenderer(),this.element.appendChild(this.tableElement),this.firstRender=!0,this.element.addEventListener("scroll",(function(){var left=_this2.element.scrollLeft,leftDir=_this2.scrollLeft>left,top=_this2.element.scrollTop,topDir=_this2.scrollTop>top;_this2.scrollLeft!=left&&(_this2.scrollLeft=left,_this2.dispatch("scroll-horizontal",left,leftDir),_this2.dispatchExternal("scrollHorizontal",left,leftDir),_this2._positionPlaceholder()),_this2.scrollTop!=top&&(_this2.scrollTop=top,_this2.renderer.scrollRows(top,topDir),_this2.dispatch("scroll-vertical",top,topDir),_this2.dispatchExternal("scrollVertical",top,topDir))}))}},{key:"findRow",value:function findRow(subject){var _this3=this,_match,match;return"object"!=_typeof(subject)?void 0!==subject&&(this.rows.find((function(row){return row.data[_this3.table.options.index]==subject}))||!1):subject instanceof Row?subject:subject instanceof RowComponent?subject._getSelf()||!1:"undefined"!=typeof HTMLElement&&subject instanceof HTMLElement&&this.rows.find((function(row){return row.getElement()===subject}))||!1}},{key:"getRowFromDataObject",value:function getRowFromDataObject(data){var match;return this.rows.find((function(row){return row.data===data}))||!1}},{key:"getRowFromPosition",value:function getRowFromPosition(position){return this.getDisplayRows().find((function(row){return row.getPosition()===position&&row.isDisplayed()}))}},{key:"scrollToRow",value:function scrollToRow(row,position,ifVisible){return this.renderer.scrollToRowPosition(row,position,ifVisible)}},{key:"setData",value:function setData(data,renderInPosition,columnsChanged){var _this4=this;return new Promise((function(resolve,reject){renderInPosition&&_this4.getDisplayRows().length?_this4.table.options.pagination?_this4._setDataActual(data,!0):_this4.reRenderInPosition((function(){_this4._setDataActual(data)})):(_this4.table.options.autoColumns&&columnsChanged&&_this4.table.initialized&&_this4.table.columnManager.generateColumnsFromRowData(data),_this4.resetScroll(),_this4._setDataActual(data)),resolve()}))}},{key:"_setDataActual",value:function _setDataActual(data,renderInPosition){var _this5=this;this.dispatchExternal("dataProcessing",data),this._wipeElements(),Array.isArray(data)?(this.dispatch("data-processing",data),data.forEach((function(def,i){if(def&&"object"===_typeof(def)){var row=new Row(def,_this5);_this5.rows.push(row)}else console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",def)})),this.refreshActiveData(!1,!1,renderInPosition),this.dispatch("data-processed",data),this.dispatchExternal("dataProcessed",data)):console.error("Data Loading Error - Unable to process data due to invalid data type \nExpecting: array \nReceived: ",_typeof(data),"\nData:     ",data)}},{key:"_wipeElements",value:function _wipeElements(){this.dispatch("rows-wipe"),this.rows.forEach((function(row){row.wipe()})),this.rows=[],this.activeRows=[],this.activeRowsPipeline=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0,this.adjustTableSize()}},{key:"deleteRow",value:function deleteRow(row,blockRedraw){var allIndex=this.rows.indexOf(row),activeIndex=this.activeRows.indexOf(row);activeIndex>-1&&this.activeRows.splice(activeIndex,1),allIndex>-1&&this.rows.splice(allIndex,1),this.setActiveRows(this.activeRows),this.displayRowIterator((function(rows){var displayIndex=rows.indexOf(row);displayIndex>-1&&rows.splice(displayIndex,1)})),blockRedraw||this.reRenderInPosition(),this.regenerateRowPositions(),this.dispatchExternal("rowDeleted",row.getComponent()),this.displayRowsCount||this._showPlaceholder(),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.getData())}},{key:"addRow",value:function addRow(data,pos,index,blockRedraw){var row;return this.addRowActual(data,pos,index,blockRedraw)}},{key:"addRows",value:function addRows(data,pos,index){var _this6=this,rows=[];return new Promise((function(resolve,reject){pos=_this6.findAddRowPos(pos),Array.isArray(data)||(data=[data]),(void 0===index&&pos||void 0!==index&&!pos)&&data.reverse(),data.forEach((function(item,i){var row=_this6.addRow(item,pos,index,!0);rows.push(row),_this6.dispatch("row-added",row,data,pos,index)})),_this6.refreshActiveData(!1,!1,!0),_this6.regenerateRowPositions(),rows.length&&_this6._clearPlaceholder(),resolve(rows)}))}},{key:"findAddRowPos",value:function findAddRowPos(pos){return void 0===pos&&(pos=this.table.options.addRowPos),"pos"===pos&&(pos=!0),"bottom"===pos&&(pos=!1),pos}},{key:"addRowActual",value:function addRowActual(data,pos,index,blockRedraw){var row=data instanceof Row?data:new Row(data||{},this),top=this.findAddRowPos(pos),allIndex=-1,activeIndex,chainResult;return index||(chainResult=this.chain("row-adding-position",[row,top],null,{index:index,top:top}),index=chainResult.index,top=chainResult.top),void 0!==index&&(index=this.findRow(index)),(index=this.chain("row-adding-index",[row,index,top],null,index))&&(allIndex=this.rows.indexOf(index)),index&&allIndex>-1?(activeIndex=this.activeRows.indexOf(index),this.displayRowIterator((function(rows){var displayIndex=rows.indexOf(index);displayIndex>-1&&rows.splice(top?displayIndex:displayIndex+1,0,row)})),activeIndex>-1&&this.activeRows.splice(top?activeIndex:activeIndex+1,0,row),this.rows.splice(top?allIndex:allIndex+1,0,row)):top?(this.displayRowIterator((function(rows){rows.unshift(row)})),this.activeRows.unshift(row),this.rows.unshift(row)):(this.displayRowIterator((function(rows){rows.push(row)})),this.activeRows.push(row),this.rows.push(row)),this.setActiveRows(this.activeRows),this.dispatchExternal("rowAdded",row.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),blockRedraw||this.reRenderInPosition(),row}},{key:"moveRow",value:function moveRow(from,to,after){this.dispatch("row-move",from,to,after),this.moveRowActual(from,to,after),this.regenerateRowPositions(),this.dispatch("row-moved",from,to,after),this.dispatchExternal("rowMoved",from.getComponent())}},{key:"moveRowActual",value:function moveRowActual(from,to,after){var _this7=this;this.moveRowInArray(this.rows,from,to,after),this.moveRowInArray(this.activeRows,from,to,after),this.displayRowIterator((function(rows){_this7.moveRowInArray(rows,from,to,after)})),this.dispatch("row-moving",from,to,after)}},{key:"moveRowInArray",value:function moveRowInArray(rows,from,to,after){var fromIndex,toIndex,start,end;if(from!==to&&((fromIndex=rows.indexOf(from))>-1&&(rows.splice(fromIndex,1),(toIndex=rows.indexOf(to))>-1?after?rows.splice(toIndex+1,0,from):rows.splice(toIndex,0,from):rows.splice(fromIndex,0,from)),rows===this.getDisplayRows())){end=toIndex>fromIndex?toIndex:fromIndex+1;for(var i=start=fromIndex<toIndex?fromIndex:toIndex;i<=end;i++)rows[i]&&this.styleRow(rows[i],i)}}},{key:"clearData",value:function clearData(){this.setData([])}},{key:"getRowIndex",value:function getRowIndex(row){return this.findRowIndex(row,this.rows)}},{key:"getDisplayRowIndex",value:function getDisplayRowIndex(row){var index=this.getDisplayRows().indexOf(row);return index>-1&&index}},{key:"nextDisplayRow",value:function nextDisplayRow(row,rowOnly){var index=this.getDisplayRowIndex(row),nextRow=!1;return!1!==index&&index<this.displayRowsCount-1&&(nextRow=this.getDisplayRows()[index+1]),!nextRow||nextRow instanceof Row&&"row"==nextRow.type?nextRow:this.nextDisplayRow(nextRow,rowOnly)}},{key:"prevDisplayRow",value:function prevDisplayRow(row,rowOnly){var index=this.getDisplayRowIndex(row),prevRow=!1;return index&&(prevRow=this.getDisplayRows()[index-1]),!rowOnly||!prevRow||prevRow instanceof Row&&"row"==prevRow.type?prevRow:this.prevDisplayRow(prevRow,rowOnly)}},{key:"findRowIndex",value:function findRowIndex(row,list){var rowIndex;return!!((row=this.findRow(row))&&(rowIndex=list.indexOf(row))>-1)&&rowIndex}},{key:"getData",value:function getData(active,transform){var output=[],rows;return this.getRows(active).forEach((function(row){"row"==row.type&&output.push(row.getData(transform||"data"))})),output}},{key:"getComponents",value:function getComponents(active){var output=[],rows;return this.getRows(active).forEach((function(row){output.push(row.getComponent())})),output}},{key:"getDataCount",value:function getDataCount(active){var rows;return this.getRows(active).length}},{key:"scrollHorizontal",value:function scrollHorizontal(left){this.scrollLeft=left,this.element.scrollLeft=left,this.dispatch("scroll-horizontal",left)}},{key:"registerDataPipelineHandler",value:function registerDataPipelineHandler(handler,priority){void 0!==priority?(this.dataPipeline.push({handler:handler,priority:priority}),this.dataPipeline.sort((function(a,b){return a.priority-b.priority}))):console.error("Data pipeline handlers must have a priority in order to be registered")}},{key:"registerDisplayPipelineHandler",value:function registerDisplayPipelineHandler(handler,priority){void 0!==priority?(this.displayPipeline.push({handler:handler,priority:priority}),this.displayPipeline.sort((function(a,b){return a.priority-b.priority}))):console.error("Display pipeline handlers must have a priority in order to be registered")}},{key:"refreshActiveData",value:function refreshActiveData(handler,skipStage,renderInPosition){var table=this.table,stage="",index=0,cascadeOrder=["all","dataPipeline","display","displayPipeline","end"];if("function"==typeof handler)if((index=this.dataPipeline.findIndex((function(item){return item.handler===handler})))>-1)stage="dataPipeline",skipStage&&(index==this.dataPipeline.length-1?stage="display":index++);else{if(!((index=this.displayPipeline.findIndex((function(item){return item.handler===handler})))>-1))return void console.error("Unable to refresh data, invalid handler provided",handler);stage="displayPipeline",skipStage&&(index==this.displayPipeline.length-1?stage="end":index++)}else stage=handler||"all",index=0;this.redrawBlock?(!this.redrawBlockRestoreConfig||this.redrawBlockRestoreConfig&&(this.redrawBlockRestoreConfig.stage===stage&&index<this.redrawBlockRestoreConfig.index||cascadeOrder.indexOf(stage)<cascadeOrder.indexOf(this.redrawBlockRestoreConfig.stage)))&&(this.redrawBlockRestoreConfig={handler:handler,skipStage:skipStage,renderInPosition:renderInPosition,stage:stage,index:index}):(Helpers.elVisible(this.element)?renderInPosition?this.reRenderInPosition(this.refreshPipelines.bind(this,handler,stage,index,renderInPosition)):(this.refreshPipelines(handler,stage,index,renderInPosition),handler||this.table.columnManager.renderer.renderColumns(),this.renderTable(),table.options.layoutColumnsOnNewData&&this.table.columnManager.redraw(!0)):this.refreshPipelines(handler,stage,index,renderInPosition),this.dispatch("data-refreshed"))}},{key:"refreshPipelines",value:function refreshPipelines(handler,stage,index,renderInPosition){switch(this.dispatch("data-refreshing"),handler||(this.activeRowsPipeline[0]=this.rows.slice(0)),stage){case"all":case"dataPipeline":for(var i=index;i<this.dataPipeline.length;i++){var result=this.dataPipeline[i].handler(this.activeRowsPipeline[i].slice(0));this.activeRowsPipeline[i+1]=result||this.activeRowsPipeline[i].slice(0)}this.setActiveRows(this.activeRowsPipeline[this.dataPipeline.length]);case"display":index=0,this.resetDisplayRows();case"displayPipeline":for(var _i=index;_i<this.displayPipeline.length;_i++){var _result=this.displayPipeline[_i].handler((_i?this.getDisplayRows(_i-1):this.activeRows).slice(0),renderInPosition);this.setDisplayRows(_result||this.getDisplayRows(_i-1).slice(0),_i)}case"end":this.regenerateRowPositions()}}},{key:"regenerateRowPositions",value:function regenerateRowPositions(){var rows=this.getDisplayRows(),index=1;rows.forEach((function(row){"row"===row.type&&(row.setPosition(index),index++)}))}},{key:"setActiveRows",value:function setActiveRows(activeRows){this.activeRows=activeRows,this.activeRowsCount=this.activeRows.length}},{key:"resetDisplayRows",value:function resetDisplayRows(){this.displayRows=[],this.displayRows.push(this.activeRows.slice(0)),this.displayRowsCount=this.displayRows[0].length}},{key:"getNextDisplayIndex",value:function getNextDisplayIndex(){return this.displayRows.length}},{key:"setDisplayRows",value:function setDisplayRows(displayRows,index){var output=!0;return index&&void 0!==this.displayRows[index]?(this.displayRows[index]=displayRows,output=!0):(this.displayRows.push(displayRows),output=index=this.displayRows.length-1),index==this.displayRows.length-1&&(this.displayRowsCount=this.displayRows[this.displayRows.length-1].length),output}},{key:"getDisplayRows",value:function getDisplayRows(index){return void 0===index?this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]:this.displayRows[index]||[]}},{key:"getVisibleRows",value:function getVisibleRows(chain,viewable){var rows=Object.assign([],this.renderer.visibleRows(!viewable));return chain&&(rows=this.chain("rows-visible",[viewable],rows,rows)),rows}},{key:"displayRowIterator",value:function displayRowIterator(callback){this.activeRowsPipeline.forEach(callback),this.displayRows.forEach(callback),this.displayRowsCount=this.displayRows[this.displayRows.length-1].length}},{key:"getRows",value:function getRows(type){var rows;switch(type){case"active":rows=this.activeRows;break;case"display":rows=this.table.rowManager.getDisplayRows();break;case"visible":rows=this.getVisibleRows(!1,!0);break;default:rows=this.chain("rows-retrieve",type,null,this.rows)||this.rows}return rows}},{key:"reRenderInPosition",value:function reRenderInPosition(callback){this.redrawBlock?callback?callback():this.redrawBlockRenderInPosition=!0:(this.dispatchExternal("renderStarted"),this.renderer.rerenderRows(callback),this.fixedHeight||this.adjustTableSize(),this.dispatchExternal("renderComplete"))}},{key:"initializeRenderer",value:function initializeRenderer(){var renderClass,renderers={virtual:VirtualDomVertical,basic:BasicVertical};(renderClass="string"==typeof this.table.options.renderVertical?renderers[this.table.options.renderVertical]:this.table.options.renderVertical)?(this.renderMode=this.table.options.renderVertical,this.renderer=new renderClass(this.table,this.element,this.tableElement),this.renderer.initialize(),this.table.element.clientHeight||this.table.options.height?this.fixedHeight=!0:this.fixedHeight=!1):console.error("Unable to find matching renderer:",this.table.options.renderVertical)}},{key:"getRenderMode",value:function getRenderMode(){return this.renderMode}},{key:"renderTable",value:function renderTable(){this.dispatchExternal("renderStarted"),this.element.scrollTop=0,this._clearTable(),this.displayRowsCount?(this.renderer.renderRows(),this.firstRender&&(this.firstRender=!1,this.layoutRefresh(!0))):this.renderEmptyScroll(),this.fixedHeight||this.adjustTableSize(),this.dispatch("table-layout"),this.displayRowsCount||this._showPlaceholder(),this.dispatchExternal("renderComplete")}},{key:"renderEmptyScroll",value:function renderEmptyScroll(){this.placeholder?this.tableElement.style.display="none":this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px"}},{key:"_clearTable",value:function _clearTable(){this._clearPlaceholder(),this.scrollTop=0,this.scrollLeft=0,this.tableElement.style.minWidth="",this.renderer.clearRows()}},{key:"_showPlaceholder",value:function _showPlaceholder(){this.placeholder&&(this.placeholder.setAttribute("tabulator-render-mode",this.renderMode),this.getElement().appendChild(this.placeholder),this._positionPlaceholder())}},{key:"_clearPlaceholder",value:function _clearPlaceholder(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder)}},{key:"_positionPlaceholder",value:function _positionPlaceholder(){this.placeholder&&this.placeholder.parentNode&&(this.placeholder.style.width=this.table.columnManager.getWidth()+"px",this.placeholderContents.style.width=this.table.rowManager.element.clientWidth+"px",this.placeholderContents.style.marginLeft=this.scrollLeft+"px")}},{key:"styleRow",value:function styleRow(row,index){var rowEl=row.getElement();index%2?(rowEl.classList.add("tabulator-row-even"),rowEl.classList.remove("tabulator-row-odd")):(rowEl.classList.add("tabulator-row-odd"),rowEl.classList.remove("tabulator-row-even"))}},{key:"normalizeHeight",value:function normalizeHeight(){this.activeRows.forEach((function(row){row.normalizeHeight()}))}},{key:"adjustTableSize",value:function adjustTableSize(){var initialHeight=this.element.clientHeight,minHeight;if(this.renderer&&"fill"===this.renderer.verticalFillMode){var otherHeight=Math.floor(this.table.columnManager.getElement().getBoundingClientRect().height+(this.table.footerManager&&this.table.footerManager.active&&!this.table.footerManager.external?this.table.footerManager.getElement().getBoundingClientRect().height:0));this.fixedHeight?(minHeight=isNaN(this.table.options.minHeight)?this.table.options.minHeight:this.table.options.minHeight+"px",this.element.style.minHeight=minHeight||"calc(100% - "+otherHeight+"px)",this.element.style.height="calc(100% - "+otherHeight+"px)",this.element.style.maxHeight="calc(100% - "+otherHeight+"px)"):(this.element.style.height="",this.element.style.height=this.table.element.clientHeight-otherHeight+"px",this.element.scrollTop=this.scrollTop),this.renderer.resize(),this.fixedHeight||initialHeight==this.element.clientHeight||(this.subscribed("table-resize")?this.dispatch("table-resize"):this.redraw())}this._positionPlaceholder()}},{key:"reinitialize",value:function reinitialize(){this.rows.forEach((function(row){row.reinitialize(!0)}))}},{key:"blockRedraw",value:function blockRedraw(){this.redrawBlock=!0,this.redrawBlockRestoreConfig=!1}},{key:"restoreRedraw",value:function restoreRedraw(){this.redrawBlock=!1,this.redrawBlockRestoreConfig?(this.refreshActiveData(this.redrawBlockRestoreConfig.handler,this.redrawBlockRestoreConfig.skipStage,this.redrawBlockRestoreConfig.renderInPosition),this.redrawBlockRestoreConfig=!1):this.redrawBlockRenderInPosition&&this.reRenderInPosition(),this.redrawBlockRenderInPosition=!1}},{key:"redraw",value:function redraw(force){var left=this.scrollLeft;this.adjustTableSize(),this.table.tableWidth=this.table.element.clientWidth,force?this.renderTable():(this.reRenderInPosition(),this.scrollHorizontal(left))}},{key:"resetScroll",value:function resetScroll(){if(this.element.scrollLeft=0,this.element.scrollTop=0,"ie"===this.table.browser){var event=document.createEvent("Event");event.initEvent("scroll",!1,!0),this.element.dispatchEvent(event)}else this.element.dispatchEvent(new Event("scroll"))}}]),RowManager}(CoreFeature),FooterManager=function(_CoreFeature){_inherits(FooterManager,_CoreFeature);var _super=_createSuper(FooterManager);function FooterManager(table){var _this;return _classCallCheck(this,FooterManager),(_this=_super.call(this,table)).active=!1,_this.element=_this.createElement(),_this.containerElement=_this.createContainerElement(),_this.external=!1,_this}return _createClass(FooterManager,[{key:"initialize",value:function initialize(){this.initializeElement()}},{key:"createElement",value:function createElement(){var el=document.createElement("div");return el.classList.add("tabulator-footer"),el}},{key:"createContainerElement",value:function createContainerElement(){var el=document.createElement("div");return el.classList.add("tabulator-footer-contents"),this.element.appendChild(el),el}},{key:"initializeElement",value:function initializeElement(){if(this.table.options.footerElement)switch(_typeof(this.table.options.footerElement)){case"string":"<"===this.table.options.footerElement[0]?this.containerElement.innerHTML=this.table.options.footerElement:(this.external=!0,this.containerElement=document.querySelector(this.table.options.footerElement));break;default:this.element=this.table.options.footerElement}}},{key:"getElement",value:function getElement(){return this.element}},{key:"append",value:function append(element){this.activate(),this.containerElement.appendChild(element),this.table.rowManager.adjustTableSize()}},{key:"prepend",value:function prepend(element){this.activate(),this.element.insertBefore(element,this.element.firstChild),this.table.rowManager.adjustTableSize()}},{key:"remove",value:function remove(element){element.parentNode.removeChild(element),this.deactivate()}},{key:"deactivate",value:function deactivate(force){this.element.firstChild&&!force||(this.external||this.element.parentNode.removeChild(this.element),this.active=!1)}},{key:"activate",value:function activate(){this.active||(this.active=!0,this.external||(this.table.element.appendChild(this.getElement()),this.table.element.style.display=""))}},{key:"redraw",value:function redraw(){this.dispatch("footer-redraw")}}]),FooterManager}(CoreFeature),InteractionManager=function(_CoreFeature){_inherits(InteractionManager,_CoreFeature);var _super=_createSuper(InteractionManager);function InteractionManager(table){var _this;return _classCallCheck(this,InteractionManager),(_this=_super.call(this,table)).el=null,_this.abortClasses=["tabulator-headers","tabulator-table"],_this.previousTargets={},_this.listeners=["click","dblclick","contextmenu","mouseenter","mouseleave","mouseover","mouseout","mousemove","touchstart","touchend"],_this.componentMap={"tabulator-cell":"cell","tabulator-row":"row","tabulator-group":"group","tabulator-col":"column"},_this.pseudoTrackers={row:{subscriber:null,target:null},cell:{subscriber:null,target:null},group:{subscriber:null,target:null},column:{subscriber:null,target:null}},_this.pseudoTracking=!1,_this}return _createClass(InteractionManager,[{key:"initialize",value:function initialize(){this.el=this.table.element,this.buildListenerMap(),this.bindSubscriptionWatchers()}},{key:"buildListenerMap",value:function buildListenerMap(){var listenerMap={};this.listeners.forEach((function(listener){listenerMap[listener]={handler:null,components:[]}})),this.listeners=listenerMap}},{key:"bindPseudoEvents",value:function bindPseudoEvents(){var _this2=this;Object.keys(this.pseudoTrackers).forEach((function(key){_this2.pseudoTrackers[key].subscriber=_this2.pseudoMouseEnter.bind(_this2,key),_this2.subscribe(key+"-mouseover",_this2.pseudoTrackers[key].subscriber)})),this.pseudoTracking=!0}},{key:"pseudoMouseEnter",value:function pseudoMouseEnter(key,e,target){this.pseudoTrackers[key].target!==target&&(this.pseudoTrackers[key].target&&this.dispatch(key+"-mouseleave",e,this.pseudoTrackers[key].target),this.pseudoMouseLeave(key,e),this.pseudoTrackers[key].target=target,this.dispatch(key+"-mouseenter",e,target))}},{key:"pseudoMouseLeave",value:function pseudoMouseLeave(key,e){var _this3=this,leaveList=Object.keys(this.pseudoTrackers),linkedKeys={row:["cell"],cell:["row"]};(leaveList=leaveList.filter((function(item){var links=linkedKeys[key];return item!==key&&(!links||links&&!links.includes(item))}))).forEach((function(key){var target=_this3.pseudoTrackers[key].target;_this3.pseudoTrackers[key].target&&(_this3.dispatch(key+"-mouseleave",e,target),_this3.pseudoTrackers[key].target=null)}))}},{key:"bindSubscriptionWatchers",value:function bindSubscriptionWatchers(){for(var listeners=Object.keys(this.listeners),components,_i=0,_components=Object.values(this.componentMap);_i<_components.length;_i++){var comp=_components[_i],_iterator=_createForOfIteratorHelper(listeners),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var listener=_step.value,key=comp+"-"+listener;this.subscriptionChange(key,this.subscriptionChanged.bind(this,comp,listener))}}catch(err){_iterator.e(err)}finally{_iterator.f()}}this.subscribe("table-destroy",this.clearWatchers.bind(this))}},{key:"subscriptionChanged",value:function subscriptionChanged(component,key,added){var listener=this.listeners[key].components,index=listener.indexOf(component),changed=!1;added?-1===index&&(listener.push(component),changed=!0):this.subscribed(component+"-"+key)||index>-1&&(listener.splice(index,1),changed=!0),"mouseenter"!==key&&"mouseleave"!==key||this.pseudoTracking||this.bindPseudoEvents(),changed&&this.updateEventListeners()}},{key:"updateEventListeners",value:function updateEventListeners(){for(var key in this.listeners){var listener=this.listeners[key];listener.components.length?listener.handler||(listener.handler=this.track.bind(this,key),this.el.addEventListener(key,listener.handler)):listener.handler&&(this.el.removeEventListener(key,listener.handler),listener.handler=null)}}},{key:"track",value:function track(type,e){var path=e.composedPath&&e.composedPath()||e.path,targets=this.findTargets(path);targets=this.bindComponents(type,targets),this.triggerEvents(type,e,targets),!this.pseudoTracking||"mouseover"!=type&&"mouseleave"!=type||Object.keys(targets).length||this.pseudoMouseLeave("none",e)}},{key:"findTargets",value:function findTargets(path){var _this4=this,targets={},componentMap=Object.keys(this.componentMap),_iterator2=_createForOfIteratorHelper(path),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var el=_step2.value,classList=el.classList?_toConsumableArray(el.classList):[],abort;if(classList.filter((function(item){return _this4.abortClasses.includes(item)})).length)break;var elTargets,_iterator3=_createForOfIteratorHelper(classList.filter((function(item){return componentMap.includes(item)}))),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var target=_step3.value;targets[this.componentMap[target]]||(targets[this.componentMap[target]]=el)}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}return targets.group&&targets.group===targets.row&&delete targets.row,targets}},{key:"bindComponents",value:function bindComponents(type,targets){var _this5=this,keys=Object.keys(targets).reverse(),listener=this.listeners[type],targetMatches={},_iterator4=_createForOfIteratorHelper(keys),_step4;try{var _loop=function _loop(){var key=_step4.value,component=void 0,target=targets[key],previousTarget=_this5.previousTargets[key];if(previousTarget&&previousTarget.target===target)component=previousTarget.component;else switch(key){case"row":case"group":var rows;if(listener.components.includes("row")||listener.components.includes("cell")||listener.components.includes("group"))component=_this5.table.rowManager.getVisibleRows(!0).find((function(row){return row.getElement()===target})),targets.row&&targets.row.parentNode&&targets.row.parentNode.closest(".tabulator-row")&&(targets[key]=!1);break;case"column":listener.components.includes("column")&&(component=_this5.table.columnManager.findColumn(target));break;case"cell":listener.components.includes("cell")&&(targets.row instanceof Row?component=targets.row.findCell(target):targets.row&&console.warn("Event Target Lookup Error - The row this cell is attached to cannot be found, has the table been reinitialized without being destroyed first?"))}component&&(targets[key]=component,targetMatches[key]={target:target,component:component})};for(_iterator4.s();!(_step4=_iterator4.n()).done;)_loop()}catch(err){_iterator4.e(err)}finally{_iterator4.f()}return this.previousTargets=targetMatches,targets}},{key:"triggerEvents",value:function triggerEvents(type,e,targets){var listener=this.listeners[type];for(var key in targets)targets[key]&&listener.components.includes(key)&&this.dispatch(key+"-"+type,e,targets[key])}},{key:"clearWatchers",value:function clearWatchers(){for(var key in this.listeners){var listener=this.listeners[key];listener.handler&&(this.el.removeEventListener(key,listener.handler),listener.handler=null)}}}]),InteractionManager}(CoreFeature),ComponentFunctionBinder=function(){function ComponentFunctionBinder(table){_classCallCheck(this,ComponentFunctionBinder),this.table=table,this.bindings={}}return _createClass(ComponentFunctionBinder,[{key:"bind",value:function bind(type,funcName,handler){this.bindings[type]||(this.bindings[type]={}),this.bindings[type][funcName]?console.warn("Unable to bind component handler, a matching function name is already bound",type,funcName,handler):this.bindings[type][funcName]=handler}},{key:"handle",value:function handle(type,component,name){if(this.bindings[type]&&this.bindings[type][name]&&"function"==typeof this.bindings[type][name].bind)return this.bindings[type][name].bind(null,component);"then"===name||"string"!=typeof name||name.startsWith("_")||this.table.options.debugInvalidComponentFuncs&&console.error("The "+type+" component does not have a "+name+" function, have you checked that you have the correct Tabulator module installed?")}}]),ComponentFunctionBinder}(),DataLoader=function(_CoreFeature){_inherits(DataLoader,_CoreFeature);var _super=_createSuper(DataLoader);function DataLoader(table){var _this;return _classCallCheck(this,DataLoader),(_this=_super.call(this,table)).requestOrder=0,_this.loading=!1,_this}return _createClass(DataLoader,[{key:"initialize",value:function initialize(){}},{key:"load",value:function load(data,params,config,replace,silent,columnsChanged){var _this2=this,requestNo=++this.requestOrder,result;return this.dispatchExternal("dataLoading",data),!data||0!=data.indexOf("{")&&0!=data.indexOf("[")||(data=JSON.parse(data)),this.confirm("data-loading",[data,params,config,silent])?(this.loading=!0,silent||this.alertLoader(),params=this.chain("data-params",[data,config,silent],params||{},params||{}),params=this.mapParams(params,this.table.options.dataSendParams),this.chain("data-load",[data,params,config,silent],!1,Promise.resolve([])).then((function(response){Array.isArray(response)||"object"!=_typeof(response)||(response=_this2.mapParams(response,_this2.objectInvert(_this2.table.options.dataReceiveParams)));var rowData=_this2.chain("data-loaded",response,null,response);requestNo==_this2.requestOrder?(_this2.clearAlert(),!1!==rowData&&(_this2.dispatchExternal("dataLoaded",rowData),_this2.table.rowManager.setData(rowData,replace,void 0===columnsChanged?!replace:columnsChanged))):console.warn("Data Load Response Blocked - An active data load request was blocked by an attempt to change table data while the request was being made")})).catch((function(error){console.error("Data Load Error: ",error),_this2.dispatchExternal("dataLoadError",error),silent||_this2.alertError(),setTimeout((function(){_this2.clearAlert()}),_this2.table.options.dataLoaderErrorTimeout)})).finally((function(){_this2.loading=!1}))):(this.dispatchExternal("dataLoaded",data),data||(data=[]),this.table.rowManager.setData(data,replace,void 0===columnsChanged?!replace:columnsChanged),Promise.resolve())}},{key:"mapParams",value:function mapParams(params,map){var output={};for(var key in params)output[map.hasOwnProperty(key)?map[key]:key]=params[key];return output}},{key:"objectInvert",value:function objectInvert(obj){var output={};for(var key in obj)output[obj[key]]=key;return output}},{key:"blockActiveLoad",value:function blockActiveLoad(){this.requestOrder++}},{key:"alertLoader",value:function alertLoader(){var shouldLoad;("function"==typeof this.table.options.dataLoader?this.table.options.dataLoader():this.table.options.dataLoader)&&this.table.alertManager.alert(this.table.options.dataLoaderLoading||this.langText("data|loading"))}},{key:"alertError",value:function alertError(){this.table.alertManager.alert(this.table.options.dataLoaderError||this.langText("data|error"),"error")}},{key:"clearAlert",value:function clearAlert(){this.table.alertManager.clear()}}]),DataLoader}(CoreFeature),ExternalEventBus=function(){function ExternalEventBus(table,optionsList,debug){_classCallCheck(this,ExternalEventBus),this.table=table,this.events={},this.optionsList=optionsList||{},this.subscriptionNotifiers={},this.dispatch=debug?this._debugDispatch.bind(this):this._dispatch.bind(this),this.debug=debug}return _createClass(ExternalEventBus,[{key:"subscriptionChange",value:function subscriptionChange(key,callback){this.subscriptionNotifiers[key]||(this.subscriptionNotifiers[key]=[]),this.subscriptionNotifiers[key].push(callback),this.subscribed(key)&&this._notifySubscriptionChange(key,!0)}},{key:"subscribe",value:function subscribe(key,callback){this.events[key]||(this.events[key]=[]),this.events[key].push(callback),this._notifySubscriptionChange(key,!0)}},{key:"unsubscribe",value:function unsubscribe(key,callback){var index;if(this.events[key]){if(callback){if(!((index=this.events[key].findIndex((function(item){return item===callback})))>-1))return void console.warn("Cannot remove event, no matching event found:",key,callback);this.events[key].splice(index,1)}else delete this.events[key];this._notifySubscriptionChange(key,!1)}else console.warn("Cannot remove event, no events set on:",key)}},{key:"subscribed",value:function subscribed(key){return this.events[key]&&this.events[key].length}},{key:"_notifySubscriptionChange",value:function _notifySubscriptionChange(key,subscribed){var notifiers=this.subscriptionNotifiers[key];notifiers&&notifiers.forEach((function(callback){callback(subscribed)}))}},{key:"_dispatch",value:function _dispatch(){var _this=this,args=Array.from(arguments),key=args.shift(),result;return this.events[key]&&this.events[key].forEach((function(callback,i){var callResult=callback.apply(_this.table,args);i||(result=callResult)})),result}},{key:"_debugDispatch",value:function _debugDispatch(){var args=Array.from(arguments),key=args[0],_console;(args[0]="ExternalEvent:"+args[0],!0===this.debug||this.debug.includes(key))&&(_console=console).log.apply(_console,_toConsumableArray(args));return this._dispatch.apply(this,arguments)}}]),ExternalEventBus}(),InternalEventBus=function(){function InternalEventBus(debug){_classCallCheck(this,InternalEventBus),this.events={},this.subscriptionNotifiers={},this.dispatch=debug?this._debugDispatch.bind(this):this._dispatch.bind(this),this.chain=debug?this._debugChain.bind(this):this._chain.bind(this),this.confirm=debug?this._debugConfirm.bind(this):this._confirm.bind(this),this.debug=debug}return _createClass(InternalEventBus,[{key:"subscriptionChange",value:function subscriptionChange(key,callback){this.subscriptionNotifiers[key]||(this.subscriptionNotifiers[key]=[]),this.subscriptionNotifiers[key].push(callback),this.subscribed(key)&&this._notifySubscriptionChange(key,!0)}},{key:"subscribe",value:function subscribe(key,callback){var priority=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e4;this.events[key]||(this.events[key]=[]),this.events[key].push({callback:callback,priority:priority}),this.events[key].sort((function(a,b){return a.priority-b.priority})),this._notifySubscriptionChange(key,!0)}},{key:"unsubscribe",value:function unsubscribe(key,callback){var index;if(this.events[key]){if(callback){if(!((index=this.events[key].findIndex((function(item){return item.callback===callback})))>-1))return void console.warn("Cannot remove event, no matching event found:",key,callback);this.events[key].splice(index,1)}this._notifySubscriptionChange(key,!1)}else console.warn("Cannot remove event, no events set on:",key)}},{key:"subscribed",value:function subscribed(key){return this.events[key]&&this.events[key].length}},{key:"_chain",value:function _chain(key,args,initialValue,fallback){var _this=this,value=initialValue;return Array.isArray(args)||(args=[args]),this.subscribed(key)?(this.events[key].forEach((function(subscriber,i){value=subscriber.callback.apply(_this,args.concat([value]))})),value):"function"==typeof fallback?fallback():fallback}},{key:"_confirm",value:function _confirm(key,args){var _this2=this,confirmed=!1;return Array.isArray(args)||(args=[args]),this.subscribed(key)&&this.events[key].forEach((function(subscriber,i){subscriber.callback.apply(_this2,args)&&(confirmed=!0)})),confirmed}},{key:"_notifySubscriptionChange",value:function _notifySubscriptionChange(key,subscribed){var notifiers=this.subscriptionNotifiers[key];notifiers&&notifiers.forEach((function(callback){callback(subscribed)}))}},{key:"_dispatch",value:function _dispatch(){var _this3=this,args=Array.from(arguments),key=args.shift();this.events[key]&&this.events[key].forEach((function(subscriber){subscriber.callback.apply(_this3,args)}))}},{key:"_debugDispatch",value:function _debugDispatch(){var args=Array.from(arguments),key=args[0],_console;(args[0]="InternalEvent:"+key,!0===this.debug||this.debug.includes(key))&&(_console=console).log.apply(_console,_toConsumableArray(args));return this._dispatch.apply(this,arguments)}},{key:"_debugChain",value:function _debugChain(){var args=Array.from(arguments),key=args[0],_console2;(args[0]="InternalEvent:"+key,!0===this.debug||this.debug.includes(key))&&(_console2=console).log.apply(_console2,_toConsumableArray(args));return this._chain.apply(this,arguments)}},{key:"_debugConfirm",value:function _debugConfirm(){var args=Array.from(arguments),key=args[0],_console3;(args[0]="InternalEvent:"+key,!0===this.debug||this.debug.includes(key))&&(_console3=console).log.apply(_console3,_toConsumableArray(args));return this._confirm.apply(this,arguments)}}]),InternalEventBus}(),DeprecationAdvisor=function(_CoreFeature){_inherits(DeprecationAdvisor,_CoreFeature);var _super=_createSuper(DeprecationAdvisor);function DeprecationAdvisor(table){return _classCallCheck(this,DeprecationAdvisor),_super.call(this,table)}return _createClass(DeprecationAdvisor,[{key:"_warnUser",value:function _warnUser(){var _console;this.options("debugDeprecation")&&(_console=console).warn.apply(_console,arguments)}},{key:"check",value:function check(oldOption,newOption){var msg="";return void 0===this.options(oldOption)||(msg="Deprecated Setup Option - Use of the %c"+oldOption+"%c option is now deprecated",newOption?(msg=msg+", Please use the %c"+newOption+"%c option instead",this._warnUser(msg,"font-weight: bold;","font-weight: normal;","font-weight: bold;","font-weight: normal;")):this._warnUser(msg,"font-weight: bold;","font-weight: normal;"),!1)}},{key:"checkMsg",value:function checkMsg(oldOption,msg){return void 0===this.options(oldOption)||(this._warnUser("%cDeprecated Setup Option - Use of the %c"+oldOption+" %c option is now deprecated, "+msg,"font-weight: normal;","font-weight: bold;","font-weight: normal;"),!1)}},{key:"msg",value:function msg(_msg){this._warnUser(_msg)}}]),DeprecationAdvisor}(CoreFeature),TableRegistry=function(){function TableRegistry(){_classCallCheck(this,TableRegistry)}return _createClass(TableRegistry,null,[{key:"register",value:function register(table){TableRegistry.tables.push(table)}},{key:"deregister",value:function deregister(table){var index=TableRegistry.tables.indexOf(table);index>-1&&TableRegistry.tables.splice(index,1)}},{key:"lookupTable",value:function lookupTable(query,silent){var results=[],matches,match;if("string"==typeof query){if((matches=document.querySelectorAll(query)).length)for(var i=0;i<matches.length;i++)(match=TableRegistry.matchElement(matches[i]))&&results.push(match)}else"undefined"!=typeof HTMLElement&&query instanceof HTMLElement||query instanceof Tabulator?(match=TableRegistry.matchElement(query))&&results.push(match):Array.isArray(query)?query.forEach((function(item){results=results.concat(TableRegistry.lookupTable(item))})):silent||console.warn("Table Connection Error - Invalid Selector",query);return results}},{key:"matchElement",value:function matchElement(element){return TableRegistry.tables.find((function(table){return element instanceof Tabulator?table===element:table.element===element}))}}]),TableRegistry}();TableRegistry.tables=[];var Popup=function(_CoreFeature){_inherits(Popup,_CoreFeature);var _super=_createSuper(Popup);function Popup(table,element,parent){var _this;return _classCallCheck(this,Popup),(_this=_super.call(this,table)).element=element,_this.container=_this._lookupContainer(),_this.parent=parent,_this.reversedX=!1,_this.childPopup=null,_this.blurable=!1,_this.blurCallback=null,_this.renderedCallback=null,_this.visible=!1,_this.hideable=!0,_this.element.classList.add("tabulator-popup-container"),_this.blurEvent=_this.hide.bind(_assertThisInitialized(_this),!1),_this.escEvent=_this._escapeCheck.bind(_assertThisInitialized(_this)),_this.destroyBinding=_this.tableDestroyed,_this.destroyed=!1,_this}return _createClass(Popup,[{key:"tableDestroyed",value:function tableDestroyed(){this.destroyed=!0,this.hide(!0)}},{key:"_lookupContainer",value:function _lookupContainer(){var container=this.table.options.popupContainer;return"string"==typeof container?(container=document.querySelector(container))||console.warn("Menu Error - no container element found matching selector:",this.table.options.popupContainer,"(defaulting to document body)"):!0===container&&(container=this.table.element),container&&!this._checkContainerIsParent(container)&&(container=!1,console.warn("Menu Error - container element does not contain this table:",this.table.options.popupContainer,"(defaulting to document body)")),container||(container=document.body),container}},{key:"_checkContainerIsParent",value:function _checkContainerIsParent(container){var element=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.table.element;return container===element||!!element.parentNode&&this._checkContainerIsParent(container,element.parentNode)}},{key:"renderCallback",value:function renderCallback(callback){this.renderedCallback=callback}},{key:"containerEventCoords",value:function containerEventCoords(e){var touch=!(e instanceof MouseEvent),x=touch?e.touches[0].pageX:e.pageX,y=touch?e.touches[0].pageY:e.pageY;if(this.container!==document.body){var parentOffset=Helpers.elOffset(this.container);x-=parentOffset.left,y-=parentOffset.top}return{x:x,y:y}}},{key:"elementPositionCoords",value:function elementPositionCoords(element){var position=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"right",offset=Helpers.elOffset(element),containerOffset,x,y;switch(this.container!==document.body&&(containerOffset=Helpers.elOffset(this.container),offset.left-=containerOffset.left,offset.top-=containerOffset.top),position){case"right":x=offset.left+element.offsetWidth,y=offset.top-1;break;case"bottom":x=offset.left,y=offset.top+element.offsetHeight}return{x:x,y:y,offset:offset}}},{key:"show",value:function show(origin,position){var x,y,parentEl,parentOffset,coords;return this.destroyed||this.table.destroyed?this:(origin instanceof HTMLElement?(parentEl=origin,parentOffset=(coords=this.elementPositionCoords(origin,position)).offset,x=coords.x,y=coords.y):"number"==typeof origin?(parentOffset={top:0,left:0},x=origin,y=position):(x=(coords=this.containerEventCoords(origin)).x,y=coords.y,this.reversedX=!1),this.element.style.top=y+"px",this.element.style.left=x+"px",this.container.appendChild(this.element),"function"==typeof this.renderedCallback&&this.renderedCallback(),this._fitToScreen(x,y,parentEl,parentOffset,position),this.visible=!0,this.subscribe("table-destroy",this.destroyBinding),this.element.addEventListener("mousedown",(function(e){e.stopPropagation()})),this)}},{key:"_fitToScreen",value:function _fitToScreen(x,y,parentEl,parentOffset,position){var scrollTop=this.container===document.body?document.documentElement.scrollTop:this.container.scrollTop;if((x+this.element.offsetWidth>=this.container.offsetWidth||this.reversedX)&&(this.element.style.left="",this.element.style.right=parentEl?this.container.offsetWidth-parentOffset.left+"px":this.container.offsetWidth-x+"px",this.reversedX=!0),y+this.element.offsetHeight>Math.max(this.container.offsetHeight,scrollTop?this.container.scrollHeight:0))if(parentEl)switch(position){case"bottom":this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight-parentEl.offsetHeight-1+"px";break;default:this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+parentEl.offsetHeight+1+"px"}else this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+"px"}},{key:"isVisible",value:function isVisible(){return this.visible}},{key:"hideOnBlur",value:function hideOnBlur(callback){var _this2=this;return this.blurable=!0,this.visible&&(setTimeout((function(){_this2.table.rowManager.element.addEventListener("scroll",_this2.blurEvent),_this2.subscribe("cell-editing",_this2.blurEvent),document.body.addEventListener("click",_this2.blurEvent),document.body.addEventListener("contextmenu",_this2.blurEvent),document.body.addEventListener("mousedown",_this2.blurEvent),window.addEventListener("resize",_this2.blurEvent),document.body.addEventListener("keydown",_this2.escEvent)}),100),this.blurCallback=callback),this}},{key:"_escapeCheck",value:function _escapeCheck(e){27==e.keyCode&&this.hide()}},{key:"blockHide",value:function blockHide(){this.hideable=!1}},{key:"restoreHide",value:function restoreHide(){this.hideable=!0}},{key:"hide",value:function hide(){var silent=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.visible&&this.hideable&&(this.blurable&&(document.body.removeEventListener("keydown",this.escEvent),document.body.removeEventListener("click",this.blurEvent),document.body.removeEventListener("contextmenu",this.blurEvent),document.body.removeEventListener("mousedown",this.blurEvent),window.removeEventListener("resize",this.blurEvent),this.table.rowManager.element.removeEventListener("scroll",this.blurEvent),this.unsubscribe("cell-editing",this.blurEvent)),this.childPopup&&this.childPopup.hide(),this.parent&&(this.parent.childPopup=null),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.visible=!1,this.blurCallback&&!silent&&this.blurCallback(),this.unsubscribe("table-destroy",this.destroyBinding)),this}},{key:"child",value:function child(element){return this.childPopup&&this.childPopup.hide(),this.childPopup=new Popup(this.table,element,this),this.childPopup}}]),Popup}(CoreFeature),Module=function(_CoreFeature){_inherits(Module,_CoreFeature);var _super=_createSuper(Module);function Module(table,name){var _this;return _classCallCheck(this,Module),(_this=_super.call(this,table))._handler=null,_this}return _createClass(Module,[{key:"initialize",value:function initialize(){}},{key:"registerTableOption",value:function registerTableOption(key,value){this.table.optionsList.register(key,value)}},{key:"registerColumnOption",value:function registerColumnOption(key,value){this.table.columnManager.optionsList.register(key,value)}},{key:"registerTableFunction",value:function registerTableFunction(name,func){var _this2=this;void 0===this.table[name]?this.table[name]=function(){return _this2.table.initGuard(name),func.apply(void 0,arguments)}:console.warn("Unable to bind table function, name already in use",name)}},{key:"registerComponentFunction",value:function registerComponentFunction(component,func,handler){return this.table.componentFunctionBinder.bind(component,func,handler)}},{key:"registerDataHandler",value:function registerDataHandler(handler,priority){this.table.rowManager.registerDataPipelineHandler(handler,priority),this._handler=handler}},{key:"registerDisplayHandler",value:function registerDisplayHandler(handler,priority){this.table.rowManager.registerDisplayPipelineHandler(handler,priority),this._handler=handler}},{key:"refreshData",value:function refreshData(renderInPosition,handler){handler||(handler=this._handler),handler&&this.table.rowManager.refreshActiveData(handler,!1,renderInPosition)}},{key:"footerAppend",value:function footerAppend(element){return this.table.footerManager.append(element)}},{key:"footerPrepend",value:function footerPrepend(element){return this.table.footerManager.prepend(element)}},{key:"footerRemove",value:function footerRemove(element){return this.table.footerManager.remove(element)}},{key:"popup",value:function popup(menuEl,menuContainer){return new Popup(this.table,menuEl,menuContainer)}},{key:"alert",value:function alert(content,type){return this.table.alertManager.alert(content,type)}},{key:"clearAlert",value:function clearAlert(){return this.table.alertManager.clear()}}]),Module}(CoreFeature);function fitData(columns,forced){forced&&this.table.columnManager.renderer.reinitializeColumnWidths(columns),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function fitDataGeneral(columns,forced){columns.forEach((function(column){column.reinitializeWidth()})),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function fitDataStretch(columns,forced){var _this=this,colsWidth=0,tableWidth=this.table.rowManager.element.clientWidth,gap=0,lastCol=!1;columns.forEach((function(column,i){column.widthFixed||column.reinitializeWidth(),(_this.table.options.responsiveLayout?column.modules.responsive.visible:column.visible)&&(lastCol=column),column.visible&&(colsWidth+=column.getWidth())})),lastCol?(gap=tableWidth-colsWidth+lastCol.getWidth(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&(lastCol.setWidth(0),this.table.modules.responsiveLayout.update()),gap>0?lastCol.setWidth(gap):lastCol.reinitializeWidth()):this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function fitColumns(columns,forced){var totalWidth=this.table.rowManager.element.getBoundingClientRect().width,fixedWidth=0,flexWidth=0,flexGrowUnits=0,flexColWidth=0,flexColumns=[],fixedShrinkColumns=[],flexShrinkUnits=0,overflowWidth=0,gapFill=0;function calcWidth(width){var colWidth;return colWidth="string"==typeof width?width.indexOf("%")>-1?totalWidth/100*parseInt(width):parseInt(width):width}function scaleColumns(columns,freeSpace,colWidth,shrinkCols){var oversizeCols=[],oversizeSpace=0,remainingSpace=0,nextColWidth=0,remainingFlexGrowUnits=flexGrowUnits,gap=0,changeUnits=0,undersizeCols=[];function calcGrow(col){return colWidth*(col.column.definition.widthGrow||1)}function calcShrink(col){return calcWidth(col.width)-colWidth*(col.column.definition.widthShrink||0)}return columns.forEach((function(col,i){var width=shrinkCols?calcShrink(col):calcGrow(col);col.column.minWidth>=width?oversizeCols.push(col):col.column.maxWidth&&col.column.maxWidth<width?(col.width=col.column.maxWidth,freeSpace-=col.column.maxWidth,(remainingFlexGrowUnits-=shrinkCols?col.column.definition.widthShrink||1:col.column.definition.widthGrow||1)&&(colWidth=Math.floor(freeSpace/remainingFlexGrowUnits))):(undersizeCols.push(col),changeUnits+=shrinkCols?col.column.definition.widthShrink||1:col.column.definition.widthGrow||1)})),oversizeCols.length?(oversizeCols.forEach((function(col){oversizeSpace+=shrinkCols?col.width-col.column.minWidth:col.column.minWidth,col.width=col.column.minWidth})),remainingSpace=freeSpace-oversizeSpace,nextColWidth=changeUnits?Math.floor(remainingSpace/changeUnits):remainingSpace,gap=scaleColumns(undersizeCols,remainingSpace,nextColWidth,shrinkCols)):(gap=changeUnits?freeSpace-Math.floor(freeSpace/changeUnits)*changeUnits:freeSpace,undersizeCols.forEach((function(column){column.width=shrinkCols?calcShrink(column):calcGrow(column)}))),gap}this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update(),this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(totalWidth-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),columns.forEach((function(column){var width,minWidth,colWidth;column.visible&&(width=column.definition.width,minWidth=parseInt(column.minWidth),width?(colWidth=calcWidth(width),fixedWidth+=colWidth>minWidth?colWidth:minWidth,column.definition.widthShrink&&(fixedShrinkColumns.push({column:column,width:colWidth>minWidth?colWidth:minWidth}),flexShrinkUnits+=column.definition.widthShrink)):(flexColumns.push({column:column,width:0}),flexGrowUnits+=column.definition.widthGrow||1))})),flexWidth=totalWidth-fixedWidth,flexColWidth=Math.floor(flexWidth/flexGrowUnits),gapFill=scaleColumns(flexColumns,flexWidth,flexColWidth,!1),flexColumns.length&&gapFill>0&&(flexColumns[flexColumns.length-1].width+=gapFill),flexColumns.forEach((function(col){flexWidth-=col.width})),(overflowWidth=Math.abs(gapFill)+flexWidth)>0&&flexShrinkUnits&&(gapFill=scaleColumns(fixedShrinkColumns,overflowWidth,Math.floor(overflowWidth/flexShrinkUnits),!0)),gapFill&&fixedShrinkColumns.length&&(fixedShrinkColumns[fixedShrinkColumns.length-1].width-=gapFill),flexColumns.forEach((function(col){col.column.setWidth(col.width)})),fixedShrinkColumns.forEach((function(col){col.column.setWidth(col.width)}))}var defaultModes={fitData:fitData,fitDataFill:fitDataGeneral,fitDataTable:fitDataGeneral,fitDataStretch:fitDataStretch,fitColumns:fitColumns},Layout=function(_Module){_inherits(Layout,_Module);var _super=_createSuper(Layout);function Layout(table){var _this;return _classCallCheck(this,Layout),(_this=_super.call(this,table,"layout")).mode=null,_this.registerTableOption("layout","fitData"),_this.registerTableOption("layoutColumnsOnNewData",!1),_this.registerColumnOption("widthGrow"),_this.registerColumnOption("widthShrink"),_this}return _createClass(Layout,[{key:"initialize",value:function initialize(){var layout=this.table.options.layout;Layout.modes[layout]?this.mode=layout:(console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+layout),this.mode="fitData"),this.table.element.setAttribute("tabulator-layout",this.mode)}},{key:"getMode",value:function getMode(){return this.mode}},{key:"layout",value:function layout(dataChanged){this.dispatch("layout-refreshing"),Layout.modes[this.mode].call(this,this.table.columnManager.columnsByIndex,dataChanged),this.dispatch("layout-refreshed")}}]),Layout}(Module);Layout.moduleName="layout",Layout.modes=defaultModes;var defaultLangs={default:{groups:{item:"item",items:"items"},columns:{},data:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All",counter:{showing:"Showing",of:"of",rows:"rows",pages:"pages"}},headerFilters:{default:"filter column...",columns:{}}}},Localize=function(_Module){_inherits(Localize,_Module);var _super=_createSuper(Localize);function Localize(table){var _this;return _classCallCheck(this,Localize),(_this=_super.call(this,table)).locale="default",_this.lang=!1,_this.bindings={},_this.langList={},_this.registerTableOption("locale",!1),_this.registerTableOption("langs",{}),_this}return _createClass(Localize,[{key:"initialize",value:function initialize(){for(var locale in this.langList=Helpers.deepClone(Localize.langs),!1!==this.table.options.columnDefaults.headerFilterPlaceholder&&this.setHeaderFilterPlaceholder(this.table.options.columnDefaults.headerFilterPlaceholder),this.table.options.langs)this.installLang(locale,this.table.options.langs[locale]);this.setLocale(this.table.options.locale),this.registerTableFunction("setLocale",this.setLocale.bind(this)),this.registerTableFunction("getLocale",this.getLocale.bind(this)),this.registerTableFunction("getLang",this.getLang.bind(this))}},{key:"setHeaderFilterPlaceholder",value:function setHeaderFilterPlaceholder(placeholder){this.langList.default.headerFilters.default=placeholder}},{key:"setHeaderFilterColumnPlaceholder",value:function setHeaderFilterColumnPlaceholder(column,placeholder){this.langList.default.headerFilters.columns[column]=placeholder,this.lang&&!this.lang.headerFilters.columns[column]&&(this.lang.headerFilters.columns[column]=placeholder)}},{key:"installLang",value:function installLang(locale,lang){this.langList[locale]?this._setLangProp(this.langList[locale],lang):this.langList[locale]=lang}},{key:"_setLangProp",value:function _setLangProp(lang,values){for(var key in values)lang[key]&&"object"==_typeof(lang[key])?this._setLangProp(lang[key],values[key]):lang[key]=values[key]}},{key:"setLocale",value:function setLocale(desiredLocale){function traverseLang(trans,path){for(var prop in trans)"object"==_typeof(trans[prop])?(path[prop]||(path[prop]={}),traverseLang(trans[prop],path[prop])):path[prop]=trans[prop]}if(!0===(desiredLocale=desiredLocale||"default")&&navigator.language&&(desiredLocale=navigator.language.toLowerCase()),desiredLocale&&!this.langList[desiredLocale]){var prefix=desiredLocale.split("-")[0];this.langList[prefix]?(console.warn("Localization Error - Exact matching locale not found, using closest match: ",desiredLocale,prefix),desiredLocale=prefix):(console.warn("Localization Error - Matching locale not found, using default: ",desiredLocale),desiredLocale="default")}this.locale=desiredLocale,this.lang=Helpers.deepClone(this.langList.default||{}),"default"!=desiredLocale&&traverseLang(this.langList[desiredLocale],this.lang),this.dispatchExternal("localized",this.locale,this.lang),this._executeBindings()}},{key:"getLocale",value:function getLocale(locale){return this.locale}},{key:"getLang",value:function getLang(locale){return locale?this.langList[locale]:this.lang}},{key:"getText",value:function getText(path,value){var fillPath,pathArray=(value?path+"|"+value:path).split("|"),text;return this._getLangElement(pathArray,this.locale)||""}},{key:"_getLangElement",value:function _getLangElement(path,locale){var root=this.lang;return path.forEach((function(level){var rootPath;root&&(rootPath=root[level],root=void 0!==rootPath&&rootPath)})),root}},{key:"bind",value:function bind(path,callback){this.bindings[path]||(this.bindings[path]=[]),this.bindings[path].push(callback),callback(this.getText(path),this.lang)}},{key:"_executeBindings",value:function _executeBindings(){var _this2=this,_loop=function _loop(path){_this2.bindings[path].forEach((function(binding){binding(_this2.getText(path),_this2.lang)}))};for(var path in this.bindings)_loop(path)}}]),Localize}(Module);Localize.moduleName="localize",Localize.langs=defaultLangs;var Comms=function(_Module){_inherits(Comms,_Module);var _super=_createSuper(Comms);function Comms(table){return _classCallCheck(this,Comms),_super.call(this,table)}return _createClass(Comms,[{key:"initialize",value:function initialize(){this.registerTableFunction("tableComms",this.receive.bind(this))}},{key:"getConnections",value:function getConnections(selectors){var _this=this,connections=[],connection;return(connection=TableRegistry.lookupTable(selectors)).forEach((function(con){_this.table!==con&&connections.push(con)})),connections}},{key:"send",value:function send(selectors,module,action,data){var _this2=this,connections=this.getConnections(selectors);connections.forEach((function(connection){connection.tableComms(_this2.table.element,module,action,data)})),!connections.length&&selectors&&console.warn("Table Connection Error - No tables matching selector found",selectors)}},{key:"receive",value:function receive(table,module,action,data){if(this.table.modExists(module))return this.table.modules[module].commsReceived(table,action,data);console.warn("Inter-table Comms Error - no such module:",module)}}]),Comms}(Module);Comms.moduleName="comms";var coreModules=Object.freeze({__proto__:null,LayoutModule:Layout,LocalizeModule:Localize,CommsModule:Comms}),ModuleBinder=function(){function ModuleBinder(tabulator,modules){_classCallCheck(this,ModuleBinder),this.bindStaticFunctionality(tabulator),this.bindModules(tabulator,coreModules,!0),modules&&this.bindModules(tabulator,modules)}return _createClass(ModuleBinder,[{key:"bindStaticFunctionality",value:function bindStaticFunctionality(tabulator){tabulator.moduleBindings={},tabulator.extendModule=function(name,property,values){if(tabulator.moduleBindings[name]){var source=tabulator.moduleBindings[name][property];if(source)if("object"==_typeof(values))for(var key in values)source[key]=values[key];else console.warn("Module Error - Invalid value type, it must be an object");else console.warn("Module Error - property does not exist:",property)}else console.warn("Module Error - module does not exist:",name)},tabulator.registerModule=function(modules){Array.isArray(modules)||(modules=[modules]),modules.forEach((function(mod){tabulator.registerModuleBinding(mod)}))},tabulator.registerModuleBinding=function(mod){tabulator.moduleBindings[mod.moduleName]=mod},tabulator.findTable=function(query){var results=TableRegistry.lookupTable(query,!0);return!(Array.isArray(results)&&!results.length)&&results},tabulator.prototype.bindModules=function(){var orderedStartMods=[],orderedEndMods=[],unOrderedMods=[];for(var name in this.modules={},tabulator.moduleBindings){var mod=tabulator.moduleBindings[name],module=new mod(this);this.modules[name]=module,mod.prototype.moduleCore?this.modulesCore.push(module):mod.moduleInitOrder?mod.moduleInitOrder<0?orderedStartMods.push(module):orderedEndMods.push(module):unOrderedMods.push(module)}orderedStartMods.sort((function(a,b){return a.moduleInitOrder>b.moduleInitOrder?1:-1})),orderedEndMods.sort((function(a,b){return a.moduleInitOrder>b.moduleInitOrder?1:-1})),this.modulesRegular=orderedStartMods.concat(unOrderedMods.concat(orderedEndMods))}}},{key:"bindModules",value:function bindModules(tabulator,modules,core){var mods=Object.values(modules);core&&mods.forEach((function(mod){mod.prototype.moduleCore=!0})),tabulator.registerModule(mods)}}]),ModuleBinder}(),Alert=function(_CoreFeature){_inherits(Alert,_CoreFeature);var _super=_createSuper(Alert);function Alert(table){var _this;return _classCallCheck(this,Alert),(_this=_super.call(this,table)).element=_this._createAlertElement(),_this.msgElement=_this._createMsgElement(),_this.type=null,_this.element.appendChild(_this.msgElement),_this}return _createClass(Alert,[{key:"_createAlertElement",value:function _createAlertElement(){var el=document.createElement("div");return el.classList.add("tabulator-alert"),el}},{key:"_createMsgElement",value:function _createMsgElement(){var el=document.createElement("div");return el.classList.add("tabulator-alert-msg"),el.setAttribute("role","alert"),el}},{key:"_typeClass",value:function _typeClass(){return"tabulator-alert-state-"+this.type}},{key:"alert",value:function alert(content){var type=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"msg";if(content){for(this.clear(),this.type=type;this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.add(this._typeClass()),"function"==typeof content&&(content=content()),content instanceof HTMLElement?this.msgElement.appendChild(content):this.msgElement.innerHTML=content,this.table.element.appendChild(this.element)}}},{key:"clear",value:function clear(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.msgElement.classList.remove(this._typeClass())}}]),Alert}(CoreFeature),Tabulator=function(){function Tabulator(element,options){var _this=this;_classCallCheck(this,Tabulator),this.options={},this.columnManager=null,this.rowManager=null,this.footerManager=null,this.alertManager=null,this.vdomHoz=null,this.externalEvents=null,this.eventBus=null,this.interactionMonitor=!1,this.browser="",this.browserSlow=!1,this.browserMobile=!1,this.rtl=!1,this.originalElement=null,this.componentFunctionBinder=new ComponentFunctionBinder(this),this.dataLoader=!1,this.modules={},this.modulesCore=[],this.modulesRegular=[],this.deprecationAdvisor=new DeprecationAdvisor(this),this.optionsList=new OptionsList(this,"table constructor"),this.initialized=!1,this.destroyed=!1,this.initializeElement(element)&&(this.initializeCoreSystems(options),setTimeout((function(){_this._create()}))),TableRegistry.register(this)}return _createClass(Tabulator,[{key:"initializeElement",value:function initializeElement(element){return"undefined"!=typeof HTMLElement&&element instanceof HTMLElement?(this.element=element,!0):"string"==typeof element?(this.element=document.querySelector(element),!!this.element||(console.error("Tabulator Creation Error - no element found matching selector: ",element),!1)):(console.error("Tabulator Creation Error - Invalid element provided:",element),!1)}},{key:"initializeCoreSystems",value:function initializeCoreSystems(options){this.columnManager=new ColumnManager(this),this.rowManager=new RowManager(this),this.footerManager=new FooterManager(this),this.dataLoader=new DataLoader(this),this.alertManager=new Alert(this),this.bindModules(),this.options=this.optionsList.generate(Tabulator.defaultOptions,options),this._clearObjectPointers(),this._mapDeprecatedFunctionality(),this.externalEvents=new ExternalEventBus(this,this.options,this.options.debugEventsExternal),this.eventBus=new InternalEventBus(this.options.debugEventsInternal),this.interactionMonitor=new InteractionManager(this),this.dataLoader.initialize(),this.footerManager.initialize()}},{key:"_mapDeprecatedFunctionality",value:function _mapDeprecatedFunctionality(){}},{key:"_clearSelection",value:function _clearSelection(){this.element.classList.add("tabulator-block-select"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this.element.classList.remove("tabulator-block-select")}},{key:"_create",value:function _create(){this.externalEvents.dispatch("tableBuilding"),this.eventBus.dispatch("table-building"),this._rtlCheck(),this._buildElement(),this._initializeTable(),this._loadInitialData(),this.initialized=!0,this.externalEvents.dispatch("tableBuilt")}},{key:"_rtlCheck",value:function _rtlCheck(){var style=window.getComputedStyle(this.element);switch(this.options.textDirection){case"auto":if("rtl"!==style.direction)break;case"rtl":this.element.classList.add("tabulator-rtl"),this.rtl=!0;break;case"ltr":this.element.classList.add("tabulator-ltr");default:this.rtl=!1}}},{key:"_clearObjectPointers",value:function _clearObjectPointers(){this.options.columns=this.options.columns.slice(0),Array.isArray(this.options.data)&&!this.options.reactiveData&&(this.options.data=this.options.data.slice(0))}},{key:"_buildElement",value:function _buildElement(){var element=this.element,options=this.options,newElement;if("TABLE"===element.tagName){this.originalElement=this.element,newElement=document.createElement("div");var attributes=element.attributes;for(var i in attributes)"object"==_typeof(attributes[i])&&newElement.setAttribute(attributes[i].name,attributes[i].value);element.parentNode.replaceChild(newElement,element),this.element=element=newElement}for(element.classList.add("tabulator"),element.setAttribute("role","grid");element.firstChild;)element.removeChild(element.firstChild);options.height&&(options.height=isNaN(options.height)?options.height:options.height+"px",element.style.height=options.height),!1!==options.minHeight&&(options.minHeight=isNaN(options.minHeight)?options.minHeight:options.minHeight+"px",element.style.minHeight=options.minHeight),!1!==options.maxHeight&&(options.maxHeight=isNaN(options.maxHeight)?options.maxHeight:options.maxHeight+"px",element.style.maxHeight=options.maxHeight)}},{key:"_initializeTable",value:function _initializeTable(){var element=this.element,options=this.options;this.interactionMonitor.initialize(),this.columnManager.initialize(),this.rowManager.initialize(),this._detectBrowser(),this.modulesCore.forEach((function(mod){mod.initialize()})),element.appendChild(this.columnManager.getElement()),element.appendChild(this.rowManager.getElement()),options.footerElement&&this.footerManager.activate(),options.autoColumns&&options.data&&this.columnManager.generateColumnsFromRowData(this.options.data),this.modulesRegular.forEach((function(mod){mod.initialize()})),this.columnManager.setColumns(options.columns),this.eventBus.dispatch("table-built")}},{key:"_loadInitialData",value:function _loadInitialData(){this.dataLoader.load(this.options.data)}},{key:"destroy",value:function destroy(){var element=this.element;for(this.destroyed=!0,TableRegistry.deregister(this),this.eventBus.dispatch("table-destroy"),this.rowManager.rows.forEach((function(row){row.wipe()})),this.rowManager.rows=[],this.rowManager.activeRows=[],this.rowManager.displayRows=[];element.firstChild;)element.removeChild(element.firstChild);element.classList.remove("tabulator"),this.externalEvents.dispatch("tableDestroyed")}},{key:"_detectBrowser",value:function _detectBrowser(){var ua=navigator.userAgent||navigator.vendor||window.opera;ua.indexOf("Trident")>-1?(this.browser="ie",this.browserSlow=!0):ua.indexOf("Edge")>-1?(this.browser="edge",this.browserSlow=!0):ua.indexOf("Firefox")>-1?(this.browser="firefox",this.browserSlow=!1):(this.browser="other",this.browserSlow=!1),this.browserMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(ua)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(ua.slice(0,4))}},{key:"initGuard",value:function initGuard(func,msg){var stack,line;return this.options.debugInitialization&&!this.initialized&&(func||(func=" "==(line="Error"==(stack=(new Error).stack.split("\n"))[0]?stack[2]:stack[1])[0]?line.trim().split(" ")[1].split(".")[1]:line.trim().split("@")[0]),console.warn("Table Not Initialized - Calling the "+func+" function before the table is initialized may result in inconsistent behavior, Please wait for the `tableBuilt` event before calling this function."+(msg?" "+msg:""))),this.initialized}},{key:"blockRedraw",value:function blockRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-blocking"),this.rowManager.blockRedraw(),this.columnManager.blockRedraw(),this.eventBus.dispatch("redraw-blocked")}},{key:"restoreRedraw",value:function restoreRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-restoring"),this.rowManager.restoreRedraw(),this.columnManager.restoreRedraw(),this.eventBus.dispatch("redraw-restored")}},{key:"setData",value:function setData(data,params,config){return this.initGuard(!1,"To set initial data please use the 'data' property in the table constructor."),this.dataLoader.load(data,params,config,!1)}},{key:"clearData",value:function clearData(){this.initGuard(),this.dataLoader.blockActiveLoad(),this.rowManager.clearData()}},{key:"getData",value:function getData(active){return this.rowManager.getData(active)}},{key:"getDataCount",value:function getDataCount(active){return this.rowManager.getDataCount(active)}},{key:"replaceData",value:function replaceData(data,params,config){return this.initGuard(),this.dataLoader.load(data,params,config,!0,!0)}},{key:"updateData",value:function updateData(data){var _this2=this,responses=0;return this.initGuard(),new Promise((function(resolve,reject){_this2.dataLoader.blockActiveLoad(),"string"==typeof data&&(data=JSON.parse(data)),data?data.forEach((function(item){var row=_this2.rowManager.findRow(item[_this2.options.index]);row&&(responses++,row.updateData(item).then((function(){--responses||resolve()})))})):(console.warn("Update Error - No data provided"),reject("Update Error - No data provided"))}))}},{key:"addData",value:function addData(data,pos,index){var _this3=this;return this.initGuard(),new Promise((function(resolve,reject){_this3.dataLoader.blockActiveLoad(),"string"==typeof data&&(data=JSON.parse(data)),data?_this3.rowManager.addRows(data,pos,index).then((function(rows){var output=[];rows.forEach((function(row){output.push(row.getComponent())})),resolve(output)})):(console.warn("Update Error - No data provided"),reject("Update Error - No data provided"))}))}},{key:"updateOrAddData",value:function updateOrAddData(data){var _this4=this,rows=[],responses=0;return this.initGuard(),new Promise((function(resolve,reject){_this4.dataLoader.blockActiveLoad(),"string"==typeof data&&(data=JSON.parse(data)),data?data.forEach((function(item){var row=_this4.rowManager.findRow(item[_this4.options.index]);responses++,row?row.updateData(item).then((function(){responses--,rows.push(row.getComponent()),responses||resolve(rows)})):_this4.rowManager.addRows(item).then((function(newRows){responses--,rows.push(newRows[0].getComponent()),responses||resolve(rows)}))})):(console.warn("Update Error - No data provided"),reject("Update Error - No data provided"))}))}},{key:"getRow",value:function getRow(index){var row=this.rowManager.findRow(index);return row?row.getComponent():(console.warn("Find Error - No matching row found:",index),!1)}},{key:"getRowFromPosition",value:function getRowFromPosition(position){var row=this.rowManager.getRowFromPosition(position);return row?row.getComponent():(console.warn("Find Error - No matching row found:",position),!1)}},{key:"deleteRow",value:function deleteRow(index){var _this5=this,foundRows=[];this.initGuard(),Array.isArray(index)||(index=[index]);var _iterator=_createForOfIteratorHelper(index),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var item=_step.value,row=this.rowManager.findRow(item,!0);if(!row)return console.error("Delete Error - No matching row found:",item),Promise.reject("Delete Error - No matching row found");foundRows.push(row)}}catch(err){_iterator.e(err)}finally{_iterator.f()}return foundRows.sort((function(a,b){return _this5.rowManager.rows.indexOf(a)>_this5.rowManager.rows.indexOf(b)?1:-1})),foundRows.forEach((function(row){row.delete()})),this.rowManager.reRenderInPosition(),Promise.resolve()}},{key:"addRow",value:function addRow(data,pos,index){return this.initGuard(),"string"==typeof data&&(data=JSON.parse(data)),this.rowManager.addRows(data,pos,index).then((function(rows){return rows[0].getComponent()}))}},{key:"updateOrAddRow",value:function updateOrAddRow(index,data){var row=this.rowManager.findRow(index);return this.initGuard(),"string"==typeof data&&(data=JSON.parse(data)),row?row.updateData(data).then((function(){return row.getComponent()})):this.rowManager.addRows(data).then((function(rows){return rows[0].getComponent()}))}},{key:"updateRow",value:function updateRow(index,data){var row=this.rowManager.findRow(index);return this.initGuard(),"string"==typeof data&&(data=JSON.parse(data)),row?row.updateData(data).then((function(){return Promise.resolve(row.getComponent())})):(console.warn("Update Error - No matching row found:",index),Promise.reject("Update Error - No matching row found"))}},{key:"scrollToRow",value:function scrollToRow(index,position,ifVisible){var row=this.rowManager.findRow(index);return row?this.rowManager.scrollToRow(row,position,ifVisible):(console.warn("Scroll Error - No matching row found:",index),Promise.reject("Scroll Error - No matching row found"))}},{key:"moveRow",value:function moveRow(from,to,after){var fromRow=this.rowManager.findRow(from);this.initGuard(),fromRow?fromRow.moveToRow(to,after):console.warn("Move Error - No matching row found:",from)}},{key:"getRows",value:function getRows(active){return this.rowManager.getComponents(active)}},{key:"getRowPosition",value:function getRowPosition(index){var row=this.rowManager.findRow(index);return row?row.getPosition():(console.warn("Position Error - No matching row found:",index),!1)}},{key:"setColumns",value:function setColumns(definition){this.initGuard(!1,"To set initial columns please use the 'columns' property in the table constructor"),this.columnManager.setColumns(definition)}},{key:"getColumns",value:function getColumns(structured){return this.columnManager.getComponents(structured)}},{key:"getColumn",value:function getColumn(field){var column=this.columnManager.findColumn(field);return column?column.getComponent():(console.warn("Find Error - No matching column found:",field),!1)}},{key:"getColumnDefinitions",value:function getColumnDefinitions(){return this.columnManager.getDefinitionTree()}},{key:"showColumn",value:function showColumn(field){var column=this.columnManager.findColumn(field);if(this.initGuard(),!column)return console.warn("Column Show Error - No matching column found:",field),!1;column.show()}},{key:"hideColumn",value:function hideColumn(field){var column=this.columnManager.findColumn(field);if(this.initGuard(),!column)return console.warn("Column Hide Error - No matching column found:",field),!1;column.hide()}},{key:"toggleColumn",value:function toggleColumn(field){var column=this.columnManager.findColumn(field);if(this.initGuard(),!column)return console.warn("Column Visibility Toggle Error - No matching column found:",field),!1;column.visible?column.hide():column.show()}},{key:"addColumn",value:function addColumn(definition,before,field){var column=this.columnManager.findColumn(field);return this.initGuard(),this.columnManager.addColumn(definition,before,column).then((function(column){return column.getComponent()}))}},{key:"deleteColumn",value:function deleteColumn(field){var column=this.columnManager.findColumn(field);return this.initGuard(),column?column.delete():(console.warn("Column Delete Error - No matching column found:",field),Promise.reject())}},{key:"updateColumnDefinition",value:function updateColumnDefinition(field,definition){var column=this.columnManager.findColumn(field);return this.initGuard(),column?column.updateDefinition(definition):(console.warn("Column Update Error - No matching column found:",field),Promise.reject())}},{key:"moveColumn",value:function moveColumn(from,to,after){var fromColumn=this.columnManager.findColumn(from),toColumn=this.columnManager.findColumn(to);this.initGuard(),fromColumn?toColumn?this.columnManager.moveColumn(fromColumn,toColumn,after):console.warn("Move Error - No matching column found:",toColumn):console.warn("Move Error - No matching column found:",from)}},{key:"scrollToColumn",value:function scrollToColumn(field,position,ifVisible){var _this6=this;return new Promise((function(resolve,reject){var column=_this6.columnManager.findColumn(field);return column?_this6.columnManager.scrollToColumn(column,position,ifVisible):(console.warn("Scroll Error - No matching column found:",field),Promise.reject("Scroll Error - No matching column found"))}))}},{key:"redraw",value:function redraw(force){this.initGuard(),this.columnManager.redraw(force),this.rowManager.redraw(force)}},{key:"setHeight",value:function setHeight(height){this.options.height=isNaN(height)?height:height+"px",this.element.style.height=this.options.height,this.rowManager.initializeRenderer(),this.rowManager.redraw()}},{key:"on",value:function on(key,callback){this.externalEvents.subscribe(key,callback)}},{key:"off",value:function off(key,callback){this.externalEvents.unsubscribe(key,callback)}},{key:"dispatchEvent",value:function dispatchEvent(){var _this$externalEvents,args=Array.from(arguments);args.shift(),(_this$externalEvents=this.externalEvents).dispatch.apply(_this$externalEvents,arguments)}},{key:"alert",value:function alert(contents,type){this.initGuard(),this.alertManager.alert(contents,type)}},{key:"clearAlert",value:function clearAlert(){this.initGuard(),this.alertManager.clear()}},{key:"modExists",value:function modExists(plugin,required){return!!this.modules[plugin]||(required&&console.error("Tabulator Module Not Installed: "+plugin),!1)}},{key:"module",value:function module(key){var mod=this.modules[key];return mod||console.error("Tabulator module not installed: "+key),mod}}]),Tabulator}();Tabulator.defaultOptions=defaultOptions,new ModuleBinder(Tabulator);var defaultAccessors={},Accessor=function(_Module){_inherits(Accessor,_Module);var _super=_createSuper(Accessor);function Accessor(table){var _this;return _classCallCheck(this,Accessor),(_this=_super.call(this,table)).allowedTypes=["","data","download","clipboard","print","htmlOutput"],_this.registerColumnOption("accessor"),_this.registerColumnOption("accessorParams"),_this.registerColumnOption("accessorData"),_this.registerColumnOption("accessorDataParams"),_this.registerColumnOption("accessorDownload"),_this.registerColumnOption("accessorDownloadParams"),_this.registerColumnOption("accessorClipboard"),_this.registerColumnOption("accessorClipboardParams"),_this.registerColumnOption("accessorPrint"),_this.registerColumnOption("accessorPrintParams"),_this.registerColumnOption("accessorHtmlOutput"),_this.registerColumnOption("accessorHtmlOutputParams"),_this}return _createClass(Accessor,[{key:"initialize",value:function initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-retrieve",this.transformRow.bind(this))}},{key:"initializeColumn",value:function initializeColumn(column){var _this2=this,match=!1,config={};this.allowedTypes.forEach((function(type){var key="accessor"+(type.charAt(0).toUpperCase()+type.slice(1)),accessor;column.definition[key]&&(accessor=_this2.lookupAccessor(column.definition[key]))&&(match=!0,config[key]={accessor:accessor,params:column.definition[key+"Params"]||{}})})),match&&(column.modules.accessor=config)}},{key:"lookupAccessor",value:function lookupAccessor(value){var accessor=!1;switch(_typeof(value)){case"string":Accessor.accessors[value]?accessor=Accessor.accessors[value]:console.warn("Accessor Error - No such accessor found, ignoring: ",value);break;case"function":accessor=value}return accessor}},{key:"transformRow",value:function transformRow(row,type){var key="accessor"+(type.charAt(0).toUpperCase()+type.slice(1)),rowComponent=row.getComponent(),data=Helpers.deepClone(row.data||{});return this.table.columnManager.traverse((function(column){var value,accessor,params,colComponent;column.modules.accessor&&(accessor=column.modules.accessor[key]||column.modules.accessor.accessor||!1)&&"undefined"!=(value=column.getFieldValue(data))&&(colComponent=column.getComponent(),params="function"==typeof accessor.params?accessor.params(value,data,type,colComponent,rowComponent):accessor.params,column.setFieldValue(data,accessor.accessor(value,data,type,params,colComponent,rowComponent)))})),data}}]),Accessor}(Module);Accessor.moduleName="accessor",Accessor.accessors=defaultAccessors;var defaultConfig={method:"GET"};function generateParamsList(data,prefix){var output=[];if(prefix=prefix||"",Array.isArray(data))data.forEach((function(item,i){output=output.concat(generateParamsList(item,prefix?prefix+"["+i+"]":i))}));else if("object"===_typeof(data))for(var key in data)output=output.concat(generateParamsList(data[key],prefix?prefix+"["+key+"]":key));else output.push({key:prefix,value:data});return output}function serializeParams(params){var output=generateParamsList(params),encoded=[];return output.forEach((function(item){encoded.push(encodeURIComponent(item.key)+"="+encodeURIComponent(item.value))})),encoded.join("&")}function urlBuilder(url,config,params){return url&&params&&Object.keys(params).length&&(config.method&&"get"!=config.method.toLowerCase()||(config.method="get",url+=(url.includes("?")?"&":"?")+serializeParams(params))),url}function defaultLoaderPromise(url,config,params){var _this=this,contentType;return new Promise((function(resolve,reject){if(url=_this.urlGenerator.call(_this.table,url,config,params),"GET"!=config.method.toUpperCase())if(contentType="object"===_typeof(_this.table.options.ajaxContentType)?_this.table.options.ajaxContentType:_this.contentTypeFormatters[_this.table.options.ajaxContentType]){for(var key in contentType.headers)config.headers||(config.headers={}),void 0===config.headers[key]&&(config.headers[key]=contentType.headers[key]);config.body=contentType.body.call(_this,url,config,params)}else console.warn("Ajax Error - Invalid ajaxContentType value:",_this.table.options.ajaxContentType);url?(void 0===config.headers&&(config.headers={}),void 0===config.headers.Accept&&(config.headers.Accept="application/json"),void 0===config.headers["X-Requested-With"]&&(config.headers["X-Requested-With"]="XMLHttpRequest"),void 0===config.mode&&(config.mode="cors"),"cors"==config.mode?(void 0===config.headers.Origin&&(config.headers.Origin=window.location.origin),void 0===config.credentials&&(config.credentials="same-origin")):void 0===config.credentials&&(config.credentials="include"),fetch(url,config).then((function(response){response.ok?response.json().then((function(data){resolve(data)})).catch((function(error){reject(error),console.warn("Ajax Load Error - Invalid JSON returned",error)})):(console.error("Ajax Load Error - Connection Error: "+response.status,response.statusText),reject(response))})).catch((function(error){console.error("Ajax Load Error - Connection Error: ",error),reject(error)}))):(console.warn("Ajax Load Error - No URL Set"),resolve([]))}))}function generateParamsList$1(data,prefix){var output=[];if(prefix=prefix||"",Array.isArray(data))data.forEach((function(item,i){output=output.concat(generateParamsList$1(item,prefix?prefix+"["+i+"]":i))}));else if("object"===_typeof(data))for(var key in data)output=output.concat(generateParamsList$1(data[key],prefix?prefix+"["+key+"]":key));else output.push({key:prefix,value:data});return output}var defaultContentTypeFormatters={json:{headers:{"Content-Type":"application/json"},body:function body(url,config,params){return JSON.stringify(params)}},form:{headers:{},body:function body(url,config,params){var output=generateParamsList$1(params),form=new FormData;return output.forEach((function(item){form.append(item.key,item.value)})),form}}},Ajax=function(_Module){_inherits(Ajax,_Module);var _super=_createSuper(Ajax);function Ajax(table){var _this;return _classCallCheck(this,Ajax),(_this=_super.call(this,table)).config={},_this.url="",_this.urlGenerator=!1,_this.params=!1,_this.loaderPromise=!1,_this.registerTableOption("ajaxURL",!1),_this.registerTableOption("ajaxURLGenerator",!1),_this.registerTableOption("ajaxParams",{}),_this.registerTableOption("ajaxConfig","get"),_this.registerTableOption("ajaxContentType","form"),_this.registerTableOption("ajaxRequestFunc",!1),_this.registerTableOption("ajaxRequesting",(function(){})),_this.registerTableOption("ajaxResponse",!1),_this.contentTypeFormatters=Ajax.contentTypeFormatters,_this}return _createClass(Ajax,[{key:"initialize",value:function initialize(){this.loaderPromise=this.table.options.ajaxRequestFunc||Ajax.defaultLoaderPromise,this.urlGenerator=this.table.options.ajaxURLGenerator||Ajax.defaultURLGenerator,this.table.options.ajaxURL&&this.setUrl(this.table.options.ajaxURL),this.setDefaultConfig(this.table.options.ajaxConfig),this.registerTableFunction("getAjaxUrl",this.getUrl.bind(this)),this.subscribe("data-loading",this.requestDataCheck.bind(this)),this.subscribe("data-params",this.requestParams.bind(this)),this.subscribe("data-load",this.requestData.bind(this))}},{key:"requestParams",value:function requestParams(data,config,silent,params){var ajaxParams=this.table.options.ajaxParams;return ajaxParams&&("function"==typeof ajaxParams&&(ajaxParams=ajaxParams.call(this.table)),params=Object.assign(params,ajaxParams)),params}},{key:"requestDataCheck",value:function requestDataCheck(data,params,config,silent){return!((data||!this.url)&&"string"!=typeof data)}},{key:"requestData",value:function requestData(url,params,config,silent,previousData){var ajaxConfig;return!previousData&&this.requestDataCheck(url)?(url&&this.setUrl(url),ajaxConfig=this.generateConfig(config),this.sendRequest(this.url,params,ajaxConfig)):previousData}},{key:"setDefaultConfig",value:function setDefaultConfig(){var config=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.config=Object.assign({},Ajax.defaultConfig),"string"==typeof config?this.config.method=config:Object.assign(this.config,config)}},{key:"generateConfig",value:function generateConfig(){var config=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},ajaxConfig=Object.assign({},this.config);return"string"==typeof config?ajaxConfig.method=config:Object.assign(ajaxConfig,config),ajaxConfig}},{key:"setUrl",value:function setUrl(url){this.url=url}},{key:"getUrl",value:function getUrl(){return this.url}},{key:"sendRequest",value:function sendRequest(url,params,config){var _this2=this;return!1!==this.table.options.ajaxRequesting.call(this.table,url,params)?this.loaderPromise(url,config,params).then((function(data){return _this2.table.options.ajaxResponse&&(data=_this2.table.options.ajaxResponse.call(_this2.table,url,params,data)),data})):Promise.reject()}}]),Ajax}(Module);Ajax.moduleName="ajax",Ajax.defaultConfig=defaultConfig,Ajax.defaultURLGenerator=urlBuilder,Ajax.defaultLoaderPromise=defaultLoaderPromise,Ajax.contentTypeFormatters=defaultContentTypeFormatters;var defaultPasteActions={replace:function replace(rows){return this.table.setData(rows)},update:function update(rows){return this.table.updateOrAddData(rows)},insert:function insert(rows){return this.table.addData(rows)}},defaultPasteParsers={table:function table(clipboard){var data=[],headerFindSuccess=!0,columns=this.table.columnManager.columns,columnMap=[],rows=[];return(clipboard=clipboard.split("\n")).forEach((function(row){data.push(row.split("\t"))})),!(!data.length||1===data.length&&data[0].length<2)&&(data[0].forEach((function(value){var column=columns.find((function(column){return value&&column.definition.title&&value.trim()&&column.definition.title.trim()===value.trim()}));column?columnMap.push(column):headerFindSuccess=!1})),headerFindSuccess||(headerFindSuccess=!0,columnMap=[],data[0].forEach((function(value){var column=columns.find((function(column){return value&&column.field&&value.trim()&&column.field.trim()===value.trim()}));column?columnMap.push(column):headerFindSuccess=!1})),headerFindSuccess||(columnMap=this.table.columnManager.columnsByIndex)),headerFindSuccess&&data.shift(),data.forEach((function(item){var row={};item.forEach((function(value,i){columnMap[i]&&(row[columnMap[i].field]=value)})),rows.push(row)})),rows)}},Clipboard=function(_Module){_inherits(Clipboard,_Module);var _super=_createSuper(Clipboard);function Clipboard(table){var _this;return _classCallCheck(this,Clipboard),(_this=_super.call(this,table)).mode=!0,_this.pasteParser=function(){},_this.pasteAction=function(){},_this.customSelection=!1,_this.rowRange=!1,_this.blocked=!0,_this.registerTableOption("clipboard",!1),_this.registerTableOption("clipboardCopyStyled",!0),_this.registerTableOption("clipboardCopyConfig",!1),_this.registerTableOption("clipboardCopyFormatter",!1),_this.registerTableOption("clipboardCopyRowRange","active"),_this.registerTableOption("clipboardPasteParser","table"),_this.registerTableOption("clipboardPasteAction","insert"),_this.registerColumnOption("clipboard"),_this.registerColumnOption("titleClipboard"),_this}return _createClass(Clipboard,[{key:"initialize",value:function initialize(){var _this2=this;this.mode=this.table.options.clipboard,this.rowRange=this.table.options.clipboardCopyRowRange,!0!==this.mode&&"copy"!==this.mode||this.table.element.addEventListener("copy",(function(e){var plain,html,list;_this2.blocked||(e.preventDefault(),_this2.customSelection?(plain=_this2.customSelection,_this2.table.options.clipboardCopyFormatter&&(plain=_this2.table.options.clipboardCopyFormatter("plain",plain))):(list=_this2.table.modules.export.generateExportList(_this2.table.options.clipboardCopyConfig,_this2.table.options.clipboardCopyStyled,_this2.rowRange,"clipboard"),plain=(html=_this2.table.modules.export.generateHTMLTable(list))?_this2.generatePlainContent(list):"",_this2.table.options.clipboardCopyFormatter&&(plain=_this2.table.options.clipboardCopyFormatter("plain",plain),html=_this2.table.options.clipboardCopyFormatter("html",html))),window.clipboardData&&window.clipboardData.setData?window.clipboardData.setData("Text",plain):e.clipboardData&&e.clipboardData.setData?(e.clipboardData.setData("text/plain",plain),html&&e.clipboardData.setData("text/html",html)):e.originalEvent&&e.originalEvent.clipboardData.setData&&(e.originalEvent.clipboardData.setData("text/plain",plain),html&&e.originalEvent.clipboardData.setData("text/html",html)),_this2.dispatchExternal("clipboardCopied",plain,html),_this2.reset())})),!0!==this.mode&&"paste"!==this.mode||this.table.element.addEventListener("paste",(function(e){_this2.paste(e)})),this.setPasteParser(this.table.options.clipboardPasteParser),this.setPasteAction(this.table.options.clipboardPasteAction),this.registerTableFunction("copyToClipboard",this.copy.bind(this))}},{key:"reset",value:function reset(){this.blocked=!0,this.customSelection=!1}},{key:"generatePlainContent",value:function generatePlainContent(list){var output=[];return list.forEach((function(row){var rowData=[];row.columns.forEach((function(col){var value="";if(col)if("group"===row.type&&(col.value=col.component.getKey()),null===col.value)value="";else switch(_typeof(col.value)){case"object":value=JSON.stringify(col.value);break;case"undefined":value="";break;default:value=col.value}rowData.push(value)})),output.push(rowData.join("\t"))})),output.join("\n")}},{key:"copy",value:function copy(range,internal){var sel,textRange;this.blocked=!1,this.customSelection=!1,!0!==this.mode&&"copy"!==this.mode||(this.rowRange=range||this.table.options.clipboardCopyRowRange,void 0!==window.getSelection&&void 0!==document.createRange?((range=document.createRange()).selectNodeContents(this.table.element),(sel=window.getSelection()).toString()&&internal&&(this.customSelection=sel.toString()),sel.removeAllRanges(),sel.addRange(range)):void 0!==document.selection&&void 0!==document.body.createTextRange&&((textRange=document.body.createTextRange()).moveToElementText(this.table.element),textRange.select()),document.execCommand("copy"),sel&&sel.removeAllRanges())}},{key:"setPasteAction",value:function setPasteAction(action){switch(_typeof(action)){case"string":this.pasteAction=Clipboard.pasteActions[action],this.pasteAction||console.warn("Clipboard Error - No such paste action found:",action);break;case"function":this.pasteAction=action}}},{key:"setPasteParser",value:function setPasteParser(parser){switch(_typeof(parser)){case"string":this.pasteParser=Clipboard.pasteParsers[parser],this.pasteParser||console.warn("Clipboard Error - No such paste parser found:",parser);break;case"function":this.pasteParser=parser}}},{key:"paste",value:function paste(e){var data,rowData,rows;this.checkPaseOrigin(e)&&(data=this.getPasteData(e),(rowData=this.pasteParser.call(this,data))?(e.preventDefault(),this.table.modExists("mutator")&&(rowData=this.mutateData(rowData)),rows=this.pasteAction.call(this,rowData),this.dispatchExternal("clipboardPasted",data,rowData,rows)):this.dispatchExternal("clipboardPasteError",data))}},{key:"mutateData",value:function mutateData(data){var _this3=this,output=[];return Array.isArray(data)?data.forEach((function(row){output.push(_this3.table.modules.mutator.transformRow(row,"clipboard"))})):output=data,output}},{key:"checkPaseOrigin",value:function checkPaseOrigin(e){var valid=!0;return("DIV"!=e.target.tagName||this.table.modules.edit.currentCell)&&(valid=!1),valid}},{key:"getPasteData",value:function getPasteData(e){var data;return window.clipboardData&&window.clipboardData.getData?data=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData?data=e.clipboardData.getData("text/plain"):e.originalEvent&&e.originalEvent.clipboardData.getData&&(data=e.originalEvent.clipboardData.getData("text/plain")),data}}]),Clipboard}(Module);Clipboard.moduleName="clipboard",Clipboard.pasteActions=defaultPasteActions,Clipboard.pasteParsers=defaultPasteParsers;var CalcComponent=function(){function CalcComponent(row){return _classCallCheck(this,CalcComponent),this._row=row,new Proxy(this,{get:function get(target,name,receiver){return void 0!==target[name]?target[name]:target._row.table.componentFunctionBinder.handle("row",target._row,name)}})}return _createClass(CalcComponent,[{key:"getData",value:function getData(transform){return this._row.getData(transform)}},{key:"getElement",value:function getElement(){return this._row.getElement()}},{key:"getTable",value:function getTable(){return this._row.table}},{key:"getCells",value:function getCells(){var cells=[];return this._row.getCells().forEach((function(cell){cells.push(cell.getComponent())})),cells}},{key:"getCell",value:function getCell(column){var cell=this._row.getCell(column);return!!cell&&cell.getComponent()}},{key:"_getSelf",value:function _getSelf(){return this._row}}]),CalcComponent}(),defaultCalculations={avg:function avg(values,data,calcParams){var output=0,precision=void 0!==calcParams.precision?calcParams.precision:2;return values.length&&(output=values.reduce((function(sum,value){return Number(sum)+Number(value)})),output/=values.length,output=!1!==precision?output.toFixed(precision):output),parseFloat(output).toString()},max:function max(values,data,calcParams){var output=null,precision=void 0!==calcParams.precision&&calcParams.precision;return values.forEach((function(value){((value=Number(value))>output||null===output)&&(output=value)})),null!==output?!1!==precision?output.toFixed(precision):output:""},min:function min(values,data,calcParams){var output=null,precision=void 0!==calcParams.precision&&calcParams.precision;return values.forEach((function(value){((value=Number(value))<output||null===output)&&(output=value)})),null!==output?!1!==precision?output.toFixed(precision):output:""},sum:function sum(values,data,calcParams){var output=0,precision=void 0!==calcParams.precision&&calcParams.precision;return values.length&&values.forEach((function(value){value=Number(value),output+=isNaN(value)?0:Number(value)})),!1!==precision?output.toFixed(precision):output},concat:function concat(values,data,calcParams){var output=0;return values.length&&(output=values.reduce((function(sum,value){return String(sum)+String(value)}))),output},count:function count(values,data,calcParams){var output=0;return values.length&&values.forEach((function(value){value&&output++})),output}},ColumnCalcs=function(_Module){_inherits(ColumnCalcs,_Module);var _super=_createSuper(ColumnCalcs);function ColumnCalcs(table){var _this;return _classCallCheck(this,ColumnCalcs),(_this=_super.call(this,table)).topCalcs=[],_this.botCalcs=[],_this.genColumn=!1,_this.topElement=_this.createElement(),_this.botElement=_this.createElement(),_this.topRow=!1,_this.botRow=!1,_this.topInitialized=!1,_this.botInitialized=!1,_this.registerTableOption("columnCalcs",!0),_this.registerColumnOption("topCalc"),_this.registerColumnOption("topCalcParams"),_this.registerColumnOption("topCalcFormatter"),_this.registerColumnOption("topCalcFormatterParams"),_this.registerColumnOption("bottomCalc"),_this.registerColumnOption("bottomCalcParams"),_this.registerColumnOption("bottomCalcFormatter"),_this.registerColumnOption("bottomCalcFormatterParams"),_this}return _createClass(ColumnCalcs,[{key:"createElement",value:function createElement(){var el=document.createElement("div");return el.classList.add("tabulator-calcs-holder"),el}},{key:"initialize",value:function initialize(){this.genColumn=new Column({field:"value"},this),this.subscribe("cell-value-changed",this.cellValueChanged.bind(this)),this.subscribe("column-init",this.initializeColumnCheck.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("column-moved",this.recalcActiveRows.bind(this)),this.subscribe("column-add",this.recalcActiveRows.bind(this)),this.subscribe("data-refreshed",this.recalcActiveRowsRefresh.bind(this)),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.registerTableFunction("getCalcResults",this.getResults.bind(this)),this.registerTableFunction("recalc",this.userRecalc.bind(this))}},{key:"tableRedraw",value:function tableRedraw(force){this.recalc(this.table.rowManager.activeRows),force&&this.redraw()}},{key:"userRecalc",value:function userRecalc(){this.recalc(this.table.rowManager.activeRows)}},{key:"visibleRows",value:function visibleRows(viewable,rows){return this.topRow&&rows.unshift(this.topRow),this.botRow&&rows.push(this.botRow),rows}},{key:"rowsUpdated",value:function rowsUpdated(row){this.table.options.groupBy?this.recalcRowGroup(row):this.recalcActiveRows()}},{key:"recalcActiveRowsRefresh",value:function recalcActiveRowsRefresh(){this.table.options.groupBy&&this.table.options.dataTreeStartExpanded&&this.table.options.dataTree?this.recalcAll():this.recalcActiveRows()}},{key:"recalcActiveRows",value:function recalcActiveRows(){this.recalc(this.table.rowManager.activeRows)}},{key:"cellValueChanged",value:function cellValueChanged(cell){(cell.column.definition.topCalc||cell.column.definition.bottomCalc)&&(this.table.options.groupBy?("table"!=this.table.options.columnCalcs&&"both"!=this.table.options.columnCalcs||this.recalcActiveRows(),"table"!=this.table.options.columnCalcs&&this.recalcRowGroup(cell.row)):this.recalcActiveRows())}},{key:"initializeColumnCheck",value:function initializeColumnCheck(column){(column.definition.topCalc||column.definition.bottomCalc)&&this.initializeColumn(column)}},{key:"initializeColumn",value:function initializeColumn(column){var def=column.definition,config={topCalcParams:def.topCalcParams||{},botCalcParams:def.bottomCalcParams||{}};if(def.topCalc){switch(_typeof(def.topCalc)){case"string":ColumnCalcs.calculations[def.topCalc]?config.topCalc=ColumnCalcs.calculations[def.topCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",def.topCalc);break;case"function":config.topCalc=def.topCalc}config.topCalc&&(column.modules.columnCalcs=config,this.topCalcs.push(column),"group"!=this.table.options.columnCalcs&&this.initializeTopRow())}if(def.bottomCalc){switch(_typeof(def.bottomCalc)){case"string":ColumnCalcs.calculations[def.bottomCalc]?config.botCalc=ColumnCalcs.calculations[def.bottomCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",def.bottomCalc);break;case"function":config.botCalc=def.bottomCalc}config.botCalc&&(column.modules.columnCalcs=config,this.botCalcs.push(column),"group"!=this.table.options.columnCalcs&&this.initializeBottomRow())}}},{key:"registerColumnField",value:function registerColumnField(){}},{key:"removeCalcs",value:function removeCalcs(){var changed=!1;this.topInitialized&&(this.topInitialized=!1,this.topElement.parentNode.removeChild(this.topElement),changed=!0),this.botInitialized&&(this.botInitialized=!1,this.footerRemove(this.botElement),changed=!0),changed&&this.table.rowManager.adjustTableSize()}},{key:"initializeTopRow",value:function initializeTopRow(){this.topInitialized||(this.table.columnManager.getElement().insertBefore(this.topElement,this.table.columnManager.headersElement.nextSibling),this.topInitialized=!0)}},{key:"initializeBottomRow",value:function initializeBottomRow(){this.botInitialized||(this.footerPrepend(this.botElement),this.botInitialized=!0)}},{key:"scrollHorizontal",value:function scrollHorizontal(left){this.botInitialized&&this.botRow&&(this.table.rtl?this.botRow.getElement().style.marginRight=left+"px":this.botRow.getElement().style.marginLeft=-left+"px")}},{key:"recalc",value:function recalc(rows){var data,row;if(this.topInitialized||this.botInitialized){if(data=this.rowsToData(rows),this.topInitialized){for(this.topRow&&this.topRow.deleteCells(),row=this.generateRow("top",data),this.topRow=row;this.topElement.firstChild;)this.topElement.removeChild(this.topElement.firstChild);this.topElement.appendChild(row.getElement()),row.initialize(!0)}if(this.botInitialized){for(this.botRow&&this.botRow.deleteCells(),row=this.generateRow("bottom",data),this.botRow=row;this.botElement.firstChild;)this.botElement.removeChild(this.botElement.firstChild);this.botElement.appendChild(row.getElement()),row.initialize(!0)}this.table.rowManager.adjustTableSize(),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layout()}}},{key:"recalcRowGroup",value:function recalcRowGroup(row){this.recalcGroup(this.table.modules.groupRows.getRowGroup(row))}},{key:"recalcAll",value:function recalcAll(){var _this2=this,groups;(this.topCalcs.length||this.botCalcs.length)&&("group"!==this.table.options.columnCalcs&&this.recalcActiveRows(),this.table.options.groupBy&&"table"!==this.table.options.columnCalcs&&this.table.modules.groupRows.getChildGroups().forEach((function(group){_this2.recalcGroup(group)})))}},{key:"recalcGroup",value:function recalcGroup(group){var data,rowData;group&&group.calcs&&(group.calcs.bottom&&(data=this.rowsToData(group.rows),rowData=this.generateRowData("bottom",data),group.calcs.bottom.updateData(rowData),group.calcs.bottom.reinitialize()),group.calcs.top&&(data=this.rowsToData(group.rows),rowData=this.generateRowData("top",data),group.calcs.top.updateData(rowData),group.calcs.top.reinitialize()))}},{key:"generateTopRow",value:function generateTopRow(rows){return this.generateRow("top",this.rowsToData(rows))}},{key:"generateBottomRow",value:function generateBottomRow(rows){return this.generateRow("bottom",this.rowsToData(rows))}},{key:"rowsToData",value:function rowsToData(rows){var _this3=this,data=[];return rows.forEach((function(row){if(data.push(row.getData()),_this3.table.options.dataTree&&_this3.table.options.dataTreeChildColumnCalcs&&row.modules.dataTree&&row.modules.dataTree.open){var children=_this3.rowsToData(_this3.table.modules.dataTree.getFilteredTreeChildren(row));data=data.concat(children)}})),data}},{key:"generateRow",value:function generateRow(pos,data){var _this4=this,rowData=this.generateRowData(pos,data),row;return this.table.modExists("mutator")&&this.table.modules.mutator.disable(),row=new Row(rowData,this,"calc"),this.table.modExists("mutator")&&this.table.modules.mutator.enable(),row.getElement().classList.add("tabulator-calcs","tabulator-calcs-"+pos),row.component=!1,row.getComponent=function(){return row.component||(row.component=new CalcComponent(row)),row.component},row.generateCells=function(){var cells=[];_this4.table.columnManager.columnsByIndex.forEach((function(column){_this4.genColumn.setField(column.getField()),_this4.genColumn.hozAlign=column.hozAlign,column.definition[pos+"CalcFormatter"]&&_this4.table.modExists("format")?_this4.genColumn.modules.format={formatter:_this4.table.modules.format.getFormatter(column.definition[pos+"CalcFormatter"]),params:column.definition[pos+"CalcFormatterParams"]||{}}:_this4.genColumn.modules.format={formatter:_this4.table.modules.format.getFormatter("plaintext"),params:{}},_this4.genColumn.definition.cssClass=column.definition.cssClass;var cell=new Cell(_this4.genColumn,row);cell.getElement(),cell.column=column,cell.setWidth(),column.cells.push(cell),cells.push(cell),column.visible||cell.hide()})),row.cells=cells},row}},{key:"generateRowData",value:function generateRowData(pos,data){var rowData={},calcs="top"==pos?this.topCalcs:this.botCalcs,type="top"==pos?"topCalc":"botCalc",params,paramKey;return calcs.forEach((function(column){var values=[];column.modules.columnCalcs&&column.modules.columnCalcs[type]&&(data.forEach((function(item){values.push(column.getFieldValue(item))})),paramKey=type+"Params",params="function"==typeof column.modules.columnCalcs[paramKey]?column.modules.columnCalcs[paramKey](values,data):column.modules.columnCalcs[paramKey],column.setFieldValue(rowData,column.modules.columnCalcs[type](values,data,params)))})),rowData}},{key:"hasTopCalcs",value:function hasTopCalcs(){return!!this.topCalcs.length}},{key:"hasBottomCalcs",value:function hasBottomCalcs(){return!!this.botCalcs.length}},{key:"redraw",value:function redraw(){this.topRow&&this.topRow.normalizeHeight(!0),this.botRow&&this.botRow.normalizeHeight(!0)}},{key:"getResults",value:function getResults(){var _this5=this,results={},groups;return this.table.options.groupBy&&this.table.modExists("groupRows")?(groups=this.table.modules.groupRows.getGroups(!0)).forEach((function(group){results[group.getKey()]=_this5.getGroupResults(group)})):results={top:this.topRow?this.topRow.getData():{},bottom:this.botRow?this.botRow.getData():{}},results}},{key:"getGroupResults",value:function getGroupResults(group){var _this6=this,groupObj=group._getSelf(),subGroups=group.getSubGroups(),subGroupResults={},results={};return subGroups.forEach((function(subgroup){subGroupResults[subgroup.getKey()]=_this6.getGroupResults(subgroup)})),results={top:groupObj.calcs.top?groupObj.calcs.top.getData():{},bottom:groupObj.calcs.bottom?groupObj.calcs.bottom.getData():{},groups:subGroupResults}}}]),ColumnCalcs}(Module);ColumnCalcs.moduleName="columnCalcs",ColumnCalcs.calculations=defaultCalculations;var DataTree=function(_Module){_inherits(DataTree,_Module);var _super=_createSuper(DataTree);function DataTree(table){var _this;return _classCallCheck(this,DataTree),(_this=_super.call(this,table)).indent=10,_this.field="",_this.collapseEl=null,_this.expandEl=null,_this.branchEl=null,_this.elementField=!1,_this.startOpen=function(){},_this.displayIndex=0,_this.registerTableOption("dataTree",!1),_this.registerTableOption("dataTreeFilter",!0),_this.registerTableOption("dataTreeSort",!0),_this.registerTableOption("dataTreeElementColumn",!1),_this.registerTableOption("dataTreeBranchElement",!0),_this.registerTableOption("dataTreeChildIndent",9),_this.registerTableOption("dataTreeChildField","_children"),_this.registerTableOption("dataTreeCollapseElement",!1),_this.registerTableOption("dataTreeExpandElement",!1),_this.registerTableOption("dataTreeStartExpanded",!1),_this.registerTableOption("dataTreeChildColumnCalcs",!1),_this.registerTableOption("dataTreeSelectPropagate",!1),_this.registerComponentFunction("row","treeCollapse",_this.collapseRow.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("row","treeExpand",_this.expandRow.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("row","treeToggle",_this.toggleRow.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("row","getTreeParent",_this.getTreeParent.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("row","getTreeChildren",_this.getRowChildren.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("row","addTreeChild",_this.addTreeChildRow.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("row","isTreeExpanded",_this.isRowExpanded.bind(_assertThisInitialized(_this))),_this}return _createClass(DataTree,[{key:"initialize",value:function initialize(){if(this.table.options.dataTree){var dummyEl=null,options=this.table.options;switch(this.field=options.dataTreeChildField,this.indent=options.dataTreeChildIndent,this.options("movableRows")&&console.warn("The movableRows option is not available with dataTree enabled, moving of child rows could result in unpredictable behavior"),options.dataTreeBranchElement&&(!0===options.dataTreeBranchElement?(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch")):"string"==typeof options.dataTreeBranchElement?((dummyEl=document.createElement("div")).innerHTML=options.dataTreeBranchElement,this.branchEl=dummyEl.firstChild):this.branchEl=options.dataTreeBranchElement),options.dataTreeCollapseElement?"string"==typeof options.dataTreeCollapseElement?((dummyEl=document.createElement("div")).innerHTML=options.dataTreeCollapseElement,this.collapseEl=dummyEl.firstChild):this.collapseEl=options.dataTreeCollapseElement:(this.collapseEl=document.createElement("div"),this.collapseEl.classList.add("tabulator-data-tree-control"),this.collapseEl.tabIndex=0,this.collapseEl.innerHTML="<div class='tabulator-data-tree-control-collapse'></div>"),options.dataTreeExpandElement?"string"==typeof options.dataTreeExpandElement?((dummyEl=document.createElement("div")).innerHTML=options.dataTreeExpandElement,this.expandEl=dummyEl.firstChild):this.expandEl=options.dataTreeExpandElement:(this.expandEl=document.createElement("div"),this.expandEl.classList.add("tabulator-data-tree-control"),this.expandEl.tabIndex=0,this.expandEl.innerHTML="<div class='tabulator-data-tree-control-expand'></div>"),_typeof(options.dataTreeStartExpanded)){case"boolean":this.startOpen=function(row,index){return options.dataTreeStartExpanded};break;case"function":this.startOpen=options.dataTreeStartExpanded;break;default:this.startOpen=function(row,index){return options.dataTreeStartExpanded[index]}}this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("row-deleted",this.rowDelete.bind(this),0),this.subscribe("row-data-changed",this.rowDataChanged.bind(this),10),this.subscribe("cell-value-updated",this.cellValueChanged.bind(this)),this.subscribe("edit-cancelled",this.cellValueChanged.bind(this)),this.subscribe("column-moving-rows",this.columnMoving.bind(this)),this.subscribe("table-built",this.initializeElementField.bind(this)),this.subscribe("table-redrawing",this.tableRedrawing.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),30)}}},{key:"tableRedrawing",value:function tableRedrawing(force){var _this2=this,rows;force&&(rows=this.table.rowManager.getRows()).forEach((function(row){_this2.reinitializeRowChildren(row)}))}},{key:"initializeElementField",value:function initializeElementField(){var firstCol=this.table.columnManager.getFirstVisibleColumn();this.elementField=this.table.options.dataTreeElementColumn||!!firstCol&&firstCol.field}},{key:"getRowChildren",value:function getRowChildren(row){return this.getTreeChildren(row,!0)}},{key:"columnMoving",value:function columnMoving(){var _this3=this,rows=[];return this.table.rowManager.rows.forEach((function(row){rows=rows.concat(_this3.getTreeChildren(row,!1,!0))})),rows}},{key:"rowDataChanged",value:function rowDataChanged(row,visible,updatedData){this.redrawNeeded(updatedData)&&(this.initializeRow(row),visible&&(this.layoutRow(row),this.refreshData(!0)))}},{key:"cellValueChanged",value:function cellValueChanged(cell){var field;cell.column.getField()===this.elementField&&this.layoutRow(cell.row)}},{key:"initializeRow",value:function initializeRow(row){var childArray=row.getData()[this.field],isArray=Array.isArray(childArray),children=isArray||!isArray&&"object"===_typeof(childArray)&&null!==childArray;!children&&row.modules.dataTree&&row.modules.dataTree.branchEl&&row.modules.dataTree.branchEl.parentNode.removeChild(row.modules.dataTree.branchEl),!children&&row.modules.dataTree&&row.modules.dataTree.controlEl&&row.modules.dataTree.controlEl.parentNode.removeChild(row.modules.dataTree.controlEl),row.modules.dataTree={index:row.modules.dataTree?row.modules.dataTree.index:0,open:!!children&&(row.modules.dataTree?row.modules.dataTree.open:this.startOpen(row.getComponent(),0)),controlEl:!(!row.modules.dataTree||!children)&&row.modules.dataTree.controlEl,branchEl:!(!row.modules.dataTree||!children)&&row.modules.dataTree.branchEl,parent:!!row.modules.dataTree&&row.modules.dataTree.parent,children:children}}},{key:"reinitializeRowChildren",value:function reinitializeRowChildren(row){var children;this.getTreeChildren(row,!1,!0).forEach((function(child){child.reinitialize(!0)}))}},{key:"layoutRow",value:function layoutRow(row){var cell,el=(this.elementField?row.getCell(this.elementField):row.getCells()[0]).getElement(),config=row.modules.dataTree;config.branchEl&&(config.branchEl.parentNode&&config.branchEl.parentNode.removeChild(config.branchEl),config.branchEl=!1),config.controlEl&&(config.controlEl.parentNode&&config.controlEl.parentNode.removeChild(config.controlEl),config.controlEl=!1),this.generateControlElement(row,el),row.getElement().classList.add("tabulator-tree-level-"+config.index),config.index&&(this.branchEl?(config.branchEl=this.branchEl.cloneNode(!0),el.insertBefore(config.branchEl,el.firstChild),this.table.rtl?config.branchEl.style.marginRight=(config.branchEl.offsetWidth+config.branchEl.style.marginLeft)*(config.index-1)+config.index*this.indent+"px":config.branchEl.style.marginLeft=(config.branchEl.offsetWidth+config.branchEl.style.marginRight)*(config.index-1)+config.index*this.indent+"px"):this.table.rtl?el.style.paddingRight=parseInt(window.getComputedStyle(el,null).getPropertyValue("padding-right"))+config.index*this.indent+"px":el.style.paddingLeft=parseInt(window.getComputedStyle(el,null).getPropertyValue("padding-left"))+config.index*this.indent+"px")}},{key:"generateControlElement",value:function generateControlElement(row,el){var _this4=this,config=row.modules.dataTree,oldControl=config.controlEl;el=el||row.getCells()[0].getElement(),!1!==config.children&&(config.open?(config.controlEl=this.collapseEl.cloneNode(!0),config.controlEl.addEventListener("click",(function(e){e.stopPropagation(),_this4.collapseRow(row)}))):(config.controlEl=this.expandEl.cloneNode(!0),config.controlEl.addEventListener("click",(function(e){e.stopPropagation(),_this4.expandRow(row)}))),config.controlEl.addEventListener("mousedown",(function(e){e.stopPropagation()})),oldControl&&oldControl.parentNode===el?oldControl.parentNode.replaceChild(config.controlEl,oldControl):el.insertBefore(config.controlEl,el.firstChild))}},{key:"setDisplayIndex",value:function setDisplayIndex(index){this.displayIndex=index}},{key:"getDisplayIndex",value:function getDisplayIndex(){return this.displayIndex}},{key:"getRows",value:function getRows(rows){var _this5=this,output=[];return rows.forEach((function(row,i){var config,children;output.push(row),row instanceof Row&&(row.create(),(config=row.modules.dataTree.children).index||!1===config.children||(children=_this5.getChildren(row)).forEach((function(child){child.create(),output.push(child)})))})),output}},{key:"getChildren",value:function getChildren(row,allChildren){var _this6=this,config=row.modules.dataTree,children=[],output=[];return!1!==config.children&&(config.open||allChildren)&&(Array.isArray(config.children)||(config.children=this.generateChildren(row)),children=this.table.modExists("filter")&&this.table.options.dataTreeFilter?this.table.modules.filter.filter(config.children):config.children,this.table.modExists("sort")&&this.table.options.dataTreeSort&&this.table.modules.sort.sort(children),children.forEach((function(child){var subChildren;output.push(child),_this6.getChildren(child).forEach((function(sub){output.push(sub)}))}))),output}},{key:"generateChildren",value:function generateChildren(row){var _this7=this,children=[],childArray=row.getData()[this.field];return Array.isArray(childArray)||(childArray=[childArray]),childArray.forEach((function(childData){var childRow=new Row(childData||{},_this7.table.rowManager);childRow.create(),childRow.modules.dataTree.index=row.modules.dataTree.index+1,childRow.modules.dataTree.parent=row,childRow.modules.dataTree.children&&(childRow.modules.dataTree.open=_this7.startOpen(childRow.getComponent(),childRow.modules.dataTree.index)),children.push(childRow)})),children}},{key:"expandRow",value:function expandRow(row,silent){var config=row.modules.dataTree;!1!==config.children&&(config.open=!0,row.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowExpanded",row.getComponent(),row.modules.dataTree.index))}},{key:"collapseRow",value:function collapseRow(row){var config=row.modules.dataTree;!1!==config.children&&(config.open=!1,row.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowCollapsed",row.getComponent(),row.modules.dataTree.index))}},{key:"toggleRow",value:function toggleRow(row){var config=row.modules.dataTree;!1!==config.children&&(config.open?this.collapseRow(row):this.expandRow(row))}},{key:"isRowExpanded",value:function isRowExpanded(row){return row.modules.dataTree.open}},{key:"getTreeParent",value:function getTreeParent(row){return!!row.modules.dataTree.parent&&row.modules.dataTree.parent.getComponent()}},{key:"getTreeParentRoot",value:function getTreeParentRoot(row){return row.modules.dataTree&&row.modules.dataTree.parent?this.getTreeParentRoot(row.modules.dataTree.parent):row}},{key:"getFilteredTreeChildren",value:function getFilteredTreeChildren(row){var config=row.modules.dataTree,output=[],children;return config.children&&(Array.isArray(config.children)||(config.children=this.generateChildren(row)),(children=this.table.modExists("filter")&&this.table.options.dataTreeFilter?this.table.modules.filter.filter(config.children):config.children).forEach((function(childRow){childRow instanceof Row&&output.push(childRow)}))),output}},{key:"rowDelete",value:function rowDelete(row){var parent=row.modules.dataTree.parent,childIndex;parent&&(!1!==(childIndex=this.findChildIndex(row,parent))&&parent.data[this.field].splice(childIndex,1),parent.data[this.field].length||delete parent.data[this.field],this.initializeRow(parent),this.layoutRow(parent)),this.refreshData(!0)}},{key:"addTreeChildRow",value:function addTreeChildRow(row,data,top,index){var childIndex=!1;"string"==typeof data&&(data=JSON.parse(data)),Array.isArray(row.data[this.field])||(row.data[this.field]=[],row.modules.dataTree.open=this.startOpen(row.getComponent(),row.modules.dataTree.index)),void 0!==index&&!1!==(childIndex=this.findChildIndex(index,row))&&row.data[this.field].splice(top?childIndex:childIndex+1,0,data),!1===childIndex&&(top?row.data[this.field].unshift(data):row.data[this.field].push(data)),this.initializeRow(row),this.layoutRow(row),this.refreshData(!0)}},{key:"findChildIndex",value:function findChildIndex(subject,parent){var _this8=this,match=!1;return"object"==_typeof(subject)?subject instanceof Row?match=subject.data:subject instanceof RowComponent?match=subject._getSelf().data:"undefined"!=typeof HTMLElement&&subject instanceof HTMLElement?parent.modules.dataTree&&(match=parent.modules.dataTree.children.find((function(childRow){return childRow instanceof Row&&childRow.element===subject})))&&(match=match.data):null===subject&&(match=!1):match=void 0!==subject&&parent.data[this.field].find((function(row){return row.data[_this8.table.options.index]==subject})),match&&(Array.isArray(parent.data[this.field])&&(match=parent.data[this.field].indexOf(match)),-1==match&&(match=!1)),match}},{key:"getTreeChildren",value:function getTreeChildren(row,component,recurse){var _this9=this,config=row.modules.dataTree,output=[];return config.children&&(Array.isArray(config.children)||(config.children=this.generateChildren(row)),config.children.forEach((function(childRow){childRow instanceof Row&&(output.push(component?childRow.getComponent():childRow),recurse&&(output=output.concat(_this9.getTreeChildren(childRow,component,recurse))))}))),output}},{key:"getChildField",value:function getChildField(){return this.field}},{key:"redrawNeeded",value:function redrawNeeded(data){return!!this.field&&void 0!==data[this.field]||!!this.elementField&&void 0!==data[this.elementField]}}]),DataTree}(Module);function csv(list){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},setFileContents=arguments.length>2?arguments[2]:void 0,delimiter=options.delimiter?options.delimiter:",",fileContents=[],headers=[];list.forEach((function(row){var item=[];switch(row.type){case"group":console.warn("Download Warning - CSV downloader cannot process row groups");break;case"calc":console.warn("Download Warning - CSV downloader cannot process column calculations");break;case"header":row.columns.forEach((function(col,i){col&&1===col.depth&&(headers[i]=void 0===col.value||null===col.value?"":'"'+String(col.value).split('"').join('""')+'"')}));break;case"row":row.columns.forEach((function(col){if(col){switch(_typeof(col.value)){case"object":col.value=null!==col.value?JSON.stringify(col.value):"";break;case"undefined":col.value=""}item.push('"'+String(col.value).split('"').join('""')+'"')}})),fileContents.push(item.join(delimiter))}})),headers.length&&fileContents.unshift(headers.join(delimiter)),fileContents=fileContents.join("\n"),options.bom&&(fileContents="\ufeff"+fileContents),setFileContents(fileContents,"text/csv")}function json(list,options,setFileContents){var fileContents=[];list.forEach((function(row){var item={};switch(row.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":row.columns.forEach((function(col){col&&(item[col.component.getTitleDownload()||col.component.getField()]=col.value)})),fileContents.push(item)}})),setFileContents(fileContents=JSON.stringify(fileContents,null,"\t"),"application/json")}function pdf(list){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},setFileContents=arguments.length>2?arguments[2]:void 0,header=[],body=[],autoTableParams={},rowGroupStyles=options.rowGroupStyles||{fontStyle:"bold",fontSize:12,cellPadding:6,fillColor:220},rowCalcStyles=options.rowCalcStyles||{fontStyle:"bold",fontSize:10,cellPadding:4,fillColor:232},jsPDFParams=options.jsPDF||{},title=options.title?options.title:"";function parseRow(row,styles){var rowData=[];return row.columns.forEach((function(col){var cell;if(col){switch(_typeof(col.value)){case"object":col.value=null!==col.value?JSON.stringify(col.value):"";break;case"undefined":col.value=""}cell={content:col.value,colSpan:col.width,rowSpan:col.height},styles&&(cell.styles=styles),rowData.push(cell)}})),rowData}jsPDFParams.orientation||(jsPDFParams.orientation=options.orientation||"landscape"),jsPDFParams.unit||(jsPDFParams.unit="pt"),list.forEach((function(row){switch(row.type){case"header":header.push(parseRow(row));break;case"group":body.push(parseRow(row,rowGroupStyles));break;case"calc":body.push(parseRow(row,rowCalcStyles));break;case"row":body.push(parseRow(row))}}));var doc=new jspdf.jsPDF(jsPDFParams);options.autoTable&&(autoTableParams="function"==typeof options.autoTable?options.autoTable(doc)||{}:options.autoTable),title&&(autoTableParams.didDrawPage=function(data){doc.text(title,40,30)}),autoTableParams.head=header,autoTableParams.body=body,doc.autoTable(autoTableParams),options.documentProcessing&&options.documentProcessing(doc),setFileContents(doc.output("arraybuffer"),"application/pdf")}function xlsx(list,options,setFileContents){var self=this,sheetName=options.sheetName||"Sheet1",workbook=XLSX.utils.book_new(),tableFeatures=new CoreFeature(this),output;function generateSheet(){var rows=[],merges=[],worksheet={},range={s:{c:0,r:0},e:{c:list[0]?list[0].columns.reduce((function(a,b){return a+(b&&b.width?b.width:1)}),0):0,r:list.length}};return list.forEach((function(row,i){var rowData=[];row.columns.forEach((function(col,j){col?(rowData.push(col.value instanceof Date||"object"!==_typeof(col.value)?col.value:JSON.stringify(col.value)),(col.width>1||col.height>-1)&&(col.height>1||col.width>1)&&merges.push({s:{r:i,c:j},e:{r:i+col.height-1,c:j+col.width-1}})):rowData.push("")})),rows.push(rowData)})),XLSX.utils.sheet_add_aoa(worksheet,rows),worksheet["!ref"]=XLSX.utils.encode_range(range),merges.length&&(worksheet["!merges"]=merges),worksheet}if(workbook.SheetNames=[],workbook.Sheets={},options.sheetOnly)setFileContents(generateSheet());else{if(options.sheets)for(var sheet in options.sheets)!0===options.sheets[sheet]?(workbook.SheetNames.push(sheet),workbook.Sheets[sheet]=generateSheet()):(workbook.SheetNames.push(sheet),tableFeatures.commsSend(options.sheets[sheet],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},active:this.active,intercept:function intercept(data){workbook.Sheets[sheet]=data}}));else workbook.SheetNames.push(sheetName),workbook.Sheets[sheetName]=generateSheet();options.documentProcessing&&(workbook=options.documentProcessing(workbook)),setFileContents(s2ab(output=XLSX.write(workbook,{bookType:"xlsx",bookSST:!0,type:"binary"})),"application/octet-stream")}function s2ab(s){for(var buf=new ArrayBuffer(s.length),view=new Uint8Array(buf),i=0;i!=s.length;++i)view[i]=255&s.charCodeAt(i);return buf}}function html(list,options,setFileContents){this.modExists("export",!0)&&setFileContents(this.modules.export.generateHTMLTable(list),"text/html")}function jsonLines(list,options,setFileContents){var fileContents=[];list.forEach((function(row){var item={};switch(row.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":row.columns.forEach((function(col){col&&(item[col.component.getTitleDownload()||col.component.getField()]=col.value)})),fileContents.push(JSON.stringify(item))}})),setFileContents(fileContents.join("\n"),"application/x-ndjson")}DataTree.moduleName="dataTree";var defaultDownloaders={csv:csv,json:json,jsonLines:jsonLines,pdf:pdf,xlsx:xlsx,html:html},Download=function(_Module){_inherits(Download,_Module);var _super=_createSuper(Download);function Download(table){var _this;return _classCallCheck(this,Download),(_this=_super.call(this,table)).registerTableOption("downloadEncoder",(function(data,mimeType){return new Blob([data],{type:mimeType})})),_this.registerTableOption("downloadReady",void 0),_this.registerTableOption("downloadConfig",{}),_this.registerTableOption("downloadRowRange","active"),_this.registerColumnOption("download"),_this.registerColumnOption("titleDownload"),_this}return _createClass(Download,[{key:"initialize",value:function initialize(){this.deprecatedOptionsCheck(),this.registerTableFunction("download",this.download.bind(this)),this.registerTableFunction("downloadToTab",this.downloadToTab.bind(this))}},{key:"deprecatedOptionsCheck",value:function deprecatedOptionsCheck(){this.deprecationCheck("downloadReady","downloadEncoder")}},{key:"downloadToTab",value:function downloadToTab(type,filename,options,active){this.download(type,filename,options,active,!0)}},{key:"download",value:function download(type,filename,options,range,interceptCallback){var downloadFunc=!1;function buildLink(data,mime){interceptCallback?!0===interceptCallback?this.triggerDownload(data,mime,type,filename,!0):interceptCallback(data):this.triggerDownload(data,mime,type,filename)}if("function"==typeof type?downloadFunc=type:Download.downloaders[type]?downloadFunc=Download.downloaders[type]:console.warn("Download Error - No such download type found: ",type),downloadFunc){var list=this.generateExportList(range);downloadFunc.call(this.table,list,options||{},buildLink.bind(this))}}},{key:"generateExportList",value:function generateExportList(range){var list=this.table.modules.export.generateExportList(this.table.options.downloadConfig,!1,range||this.table.options.downloadRowRange,"download"),groupHeader=this.table.options.groupHeaderDownload;return groupHeader&&!Array.isArray(groupHeader)&&(groupHeader=[groupHeader]),list.forEach((function(row){var group;"group"===row.type&&(group=row.columns[0],groupHeader&&groupHeader[row.indent]&&(group.value=groupHeader[row.indent](group.value,row.component._group.getRowCount(),row.component._group.getData(),row.component)))})),list}},{key:"triggerDownload",value:function triggerDownload(data,mime,type,filename,newTab){var element=document.createElement("a"),blob=this.table.options.downloadEncoder(data,mime);blob&&(newTab?window.open(window.URL.createObjectURL(blob)):(filename=filename||"Tabulator."+("function"==typeof type?"txt":type),navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(blob,filename):(element.setAttribute("href",window.URL.createObjectURL(blob)),element.setAttribute("download",filename),element.style.display="none",document.body.appendChild(element),element.click(),document.body.removeChild(element))),this.dispatchExternal("downloadComplete"))}},{key:"commsReceived",value:function commsReceived(table,action,data){switch(action){case"intercept":this.download(data.type,"",data.options,data.active,data.intercept)}}}]),Download}(Module);function maskInput(el,options){var mask=options.mask,maskLetter=void 0!==options.maskLetterChar?options.maskLetterChar:"A",maskNumber=void 0!==options.maskNumberChar?options.maskNumberChar:"9",maskWildcard=void 0!==options.maskWildcardChar?options.maskWildcardChar:"*";function fillSymbols(index){var symbol=mask[index];void 0!==symbol&&symbol!==maskWildcard&&symbol!==maskLetter&&symbol!==maskNumber&&(el.value=el.value+""+symbol,fillSymbols(index+1))}el.addEventListener("keydown",(function(e){var index=el.value.length,_char=e.key;if(e.keyCode>46){if(index>=mask.length)return e.preventDefault(),e.stopPropagation(),!1;switch(mask[index]){case maskLetter:if(_char.toUpperCase()==_char.toLowerCase())return e.preventDefault(),e.stopPropagation(),!1;break;case maskNumber:if(isNaN(_char))return e.preventDefault(),e.stopPropagation(),!1;break;case maskWildcard:break;default:if(_char!==mask[index])return e.preventDefault(),e.stopPropagation(),!1}}})),el.addEventListener("keyup",(function(e){e.keyCode>46&&options.maskAutoFill&&fillSymbols(el.value.length)})),el.placeholder||(el.placeholder=mask),options.maskAutoFill&&fillSymbols(el.value.length)}function input(cell,onRendered,success,cancel,editorParams){var cellValue=cell.getValue(),input=document.createElement("input");if(input.setAttribute("type",editorParams.search?"search":"text"),input.style.padding="4px",input.style.width="100%",input.style.boxSizing="border-box",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+editorParams.elementAttributes["+"+key])):input.setAttribute(key,editorParams.elementAttributes[key]);function onChange(e){null==cellValue&&""!==input.value||input.value!==cellValue?success(input.value)&&(cellValue=input.value):cancel()}return input.value=void 0!==cellValue?cellValue:"",onRendered((function(){input.focus({preventScroll:!0}),input.style.height="100%",editorParams.selectContents&&input.select()})),input.addEventListener("change",onChange),input.addEventListener("blur",onChange),input.addEventListener("keydown",(function(e){switch(e.keyCode){case 13:onChange();break;case 27:cancel();break;case 35:case 36:e.stopPropagation()}})),editorParams.mask&&maskInput(input,editorParams),input}function textarea(cell,onRendered,success,cancel,editorParams){var cellValue=cell.getValue(),vertNav=editorParams.verticalNavigation||"hybrid",value=String(null!=cellValue?cellValue:""),input=document.createElement("textarea"),scrollHeight=0;if(input.style.display="block",input.style.padding="2px",input.style.height="100%",input.style.width="100%",input.style.boxSizing="border-box",input.style.whiteSpace="pre-wrap",input.style.resize="none",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+editorParams.elementAttributes["+"+key])):input.setAttribute(key,editorParams.elementAttributes[key]);function onChange(e){null==cellValue&&""!==input.value||input.value!==cellValue?(success(input.value)&&(cellValue=input.value),setTimeout((function(){cell.getRow().normalizeHeight()}),300)):cancel()}return input.value=value,onRendered((function(){input.focus({preventScroll:!0}),input.style.height="100%",input.scrollHeight,input.style.height=input.scrollHeight+"px",cell.getRow().normalizeHeight(),editorParams.selectContents&&input.select()})),input.addEventListener("change",onChange),input.addEventListener("blur",onChange),input.addEventListener("keyup",(function(){input.style.height="";var heightNow=input.scrollHeight;input.style.height=heightNow+"px",heightNow!=scrollHeight&&(scrollHeight=heightNow,cell.getRow().normalizeHeight())})),input.addEventListener("keydown",(function(e){switch(e.keyCode){case 13:e.shiftKey&&editorParams.shiftEnterSubmit&&onChange();break;case 27:cancel();break;case 38:("editor"==vertNav||"hybrid"==vertNav&&input.selectionStart)&&(e.stopImmediatePropagation(),e.stopPropagation());break;case 40:("editor"==vertNav||"hybrid"==vertNav&&input.selectionStart!==input.value.length)&&(e.stopImmediatePropagation(),e.stopPropagation());break;case 35:case 36:e.stopPropagation()}})),editorParams.mask&&maskInput(input,editorParams),input}function number(cell,onRendered,success,cancel,editorParams){var cellValue=cell.getValue(),vertNav=editorParams.verticalNavigation||"editor",input=document.createElement("input");if(input.setAttribute("type","number"),void 0!==editorParams.max&&input.setAttribute("max",editorParams.max),void 0!==editorParams.min&&input.setAttribute("min",editorParams.min),void 0!==editorParams.step&&input.setAttribute("step",editorParams.step),input.style.padding="4px",input.style.width="100%",input.style.boxSizing="border-box",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+editorParams.elementAttributes["+"+key])):input.setAttribute(key,editorParams.elementAttributes[key]);input.value=cellValue;var blurFunc=function blurFunc(e){onChange()};function onChange(){var value=input.value;isNaN(value)||""===value||(value=Number(value)),value!==cellValue?success(value)&&(cellValue=value):cancel()}return onRendered((function(){input.removeEventListener("blur",blurFunc),input.focus({preventScroll:!0}),input.style.height="100%",input.addEventListener("blur",blurFunc),editorParams.selectContents&&input.select()})),input.addEventListener("keydown",(function(e){switch(e.keyCode){case 13:onChange();break;case 27:cancel();break;case 38:case 40:"editor"==vertNav&&(e.stopImmediatePropagation(),e.stopPropagation());break;case 35:case 36:e.stopPropagation()}})),editorParams.mask&&maskInput(input,editorParams),input}function range(cell,onRendered,success,cancel,editorParams){var cellValue=cell.getValue(),input=document.createElement("input");if(input.setAttribute("type","range"),void 0!==editorParams.max&&input.setAttribute("max",editorParams.max),void 0!==editorParams.min&&input.setAttribute("min",editorParams.min),void 0!==editorParams.step&&input.setAttribute("step",editorParams.step),input.style.padding="4px",input.style.width="100%",input.style.boxSizing="border-box",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+editorParams.elementAttributes["+"+key])):input.setAttribute(key,editorParams.elementAttributes[key]);function onChange(){var value=input.value;isNaN(value)||""===value||(value=Number(value)),value!=cellValue?success(value)&&(cellValue=value):cancel()}return input.value=cellValue,onRendered((function(){input.focus({preventScroll:!0}),input.style.height="100%"})),input.addEventListener("blur",(function(e){onChange()})),input.addEventListener("keydown",(function(e){switch(e.keyCode){case 13:onChange();break;case 27:cancel()}})),input}function date(cell,onRendered,success,cancel,editorParams){var inputFormat=editorParams.format,DT=inputFormat?window.DateTime||luxon.DateTime:null,cellValue=cell.getValue(),input=document.createElement("input");function convertDate(value){var newDatetime;return(newDatetime=DT.isDateTime(value)?value:"iso"===inputFormat?DT.fromISO(String(value)):DT.fromFormat(String(value),inputFormat)).toFormat("yyyy-MM-dd")}if(input.type="date",input.style.padding="4px",input.style.width="100%",input.style.boxSizing="border-box",editorParams.max&&input.setAttribute("max",inputFormat?convertDate(editorParams.max):editorParams.max),editorParams.min&&input.setAttribute("min",inputFormat?convertDate(editorParams.min):editorParams.min),editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+editorParams.elementAttributes["+"+key])):input.setAttribute(key,editorParams.elementAttributes[key]);function onChange(e){var value=input.value;null==cellValue&&""!==value||value!==cellValue?(value&&inputFormat&&(value=DT.fromFormat(String(value),"yyyy-MM-dd").toFormat(inputFormat)),success(value)&&(cellValue=input.value)):cancel()}return cellValue=void 0!==cellValue?cellValue:"",inputFormat&&(DT?cellValue=convertDate(cellValue):console.error("Editor Error - 'date' editor 'inputFormat' param is dependant on luxon.js")),input.value=cellValue,onRendered((function(){input.focus({preventScroll:!0}),input.style.height="100%",editorParams.selectContents&&input.select()})),input.addEventListener("change",onChange),input.addEventListener("blur",onChange),input.addEventListener("keydown",(function(e){switch(e.keyCode){case 13:onChange();break;case 27:cancel();break;case 35:case 36:e.stopPropagation()}})),input}function time(cell,onRendered,success,cancel,editorParams){var inputFormat=editorParams.format,DT=inputFormat?window.DateTime||luxon.DateTime:null,newDatetime,cellValue=cell.getValue(),input=document.createElement("input");if(input.type="time",input.style.padding="4px",input.style.width="100%",input.style.boxSizing="border-box",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+editorParams.elementAttributes["+"+key])):input.setAttribute(key,editorParams.elementAttributes[key]);function onChange(e){var value=input.value;null==cellValue&&""!==value||value!==cellValue?(value&&inputFormat&&(value=DT.fromFormat(String(value),"hh:mm").toFormat(inputFormat)),success(value)&&(cellValue=input.value)):cancel()}return cellValue=void 0!==cellValue?cellValue:"",inputFormat&&(DT?(newDatetime=DT.isDateTime(cellValue)?cellValue:"iso"===inputFormat?DT.fromISO(String(cellValue)):DT.fromFormat(String(cellValue),inputFormat),cellValue=newDatetime.toFormat("hh:mm")):console.error("Editor Error - 'date' editor 'inputFormat' param is dependant on luxon.js")),input.value=cellValue,onRendered((function(){input.focus({preventScroll:!0}),input.style.height="100%",editorParams.selectContents&&input.select()})),input.addEventListener("change",onChange),input.addEventListener("blur",onChange),input.addEventListener("keydown",(function(e){switch(e.keyCode){case 13:onChange();break;case 27:cancel();break;case 35:case 36:e.stopPropagation()}})),input}function datetime(cell,onRendered,success,cancel,editorParams){var inputFormat=editorParams.format,DT=inputFormat?window.DateTime||luxon.DateTime:null,newDatetime,cellValue=cell.getValue(),input=document.createElement("input");if(input.type="datetime-local",input.style.padding="4px",input.style.width="100%",input.style.boxSizing="border-box",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+editorParams.elementAttributes["+"+key])):input.setAttribute(key,editorParams.elementAttributes[key]);function onChange(e){var value=input.value;null==cellValue&&""!==value||value!==cellValue?(value&&inputFormat&&(value=DT.fromISO(String(value)).toFormat(inputFormat)),success(value)&&(cellValue=input.value)):cancel()}return cellValue=void 0!==cellValue?cellValue:"",inputFormat&&(DT?(newDatetime=DT.isDateTime(cellValue)?cellValue:"iso"===inputFormat?DT.fromISO(String(cellValue)):DT.fromFormat(String(cellValue),inputFormat),cellValue=newDatetime.toFormat("yyyy-MM-dd")+"T"+newDatetime.toFormat("hh:mm")):console.error("Editor Error - 'date' editor 'inputFormat' param is dependant on luxon.js")),input.value=cellValue,onRendered((function(){input.focus({preventScroll:!0}),input.style.height="100%",editorParams.selectContents&&input.select()})),input.addEventListener("change",onChange),input.addEventListener("blur",onChange),input.addEventListener("keydown",(function(e){switch(e.keyCode){case 13:onChange();break;case 27:cancel();break;case 35:case 36:e.stopPropagation()}})),input}Download.moduleName="download",Download.downloaders=defaultDownloaders;var Edit=function(){function Edit(editor,cell,onRendered,success,cancel,editorParams){_classCallCheck(this,Edit),this.edit=editor,this.table=editor.table,this.cell=cell,this.params=this._initializeParams(editorParams),this.data=[],this.displayItems=[],this.currentItems=[],this.focusedItem=null,this.input=this._createInputElement(),this.listEl=this._createListElement(),this.initialValues=null,this.isFilter=!cell._getSelf,this.filterTimeout=null,this.filtered=!1,this.typing=!1,this.values=[],this.popup=null,this.listIteration=0,this.lastAction="",this.blurable=!0,this.actions={success:success,cancel:cancel},this._deprecatedOptionsCheck(),this._initializeValue(),onRendered(this._onRendered.bind(this))}return _createClass(Edit,[{key:"_deprecatedOptionsCheck",value:function _deprecatedOptionsCheck(){this.params.listItemFormatter&&this.cell.getTable().deprecationAdvisor.msg("The listItemFormatter editor param has been deprecated, please see the latest editor documentation for updated options"),this.params.sortValuesList&&this.cell.getTable().deprecationAdvisor.msg("The sortValuesList editor param has been deprecated, please see the latest editor documentation for updated options"),this.params.searchFunc&&this.cell.getTable().deprecationAdvisor.msg("The searchFunc editor param has been deprecated, please see the latest editor documentation for updated options"),this.params.searchingPlaceholder&&this.cell.getTable().deprecationAdvisor.msg("The searchingPlaceholder editor param has been deprecated, please see the latest editor documentation for updated options")}},{key:"_initializeValue",value:function _initializeValue(){var initialValue=this.cell.getValue();void 0===initialValue&&void 0!==this.params.defaultValue&&(initialValue=this.params.defaultValue),this.initialValues=this.params.multiselect?initialValue:[initialValue],this.isFilter&&(this.input.value=this.initialValues?this.initialValues.join(","):"",this.headerFilterInitialListGen())}},{key:"_onRendered",value:function _onRendered(){var cellEl=this.cell.getElement();function clickStop(e){e.stopPropagation()}this.input.style.height="100%",this.input.focus({preventScroll:!0}),cellEl.addEventListener("click",clickStop),setTimeout((function(){cellEl.removeEventListener("click",clickStop)}),1e3),this.input.addEventListener("mousedown",this._preventPopupBlur.bind(this))}},{key:"_createListElement",value:function _createListElement(){var listEl=document.createElement("div");return listEl.classList.add("tabulator-edit-list"),listEl.addEventListener("mousedown",this._preventBlur.bind(this)),listEl.addEventListener("keydown",this._inputKeyDown.bind(this)),listEl}},{key:"_setListWidth",value:function _setListWidth(){var element=this.isFilter?this.input:this.cell.getElement();this.listEl.style.minWidth=element.offsetWidth+"px",this.params.maxWidth&&(!0===this.params.maxWidth?this.listEl.style.maxWidth=element.offsetWidth+"px":"number"==typeof this.params.maxWidth?this.listEl.style.maxWidth=this.params.maxWidth+"px":this.listEl.style.maxWidth=this.params.maxWidth)}},{key:"_createInputElement",value:function _createInputElement(){var attribs=this.params.elementAttributes,input=document.createElement("input");if(input.setAttribute("type",this.params.clearable?"search":"text"),input.style.padding="4px",input.style.width="100%",input.style.boxSizing="border-box",this.params.autocomplete||(input.style.cursor="default",input.style.caretColor="transparent"),attribs&&"object"==_typeof(attribs))for(var key in attribs)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+attribs["+"+key])):input.setAttribute(key,attribs[key]);return this.params.mask&&maskInput(input,this.params),this._bindInputEvents(input),input}},{key:"_initializeParams",value:function _initializeParams(params){var valueKeys=["values","valuesURL","valuesLookup"],valueCheck;return(params=Object.assign({},params)).verticalNavigation=params.verticalNavigation||"editor",params.placeholderLoading=void 0===params.placeholderLoading?"Searching ...":params.placeholderLoading,params.placeholderEmpty=void 0===params.placeholderEmpty?"No Results Found":params.placeholderEmpty,params.filterDelay=void 0===params.filterDelay?300:params.filterDelay,params.emptyValue=Object.keys(params).includes("emptyValue")?params.emptyValue:"",(valueCheck=Object.keys(params).filter((function(key){return valueKeys.includes(key)})).length)?valueCheck>1&&console.warn("list editor config error - only one of the values, valuesURL, or valuesLookup options can be set on the same editor"):console.warn("list editor config error - either the values, valuesURL, or valuesLookup option must be set"),params.autocomplete?params.multiselect&&(params.multiselect=!1,console.warn("list editor config error - multiselect option is not available when autocomplete is enabled")):(params.freetext&&(params.freetext=!1,console.warn("list editor config error - freetext option is only available when autocomplete is enabled")),params.filterFunc&&(params.filterFunc=!1,console.warn("list editor config error - filterFunc option is only available when autocomplete is enabled")),params.filterRemote&&(params.filterRemote=!1,console.warn("list editor config error - filterRemote option is only available when autocomplete is enabled")),params.mask&&(params.mask=!1,console.warn("list editor config error - mask option is only available when autocomplete is enabled")),params.allowEmpty&&(params.allowEmpty=!1,console.warn("list editor config error - allowEmpty option is only available when autocomplete is enabled")),params.listOnEmpty&&(params.listOnEmpty=!1,console.warn("list editor config error - listOnEmpty option is only available when autocomplete is enabled"))),params.filterRemote&&"function"!=typeof params.valuesLookup&&!params.valuesURL&&(params.filterRemote=!1,console.warn("list editor config error - filterRemote option should only be used when values list is populated from a remote source")),params}},{key:"_bindInputEvents",value:function _bindInputEvents(input){input.addEventListener("focus",this._inputFocus.bind(this)),input.addEventListener("click",this._inputClick.bind(this)),input.addEventListener("blur",this._inputBlur.bind(this)),input.addEventListener("keydown",this._inputKeyDown.bind(this)),input.addEventListener("search",this._inputSearch.bind(this)),this.params.autocomplete&&input.addEventListener("keyup",this._inputKeyUp.bind(this))}},{key:"_inputFocus",value:function _inputFocus(e){this.rebuildOptionsList()}},{key:"_filter",value:function _filter(){var _this=this;this.params.filterRemote?(clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout((function(){_this.rebuildOptionsList()}),this.params.filterDelay)):this._filterList()}},{key:"_inputClick",value:function _inputClick(e){e.stopPropagation()}},{key:"_inputBlur",value:function _inputBlur(e){this.blurable&&(this.popup?this.popup.hide():this._resolveValue(!0))}},{key:"_inputSearch",value:function _inputSearch(){this._clearChoices()}},{key:"_inputKeyDown",value:function _inputKeyDown(e){switch(e.keyCode){case 38:this._keyUp(e);break;case 40:this._keyDown(e);break;case 37:case 39:this._keySide(e);break;case 13:this._keyEnter();break;case 27:this._keyEsc();break;case 36:case 35:this._keyHomeEnd(e);break;case 9:break;default:this._keySelectLetter(e)}}},{key:"_inputKeyUp",value:function _inputKeyUp(e){switch(e.keyCode){case 38:case 37:case 39:case 40:case 13:case 27:break;default:this._keyAutoCompLetter(e)}}},{key:"_preventPopupBlur",value:function _preventPopupBlur(){var _this2=this;this.popup&&this.popup.blockHide(),setTimeout((function(){_this2.popup&&_this2.popup.restoreHide()}),10)}},{key:"_preventBlur",value:function _preventBlur(){var _this3=this;this.blurable=!1,setTimeout((function(){_this3.blurable=!0}),10)}},{key:"_keyUp",value:function _keyUp(e){var index=this.displayItems.indexOf(this.focusedItem);("editor"==this.params.verticalNavigation||"hybrid"==this.params.verticalNavigation&&index)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),index>0&&this._focusItem(this.displayItems[index-1]))}},{key:"_keyDown",value:function _keyDown(e){var index=this.displayItems.indexOf(this.focusedItem);("editor"==this.params.verticalNavigation||"hybrid"==this.params.verticalNavigation&&index<this.displayItems.length-1)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),index<this.displayItems.length-1&&(-1==index?this._focusItem(this.displayItems[0]):this._focusItem(this.displayItems[index+1])))}},{key:"_keySide",value:function _keySide(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}},{key:"_keyEnter",value:function _keyEnter(e){this.params.autocomplete&&"typing"===this.lastAction?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem)}},{key:"_keyEsc",value:function _keyEsc(e){this._cancel()}},{key:"_keyHomeEnd",value:function _keyHomeEnd(e){this.params.autocomplete&&e.stopImmediatePropagation()}},{key:"_keySelectLetter",value:function _keySelectLetter(e){this.params.autocomplete||(e.preventDefault(),e.keyCode>=38&&e.keyCode<=90&&this._scrollToValue(e.keyCode))}},{key:"_keyAutoCompLetter",value:function _keyAutoCompLetter(e){this._filter(),this.lastAction="typing",this.typing=!0}},{key:"_scrollToValue",value:function _scrollToValue(_char){var _this4=this;clearTimeout(this.filterTimeout);var character=String.fromCharCode(_char).toLowerCase();this.filterTerm+=character.toLowerCase();var match=this.displayItems.find((function(item){return void 0!==item.label&&item.label.toLowerCase().startsWith(_this4.filterTerm)}));match&&this._focusItem(match),this.filterTimeout=setTimeout((function(){_this4.filterTerm=""}),800)}},{key:"_focusItem",value:function _focusItem(item){this.lastAction="focus",this.focusedItem&&this.focusedItem.element&&this.focusedItem.element.classList.remove("focused"),this.focusedItem=item,item&&item.element&&(item.element.classList.add("focused"),item.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}},{key:"headerFilterInitialListGen",value:function headerFilterInitialListGen(){this._generateOptions(!0)}},{key:"rebuildOptionsList",value:function rebuildOptionsList(){this._generateOptions().then(this._sortOptions.bind(this)).then(this._buildList.bind(this)).then(this._showList.bind(this)).catch((function(e){Number.isInteger(e)||console.error("List generation error",e)}))}},{key:"_filterList",value:function _filterList(){this._buildList(this._filterOptions()),this._showList()}},{key:"_generateOptions",value:function _generateOptions(silent){var _this5=this,values=[],iteration=++this.listIteration;return this.filtered=!1,this.params.values?values=this.params.values:this.params.valuesURL?values=this._ajaxRequest(this.params.valuesURL,this.input.value):"function"==typeof this.params.valuesLookup?values=this.params.valuesLookup(this.cell,this.input.value):this.params.valuesLookup&&(values=this._uniqueColumnValues(this.params.valuesLookupField)),values instanceof Promise?(silent||this._addPlaceholder(this.params.placeholderLoading),values.then().then((function(responseValues){return _this5.listIteration===iteration?_this5._parseList(responseValues):Promise.reject(iteration)}))):Promise.resolve(this._parseList(values))}},{key:"_addPlaceholder",value:function _addPlaceholder(contents){var placeholder=document.createElement("div");"function"==typeof contents&&(contents=contents(this.cell.getComponent(),this.listEl)),contents&&(this._clearList(),contents instanceof HTMLElement?placeholder=contents:(placeholder.classList.add("tabulator-edit-list-placeholder"),placeholder.innerHTML=contents),this.listEl.appendChild(placeholder),this._showList())}},{key:"_ajaxRequest",value:function _ajaxRequest(url,term){var params;return url=urlBuilder(url,{},this.params.filterRemote?{term:term}:{}),fetch(url).then((function(response){return response.ok?response.json().catch((function(error){return console.warn("List Ajax Load Error - Invalid JSON returned",error),Promise.reject(error)})):(console.error("List Ajax Load Error - Connection Error: "+response.status,response.statusText),Promise.reject(response))})).catch((function(error){return console.error("List Ajax Load Error - Connection Error: ",error),Promise.reject(error)}))}},{key:"_uniqueColumnValues",value:function _uniqueColumnValues(field){var output={},data=this.table.getData(this.params.valuesLookup),column;return(column=field?this.table.columnManager.getColumnByField(field):this.cell.getColumn()._getSelf())?data.forEach((function(row){var val=column.getFieldValue(row);null!=val&&""!==val&&(output[val]=!0)})):(console.warn("unable to find matching column to create select lookup list:",field),output=[]),Object.keys(output)}},{key:"_parseList",value:function _parseList(inputValues){var _this6=this,data=[];return Array.isArray(inputValues)||(inputValues=Object.entries(inputValues).map((function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value;return{label:_ref2[1],value:key}}))),inputValues.forEach((function(value){"object"!==_typeof(value)&&(value={label:value,value:value}),_this6._parseListItem(value,data,0)})),!this.currentItems.length&&this.params.freetext&&(this.input.value=this.initialValues,this.typing=!0,this.lastAction="typing"),this.data=data,data}},{key:"_parseListItem",value:function _parseListItem(option,data,level){var item={};option.options?item=this._parseListGroup(option,level+1):(item={label:option.label,value:option.value,itemParams:option.itemParams,elementAttributes:option.elementAttributes,element:!1,selected:!1,visible:!0,level:level,original:option},this.initialValues&&this.initialValues.indexOf(option.value)>-1&&this._chooseItem(item,!0)),data.push(item)}},{key:"_parseListGroup",value:function _parseListGroup(option,level){var _this7=this,item={label:option.label,group:!0,itemParams:option.itemParams,elementAttributes:option.elementAttributes,element:!1,visible:!0,level:level,options:[],original:option};return option.options.forEach((function(child){_this7._parseListItem(child,item.options,level)})),item}},{key:"_sortOptions",value:function _sortOptions(options){var sorter;return this.params.sort&&(sorter="function"==typeof this.params.sort?this.params.sort:this._defaultSortFunction.bind(this),this._sortGroup(sorter,options)),options}},{key:"_sortGroup",value:function _sortGroup(sorter,options){var _this8=this;options.sort((function(a,b){return sorter(a.label,b.label,a.value,b.value,a.original,b.original)})),options.forEach((function(option){option.group&&_this8._sortGroup(sorter,option.options)}))}},{key:"_defaultSortFunction",value:function _defaultSortFunction(as,bs){var a,b,a1,b1,i=0,L,rx=/(\d+)|(\D+)/g,rd=/\d/,emptyAlign=0;if("desc"===this.params.sort){var _ref3=[bs,as];as=_ref3[0],bs=_ref3[1]}if(as||0===as){if(bs||0===bs){if(isFinite(as)&&isFinite(bs))return as-bs;if((a=String(as).toLowerCase())===(b=String(bs).toLowerCase()))return 0;if(!rd.test(a)||!rd.test(b))return a>b?1:-1;for(a=a.match(rx),b=b.match(rx),L=a.length>b.length?b.length:a.length;i<L;)if((a1=a[i])!==(b1=b[i++]))return isFinite(a1)&&isFinite(b1)?("0"===a1.charAt(0)&&(a1="."+a1),"0"===b1.charAt(0)&&(b1="."+b1),a1-b1):a1>b1?1:-1;return a.length>b.length}emptyAlign=1}else emptyAlign=bs||0===bs?-1:0;return emptyAlign}},{key:"_filterOptions",value:function _filterOptions(){var _this9=this,filterFunc=this.params.filterFunc||this._defaultFilterFunc,term=this.input.value;return term?(this.filtered=!0,this.data.forEach((function(item){_this9._filterItem(filterFunc,term,item)}))):this.filtered=!1,this.data}},{key:"_filterItem",value:function _filterItem(func,term,item){var _this10=this,matches=!1;return item.group?(item.options.forEach((function(option){_this10._filterItem(func,term,option)&&(matches=!0)})),item.visible=matches):item.visible=func(term,item.label,item.value,item.original),item.visible}},{key:"_defaultFilterFunc",value:function _defaultFilterFunc(term,label,value,item){return term=String(term).toLowerCase(),null!=label&&(String(label).toLowerCase().indexOf(term)>-1||String(value).toLowerCase().indexOf(term)>-1)}},{key:"_clearList",value:function _clearList(){for(;this.listEl.firstChild;)this.listEl.removeChild(this.listEl.firstChild);this.displayItems=[]}},{key:"_buildList",value:function _buildList(data){var _this11=this;this._clearList(),data.forEach((function(option){_this11._buildItem(option)})),this.displayItems.length||this._addPlaceholder(this.params.placeholderEmpty)}},{key:"_buildItem",value:function _buildItem(item){var _this12=this,el=item.element,contents;if(!this.filtered||item.visible){if(!el){if((el=document.createElement("div")).tabIndex=0,(contents=this.params.itemFormatter?this.params.itemFormatter(item.label,item.value,item.original,el):item.label)instanceof HTMLElement?el.appendChild(contents):el.innerHTML=contents,item.group?el.classList.add("tabulator-edit-list-group"):el.classList.add("tabulator-edit-list-item"),el.classList.add("tabulator-edit-list-group-level-"+item.level),item.elementAttributes&&"object"==_typeof(item.elementAttributes))for(var key in item.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),el.setAttribute(key,this.input.getAttribute(key)+item.elementAttributes["+"+key])):el.setAttribute(key,item.elementAttributes[key]);item.group?el.addEventListener("click",this._groupClick.bind(this,item)):el.addEventListener("click",this._itemClick.bind(this,item)),el.addEventListener("mousedown",this._preventBlur.bind(this)),item.element=el}this._styleItem(item),this.listEl.appendChild(el),item.group?item.options.forEach((function(option){_this12._buildItem(option)})):this.displayItems.push(item)}}},{key:"_showList",value:function _showList(){var _this13=this,startVis=this.popup&&this.popup.isVisible();if(this.input.parentNode){if(this.params.autocomplete&&""===this.input.value&&!this.params.listOnEmpty)return void(this.popup&&this.popup.hide(!0));this._setListWidth(),this.popup||(this.popup=this.edit.popup(this.listEl)),this.popup.show(this.cell.getElement(),"bottom"),startVis||setTimeout((function(){_this13.popup.hideOnBlur(_this13._resolveValue.bind(_this13,!0))}),10)}}},{key:"_styleItem",value:function _styleItem(item){item&&item.element&&(item.selected?item.element.classList.add("active"):item.element.classList.remove("active"))}},{key:"_itemClick",value:function _itemClick(item,e){e.stopPropagation(),this._chooseItem(item)}},{key:"_groupClick",value:function _groupClick(item,e){e.stopPropagation()}},{key:"_cancel",value:function _cancel(){this.popup.hide(!0),this.actions.cancel()}},{key:"_clearChoices",value:function _clearChoices(){var _this14=this;this.typing=!0,this.currentItems.forEach((function(item){item.selected=!1,_this14._styleItem(item)})),this.currentItems=[],this.focusedItem=null}},{key:"_chooseItem",value:function _chooseItem(item,silent){var index;this.typing=!1,this.params.multiselect?((index=this.currentItems.indexOf(item))>-1?(this.currentItems.splice(index,1),item.selected=!1):(this.currentItems.push(item),item.selected=!0),this.input.value=this.currentItems.map((function(item){return item.label})).join(","),this._styleItem(item)):(this.currentItems=[item],item.selected=!0,this.input.value=item.label,this._styleItem(item),silent||this._resolveValue()),this._focusItem(item)}},{key:"_resolveValue",value:function _resolveValue(blur){var output,initialValue;if(this.popup&&this.popup.hide(!0),this.params.multiselect)output=this.currentItems.map((function(item){return item.value}));else if(blur&&this.params.autocomplete&&this.typing){if(!(this.params.freetext||this.params.allowEmpty&&""===this.input.value))return void this.actions.cancel();output=this.input.value}else output=this.currentItems[0]?this.currentItems[0].value:null==(initialValue=this.initialValues[0])||""===initialValue?initialValue:this.params.emptyValue;""===output&&(output=this.params.emptyValue),this.actions.success(output),this.isFilter&&(this.initialValues=output&&!Array.isArray(output)?[output]:output,this.currentItems=[])}}]),Edit}();function select(cell,onRendered,success,cancel,editorParams){var list;return this.deprecationMsg("The select editor has been deprecated, please use the new list editor"),new Edit(this,cell,onRendered,success,cancel,editorParams).input}function list(cell,onRendered,success,cancel,editorParams){var list;return new Edit(this,cell,onRendered,success,cancel,editorParams).input}function autocomplete(cell,onRendered,success,cancel,editorParams){var list;return this.deprecationMsg("The autocomplete editor has been deprecated, please use the new list editor with the 'autocomplete' editorParam"),editorParams.autocomplete=!0,new Edit(this,cell,onRendered,success,cancel,editorParams).input}function star(cell,onRendered,success,cancel,editorParams){var self=this,element=cell.getElement(),value=cell.getValue(),maxStars=element.getElementsByTagName("svg").length||5,size=element.getElementsByTagName("svg")[0]?element.getElementsByTagName("svg")[0].getAttribute("width"):14,stars=[],starsHolder=document.createElement("div"),star=document.createElementNS("http://www.w3.org/2000/svg","svg");function starChange(val){stars.forEach((function(star,i){i<val?("ie"==self.table.browser?star.setAttribute("class","tabulator-star-active"):star.classList.replace("tabulator-star-inactive","tabulator-star-active"),star.innerHTML='<polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>'):("ie"==self.table.browser?star.setAttribute("class","tabulator-star-inactive"):star.classList.replace("tabulator-star-active","tabulator-star-inactive"),star.innerHTML='<polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>')}))}function buildStar(i){var starHolder=document.createElement("span"),nextStar=star.cloneNode(!0);stars.push(nextStar),starHolder.addEventListener("mouseenter",(function(e){e.stopPropagation(),e.stopImmediatePropagation(),starChange(i)})),starHolder.addEventListener("mousemove",(function(e){e.stopPropagation(),e.stopImmediatePropagation()})),starHolder.addEventListener("click",(function(e){e.stopPropagation(),e.stopImmediatePropagation(),success(i),element.blur()})),starHolder.appendChild(nextStar),starsHolder.appendChild(starHolder)}function changeValue(val){value=val,starChange(val)}if(element.style.whiteSpace="nowrap",element.style.overflow="hidden",element.style.textOverflow="ellipsis",starsHolder.style.verticalAlign="middle",starsHolder.style.display="inline-block",starsHolder.style.padding="4px",star.setAttribute("width",size),star.setAttribute("height",size),star.setAttribute("viewBox","0 0 512 512"),star.setAttribute("xml:space","preserve"),star.style.padding="0 1px",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),starsHolder.setAttribute(key,starsHolder.getAttribute(key)+editorParams.elementAttributes["+"+key])):starsHolder.setAttribute(key,editorParams.elementAttributes[key]);for(var i=1;i<=maxStars;i++)buildStar(i);return starChange(value=Math.min(parseInt(value),maxStars)),starsHolder.addEventListener("mousemove",(function(e){starChange(0)})),starsHolder.addEventListener("click",(function(e){success(0)})),element.addEventListener("blur",(function(e){cancel()})),element.addEventListener("keydown",(function(e){switch(e.keyCode){case 39:changeValue(value+1);break;case 37:changeValue(value-1);break;case 13:success(value);break;case 27:cancel()}})),starsHolder}function progress(cell,onRendered,success,cancel,editorParams){var element=cell.getElement(),max=void 0===editorParams.max?element.getElementsByTagName("div")[0]&&element.getElementsByTagName("div")[0].getAttribute("max")||100:editorParams.max,min=void 0===editorParams.min?element.getElementsByTagName("div")[0]&&element.getElementsByTagName("div")[0].getAttribute("min")||0:editorParams.min,percent=(max-min)/100,value=cell.getValue()||0,handle=document.createElement("div"),bar=document.createElement("div"),mouseDrag,mouseDragWidth;function updateValue(){var style=window.getComputedStyle(element,null),calcVal=percent*Math.round(bar.offsetWidth/((element.clientWidth-parseInt(style.getPropertyValue("padding-left"))-parseInt(style.getPropertyValue("padding-right")))/100))+min;success(calcVal),element.setAttribute("aria-valuenow",calcVal),element.setAttribute("aria-label",value)}if(handle.style.position="absolute",handle.style.right="0",handle.style.top="0",handle.style.bottom="0",handle.style.width="5px",handle.classList.add("tabulator-progress-handle"),bar.style.display="inline-block",bar.style.position="relative",bar.style.height="100%",bar.style.backgroundColor="#488CE9",bar.style.maxWidth="100%",bar.style.minWidth="0%",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),bar.setAttribute(key,bar.getAttribute(key)+editorParams.elementAttributes["+"+key])):bar.setAttribute(key,editorParams.elementAttributes[key]);return element.style.padding="4px 4px",value=Math.min(parseFloat(value),max),value=Math.max(parseFloat(value),min),value=Math.round((value-min)/percent),bar.style.width=value+"%",element.setAttribute("aria-valuemin",min),element.setAttribute("aria-valuemax",max),bar.appendChild(handle),handle.addEventListener("mousedown",(function(e){mouseDrag=e.screenX,mouseDragWidth=bar.offsetWidth})),handle.addEventListener("mouseover",(function(){handle.style.cursor="ew-resize"})),element.addEventListener("mousemove",(function(e){mouseDrag&&(bar.style.width=mouseDragWidth+e.screenX-mouseDrag+"px")})),element.addEventListener("mouseup",(function(e){mouseDrag&&(e.stopPropagation(),e.stopImmediatePropagation(),mouseDrag=!1,mouseDragWidth=!1,updateValue())})),element.addEventListener("keydown",(function(e){switch(e.keyCode){case 39:e.preventDefault(),bar.style.width=bar.clientWidth+element.clientWidth/100+"px";break;case 37:e.preventDefault(),bar.style.width=bar.clientWidth-element.clientWidth/100+"px";break;case 9:case 13:updateValue();break;case 27:cancel()}})),element.addEventListener("blur",(function(){cancel()})),bar}function tickCross(cell,onRendered,success,cancel,editorParams){var value=cell.getValue(),input=document.createElement("input"),tristate=editorParams.tristate,indetermValue=void 0===editorParams.indeterminateValue?null:editorParams.indeterminateValue,indetermState=!1,trueValueSet=Object.keys(editorParams).includes("trueValue"),falseValueSet=Object.keys(editorParams).includes("falseValue");if(input.setAttribute("type","checkbox"),input.style.marginTop="5px",input.style.boxSizing="border-box",editorParams.elementAttributes&&"object"==_typeof(editorParams.elementAttributes))for(var key in editorParams.elementAttributes)"+"==key.charAt(0)?(key=key.slice(1),input.setAttribute(key,input.getAttribute(key)+editorParams.elementAttributes["+"+key])):input.setAttribute(key,editorParams.elementAttributes[key]);function setValue(blur){var checkedValue=input.checked;return trueValueSet&&checkedValue?checkedValue=editorParams.trueValue:falseValueSet&&!checkedValue&&(checkedValue=editorParams.falseValue),tristate?blur?indetermState?indetermValue:checkedValue:input.checked&&!indetermState?(input.checked=!1,input.indeterminate=!0,indetermState=!0,indetermValue):(indetermState=!1,checkedValue):checkedValue}return input.value=value,!tristate||void 0!==value&&value!==indetermValue&&""!==value||(indetermState=!0,input.indeterminate=!0),"firefox"!=this.table.browser&&onRendered((function(){input.focus({preventScroll:!0})})),input.checked=trueValueSet?value===editorParams.trueValue:!0===value||"true"===value||"True"===value||1===value,onRendered((function(){input.focus()})),input.addEventListener("change",(function(e){success(setValue())})),input.addEventListener("blur",(function(e){success(setValue(!0))})),input.addEventListener("keydown",(function(e){13==e.keyCode&&success(setValue()),27==e.keyCode&&cancel()})),input}var defaultEditors={input:input,textarea:textarea,number:number,range:range,date:date,time:time,datetime:datetime,select:select,list:list,autocomplete:autocomplete,star:star,progress:progress,tickCross:tickCross},Edit$1=function(_Module){_inherits(Edit,_Module);var _super=_createSuper(Edit);function Edit(table){var _this;return _classCallCheck(this,Edit),(_this=_super.call(this,table)).currentCell=!1,_this.mouseClick=!1,_this.recursionBlock=!1,_this.invalidEdit=!1,_this.editedCells=[],_this.editors=Edit.editors,_this.registerColumnOption("editable"),_this.registerColumnOption("editor"),_this.registerColumnOption("editorParams"),_this.registerColumnOption("cellEditing"),_this.registerColumnOption("cellEdited"),_this.registerColumnOption("cellEditCancelled"),_this.registerTableFunction("getEditedCells",_this.getEditedCells.bind(_assertThisInitialized(_this))),_this.registerTableFunction("clearCellEdited",_this.clearCellEdited.bind(_assertThisInitialized(_this))),_this.registerTableFunction("navigatePrev",_this.navigatePrev.bind(_assertThisInitialized(_this))),_this.registerTableFunction("navigateNext",_this.navigateNext.bind(_assertThisInitialized(_this))),_this.registerTableFunction("navigateLeft",_this.navigateLeft.bind(_assertThisInitialized(_this))),_this.registerTableFunction("navigateRight",_this.navigateRight.bind(_assertThisInitialized(_this))),_this.registerTableFunction("navigateUp",_this.navigateUp.bind(_assertThisInitialized(_this))),_this.registerTableFunction("navigateDown",_this.navigateDown.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("cell","isEdited",_this.cellIsEdited.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("cell","clearEdited",_this.clearEdited.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("cell","edit",_this.editCell.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("cell","cancelEdit",_this.cellCancelEdit.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("cell","navigatePrev",_this.navigatePrev.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("cell","navigateNext",_this.navigateNext.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("cell","navigateLeft",_this.navigateLeft.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("cell","navigateRight",_this.navigateRight.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("cell","navigateUp",_this.navigateUp.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("cell","navigateDown",_this.navigateDown.bind(_assertThisInitialized(_this))),_this}return _createClass(Edit,[{key:"initialize",value:function initialize(){this.subscribe("cell-init",this.bindEditor.bind(this)),this.subscribe("cell-delete",this.clearEdited.bind(this)),this.subscribe("cell-value-changed",this.updateCellClass.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("column-delete",this.columnDeleteCheck.bind(this)),this.subscribe("row-deleting",this.rowDeleteCheck.bind(this)),this.subscribe("data-refreshing",this.cancelEdit.bind(this)),this.subscribe("keybinding-nav-prev",this.navigatePrev.bind(this,void 0)),this.subscribe("keybinding-nav-next",this.keybindingNavigateNext.bind(this)),this.subscribe("keybinding-nav-left",this.navigateLeft.bind(this,void 0)),this.subscribe("keybinding-nav-right",this.navigateRight.bind(this,void 0)),this.subscribe("keybinding-nav-up",this.navigateUp.bind(this,void 0)),this.subscribe("keybinding-nav-down",this.navigateDown.bind(this,void 0))}},{key:"keybindingNavigateNext",value:function keybindingNavigateNext(e){var cell=this.currentCell,newRow=this.options("tabEndNewRow");cell&&(this.navigateNext(cell,e)||newRow&&(cell.getElement().firstChild.blur(),(newRow=!0===newRow?this.table.addRow({}):"function"==typeof newRow?this.table.addRow(newRow(cell.row.getComponent())):this.table.addRow(Object.assign({},newRow))).then((function(){setTimeout((function(){cell.getComponent().navigateNext()}))}))))}},{key:"cellIsEdited",value:function cellIsEdited(cell){return!!cell.modules.edit&&cell.modules.edit.edited}},{key:"cellCancelEdit",value:function cellCancelEdit(cell){cell===this.currentCell?this.table.modules.edit.cancelEdit():console.warn("Cancel Editor Error - This cell is not currently being edited ")}},{key:"updateCellClass",value:function updateCellClass(cell){this.allowEdit(cell)?cell.getElement().classList.add("tabulator-editable"):cell.getElement().classList.remove("tabulator-editable")}},{key:"clearCellEdited",value:function clearCellEdited(cells){var _this2=this;cells||(cells=this.table.modules.edit.getEditedCells()),Array.isArray(cells)||(cells=[cells]),cells.forEach((function(cell){_this2.table.modules.edit.clearEdited(cell._getSelf())}))}},{key:"navigatePrev",value:function navigatePrev(){var cell=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentCell,e=arguments.length>1?arguments[1]:void 0,nextCell,prevRow;if(cell){if(e&&e.preventDefault(),nextCell=this.navigateLeft())return!0;if((prevRow=this.table.rowManager.prevDisplayRow(cell.row,!0))&&(nextCell=this.findNextEditableCell(prevRow,prevRow.cells.length)))return nextCell.getComponent().edit(),!0}return!1}},{key:"navigateNext",value:function navigateNext(){var cell=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentCell,e=arguments.length>1?arguments[1]:void 0,nextCell,nextRow;if(cell){if(e&&e.preventDefault(),nextCell=this.navigateRight())return!0;if((nextRow=this.table.rowManager.nextDisplayRow(cell.row,!0))&&(nextCell=this.findNextEditableCell(nextRow,-1)))return nextCell.getComponent().edit(),!0}return!1}},{key:"navigateLeft",value:function navigateLeft(){var cell=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentCell,e=arguments.length>1?arguments[1]:void 0,index,nextCell;return!!(cell&&(e&&e.preventDefault(),index=cell.getIndex(),nextCell=this.findPrevEditableCell(cell.row,index)))&&(nextCell.getComponent().edit(),!0)}},{key:"navigateRight",value:function navigateRight(){var cell=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentCell,e=arguments.length>1?arguments[1]:void 0,index,nextCell;return!!(cell&&(e&&e.preventDefault(),index=cell.getIndex(),nextCell=this.findNextEditableCell(cell.row,index)))&&(nextCell.getComponent().edit(),!0)}},{key:"navigateUp",value:function navigateUp(){var cell=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentCell,e=arguments.length>1?arguments[1]:void 0,index,nextRow;return!!(cell&&(e&&e.preventDefault(),index=cell.getIndex(),nextRow=this.table.rowManager.prevDisplayRow(cell.row,!0)))&&(nextRow.cells[index].getComponent().edit(),!0)}},{key:"navigateDown",value:function navigateDown(){var cell=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentCell,e=arguments.length>1?arguments[1]:void 0,index,nextRow;return!!(cell&&(e&&e.preventDefault(),index=cell.getIndex(),nextRow=this.table.rowManager.nextDisplayRow(cell.row,!0)))&&(nextRow.cells[index].getComponent().edit(),!0)}},{key:"findNextEditableCell",value:function findNextEditableCell(row,index){var nextCell=!1;if(index<row.cells.length-1)for(var i=index+1;i<row.cells.length;i++){var cell=row.cells[i],allowEdit;if(cell.column.modules.edit&&Helpers.elVisible(cell.getElement()))if(this.allowEdit(cell)){nextCell=cell;break}}return nextCell}},{key:"findPrevEditableCell",value:function findPrevEditableCell(row,index){var prevCell=!1;if(index>0)for(var i=index-1;i>=0;i--){var cell=row.cells[i],allowEdit;if(cell.column.modules.edit&&Helpers.elVisible(cell.getElement()))if(this.allowEdit(cell)){prevCell=cell;break}}return prevCell}},{key:"initializeColumnCheck",value:function initializeColumnCheck(column){void 0!==column.definition.editor&&this.initializeColumn(column)}},{key:"columnDeleteCheck",value:function columnDeleteCheck(column){this.currentCell&&this.currentCell.column===column&&this.cancelEdit()}},{key:"rowDeleteCheck",value:function rowDeleteCheck(row){this.currentCell&&this.currentCell.row===row&&this.cancelEdit()}},{key:"initializeColumn",value:function initializeColumn(column){var config={editor:!1,blocked:!1,check:column.definition.editable,params:column.definition.editorParams||{}};switch(_typeof(column.definition.editor)){case"string":this.editors[column.definition.editor]?config.editor=this.editors[column.definition.editor]:console.warn("Editor Error - No such editor found: ",column.definition.editor);break;case"function":config.editor=column.definition.editor;break;case"boolean":!0===column.definition.editor&&("function"!=typeof column.definition.formatter?this.editors[column.definition.formatter]?config.editor=this.editors[column.definition.formatter]:config.editor=this.editors.input:console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ",column.definition.formatter))}config.editor&&(column.modules.edit=config)}},{key:"getCurrentCell",value:function getCurrentCell(){return!!this.currentCell&&this.currentCell.getComponent()}},{key:"clearEditor",value:function clearEditor(cancel){var cell=this.currentCell,cellEl;if(this.invalidEdit=!1,cell){for(this.currentCell=!1,cellEl=cell.getElement(),this.dispatch("edit-editor-clear",cell,cancel),cellEl.classList.remove("tabulator-editing");cellEl.firstChild;)cellEl.removeChild(cellEl.firstChild);cell.row.getElement().classList.remove("tabulator-editing"),cell.table.element.classList.remove("tabulator-editing")}}},{key:"cancelEdit",value:function cancelEdit(){if(this.currentCell){var cell=this.currentCell,component=this.currentCell.getComponent();this.clearEditor(!0),cell.setValueActual(cell.getValue()),cell.cellRendered(),("textarea"==cell.column.definition.editor||cell.column.definition.variableHeight)&&cell.row.normalizeHeight(!0),cell.column.definition.cellEditCancelled&&cell.column.definition.cellEditCancelled.call(this.table,component),this.dispatch("edit-cancelled",cell),this.dispatchExternal("cellEditCancelled",component)}}},{key:"bindEditor",value:function bindEditor(cell){if(cell.column.modules.edit){var self=this,element=cell.getElement(!0);this.updateCellClass(cell),element.setAttribute("tabindex",0),element.addEventListener("click",(function(e){element.classList.contains("tabulator-editing")||element.focus({preventScroll:!0})})),element.addEventListener("mousedown",(function(e){2===e.button?e.preventDefault():self.mouseClick=!0})),element.addEventListener("focus",(function(e){self.recursionBlock||self.edit(cell,e,!1)}))}}},{key:"focusCellNoEvent",value:function focusCellNoEvent(cell,block){this.recursionBlock=!0,block&&"ie"===this.table.browser||cell.getElement().focus({preventScroll:!0}),this.recursionBlock=!1}},{key:"editCell",value:function editCell(cell,forceEdit){this.focusCellNoEvent(cell),this.edit(cell,!1,forceEdit)}},{key:"focusScrollAdjust",value:function focusScrollAdjust(cell){if("virtual"==this.table.rowManager.getRenderMode()){var topEdge=this.table.rowManager.element.scrollTop,bottomEdge=this.table.rowManager.element.clientHeight+this.table.rowManager.element.scrollTop,rowEl=cell.row.getElement();rowEl.offsetTop<topEdge?this.table.rowManager.element.scrollTop-=topEdge-rowEl.offsetTop:rowEl.offsetTop+rowEl.offsetHeight>bottomEdge&&(this.table.rowManager.element.scrollTop+=rowEl.offsetTop+rowEl.offsetHeight-bottomEdge);var leftEdge=this.table.rowManager.element.scrollLeft,rightEdge=this.table.rowManager.element.clientWidth+this.table.rowManager.element.scrollLeft,cellEl=cell.getElement();this.table.modExists("frozenColumns")&&(leftEdge+=parseInt(this.table.modules.frozenColumns.leftMargin),rightEdge-=parseInt(this.table.modules.frozenColumns.rightMargin)),"virtual"===this.table.options.renderHorizontal&&(leftEdge-=parseInt(this.table.columnManager.renderer.vDomPadLeft),rightEdge-=parseInt(this.table.columnManager.renderer.vDomPadLeft)),cellEl.offsetLeft<leftEdge?this.table.rowManager.element.scrollLeft-=leftEdge-cellEl.offsetLeft:cellEl.offsetLeft+cellEl.offsetWidth>rightEdge&&(this.table.rowManager.element.scrollLeft+=cellEl.offsetLeft+cellEl.offsetWidth-rightEdge)}}},{key:"allowEdit",value:function allowEdit(cell){var check=!!cell.column.modules.edit;if(cell.column.modules.edit)switch(_typeof(cell.column.modules.edit.check)){case"function":check=cell.column.modules.edit.check(cell.getComponent());break;case"string":check=!!cell.row.data[cell.column.modules.edit.check];break;case"boolean":check=cell.column.modules.edit.check}return check}},{key:"edit",value:function edit(cell,e,forceEdit){var self=this,allowEdit=!0,rendered=function rendered(){},element=cell.getElement(),cellEditor,component,params;if(!this.currentCell){if(cell.column.modules.edit.blocked)return this.mouseClick=!1,element.blur(),!1;if(e&&e.stopPropagation(),(allowEdit=this.allowEdit(cell))||forceEdit){if(self.cancelEdit(),self.currentCell=cell,this.focusScrollAdjust(cell),component=cell.getComponent(),this.mouseClick&&(this.mouseClick=!1,cell.column.definition.cellClick&&cell.column.definition.cellClick.call(this.table,e,component)),cell.column.definition.cellEditing&&cell.column.definition.cellEditing.call(this.table,component),this.dispatch("cell-editing",cell),this.dispatchExternal("cellEditing",component),params="function"==typeof cell.column.modules.edit.params?cell.column.modules.edit.params(component):cell.column.modules.edit.params,!1===(cellEditor=cell.column.modules.edit.editor.call(self,component,onRendered,success,cancel,params)))return element.blur(),!1;if(!(cellEditor instanceof Node))return console.warn("Edit Error - Editor should return an instance of Node, the editor returned:",cellEditor),element.blur(),!1;for(element.classList.add("tabulator-editing"),cell.row.getElement().classList.add("tabulator-editing"),cell.table.element.classList.add("tabulator-editing");element.firstChild;)element.removeChild(element.firstChild);element.appendChild(cellEditor),rendered();for(var children=element.children,i=0;i<children.length;i++)children[i].addEventListener("click",(function(e){e.stopPropagation()}));return!0}return this.mouseClick=!1,element.blur(),!1}function success(value){if(self.currentCell===cell){var valid=self.chain("edit-success",[cell,value],!0,!0);return!0===valid||"highlight"===self.table.options.validationMode?(self.clearEditor(),cell.modules.edit||(cell.modules.edit={}),cell.modules.edit.edited=!0,-1==self.editedCells.indexOf(cell)&&self.editedCells.push(cell),cell.setValue(value,!0),!0===valid):(self.invalidEdit=!0,self.focusCellNoEvent(cell,!0),rendered(),!1)}}function cancel(){self.currentCell===cell&&self.cancelEdit()}function onRendered(callback){rendered=callback}this.invalidEdit||this.cancelEdit()}},{key:"getEditedCells",value:function getEditedCells(){var output=[];return this.editedCells.forEach((function(cell){output.push(cell.getComponent())})),output}},{key:"clearEdited",value:function clearEdited(cell){var editIndex;cell.modules.edit&&cell.modules.edit.edited&&(cell.modules.edit.edited=!1,this.dispatch("edit-edited-clear",cell)),(editIndex=this.editedCells.indexOf(cell))>-1&&this.editedCells.splice(editIndex,1)}}]),Edit}(Module);Edit$1.moduleName="edit",Edit$1.editors=defaultEditors;var ExportRow=function ExportRow(type,columns,component,indent){_classCallCheck(this,ExportRow),this.type=type,this.columns=columns,this.component=component||!1,this.indent=indent||0},ExportColumn=function ExportColumn(value,component,width,height,depth){_classCallCheck(this,ExportColumn),this.value=value,this.component=component||!1,this.width=width,this.height=height,this.depth=depth},Export=function(_Module){_inherits(Export,_Module);var _super=_createSuper(Export);function Export(table){var _this;return _classCallCheck(this,Export),(_this=_super.call(this,table)).config={},_this.cloneTableStyle=!0,_this.colVisProp="",_this.registerTableOption("htmlOutputConfig",!1),_this.registerColumnOption("htmlOutput"),_this.registerColumnOption("titleHtmlOutput"),_this}return _createClass(Export,[{key:"initialize",value:function initialize(){this.registerTableFunction("getHtml",this.getHtml.bind(this))}},{key:"generateExportList",value:function generateExportList(config,style,range,colVisProp){this.cloneTableStyle=style,this.config=config||{},this.colVisProp=colVisProp;var headers=!1!==this.config.columnHeaders?this.headersToExportRows(this.generateColumnGroupHeaders()):[],body=this.bodyToExportRows(this.rowLookup(range));return headers.concat(body)}},{key:"generateTable",value:function generateTable(config,style,range,colVisProp){var list=this.generateExportList(config,style,range,colVisProp);return this.generateTableElement(list)}},{key:"rowLookup",value:function rowLookup(range){var _this2=this,rows=[];if("function"==typeof range)range.call(this.table).forEach((function(row){(row=_this2.table.rowManager.findRow(row))&&rows.push(row)}));else switch(range){case!0:case"visible":rows=this.table.rowManager.getVisibleRows(!1,!0);break;case"all":rows=this.table.rowManager.rows;break;case"selected":rows=this.table.modules.selectRow.selectedRows;break;case"active":default:rows=this.table.options.pagination?this.table.rowManager.getDisplayRows(this.table.rowManager.displayRows.length-2):this.table.rowManager.getDisplayRows()}return Object.assign([],rows)}},{key:"generateColumnGroupHeaders",value:function generateColumnGroupHeaders(){var _this3=this,output=[],columns;return(!1!==this.config.columnGroups?this.table.columnManager.columns:this.table.columnManager.columnsByIndex).forEach((function(column){var colData=_this3.processColumnGroup(column);colData&&output.push(colData)})),output}},{key:"processColumnGroup",value:function processColumnGroup(column){var _this4=this,subGroups=column.columns,maxDepth=0,title,groupData={title:column.definition["title"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))]||column.definition.title,column:column,depth:1};if(subGroups.length){if(groupData.subGroups=[],groupData.width=0,subGroups.forEach((function(subGroup){var subGroupData=_this4.processColumnGroup(subGroup);subGroupData&&(groupData.width+=subGroupData.width,groupData.subGroups.push(subGroupData),subGroupData.depth>maxDepth&&(maxDepth=subGroupData.depth))})),groupData.depth+=maxDepth,!groupData.width)return!1}else{if(!this.columnVisCheck(column))return!1;groupData.width=1}return groupData}},{key:"columnVisCheck",value:function columnVisCheck(column){var visProp=column.definition[this.colVisProp];return"function"==typeof visProp&&(visProp=visProp.call(this.table,column.getComponent())),!1!==visProp&&(column.visible||!column.visible&&visProp)}},{key:"headersToExportRows",value:function headersToExportRows(columns){var headers=[],headerDepth=0,exportRows=[];function parseColumnGroup(column,level){var depth=headerDepth-level;if(void 0===headers[level]&&(headers[level]=[]),column.height=column.subGroups?1:depth-column.depth+1,headers[level].push(column),column.height>1)for(var i=1;i<column.height;i++)void 0===headers[level+i]&&(headers[level+i]=[]),headers[level+i].push(!1);if(column.width>1)for(var _i=1;_i<column.width;_i++)headers[level].push(!1);column.subGroups&&column.subGroups.forEach((function(subGroup){parseColumnGroup(subGroup,level+1)}))}return columns.forEach((function(column){column.depth>headerDepth&&(headerDepth=column.depth)})),columns.forEach((function(column){parseColumnGroup(column,0)})),headers.forEach((function(header){var columns=[];header.forEach((function(col){if(col){var title=void 0===col.title?"":col.title;columns.push(new ExportColumn(title,col.column.getComponent(),col.width,col.height,col.depth))}else columns.push(null)})),exportRows.push(new ExportRow("header",columns))})),exportRows}},{key:"bodyToExportRows",value:function bodyToExportRows(rows){var _this5=this,columns=[],exportRows=[];return this.table.columnManager.columnsByIndex.forEach((function(column){_this5.columnVisCheck(column)&&columns.push(column.getComponent())})),!1!==this.config.columnCalcs&&this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&rows.unshift(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&rows.push(this.table.modules.columnCalcs.botRow)),(rows=rows.filter((function(row){switch(row.type){case"group":return!1!==_this5.config.rowGroups;case"calc":return!1!==_this5.config.columnCalcs;case"row":return!(_this5.table.options.dataTree&&!1===_this5.config.dataTree&&row.modules.dataTree.parent)}return!0}))).forEach((function(row,i){var rowData=row.getData(_this5.colVisProp),exportCols=[],indent=0;switch(row.type){case"group":indent=row.level,exportCols.push(new ExportColumn(row.key,row.getComponent(),columns.length,1));break;case"calc":case"row":columns.forEach((function(col){exportCols.push(new ExportColumn(col._column.getFieldValue(rowData),col,1,1))})),_this5.table.options.dataTree&&!1!==_this5.config.dataTree&&(indent=row.modules.dataTree.index)}exportRows.push(new ExportRow(row.type,exportCols,row.getComponent(),indent))})),exportRows}},{key:"generateTableElement",value:function generateTableElement(list){var _this6=this,table=document.createElement("table"),headerEl=document.createElement("thead"),bodyEl=document.createElement("tbody"),styles=this.lookupTableStyles(),rowFormatter=this.table.options["rowFormatter"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))],setup={};return setup.rowFormatter=null!==rowFormatter?rowFormatter:this.table.options.rowFormatter,this.table.options.dataTree&&!1!==this.config.dataTree&&this.table.modExists("columnCalcs")&&(setup.treeElementField=this.table.modules.dataTree.elementField),setup.groupHeader=this.table.options["groupHeader"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))],setup.groupHeader&&!Array.isArray(setup.groupHeader)&&(setup.groupHeader=[setup.groupHeader]),table.classList.add("tabulator-print-table"),this.mapElementStyles(this.table.columnManager.getHeadersElement(),headerEl,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),list.length>1e3&&console.warn("It may take a long time to render an HTML table with more than 1000 rows"),list.forEach((function(row,i){var rowEl;switch(row.type){case"header":headerEl.appendChild(_this6.generateHeaderElement(row,setup,styles));break;case"group":bodyEl.appendChild(_this6.generateGroupElement(row,setup,styles));break;case"calc":bodyEl.appendChild(_this6.generateCalcElement(row,setup,styles));break;case"row":rowEl=_this6.generateRowElement(row,setup,styles),_this6.mapElementStyles(i%2&&styles.evenRow?styles.evenRow:styles.oddRow,rowEl,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),bodyEl.appendChild(rowEl)}})),headerEl.innerHTML&&table.appendChild(headerEl),table.appendChild(bodyEl),this.mapElementStyles(this.table.element,table,["border-top","border-left","border-right","border-bottom"]),table}},{key:"lookupTableStyles",value:function lookupTableStyles(){var styles={};return this.cloneTableStyle&&window.getComputedStyle&&(styles.oddRow=this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)"),styles.evenRow=this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)"),styles.calcRow=this.table.element.querySelector(".tabulator-row.tabulator-calcs"),styles.firstRow=this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)"),styles.firstGroup=this.table.element.getElementsByClassName("tabulator-group")[0],styles.firstRow&&(styles.styleCells=styles.firstRow.getElementsByClassName("tabulator-cell"),styles.firstCell=styles.styleCells[0],styles.lastCell=styles.styleCells[styles.styleCells.length-1])),styles}},{key:"generateHeaderElement",value:function generateHeaderElement(row,setup,styles){var _this7=this,rowEl=document.createElement("tr");return row.columns.forEach((function(column){if(column){var cellEl=document.createElement("th"),classNames=column.component._column.definition.cssClass?column.component._column.definition.cssClass.split(" "):[];cellEl.colSpan=column.width,cellEl.rowSpan=column.height,cellEl.innerHTML=column.value,_this7.cloneTableStyle&&(cellEl.style.boxSizing="border-box"),classNames.forEach((function(className){cellEl.classList.add(className)})),_this7.mapElementStyles(column.component.getElement(),cellEl,["text-align","border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),_this7.mapElementStyles(column.component._column.contentElement,cellEl,["padding-top","padding-left","padding-right","padding-bottom"]),column.component._column.visible?_this7.mapElementStyles(column.component.getElement(),cellEl,["width"]):column.component._column.definition.width&&(cellEl.style.width=column.component._column.definition.width+"px"),column.component._column.parent&&_this7.mapElementStyles(column.component._column.parent.groupElement,cellEl,["border-top"]),rowEl.appendChild(cellEl)}})),rowEl}},{key:"generateGroupElement",value:function generateGroupElement(row,setup,styles){var rowEl=document.createElement("tr"),cellEl=document.createElement("td"),group=row.columns[0];return rowEl.classList.add("tabulator-print-table-row"),setup.groupHeader&&setup.groupHeader[row.indent]?group.value=setup.groupHeader[row.indent](group.value,row.component._group.getRowCount(),row.component._group.getData(),row.component):!1!==setup.groupHeader&&(group.value=row.component._group.generator(group.value,row.component._group.getRowCount(),row.component._group.getData(),row.component)),cellEl.colSpan=group.width,cellEl.innerHTML=group.value,rowEl.classList.add("tabulator-print-table-group"),rowEl.classList.add("tabulator-group-level-"+row.indent),group.component.isVisible()&&rowEl.classList.add("tabulator-group-visible"),this.mapElementStyles(styles.firstGroup,rowEl,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),this.mapElementStyles(styles.firstGroup,cellEl,["padding-top","padding-left","padding-right","padding-bottom"]),rowEl.appendChild(cellEl),rowEl}},{key:"generateCalcElement",value:function generateCalcElement(row,setup,styles){var rowEl=this.generateRowElement(row,setup,styles);return rowEl.classList.add("tabulator-print-table-calcs"),this.mapElementStyles(styles.calcRow,rowEl,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),rowEl}},{key:"generateRowElement",value:function generateRowElement(row,setup,styles){var _this8=this,rowEl=document.createElement("tr");return rowEl.classList.add("tabulator-print-table-row"),row.columns.forEach((function(col,i){if(col){var cellEl=document.createElement("td"),column=col.component._column,index=_this8.table.columnManager.findColumnIndex(column),value=col.value,cellStyle,cellWrapper={modules:{},getValue:function getValue(){return value},getField:function getField(){return column.definition.field},getElement:function getElement(){return cellEl},getColumn:function getColumn(){return column.getComponent()},getData:function getData(){return row.component.getData()},getRow:function getRow(){return row.component},getComponent:function getComponent(){return cellWrapper},column:column},classNames;if((column.definition.cssClass?column.definition.cssClass.split(" "):[]).forEach((function(className){cellEl.classList.add(className)})),_this8.table.modExists("format")&&!1!==_this8.config.formatCells)value=_this8.table.modules.format.formatExportValue(cellWrapper,_this8.colVisProp);else switch(_typeof(value)){case"object":value=null!==value?JSON.stringify(value):"";break;case"undefined":value=""}value instanceof Node?cellEl.appendChild(value):cellEl.innerHTML=value,(cellStyle=styles.styleCells&&styles.styleCells[index]?styles.styleCells[index]:styles.firstCell)&&(_this8.mapElementStyles(cellStyle,cellEl,["padding-top","padding-left","padding-right","padding-bottom","border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","text-align"]),column.definition.align&&(cellEl.style.textAlign=column.definition.align)),_this8.table.options.dataTree&&!1!==_this8.config.dataTree&&(setup.treeElementField&&setup.treeElementField==column.field||!setup.treeElementField&&0==i)&&(row.component._row.modules.dataTree.controlEl&&cellEl.insertBefore(row.component._row.modules.dataTree.controlEl.cloneNode(!0),cellEl.firstChild),row.component._row.modules.dataTree.branchEl&&cellEl.insertBefore(row.component._row.modules.dataTree.branchEl.cloneNode(!0),cellEl.firstChild)),rowEl.appendChild(cellEl),cellWrapper.modules.format&&cellWrapper.modules.format.renderedCallback&&cellWrapper.modules.format.renderedCallback(),setup.rowFormatter&&!1!==_this8.config.formatCells&&setup.rowFormatter(row.component)}})),rowEl}},{key:"generateHTMLTable",value:function generateHTMLTable(list){var holder=document.createElement("div");return holder.appendChild(this.generateTableElement(list)),holder.innerHTML}},{key:"getHtml",value:function getHtml(visible,style,config,colVisProp){var list=this.generateExportList(config||this.table.options.htmlOutputConfig,style,visible,colVisProp||"htmlOutput");return this.generateHTMLTable(list)}},{key:"mapElementStyles",value:function mapElementStyles(from,to,props){if(this.cloneTableStyle&&from&&to){var lookup={"background-color":"backgroundColor",color:"fontColor",width:"width","font-weight":"fontWeight","font-family":"fontFamily","font-size":"fontSize","text-align":"textAlign","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom","padding-top":"paddingTop","padding-left":"paddingLeft","padding-right":"paddingRight","padding-bottom":"paddingBottom"};if(window.getComputedStyle){var fromStyle=window.getComputedStyle(from);props.forEach((function(prop){to.style[lookup[prop]]=fromStyle.getPropertyValue(prop)}))}}}}]),Export}(Module);Export.moduleName="export";var defaultFilters={"=":function _(filterVal,rowVal,rowData,filterParams){return rowVal==filterVal},"<":function _(filterVal,rowVal,rowData,filterParams){return rowVal<filterVal},"<=":function _(filterVal,rowVal,rowData,filterParams){return rowVal<=filterVal},">":function _(filterVal,rowVal,rowData,filterParams){return rowVal>filterVal},">=":function _(filterVal,rowVal,rowData,filterParams){return rowVal>=filterVal},"!=":function _(filterVal,rowVal,rowData,filterParams){return rowVal!=filterVal},regex:function regex(filterVal,rowVal,rowData,filterParams){return"string"==typeof filterVal&&(filterVal=new RegExp(filterVal)),filterVal.test(rowVal)},like:function like(filterVal,rowVal,rowData,filterParams){return null==filterVal?rowVal===filterVal:null!=rowVal&&String(rowVal).toLowerCase().indexOf(filterVal.toLowerCase())>-1},keywords:function keywords(filterVal,rowVal,rowData,filterParams){var keywords=filterVal.toLowerCase().split(void 0===filterParams.separator?" ":filterParams.separator),value=String(null==rowVal?"":rowVal).toLowerCase(),matches=[];return keywords.forEach((function(keyword){value.includes(keyword)&&matches.push(!0)})),filterParams.matchAll?matches.length===keywords.length:!!matches.length},starts:function starts(filterVal,rowVal,rowData,filterParams){return null==filterVal?rowVal===filterVal:null!=rowVal&&String(rowVal).toLowerCase().startsWith(filterVal.toLowerCase())},ends:function ends(filterVal,rowVal,rowData,filterParams){return null==filterVal?rowVal===filterVal:null!=rowVal&&String(rowVal).toLowerCase().endsWith(filterVal.toLowerCase())},in:function _in(filterVal,rowVal,rowData,filterParams){return Array.isArray(filterVal)?!filterVal.length||filterVal.indexOf(rowVal)>-1:(console.warn("Filter Error - filter value is not an array:",filterVal),!1)}},Filter=function(_Module){_inherits(Filter,_Module);var _super=_createSuper(Filter);function Filter(table){var _this;return _classCallCheck(this,Filter),(_this=_super.call(this,table)).filterList=[],_this.headerFilters={},_this.headerFilterColumns=[],_this.prevHeaderFilterChangeCheck="",_this.prevHeaderFilterChangeCheck="{}",_this.changed=!1,_this.tableInitialized=!1,_this.registerTableOption("filterMode","local"),_this.registerTableOption("initialFilter",!1),_this.registerTableOption("initialHeaderFilter",!1),_this.registerTableOption("headerFilterLiveFilterDelay",300),_this.registerColumnOption("headerFilter"),_this.registerColumnOption("headerFilterPlaceholder"),_this.registerColumnOption("headerFilterParams"),_this.registerColumnOption("headerFilterEmptyCheck"),_this.registerColumnOption("headerFilterFunc"),_this.registerColumnOption("headerFilterFuncParams"),_this.registerColumnOption("headerFilterLiveFilter"),_this.registerTableFunction("searchRows",_this.searchRows.bind(_assertThisInitialized(_this))),_this.registerTableFunction("searchData",_this.searchData.bind(_assertThisInitialized(_this))),_this.registerTableFunction("setFilter",_this.userSetFilter.bind(_assertThisInitialized(_this))),_this.registerTableFunction("refreshFilter",_this.userRefreshFilter.bind(_assertThisInitialized(_this))),_this.registerTableFunction("addFilter",_this.userAddFilter.bind(_assertThisInitialized(_this))),_this.registerTableFunction("getFilters",_this.getFilters.bind(_assertThisInitialized(_this))),_this.registerTableFunction("setHeaderFilterFocus",_this.userSetHeaderFilterFocus.bind(_assertThisInitialized(_this))),_this.registerTableFunction("getHeaderFilterValue",_this.userGetHeaderFilterValue.bind(_assertThisInitialized(_this))),_this.registerTableFunction("setHeaderFilterValue",_this.userSetHeaderFilterValue.bind(_assertThisInitialized(_this))),_this.registerTableFunction("getHeaderFilters",_this.getHeaderFilters.bind(_assertThisInitialized(_this))),_this.registerTableFunction("removeFilter",_this.userRemoveFilter.bind(_assertThisInitialized(_this))),_this.registerTableFunction("clearFilter",_this.userClearFilter.bind(_assertThisInitialized(_this))),_this.registerTableFunction("clearHeaderFilter",_this.userClearHeaderFilter.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("column","headerFilterFocus",_this.setHeaderFilterFocus.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("column","reloadHeaderFilter",_this.reloadHeaderFilter.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("column","getHeaderFilterValue",_this.getHeaderFilterValue.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("column","setHeaderFilterValue",_this.setHeaderFilterValue.bind(_assertThisInitialized(_this))),_this}return _createClass(Filter,[{key:"initialize",value:function initialize(){this.subscribe("column-init",this.initializeColumnHeaderFilter.bind(this)),this.subscribe("column-width-fit-before",this.hideHeaderFilterElements.bind(this)),this.subscribe("column-width-fit-after",this.showHeaderFilterElements.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),"remote"===this.table.options.filterMode&&this.subscribe("data-params",this.remoteFilterParams.bind(this)),this.registerDataHandler(this.filter.bind(this),10)}},{key:"tableBuilt",value:function tableBuilt(){var _this2=this;this.table.options.initialFilter&&this.setFilter(this.table.options.initialFilter),this.table.options.initialHeaderFilter&&this.table.options.initialHeaderFilter.forEach((function(item){var column=_this2.table.columnManager.findColumn(item.field);if(!column)return console.warn("Column Filter Error - No matching column found:",item.field),!1;_this2.setHeaderFilterValue(column,item.value)})),this.tableInitialized=!0}},{key:"remoteFilterParams",value:function remoteFilterParams(data,config,silent,params){return params.filter=this.getFilters(!0,!0),params}},{key:"userSetFilter",value:function userSetFilter(field,type,value,params){this.setFilter(field,type,value,params),this.refreshFilter()}},{key:"userRefreshFilter",value:function userRefreshFilter(){this.refreshFilter()}},{key:"userAddFilter",value:function userAddFilter(field,type,value,params){this.addFilter(field,type,value,params),this.refreshFilter()}},{key:"userSetHeaderFilterFocus",value:function userSetHeaderFilterFocus(field){var column=this.table.columnManager.findColumn(field);if(!column)return console.warn("Column Filter Focus Error - No matching column found:",field),!1;this.setHeaderFilterFocus(column)}},{key:"userGetHeaderFilterValue",value:function userGetHeaderFilterValue(field){var column=this.table.columnManager.findColumn(field);if(column)return this.getHeaderFilterValue(column);console.warn("Column Filter Error - No matching column found:",field)}},{key:"userSetHeaderFilterValue",value:function userSetHeaderFilterValue(field,value){var column=this.table.columnManager.findColumn(field);if(!column)return console.warn("Column Filter Error - No matching column found:",field),!1;this.setHeaderFilterValue(column,value)}},{key:"userRemoveFilter",value:function userRemoveFilter(field,type,value){this.removeFilter(field,type,value),this.refreshFilter()}},{key:"userClearFilter",value:function userClearFilter(all){this.clearFilter(all),this.refreshFilter()}},{key:"userClearHeaderFilter",value:function userClearHeaderFilter(){this.clearHeaderFilter(),this.refreshFilter()}},{key:"searchRows",value:function searchRows(field,type,value){return this.search("rows",field,type,value)}},{key:"searchData",value:function searchData(field,type,value){return this.search("data",field,type,value)}},{key:"initializeColumnHeaderFilter",value:function initializeColumnHeaderFilter(column){var def=column.definition;def.headerFilter&&(void 0!==def.headerFilterPlaceholder&&def.field&&this.module("localize").setHeaderFilterColumnPlaceholder(def.field,def.headerFilterPlaceholder),this.initializeColumn(column))}},{key:"initializeColumn",value:function initializeColumn(column,value){var self=this,field=column.getField();function success(value){var filterType="input"==column.modules.filter.tagType&&"text"==column.modules.filter.attrType||"textarea"==column.modules.filter.tagType?"partial":"match",type="",filterChangeCheck="",filterFunc;if(void 0===column.modules.filter.prevSuccess||column.modules.filter.prevSuccess!==value){if(column.modules.filter.prevSuccess=value,column.modules.filter.emptyFunc(value))delete self.headerFilters[field];else{switch(column.modules.filter.value=value,_typeof(column.definition.headerFilterFunc)){case"string":Filter.filters[column.definition.headerFilterFunc]?(type=column.definition.headerFilterFunc,filterFunc=function filterFunc(data){var params=column.definition.headerFilterFuncParams||{},fieldVal=column.getFieldValue(data);return params="function"==typeof params?params(value,fieldVal,data):params,Filter.filters[column.definition.headerFilterFunc](value,fieldVal,data,params)}):console.warn("Header Filter Error - Matching filter function not found: ",column.definition.headerFilterFunc);break;case"function":type=filterFunc=function filterFunc(data){var params=column.definition.headerFilterFuncParams||{},fieldVal=column.getFieldValue(data);return params="function"==typeof params?params(value,fieldVal,data):params,column.definition.headerFilterFunc(value,fieldVal,data,params)}}if(!filterFunc)switch(filterType){case"partial":filterFunc=function filterFunc(data){var colVal=column.getFieldValue(data);return null!=colVal&&String(colVal).toLowerCase().indexOf(String(value).toLowerCase())>-1},type="like";break;default:filterFunc=function filterFunc(data){return column.getFieldValue(data)==value},type="="}self.headerFilters[field]={value:value,func:filterFunc,type:type}}column.modules.filter.value=value,filterChangeCheck=JSON.stringify(self.headerFilters),self.prevHeaderFilterChangeCheck!==filterChangeCheck&&(self.prevHeaderFilterChangeCheck=filterChangeCheck,self.trackChanges(),self.refreshFilter())}return!0}column.modules.filter={success:success,attrType:!1,tagType:!1,emptyFunc:!1},this.generateHeaderFilterElement(column)}},{key:"generateHeaderFilterElement",value:function generateHeaderFilterElement(column,initialValue,reinitialize){var _this3=this,self=this,success=column.modules.filter.success,field=column.getField(),filterElement,editor,editorElement,cellWrapper,typingTimer,searchTrigger,params;function cancel(){}if(column.modules.filter.value=initialValue,column.modules.filter.headerElement&&column.modules.filter.headerElement.parentNode&&column.contentElement.removeChild(column.modules.filter.headerElement.parentNode),field){switch(column.modules.filter.emptyFunc=column.definition.headerFilterEmptyCheck||function(value){return!value&&0!==value},(filterElement=document.createElement("div")).classList.add("tabulator-header-filter"),_typeof(column.definition.headerFilter)){case"string":self.table.modules.edit.editors[column.definition.headerFilter]?(editor=self.table.modules.edit.editors[column.definition.headerFilter],"tick"!==column.definition.headerFilter&&"tickCross"!==column.definition.headerFilter||column.definition.headerFilterEmptyCheck||(column.modules.filter.emptyFunc=function(value){return!0!==value&&!1!==value})):console.warn("Filter Error - Cannot build header filter, No such editor found: ",column.definition.editor);break;case"function":editor=column.definition.headerFilter;break;case"boolean":column.modules.edit&&column.modules.edit.editor?editor=column.modules.edit.editor:column.definition.formatter&&self.table.modules.edit.editors[column.definition.formatter]?(editor=self.table.modules.edit.editors[column.definition.formatter],"tick"!==column.definition.formatter&&"tickCross"!==column.definition.formatter||column.definition.headerFilterEmptyCheck||(column.modules.filter.emptyFunc=function(value){return!0!==value&&!1!==value})):editor=self.table.modules.edit.editors.input}if(editor){if(cellWrapper={getValue:function getValue(){return void 0!==initialValue?initialValue:""},getField:function getField(){return column.definition.field},getElement:function getElement(){return filterElement},getColumn:function getColumn(){return column.getComponent()},getTable:function getTable(){return _this3.table},getRow:function getRow(){return{normalizeHeight:function normalizeHeight(){}}}},params="function"==typeof(params=column.definition.headerFilterParams||{})?params.call(self.table,cellWrapper):params,!(editorElement=editor.call(this.table.modules.edit,cellWrapper,(function(){}),success,cancel,params)))return void console.warn("Filter Error - Cannot add filter to "+field+" column, editor returned a value of false");if(!(editorElement instanceof Node))return void console.warn("Filter Error - Cannot add filter to "+field+" column, editor should return an instance of Node, the editor returned:",editorElement);self.langBind("headerFilters|columns|"+column.definition.field,(function(value){editorElement.setAttribute("placeholder",void 0!==value&&value?value:self.langText("headerFilters|default"))})),editorElement.addEventListener("click",(function(e){e.stopPropagation(),editorElement.focus()})),editorElement.addEventListener("focus",(function(e){var left=_this3.table.columnManager.element.scrollLeft,headerPos;left!==_this3.table.rowManager.element.scrollLeft+parseInt(_this3.table.columnManager.element.style.marginLeft)&&(_this3.table.rowManager.scrollHorizontal(left),_this3.table.columnManager.scrollHorizontal(left))})),typingTimer=!1,searchTrigger=function searchTrigger(e){typingTimer&&clearTimeout(typingTimer),typingTimer=setTimeout((function(){success(editorElement.value)}),self.table.options.headerFilterLiveFilterDelay)},column.modules.filter.headerElement=editorElement,column.modules.filter.attrType=editorElement.hasAttribute("type")?editorElement.getAttribute("type").toLowerCase():"",column.modules.filter.tagType=editorElement.tagName.toLowerCase(),!1!==column.definition.headerFilterLiveFilter&&("autocomplete"!==column.definition.headerFilter&&"tickCross"!==column.definition.headerFilter&&("autocomplete"!==column.definition.editor&&"tickCross"!==column.definition.editor||!0!==column.definition.headerFilter)&&(editorElement.addEventListener("keyup",searchTrigger),editorElement.addEventListener("search",searchTrigger),"number"==column.modules.filter.attrType&&editorElement.addEventListener("change",(function(e){success(editorElement.value)})),"text"==column.modules.filter.attrType&&"ie"!==this.table.browser&&editorElement.setAttribute("type","search")),"input"!=column.modules.filter.tagType&&"select"!=column.modules.filter.tagType&&"textarea"!=column.modules.filter.tagType||editorElement.addEventListener("mousedown",(function(e){e.stopPropagation()}))),filterElement.appendChild(editorElement),column.contentElement.appendChild(filterElement),reinitialize||self.headerFilterColumns.push(column)}}else console.warn("Filter Error - Cannot add header filter, column has no field set:",column.definition.title)}},{key:"hideHeaderFilterElements",value:function hideHeaderFilterElements(){this.headerFilterColumns.forEach((function(column){column.modules.filter&&column.modules.filter.headerElement&&(column.modules.filter.headerElement.style.display="none")}))}},{key:"showHeaderFilterElements",value:function showHeaderFilterElements(){this.headerFilterColumns.forEach((function(column){column.modules.filter&&column.modules.filter.headerElement&&(column.modules.filter.headerElement.style.display="")}))}},{key:"setHeaderFilterFocus",value:function setHeaderFilterFocus(column){column.modules.filter&&column.modules.filter.headerElement?column.modules.filter.headerElement.focus():console.warn("Column Filter Focus Error - No header filter set on column:",column.getField())}},{key:"getHeaderFilterValue",value:function getHeaderFilterValue(column){if(column.modules.filter&&column.modules.filter.headerElement)return column.modules.filter.value;console.warn("Column Filter Error - No header filter set on column:",column.getField())}},{key:"setHeaderFilterValue",value:function setHeaderFilterValue(column,value){column&&(column.modules.filter&&column.modules.filter.headerElement?(this.generateHeaderFilterElement(column,value,!0),column.modules.filter.success(value)):console.warn("Column Filter Error - No header filter set on column:",column.getField()))}},{key:"reloadHeaderFilter",value:function reloadHeaderFilter(column){column&&(column.modules.filter&&column.modules.filter.headerElement?this.generateHeaderFilterElement(column,column.modules.filter.value,!0):console.warn("Column Filter Error - No header filter set on column:",column.getField()))}},{key:"refreshFilter",value:function refreshFilter(){this.tableInitialized&&("remote"===this.table.options.filterMode?this.reloadData(null,!1,!1):this.refreshData(!0))}},{key:"trackChanges",value:function trackChanges(){this.changed=!0,this.dispatch("filter-changed")}},{key:"hasChanged",value:function hasChanged(){var changed=this.changed;return this.changed=!1,changed}},{key:"setFilter",value:function setFilter(field,type,value,params){this.filterList=[],Array.isArray(field)||(field=[{field:field,type:type,value:value,params:params}]),this.addFilter(field)}},{key:"addFilter",value:function addFilter(field,type,value,params){var _this4=this,changed=!1;Array.isArray(field)||(field=[{field:field,type:type,value:value,params:params}]),field.forEach((function(filter){(filter=_this4.findFilter(filter))&&(_this4.filterList.push(filter),changed=!0)})),changed&&this.trackChanges()}},{key:"findFilter",value:function findFilter(filter){var column;if(Array.isArray(filter))return this.findSubFilters(filter);var filterFunc=!1;return"function"==typeof filter.field?filterFunc=function filterFunc(data){return filter.field(data,filter.type||{})}:Filter.filters[filter.type]?filterFunc=(column=this.table.columnManager.getColumnByField(filter.field))?function filterFunc(data){return Filter.filters[filter.type](filter.value,column.getFieldValue(data),data,filter.params||{})}:function filterFunc(data){return Filter.filters[filter.type](filter.value,data[filter.field],data,filter.params||{})}:console.warn("Filter Error - No such filter type found, ignoring: ",filter.type),filter.func=filterFunc,!!filter.func&&filter}},{key:"findSubFilters",value:function findSubFilters(filters){var _this5=this,output=[];return filters.forEach((function(filter){(filter=_this5.findFilter(filter))&&output.push(filter)})),!!output.length&&output}},{key:"getFilters",value:function getFilters(all,ajax){var output=[];return all&&(output=this.getHeaderFilters()),ajax&&output.forEach((function(item){"function"==typeof item.type&&(item.type="function")})),output=output.concat(this.filtersToArray(this.filterList,ajax))}},{key:"filtersToArray",value:function filtersToArray(filterList,ajax){var _this6=this,output=[];return filterList.forEach((function(filter){var item;Array.isArray(filter)?output.push(_this6.filtersToArray(filter,ajax)):(item={field:filter.field,type:filter.type,value:filter.value},ajax&&"function"==typeof item.type&&(item.type="function"),output.push(item))})),output}},{key:"getHeaderFilters",value:function getHeaderFilters(){var output=[];for(var key in this.headerFilters)output.push({field:key,type:this.headerFilters[key].type,value:this.headerFilters[key].value});return output}},{key:"removeFilter",value:function removeFilter(field,type,value){var _this7=this;Array.isArray(field)||(field=[{field:field,type:type,value:value}]),field.forEach((function(filter){var index=-1;(index="object"==_typeof(filter.field)?_this7.filterList.findIndex((function(element){return filter===element})):_this7.filterList.findIndex((function(element){return filter.field===element.field&&filter.type===element.type&&filter.value===element.value})))>-1?_this7.filterList.splice(index,1):console.warn("Filter Error - No matching filter type found, ignoring: ",filter.type)})),this.trackChanges()}},{key:"clearFilter",value:function clearFilter(all){this.filterList=[],all&&this.clearHeaderFilter(),this.trackChanges()}},{key:"clearHeaderFilter",value:function clearHeaderFilter(){var _this8=this;this.headerFilters={},this.prevHeaderFilterChangeCheck="{}",this.headerFilterColumns.forEach((function(column){void 0!==column.modules.filter.value&&delete column.modules.filter.value,column.modules.filter.prevSuccess=void 0,_this8.reloadHeaderFilter(column)})),this.trackChanges()}},{key:"search",value:function search(searchType,field,type,value){var _this9=this,activeRows=[],filterList=[];return Array.isArray(field)||(field=[{field:field,type:type,value:value}]),field.forEach((function(filter){(filter=_this9.findFilter(filter))&&filterList.push(filter)})),this.table.rowManager.rows.forEach((function(row){var match=!0;filterList.forEach((function(filter){_this9.filterRecurse(filter,row.getData())||(match=!1)})),match&&activeRows.push("data"===searchType?row.getData("data"):row.getComponent())})),activeRows}},{key:"filter",value:function filter(rowList,filters){var _this10=this,activeRows=[],activeRowComponents=[];return this.subscribedExternal("dataFiltering")&&this.dispatchExternal("dataFiltering",this.getFilters(!0)),"remote"!==this.table.options.filterMode&&(this.filterList.length||Object.keys(this.headerFilters).length)?rowList.forEach((function(row){_this10.filterRow(row)&&activeRows.push(row)})):activeRows=rowList.slice(0),this.subscribedExternal("dataFiltered")&&(activeRows.forEach((function(row){activeRowComponents.push(row.getComponent())})),this.dispatchExternal("dataFiltered",this.getFilters(!0),activeRowComponents)),activeRows}},{key:"filterRow",value:function filterRow(row,filters){var _this11=this,match=!0,data=row.getData();for(var field in this.filterList.forEach((function(filter){_this11.filterRecurse(filter,data)||(match=!1)})),this.headerFilters)this.headerFilters[field].func(data)||(match=!1);return match}},{key:"filterRecurse",value:function filterRecurse(filter,data){var _this12=this,match=!1;return Array.isArray(filter)?filter.forEach((function(subFilter){_this12.filterRecurse(subFilter,data)&&(match=!0)})):match=filter.func(data),match}}]),Filter}(Module);function plaintext(cell,formatterParams,onRendered){return this.emptyToSpace(this.sanitizeHTML(cell.getValue()))}function html$1(cell,formatterParams,onRendered){return cell.getValue()}function textarea$1(cell,formatterParams,onRendered){return cell.getElement().style.whiteSpace="pre-wrap",this.emptyToSpace(this.sanitizeHTML(cell.getValue()))}function money(cell,formatterParams,onRendered){var floatVal=parseFloat(cell.getValue()),sign="",number,integer,decimal,rgx,decimalSym=formatterParams.decimal||".",thousandSym=formatterParams.thousand||",",negativeSign=formatterParams.negativeSign||"-",symbol=formatterParams.symbol||"",after=!!formatterParams.symbolAfter,precision=void 0!==formatterParams.precision?formatterParams.precision:2;if(isNaN(floatVal))return this.emptyToSpace(this.sanitizeHTML(cell.getValue()));if(floatVal<0&&(floatVal=Math.abs(floatVal),sign=negativeSign),number=!1!==precision?floatVal.toFixed(precision):floatVal,integer=(number=String(number).split("."))[0],decimal=number.length>1?decimalSym+number[1]:"",!1!==formatterParams.thousand)for(rgx=/(\d+)(\d{3})/;rgx.test(integer);)integer=integer.replace(rgx,"$1"+thousandSym+"$2");return after?sign+integer+decimal+symbol:sign+symbol+integer+decimal}function link(cell,formatterParams,onRendered){var value=cell.getValue(),urlPrefix=formatterParams.urlPrefix||"",download=formatterParams.download,label=value,el=document.createElement("a"),data;function labelTraverse(path,data){var item,value=data[path.shift()];return path.length&&"object"===_typeof(value)?labelTraverse(path,value):value}if(formatterParams.labelField&&(data=cell.getData(),label=labelTraverse(formatterParams.labelField.split(this.table.options.nestedFieldSeparator),data)),formatterParams.label)switch(_typeof(formatterParams.label)){case"string":label=formatterParams.label;break;case"function":label=formatterParams.label(cell)}if(label){if(formatterParams.urlField&&(value=(data=cell.getData())[formatterParams.urlField]),formatterParams.url)switch(_typeof(formatterParams.url)){case"string":value=formatterParams.url;break;case"function":value=formatterParams.url(cell)}return el.setAttribute("href",urlPrefix+value),formatterParams.target&&el.setAttribute("target",formatterParams.target),formatterParams.download&&(download="function"==typeof download?download(cell):!0===download?"":download,el.setAttribute("download",download)),el.innerHTML=this.emptyToSpace(this.sanitizeHTML(label)),el}return"&nbsp;"}function image(cell,formatterParams,onRendered){var el=document.createElement("img"),src=cell.getValue();switch(formatterParams.urlPrefix&&(src=formatterParams.urlPrefix+cell.getValue()),formatterParams.urlSuffix&&(src+=formatterParams.urlSuffix),el.setAttribute("src",src),_typeof(formatterParams.height)){case"number":el.style.height=formatterParams.height+"px";break;case"string":el.style.height=formatterParams.height}switch(_typeof(formatterParams.width)){case"number":el.style.width=formatterParams.width+"px";break;case"string":el.style.width=formatterParams.width}return el.addEventListener("load",(function(){cell.getRow().normalizeHeight()})),el}function tickCross$1(cell,formatterParams,onRendered){var value=cell.getValue(),element=cell.getElement(),empty=formatterParams.allowEmpty,truthy=formatterParams.allowTruthy,trueValueSet=Object.keys(formatterParams).includes("trueValue"),tick=void 0!==formatterParams.tickElement?formatterParams.tickElement:'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>',cross=void 0!==formatterParams.crossElement?formatterParams.crossElement:'<svg enable-background="new 0 0 24 24" height="14" width="14"  viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';return trueValueSet&&value===formatterParams.trueValue||!trueValueSet&&(truthy&&value||!0===value||"true"===value||"True"===value||1===value||"1"===value)?(element.setAttribute("aria-checked",!0),tick||""):!empty||"null"!==value&&""!==value&&null!=value?(element.setAttribute("aria-checked",!1),cross||""):(element.setAttribute("aria-checked","mixed"),"")}function datetime$1(cell,formatterParams,onRendered){var DT=window.DateTime||luxon.DateTime,inputFormat=formatterParams.inputFormat||"yyyy-MM-dd HH:mm:ss",outputFormat=formatterParams.outputFormat||"dd/MM/yyyy HH:mm:ss",invalid=void 0!==formatterParams.invalidPlaceholder?formatterParams.invalidPlaceholder:"",value=cell.getValue(),newDatetime;if(void 0!==DT)return(newDatetime=DT.isDateTime(value)?value:"iso"===inputFormat?DT.fromISO(String(value)):DT.fromFormat(String(value),inputFormat)).isValid?(formatterParams.timezone&&(newDatetime=newDatetime.setZone(formatterParams.timezone)),newDatetime.toFormat(outputFormat)):!0!==invalid&&value?"function"==typeof invalid?invalid(value):invalid:value;console.error("Format Error - 'datetime' formatter is dependant on luxon.js")}function datetimediff(cell,formatterParams,onRendered){var DT=window.DateTime||luxon.DateTime,inputFormat=formatterParams.inputFormat||"yyyy-MM-dd HH:mm:ss",invalid=void 0!==formatterParams.invalidPlaceholder?formatterParams.invalidPlaceholder:"",suffix=void 0!==formatterParams.suffix&&formatterParams.suffix,unit=void 0!==formatterParams.unit?formatterParams.unit:"days",humanize=void 0!==formatterParams.humanize&&formatterParams.humanize,date=void 0!==formatterParams.date?formatterParams.date:DT.now(),value=cell.getValue(),newDatetime;if(void 0!==DT)return(newDatetime=DT.isDateTime(value)?value:"iso"===inputFormat?DT.fromISO(String(value)):DT.fromFormat(String(value),inputFormat)).isValid?humanize?newDatetime.diff(date,unit).toHuman()+(suffix?" "+suffix:""):parseInt(newDatetime.diff(date,unit)[unit])+(suffix?" "+suffix:""):!0===invalid?value:"function"==typeof invalid?invalid(value):invalid;console.error("Format Error - 'datetimediff' formatter is dependant on luxon.js")}function lookup(cell,formatterParams,onRendered){var value=cell.getValue();return void 0===formatterParams[value]?(console.warn("Missing display value for "+value),value):formatterParams[value]}function star$1(cell,formatterParams,onRendered){var value=cell.getValue(),element=cell.getElement(),maxStars=formatterParams&&formatterParams.stars?formatterParams.stars:5,stars=document.createElement("span"),star=document.createElementNS("http://www.w3.org/2000/svg","svg"),starActive='<polygon fill="#FFEA00" stroke="#C1AB60" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>',starInactive='<polygon fill="#D2D2D2" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';stars.style.verticalAlign="middle",star.setAttribute("width","14"),star.setAttribute("height","14"),star.setAttribute("viewBox","0 0 512 512"),star.setAttribute("xml:space","preserve"),star.style.padding="0 1px",value=value&&!isNaN(value)?parseInt(value):0,value=Math.max(0,Math.min(value,maxStars));for(var i=1;i<=maxStars;i++){var nextStar=star.cloneNode(!0);nextStar.innerHTML=i<=value?starActive:starInactive,stars.appendChild(nextStar)}return element.style.whiteSpace="nowrap",element.style.overflow="hidden",element.style.textOverflow="ellipsis",element.setAttribute("aria-label",value),stars}function traffic(cell,formatterParams,onRendered){var value=this.sanitizeHTML(cell.getValue())||0,el=document.createElement("span"),max=formatterParams&&formatterParams.max?formatterParams.max:100,min=formatterParams&&formatterParams.min?formatterParams.min:0,colors=formatterParams&&void 0!==formatterParams.color?formatterParams.color:["red","orange","green"],color="#666666",percent,percentValue;if(!isNaN(value)&&void 0!==cell.getValue()){switch(el.classList.add("tabulator-traffic-light"),percentValue=parseFloat(value)<=max?parseFloat(value):max,percentValue=parseFloat(percentValue)>=min?parseFloat(percentValue):min,percent=(max-min)/100,percentValue=Math.round((percentValue-min)/percent),_typeof(colors)){case"string":color=colors;break;case"function":color=colors(value);break;case"object":if(Array.isArray(colors)){var unit=100/colors.length,index=Math.floor(percentValue/unit);index=Math.min(index,colors.length-1),color=colors[index=Math.max(index,0)];break}}return el.style.backgroundColor=color,el}}function progress$1(cell){var formatterParams=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},onRendered=arguments.length>2?arguments[2]:void 0,value=this.sanitizeHTML(cell.getValue())||0,element=cell.getElement(),max=formatterParams.max?formatterParams.max:100,min=formatterParams.min?formatterParams.min:0,legendAlign=formatterParams.legendAlign?formatterParams.legendAlign:"center",percent,percentValue,color,legend,legendColor;switch(percentValue=parseFloat(value)<=max?parseFloat(value):max,percentValue=parseFloat(percentValue)>=min?parseFloat(percentValue):min,percent=(max-min)/100,percentValue=Math.round((percentValue-min)/percent),_typeof(formatterParams.color)){case"string":color=formatterParams.color;break;case"function":color=formatterParams.color(value);break;case"object":if(Array.isArray(formatterParams.color)){var unit=100/formatterParams.color.length,index=Math.floor(percentValue/unit);index=Math.min(index,formatterParams.color.length-1),index=Math.max(index,0),color=formatterParams.color[index];break}default:color="#2DC214"}switch(_typeof(formatterParams.legend)){case"string":legend=formatterParams.legend;break;case"function":legend=formatterParams.legend(value);break;case"boolean":legend=value;break;default:legend=!1}switch(_typeof(formatterParams.legendColor)){case"string":legendColor=formatterParams.legendColor;break;case"function":legendColor=formatterParams.legendColor(value);break;case"object":if(Array.isArray(formatterParams.legendColor)){var _unit=100/formatterParams.legendColor.length,_index=Math.floor(percentValue/_unit);_index=Math.min(_index,formatterParams.legendColor.length-1),_index=Math.max(_index,0),legendColor=formatterParams.legendColor[_index]}break;default:legendColor="#000"}element.style.minWidth="30px",element.style.position="relative",element.setAttribute("aria-label",percentValue);var barEl=document.createElement("div");barEl.style.display="inline-block",barEl.style.width=percentValue+"%",barEl.style.backgroundColor=color,barEl.style.height="100%",barEl.setAttribute("data-max",max),barEl.setAttribute("data-min",min);var barContainer=document.createElement("div");if(barContainer.style.position="relative",barContainer.style.width="100%",barContainer.style.height="100%",legend){var legendEl=document.createElement("div");legendEl.style.position="absolute",legendEl.style.top=0,legendEl.style.left=0,legendEl.style.textAlign=legendAlign,legendEl.style.width="100%",legendEl.style.color=legendColor,legendEl.innerHTML=legend}return onRendered((function(){if(!(cell instanceof CellComponent)){var holderEl=document.createElement("div");holderEl.style.position="absolute",holderEl.style.top="4px",holderEl.style.bottom="4px",holderEl.style.left="4px",holderEl.style.right="4px",element.appendChild(holderEl),element=holderEl}element.appendChild(barContainer),barContainer.appendChild(barEl),legend&&barContainer.appendChild(legendEl)})),""}function color(cell,formatterParams,onRendered){return cell.getElement().style.backgroundColor=this.sanitizeHTML(cell.getValue()),""}function buttonTick(cell,formatterParams,onRendered){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>'}function buttonCross(cell,formatterParams,onRendered){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>'}function rownum(cell,formatterParams,onRendered){var content=document.createElement("span"),row;return cell.getRow().watchPosition((function(position){content.innerText=position})),content}function handle(cell,formatterParams,onRendered){return cell.getElement().classList.add("tabulator-row-handle"),"<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>"}function responsiveCollapse(cell,formatterParams,onRendered){var el=document.createElement("div"),config=cell.getRow()._row.modules.responsiveLayout;function toggleList(isOpen){var collapseEl=config.element;config.open=isOpen,collapseEl&&(config.open?(el.classList.add("open"),collapseEl.style.display=""):(el.classList.remove("open"),collapseEl.style.display="none"))}return el.classList.add("tabulator-responsive-collapse-toggle"),el.innerHTML="<span class='tabulator-responsive-collapse-toggle-open'>+</span><span class='tabulator-responsive-collapse-toggle-close'>-</span>",cell.getElement().classList.add("tabulator-row-handle"),el.addEventListener("click",(function(e){e.stopImmediatePropagation(),toggleList(!config.open),cell.getTable().rowManager.adjustTableSize()})),toggleList(config.open),el}function rowSelection(cell,formatterParams,onRendered){var _this=this,checkbox=document.createElement("input"),blocked=!1;if(checkbox.type="checkbox",checkbox.setAttribute("aria-label","Select Row"),this.table.modExists("selectRow",!0))if(checkbox.addEventListener("click",(function(e){e.stopPropagation()})),"function"==typeof cell.getRow){var row=cell.getRow();row instanceof RowComponent?(checkbox.addEventListener("change",(function(e){"click"===_this.table.options.selectableRangeMode&&blocked?blocked=!1:row.toggleSelect()})),"click"===this.table.options.selectableRangeMode&&checkbox.addEventListener("click",(function(e){blocked=!0,_this.table.modules.selectRow.handleComplexRowClick(row._row,e)})),checkbox.checked=row.isSelected&&row.isSelected(),this.table.modules.selectRow.registerRowSelectCheckbox(row,checkbox)):checkbox=""}else checkbox.addEventListener("change",(function(e){_this.table.modules.selectRow.selectedRows.length?_this.table.deselectRow():_this.table.selectRow(formatterParams.rowRange)})),this.table.modules.selectRow.registerHeaderSelectCheckbox(checkbox);return checkbox}Filter.moduleName="filter",Filter.filters=defaultFilters;var defaultFormatters={plaintext:plaintext,html:html$1,textarea:textarea$1,money:money,link:link,image:image,tickCross:tickCross$1,datetime:datetime$1,datetimediff:datetimediff,lookup:lookup,star:star$1,traffic:traffic,progress:progress$1,color:color,buttonTick:buttonTick,buttonCross:buttonCross,rownum:rownum,handle:handle,responsiveCollapse:responsiveCollapse,rowSelection:rowSelection},Format=function(_Module){_inherits(Format,_Module);var _super=_createSuper(Format);function Format(table){var _this;return _classCallCheck(this,Format),(_this=_super.call(this,table)).registerColumnOption("formatter"),_this.registerColumnOption("formatterParams"),_this.registerColumnOption("formatterPrint"),_this.registerColumnOption("formatterPrintParams"),_this.registerColumnOption("formatterClipboard"),_this.registerColumnOption("formatterClipboardParams"),_this.registerColumnOption("formatterHtmlOutput"),_this.registerColumnOption("formatterHtmlOutputParams"),_this.registerColumnOption("titleFormatter"),_this.registerColumnOption("titleFormatterParams"),_this}return _createClass(Format,[{key:"initialize",value:function initialize(){this.subscribe("cell-format",this.formatValue.bind(this)),this.subscribe("cell-rendered",this.cellRendered.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-format",this.formatHeader.bind(this))}},{key:"initializeColumn",value:function initializeColumn(column){column.modules.format=this.lookupFormatter(column,""),void 0!==column.definition.formatterPrint&&(column.modules.format.print=this.lookupFormatter(column,"Print")),void 0!==column.definition.formatterClipboard&&(column.modules.format.clipboard=this.lookupFormatter(column,"Clipboard")),void 0!==column.definition.formatterHtmlOutput&&(column.modules.format.htmlOutput=this.lookupFormatter(column,"HtmlOutput"))}},{key:"lookupFormatter",value:function lookupFormatter(column,type){var config={params:column.definition["formatter"+type+"Params"]||{}},formatter=column.definition["formatter"+type];switch(_typeof(formatter)){case"string":Format.formatters[formatter]?config.formatter=Format.formatters[formatter]:(console.warn("Formatter Error - No such formatter found: ",formatter),config.formatter=Format.formatters.plaintext);break;case"function":config.formatter=formatter;break;default:config.formatter=Format.formatters.plaintext}return config}},{key:"cellRendered",value:function cellRendered(cell){cell.modules.format&&cell.modules.format.renderedCallback&&!cell.modules.format.rendered&&(cell.modules.format.renderedCallback(),cell.modules.format.rendered=!0)}},{key:"formatHeader",value:function formatHeader(column,title,el){var formatter,params,onRendered,mockCell;return column.definition.titleFormatter?(formatter=this.getFormatter(column.definition.titleFormatter),onRendered=function onRendered(callback){column.titleFormatterRendered=callback},mockCell={getValue:function getValue(){return title},getElement:function getElement(){return el}},params="function"==typeof(params=column.definition.titleFormatterParams||{})?params():params,formatter.call(this,mockCell,params,onRendered)):title}},{key:"formatValue",value:function formatValue(cell){var component=cell.getComponent(),params="function"==typeof cell.column.modules.format.params?cell.column.modules.format.params(component):cell.column.modules.format.params;function onRendered(callback){cell.modules.format||(cell.modules.format={}),cell.modules.format.renderedCallback=callback,cell.modules.format.rendered=!1}return cell.column.modules.format.formatter.call(this,component,params,onRendered)}},{key:"formatExportValue",value:function formatExportValue(cell,type){var formatter=cell.column.modules.format[type],params;if(formatter){var onRendered=function onRendered(callback){cell.modules.format||(cell.modules.format={}),cell.modules.format.renderedCallback=callback,cell.modules.format.rendered=!1};return params="function"==typeof formatter.params?formatter.params(cell.getComponent()):formatter.params,formatter.formatter.call(this,cell.getComponent(),params,onRendered)}return this.formatValue(cell)}},{key:"sanitizeHTML",value:function sanitizeHTML(value){if(value){var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(value).replace(/[&<>"'`=/]/g,(function(s){return entityMap[s]}))}return value}},{key:"emptyToSpace",value:function emptyToSpace(value){return null==value||""===value?"&nbsp;":value}},{key:"getFormatter",value:function getFormatter(formatter){switch(_typeof(formatter)){case"string":Format.formatters[formatter]?formatter=Format.formatters[formatter]:(console.warn("Formatter Error - No such formatter found: ",formatter),formatter=Format.formatters.plaintext);break;case"function":break;default:formatter=Format.formatters.plaintext}return formatter}}]),Format}(Module);Format.moduleName="format",Format.formatters=defaultFormatters;var FrozenColumns=function(_Module){_inherits(FrozenColumns,_Module);var _super=_createSuper(FrozenColumns);function FrozenColumns(table){var _this;return _classCallCheck(this,FrozenColumns),(_this=_super.call(this,table)).leftColumns=[],_this.rightColumns=[],_this.leftMargin=0,_this.rightMargin=0,_this.rightPadding=0,_this.initializationMode="left",_this.active=!1,_this.blocked=!0,_this.registerColumnOption("frozen"),_this}return _createClass(FrozenColumns,[{key:"reset",value:function reset(){this.initializationMode="left",this.leftColumns=[],this.rightColumns=[],this.leftMargin=0,this.rightMargin=0,this.rightMargin=0,this.active=!1,this.table.columnManager.headersElement.style.marginLeft=0,this.table.columnManager.element.style.paddingRight=0}},{key:"initialize",value:function initialize(){this.subscribe("cell-layout",this.layoutCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-width",this.layout.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("table-layout",this.layout.bind(this)),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("columns-loading",this.reset.bind(this)),this.subscribe("column-add",this.reinitializeColumns.bind(this)),this.subscribe("column-delete",this.reinitializeColumns.bind(this)),this.subscribe("table-redraw",this.layout.bind(this)),this.subscribe("layout-refreshing",this.blockLayout.bind(this)),this.subscribe("layout-refreshed",this.unblockLayout.bind(this))}},{key:"blockLayout",value:function blockLayout(){this.blocked=!0}},{key:"unblockLayout",value:function unblockLayout(){this.blocked=!1}},{key:"layoutCell",value:function layoutCell(cell){this.layoutElement(cell.element,cell.column)}},{key:"reinitializeColumns",value:function reinitializeColumns(){var _this2=this;this.reset(),this.table.columnManager.columnsByIndex.forEach((function(column){_this2.initializeColumn(column)}))}},{key:"initializeColumn",value:function initializeColumn(column){var config={margin:0,edge:!1};column.isGroup||(this.frozenCheck(column)?(config.position=this.initializationMode,"left"==this.initializationMode?this.leftColumns.push(column):this.rightColumns.unshift(column),this.active=!0,column.modules.frozen=config):this.initializationMode="right")}},{key:"frozenCheck",value:function frozenCheck(column){return column.parent.isGroup&&column.definition.frozen&&console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups"),column.parent.isGroup?this.frozenCheck(column.parent):column.definition.frozen}},{key:"scrollHorizontal",value:function scrollHorizontal(){this.active&&(this.calcMargins(!0),this.layoutColumnPosition(),this.layoutCalcRows(),this.reinitializeRows())}},{key:"calcMargins",value:function calcMargins(scroll){scroll||(this.leftMargin=this._calcSpace(this.leftColumns,this.leftColumns.length)+"px",this.rightMargin=this._calcSpace(this.rightColumns,this.rightColumns.length)+"px",this.table.rowManager.tableElement.style.marginRight=this.rightMargin),this.rightPadding=this.table.rowManager.element.clientWidth+this.table.columnManager.scrollLeft}},{key:"layoutCalcRows",value:function layoutCalcRows(){this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&this.table.modules.columnCalcs.topRow&&this.layoutRow(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&this.table.modules.columnCalcs.botRow&&this.layoutRow(this.table.modules.columnCalcs.botRow),this.table.modExists("groupRows")&&this.layoutGroupCalcs(this.table.modules.groupRows.getGroups()))}},{key:"layoutGroupCalcs",value:function layoutGroupCalcs(groups){var _this3=this;groups.forEach((function(group){group.calcs.top&&_this3.layoutRow(group.calcs.top),group.calcs.bottom&&_this3.layoutRow(group.calcs.bottom),group.groupList&&group.groupList.length&&_this3.layoutGroupCalcs(group.groupList)}))}},{key:"layoutColumnPosition",value:function layoutColumnPosition(allCells){var _this4=this,leftParents=[],leftMargin=0,rightMargin=0;this.table.columnManager.headersElement.style.marginLeft=this.leftMargin,this.table.columnManager.element.style.paddingRight=this.rightMargin,this.leftColumns.forEach((function(column,i){if(column.modules.frozen.marginValue=leftMargin+_this4.table.columnManager.scrollLeft,column.modules.frozen.margin=column.modules.frozen.marginValue+"px",column.visible&&(leftMargin+=column.getWidth()),i==_this4.leftColumns.length-1?column.modules.frozen.edge=!0:column.modules.frozen.edge=!1,column.parent.isGroup){var parentEl=_this4.getColGroupParentElement(column);leftParents.includes(parentEl)||(_this4.layoutElement(parentEl,column),leftParents.push(parentEl)),column.modules.frozen.edge&&parentEl.classList.add("tabulator-frozen-"+column.modules.frozen.position)}else _this4.layoutElement(column.getElement(),column);allCells&&column.cells.forEach((function(cell){_this4.layoutElement(cell.getElement(!0),column)}))})),this.rightColumns.forEach((function(column,i){column.visible&&(rightMargin+=column.getWidth()),column.modules.frozen.marginValue=_this4.rightPadding-rightMargin,column.modules.frozen.margin=column.modules.frozen.marginValue+"px",i==_this4.rightColumns.length-1?column.modules.frozen.edge=!0:column.modules.frozen.edge=!1,column.parent.isGroup?_this4.layoutElement(_this4.getColGroupParentElement(column),column):_this4.layoutElement(column.getElement(),column),allCells&&column.cells.forEach((function(cell){_this4.layoutElement(cell.getElement(!0),column)}))}))}},{key:"getColGroupParentElement",value:function getColGroupParentElement(column){return column.parent.isGroup?this.getColGroupParentElement(column.parent):column.getElement()}},{key:"layout",value:function layout(){this.active&&!this.blocked&&(this.calcMargins(),this.layoutColumnPosition(),this.reinitializeRows(),this.layoutCalcRows())}},{key:"reinitializeRows",value:function reinitializeRows(){var _this5=this,visibleRows=this.table.rowManager.getVisibleRows(!0),otherRows;this.table.rowManager.getRows().filter((function(row){return!visibleRows.includes(row)})).forEach((function(row){row.deinitialize()})),visibleRows.forEach((function(row){"row"===row.type&&_this5.layoutRow(row)}))}},{key:"layoutRow",value:function layoutRow(row){var _this6=this,rowEl;row.getElement().style.paddingLeft=this.leftMargin,"fitDataFill"===this.table.options.layout&&this.rightColumns.length&&(this.table.rowManager.getTableElement().style.minWidth="calc(100% - "+this.rightMargin+")"),this.leftColumns.forEach((function(column){var cell=row.getCell(column);cell&&_this6.layoutElement(cell.getElement(!0),column)})),this.rightColumns.forEach((function(column){var cell=row.getCell(column);cell&&_this6.layoutElement(cell.getElement(!0),column)}))}},{key:"layoutElement",value:function layoutElement(element,column){column.modules.frozen&&(element.style.position="absolute",element.style.left=column.modules.frozen.margin,element.classList.add("tabulator-frozen"),column.modules.frozen.edge&&element.classList.add("tabulator-frozen-"+column.modules.frozen.position))}},{key:"_calcSpace",value:function _calcSpace(columns,index){for(var width=0,i=0;i<index;i++)columns[i].visible&&(width+=columns[i].getWidth());return width}}]),FrozenColumns}(Module);FrozenColumns.moduleName="frozenColumns";var FrozenRows=function(_Module){_inherits(FrozenRows,_Module);var _super=_createSuper(FrozenRows);function FrozenRows(table){var _this;return _classCallCheck(this,FrozenRows),(_this=_super.call(this,table)).topElement=document.createElement("div"),_this.rows=[],_this.registerComponentFunction("row","freeze",_this.freezeRow.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("row","unfreeze",_this.unfreezeRow.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("row","isFrozen",_this.isRowFrozen.bind(_assertThisInitialized(_this))),_this.registerTableOption("frozenRowsField","id"),_this.registerTableOption("frozenRows",!1),_this}return _createClass(FrozenRows,[{key:"initialize",value:function initialize(){this.rows=[],this.topElement.classList.add("tabulator-frozen-rows-holder"),this.table.columnManager.getElement().insertBefore(this.topElement,this.table.columnManager.headersElement.nextSibling),this.subscribe("row-deleting",this.detachRow.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),10),this.table.options.frozenRows&&(this.subscribe("data-processed",this.initializeRows.bind(this)),this.subscribe("row-added",this.initializeRow.bind(this)))}},{key:"initializeRows",value:function initializeRows(){var _this2=this;this.table.rowManager.getRows().forEach((function(row){_this2.initializeRow(row)}))}},{key:"initializeRow",value:function initializeRow(row){var frozenRows=this.table.options.frozenRows,rowType=_typeof(frozenRows);"number"===rowType?row.getPosition()&&row.getPosition()+this.rows.length<=frozenRows&&this.freezeRow(row):"function"===rowType?frozenRows.call(this.table,row.getComponent())&&this.freezeRow(row):Array.isArray(frozenRows)&&frozenRows.includes(row.data[this.options("frozenRowsField")])&&this.freezeRow(row)}},{key:"isRowFrozen",value:function isRowFrozen(row){var index;return this.rows.indexOf(row)>-1}},{key:"isFrozen",value:function isFrozen(){return!!this.rows.length}},{key:"visibleRows",value:function visibleRows(viewable,rows){return this.rows.forEach((function(row){rows.push(row)})),rows}},{key:"getRows",value:function getRows(rows){var output=rows.slice(0);return this.rows.forEach((function(row){var index=output.indexOf(row);index>-1&&output.splice(index,1)})),output}},{key:"freezeRow",value:function freezeRow(row){row.modules.frozen?console.warn("Freeze Error - Row is already frozen"):(row.modules.frozen=!0,this.topElement.appendChild(row.getElement()),row.initialize(),row.normalizeHeight(),this.table.rowManager.adjustTableSize(),this.rows.push(row),this.refreshData(!1,"display"),this.styleRows())}},{key:"unfreezeRow",value:function unfreezeRow(row){row.modules.frozen?(row.modules.frozen=!1,this.detachRow(row),this.table.rowManager.adjustTableSize(),this.refreshData(!1,"display"),this.rows.length&&this.styleRows()):console.warn("Freeze Error - Row is already unfrozen")}},{key:"detachRow",value:function detachRow(row){var index=this.rows.indexOf(row);if(index>-1){var rowEl=row.getElement();rowEl.parentNode&&rowEl.parentNode.removeChild(rowEl),this.rows.splice(index,1)}}},{key:"styleRows",value:function styleRows(row){var _this3=this;this.rows.forEach((function(row,i){_this3.table.rowManager.styleRow(row,i)}))}}]),FrozenRows}(Module);FrozenRows.moduleName="frozenRows";var GroupComponent=function(){function GroupComponent(group){return _classCallCheck(this,GroupComponent),this._group=group,this.type="GroupComponent",new Proxy(this,{get:function get(target,name,receiver){return void 0!==target[name]?target[name]:target._group.groupManager.table.componentFunctionBinder.handle("row",target._group,name)}})}return _createClass(GroupComponent,[{key:"getKey",value:function getKey(){return this._group.key}},{key:"getField",value:function getField(){return this._group.field}},{key:"getElement",value:function getElement(){return this._group.element}},{key:"getRows",value:function getRows(){return this._group.getRows(!0)}},{key:"getSubGroups",value:function getSubGroups(){return this._group.getSubGroups(!0)}},{key:"getParentGroup",value:function getParentGroup(){return!!this._group.parent&&this._group.parent.getComponent()}},{key:"isVisible",value:function isVisible(){return this._group.visible}},{key:"show",value:function show(){this._group.show()}},{key:"hide",value:function hide(){this._group.hide()}},{key:"toggle",value:function toggle(){this._group.toggleVisibility()}},{key:"_getSelf",value:function _getSelf(){return this._group}},{key:"getTable",value:function getTable(){return this._group.groupManager.table}}]),GroupComponent}(),Group=function(){function Group(groupManager,parent,level,key,field,generator,oldGroup){_classCallCheck(this,Group),this.groupManager=groupManager,this.parent=parent,this.key=key,this.level=level,this.field=field,this.hasSubGroups=level<groupManager.groupIDLookups.length-1,this.addRow=this.hasSubGroups?this._addRowToGroup:this._addRow,this.type="group",this.old=oldGroup,this.rows=[],this.groups=[],this.groupList=[],this.generator=generator,this.element=!1,this.elementContents=!1,this.height=0,this.outerHeight=0,this.initialized=!1,this.calcs={},this.initialized=!1,this.modules={},this.arrowElement=!1,this.visible=oldGroup?oldGroup.visible:void 0!==groupManager.startOpen[level]?groupManager.startOpen[level]:groupManager.startOpen[0],this.component=null,this.createElements(),this.addBindings(),this.createValueGroups()}return _createClass(Group,[{key:"wipe",value:function wipe(){this.groupList.length?this.groupList.forEach((function(group){group.wipe()})):this.rows.forEach((function(row){row.modules&&delete row.modules.group})),this.element=!1,this.arrowElement=!1,this.elementContents=!1}},{key:"createElements",value:function createElements(){var arrow=document.createElement("div");arrow.classList.add("tabulator-arrow"),this.element=document.createElement("div"),this.element.classList.add("tabulator-row"),this.element.classList.add("tabulator-group"),this.element.classList.add("tabulator-group-level-"+this.level),this.element.setAttribute("role","rowgroup"),this.arrowElement=document.createElement("div"),this.arrowElement.classList.add("tabulator-group-toggle"),this.arrowElement.appendChild(arrow),!1!==this.groupManager.table.options.movableRows&&this.groupManager.table.modExists("moveRow")&&this.groupManager.table.modules.moveRow.initializeGroupHeader(this)}},{key:"createValueGroups",value:function createValueGroups(){var _this=this,level=this.level+1;this.groupManager.allowedValues&&this.groupManager.allowedValues[level]&&this.groupManager.allowedValues[level].forEach((function(value){_this._createGroup(value,level)}))}},{key:"addBindings",value:function addBindings(){var _this2=this,toggleElement;this.groupManager.table.options.groupToggleElement&&(toggleElement="arrow"==this.groupManager.table.options.groupToggleElement?this.arrowElement:this.element).addEventListener("click",(function(e){e.stopPropagation(),e.stopImmediatePropagation(),_this2.toggleVisibility()}))}},{key:"_createGroup",value:function _createGroup(groupID,level){var groupKey=level+"_"+groupID,group=new Group(this.groupManager,this,level,groupID,this.groupManager.groupIDLookups[level].field,this.groupManager.headerGenerator[level]||this.groupManager.headerGenerator[0],!!this.old&&this.old.groups[groupKey]);this.groups[groupKey]=group,this.groupList.push(group)}},{key:"_addRowToGroup",value:function _addRowToGroup(row){var level=this.level+1;if(this.hasSubGroups){var groupID=this.groupManager.groupIDLookups[level].func(row.getData()),groupKey=level+"_"+groupID;this.groupManager.allowedValues&&this.groupManager.allowedValues[level]?this.groups[groupKey]&&this.groups[groupKey].addRow(row):(this.groups[groupKey]||this._createGroup(groupID,level),this.groups[groupKey].addRow(row))}}},{key:"_addRow",value:function _addRow(row){this.rows.push(row),row.modules.group=this}},{key:"insertRow",value:function insertRow(row,to,after){var data=this.conformRowData({});row.updateData(data);var toIndex=this.rows.indexOf(to);toIndex>-1?after?this.rows.splice(toIndex+1,0,row):this.rows.splice(toIndex,0,row):after?this.rows.push(row):this.rows.unshift(row),row.modules.group=this,this.generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&"table"!=this.groupManager.table.options.columnCalcs&&this.groupManager.table.modules.columnCalcs.recalcGroup(this),this.groupManager.updateGroupRows(!0)}},{key:"scrollHeader",value:function scrollHeader(left){this.arrowElement&&(this.arrowElement.style.marginLeft=left,this.groupList.forEach((function(child){child.scrollHeader(left)})))}},{key:"getRowIndex",value:function getRowIndex(row){}},{key:"conformRowData",value:function conformRowData(data){return this.field?data[this.field]=this.key:console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function"),this.parent&&(data=this.parent.conformRowData(data)),data}},{key:"removeRow",value:function removeRow(row){var index=this.rows.indexOf(row),el=row.getElement();index>-1&&this.rows.splice(index,1),this.groupManager.table.options.groupValues||this.rows.length?(el.parentNode&&el.parentNode.removeChild(el),this.generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&"table"!=this.groupManager.table.options.columnCalcs&&this.groupManager.table.modules.columnCalcs.recalcGroup(this)):(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this),this.groupManager.updateGroupRows(!0))}},{key:"removeGroup",value:function removeGroup(group){var groupKey=group.level+"_"+group.key,index;this.groups[groupKey]&&(delete this.groups[groupKey],(index=this.groupList.indexOf(group))>-1&&this.groupList.splice(index,1),this.groupList.length||(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this)))}},{key:"getHeadersAndRows",value:function getHeadersAndRows(noCalc){var output=[];return output.push(this),this._visSet(),this.visible?this.groupList.length?this.groupList.forEach((function(group){output=output.concat(group.getHeadersAndRows(noCalc))})):(!noCalc&&"table"!=this.groupManager.table.options.columnCalcs&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&(this.calcs.top&&(this.calcs.top.detachElement(),this.calcs.top.deleteCells()),this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),output.push(this.calcs.top)),output=output.concat(this.rows),!noCalc&&"table"!=this.groupManager.table.options.columnCalcs&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&(this.calcs.bottom&&(this.calcs.bottom.detachElement(),this.calcs.bottom.deleteCells()),this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),output.push(this.calcs.bottom))):this.groupList.length||"table"==this.groupManager.table.options.columnCalcs||this.groupManager.table.modExists("columnCalcs")&&(!noCalc&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&(this.calcs.top&&(this.calcs.top.detachElement(),this.calcs.top.deleteCells()),this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),output.push(this.calcs.top))),!noCalc&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&(this.calcs.bottom&&(this.calcs.bottom.detachElement(),this.calcs.bottom.deleteCells()),this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),output.push(this.calcs.bottom)))),output}},{key:"getData",value:function getData(visible,transform){var output=[];return this._visSet(),(!visible||visible&&this.visible)&&this.rows.forEach((function(row){output.push(row.getData(transform||"data"))})),output}},{key:"getRowCount",value:function getRowCount(){var count=0;return this.groupList.length?this.groupList.forEach((function(group){count+=group.getRowCount()})):count=this.rows.length,count}},{key:"toggleVisibility",value:function toggleVisibility(){this.visible?this.hide():this.show()}},{key:"hide",value:function hide(){this.visible=!1,"basic"!=this.groupManager.table.rowManager.getRenderMode()||this.groupManager.table.options.pagination?this.groupManager.updateGroupRows(!0):(this.element.classList.remove("tabulator-group-visible"),this.groupList.length?this.groupList.forEach((function(group){var rows;group.getHeadersAndRows().forEach((function(row){row.detachElement()}))})):this.rows.forEach((function(row){var rowEl=row.getElement();rowEl.parentNode.removeChild(rowEl)})),this.groupManager.table.rowManager.setDisplayRows(this.groupManager.updateGroupRows(),this.groupManager.getDisplayIndex()),this.groupManager.checkBasicModeGroupHeaderWidth()),this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!1)}},{key:"show",value:function show(){if(this.visible=!0,"basic"!=this.groupManager.table.rowManager.getRenderMode()||this.groupManager.table.options.pagination)this.groupManager.updateGroupRows(!0);else{this.element.classList.add("tabulator-group-visible");var prev=this.generateElement();this.groupList.length?this.groupList.forEach((function(group){var rows;group.getHeadersAndRows().forEach((function(row){var rowEl=row.getElement();prev.parentNode.insertBefore(rowEl,prev.nextSibling),row.initialize(),prev=rowEl}))})):this.rows.forEach((function(row){var rowEl=row.getElement();prev.parentNode.insertBefore(rowEl,prev.nextSibling),row.initialize(),prev=rowEl})),this.groupManager.table.rowManager.setDisplayRows(this.groupManager.updateGroupRows(),this.groupManager.getDisplayIndex()),this.groupManager.checkBasicModeGroupHeaderWidth()}this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!0)}},{key:"_visSet",value:function _visSet(){var data=[];"function"==typeof this.visible&&(this.rows.forEach((function(row){data.push(row.getData())})),this.visible=this.visible(this.key,this.getRowCount(),data,this.getComponent()))}},{key:"getRowGroup",value:function getRowGroup(row){var match=!1;return this.groupList.length?this.groupList.forEach((function(group){var result=group.getRowGroup(row);result&&(match=result)})):this.rows.find((function(item){return item===row}))&&(match=this),match}},{key:"getSubGroups",value:function getSubGroups(component){var output=[];return this.groupList.forEach((function(child){output.push(component?child.getComponent():child)})),output}},{key:"getRows",value:function getRows(component){var output=[];return this.rows.forEach((function(row){output.push(component?row.getComponent():row)})),output}},{key:"generateGroupHeaderContents",value:function generateGroupHeaderContents(){var data=[];for(this.rows.forEach((function(row){data.push(row.getData())})),this.elementContents=this.generator(this.key,this.getRowCount(),data,this.getComponent());this.element.firstChild;)this.element.removeChild(this.element.firstChild);"string"==typeof this.elementContents?this.element.innerHTML=this.elementContents:this.element.appendChild(this.elementContents),this.element.insertBefore(this.arrowElement,this.element.firstChild)}},{key:"getPath",value:function getPath(){var path=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return path.unshift(this.key),this.parent&&this.parent.getPath(path),path}},{key:"getElement",value:function getElement(){return this.elementContents?this.element:this.generateElement()}},{key:"generateElement",value:function generateElement(){this.addBindings=!1,this._visSet(),this.visible?this.element.classList.add("tabulator-group-visible"):this.element.classList.remove("tabulator-group-visible");for(var i=0;i<this.element.childNodes.length;++i)this.element.childNodes[i].parentNode.removeChild(this.element.childNodes[i]);return this.generateGroupHeaderContents(),this.element}},{key:"detachElement",value:function detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}},{key:"normalizeHeight",value:function normalizeHeight(){this.setHeight(this.element.clientHeight)}},{key:"initialize",value:function initialize(force){this.initialized&&!force||(this.normalizeHeight(),this.initialized=!0)}},{key:"reinitialize",value:function reinitialize(){this.initialized=!1,this.height=0,Helpers.elVisible(this.element)&&this.initialize(!0)}},{key:"setHeight",value:function setHeight(height){this.height!=height&&(this.height=height,this.outerHeight=this.element.offsetHeight)}},{key:"getHeight",value:function getHeight(){return this.outerHeight}},{key:"getGroup",value:function getGroup(){return this}},{key:"reinitializeHeight",value:function reinitializeHeight(){}},{key:"calcHeight",value:function calcHeight(){}},{key:"setCellHeight",value:function setCellHeight(){}},{key:"clearCellHeight",value:function clearCellHeight(){}},{key:"deinitializeHeight",value:function deinitializeHeight(){}},{key:"getComponent",value:function getComponent(){return this.component||(this.component=new GroupComponent(this)),this.component}}]),Group}(),GroupRows=function(_Module){_inherits(GroupRows,_Module);var _super=_createSuper(GroupRows);function GroupRows(table){var _this;return _classCallCheck(this,GroupRows),(_this=_super.call(this,table)).groupIDLookups=!1,_this.startOpen=[function(){return!1}],_this.headerGenerator=[function(){return""}],_this.groupList=[],_this.allowedValues=!1,_this.groups={},_this.displayIndex=0,_this.displayHandler=_this.getRows.bind(_assertThisInitialized(_this)),_this.registerTableOption("groupBy",!1),_this.registerTableOption("groupStartOpen",!0),_this.registerTableOption("groupValues",!1),_this.registerTableOption("groupUpdateOnCellEdit",!1),_this.registerTableOption("groupHeader",!1),_this.registerTableOption("groupHeaderPrint",null),_this.registerTableOption("groupHeaderClipboard",null),_this.registerTableOption("groupHeaderHtmlOutput",null),_this.registerTableOption("groupHeaderDownload",null),_this.registerTableOption("groupToggleElement","arrow"),_this.registerTableOption("groupClosedShowCalcs",!1),_this.registerTableFunction("setGroupBy",_this.setGroupBy.bind(_assertThisInitialized(_this))),_this.registerTableFunction("setGroupValues",_this.setGroupValues.bind(_assertThisInitialized(_this))),_this.registerTableFunction("setGroupStartOpen",_this.setGroupStartOpen.bind(_assertThisInitialized(_this))),_this.registerTableFunction("setGroupHeader",_this.setGroupHeader.bind(_assertThisInitialized(_this))),_this.registerTableFunction("getGroups",_this.userGetGroups.bind(_assertThisInitialized(_this))),_this.registerTableFunction("getGroupedData",_this.userGetGroupedData.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("row","getGroup",_this.rowGetGroup.bind(_assertThisInitialized(_this))),_this}return _createClass(GroupRows,[{key:"initialize",value:function initialize(){this.table.options.groupBy&&(this.table.options.groupUpdateOnCellEdit&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("row-data-changed",this.reassignRowToGroup.bind(this),0)),this.subscribe("table-built",this.configureGroupSetup.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHeaders.bind(this)),this.subscribe("rows-wipe",this.wipe.bind(this)),this.subscribe("rows-added",this.rowsUpdated.bind(this)),this.subscribe("row-moving",this.rowMoving.bind(this)),this.subscribe("row-adding-index",this.rowAddingIndex.bind(this)),this.subscribe("rows-sample",this.rowSample.bind(this)),this.subscribe("render-virtual-fill",this.virtualRenderFill.bind(this)),this.registerDisplayHandler(this.displayHandler,20),this.initialized=!0)}},{key:"configureGroupSetup",value:function configureGroupSetup(){var _this2=this;if(this.table.options.groupBy){var groupBy=this.table.options.groupBy,startOpen=this.table.options.groupStartOpen,groupHeader=this.table.options.groupHeader,cols;if(this.allowedValues=this.table.options.groupValues,Array.isArray(groupBy)&&Array.isArray(groupHeader)&&groupBy.length>groupHeader.length&&console.warn("Error creating group headers, groupHeader array is shorter than groupBy array"),this.headerGenerator=[function(){return""}],this.startOpen=[function(){return!1}],this.langBind("groups|item",(function(langValue,lang){_this2.headerGenerator[0]=function(value,count,data){return(void 0===value?"":value)+"<span>("+count+" "+(1===count?langValue:lang.groups.items)+")</span>"}})),this.groupIDLookups=[],Array.isArray(groupBy))this.table.modExists("columnCalcs")&&"table"!=this.table.options.columnCalcs&&"both"!=this.table.options.columnCalcs&&this.table.modules.columnCalcs.removeCalcs();else if(this.table.modExists("columnCalcs")&&"group"!=this.table.options.columnCalcs)this.table.columnManager.getRealColumns().forEach((function(col){col.definition.topCalc&&_this2.table.modules.columnCalcs.initializeTopRow(),col.definition.bottomCalc&&_this2.table.modules.columnCalcs.initializeBottomRow()}));Array.isArray(groupBy)||(groupBy=[groupBy]),groupBy.forEach((function(group,i){var lookupFunc,column;lookupFunc="function"==typeof group?group:(column=_this2.table.columnManager.getColumnByField(group))?function lookupFunc(data){return column.getFieldValue(data)}:function lookupFunc(data){return data[group]},_this2.groupIDLookups.push({field:"function"!=typeof group&&group,func:lookupFunc,values:!!_this2.allowedValues&&_this2.allowedValues[i]})})),startOpen&&(Array.isArray(startOpen)||(startOpen=[startOpen]),startOpen.forEach((function(level){})),this.startOpen=startOpen),groupHeader&&(this.headerGenerator=Array.isArray(groupHeader)?groupHeader:[groupHeader])}else this.groupList=[],this.groups={}}},{key:"rowSample",value:function rowSample(rows,prevValue){var group=this.getGroups(!1)[0];return prevValue.push(group.getRows(!1)[0]),prevValue}},{key:"virtualRenderFill",value:function virtualRenderFill(){var el=this.table.rowManager.tableElement,rows=this.table.rowManager.getVisibleRows();rows=rows.filter((function(row){return"group"!==row.type})),el.style.minWidth=rows.length?"":this.table.columnManager.getWidth()+"px"}},{key:"rowAddingIndex",value:function rowAddingIndex(row,index,top){this.assignRowToGroup(row);var groupRows=row.modules.group.rows;return groupRows.length>1&&(!index||index&&-1==groupRows.indexOf(index)?top?groupRows[0]!==row&&(index=groupRows[0],this.table.rowManager.moveRowInArray(row.modules.group.rows,row,index,!top)):groupRows[groupRows.length-1]!==row&&(index=groupRows[groupRows.length-1],this.table.rowManager.moveRowInArray(row.modules.group.rows,row,index,!top)):this.table.rowManager.moveRowInArray(row.modules.group.rows,row,index,!top)),index}},{key:"trackChanges",value:function trackChanges(){this.dispatch("group-changed")}},{key:"setGroupBy",value:function setGroupBy(groups){this.table.options.groupBy=groups,this.initialized||this.initialize(),this.configureGroupSetup(),this.refreshData(),this.trackChanges()}},{key:"setGroupValues",value:function setGroupValues(groupValues){this.table.options.groupValues=groupValues,this.configureGroupSetup(),this.refreshData(),this.trackChanges()}},{key:"setGroupStartOpen",value:function setGroupStartOpen(values){this.table.options.groupStartOpen=values,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}},{key:"setGroupHeader",value:function setGroupHeader(values){this.table.options.groupHeader=values,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}},{key:"userGetGroups",value:function userGetGroups(values){return this.getGroups(!0)}},{key:"userGetGroupedData",value:function userGetGroupedData(){return this.table.options.groupBy?this.getGroupedData():this.getData()}},{key:"rowGetGroup",value:function rowGetGroup(row){return!!row.modules.group&&row.modules.group.getComponent()}},{key:"rowMoving",value:function rowMoving(from,to,after){!after&&to instanceof Group&&(to=this.table.rowManager.prevDisplayRow(from)||to);var toGroup=to instanceof Group?to:to.modules.group,fromGroup=from instanceof Group?from:from.modules.group;toGroup===fromGroup?this.table.rowManager.moveRowInArray(toGroup.rows,from,to,after):(fromGroup&&fromGroup.removeRow(from),toGroup.insertRow(from,to,after))}},{key:"rowDeleting",value:function rowDeleting(row){row.modules.group&&row.modules.group.removeRow(row)}},{key:"rowsUpdated",value:function rowsUpdated(row){this.updateGroupRows(!0)}},{key:"cellUpdated",value:function cellUpdated(cell){this.reassignRowToGroup(cell.row)}},{key:"setDisplayIndex",value:function setDisplayIndex(index){this.displayIndex=index}},{key:"getDisplayIndex",value:function getDisplayIndex(){return this.displayIndex}},{key:"getRows",value:function getRows(rows){return this.table.options.groupBy&&this.groupIDLookups.length?(this.dispatchExternal("dataGrouping"),this.generateGroups(rows),this.subscribedExternal("dataGrouped")&&this.dispatchExternal("dataGrouped",this.getGroups(!0)),this.updateGroupRows()):rows.slice(0)}},{key:"getGroups",value:function getGroups(component){var groupComponents=[];return this.groupList.forEach((function(group){groupComponents.push(component?group.getComponent():group)})),groupComponents}},{key:"getChildGroups",value:function getChildGroups(group){var _this3=this,groupComponents=[];return group||(group=this),group.groupList.forEach((function(child){child.groupList.length?groupComponents=groupComponents.concat(_this3.getChildGroups(child)):groupComponents.push(child)})),groupComponents}},{key:"wipe",value:function wipe(){this.groupList.forEach((function(group){group.wipe()}))}},{key:"pullGroupListData",value:function pullGroupListData(groupList){var _this4=this,groupListData=[];return groupList.forEach((function(group){var groupHeader={level:0,rowCount:0,headerContent:""},childData=[];group.hasSubGroups?(childData=_this4.pullGroupListData(group.groupList),groupHeader.level=group.level,groupHeader.rowCount=childData.length-group.groupList.length,groupHeader.headerContent=group.generator(group.key,groupHeader.rowCount,group.rows,group),groupListData.push(groupHeader),groupListData=groupListData.concat(childData)):(groupHeader.level=group.level,groupHeader.headerContent=group.generator(group.key,group.rows.length,group.rows,group),groupHeader.rowCount=group.getRows().length,groupListData.push(groupHeader),group.getRows().forEach((function(row){groupListData.push(row.getData("data"))})))})),groupListData}},{key:"getGroupedData",value:function getGroupedData(){return this.pullGroupListData(this.groupList)}},{key:"getRowGroup",value:function getRowGroup(row){var match=!1;return this.options("dataTree")&&(row=this.table.modules.dataTree.getTreeParentRoot(row)),this.groupList.forEach((function(group){var result=group.getRowGroup(row);result&&(match=result)})),match}},{key:"countGroups",value:function countGroups(){return this.groupList.length}},{key:"generateGroups",value:function generateGroups(rows){var _this5=this,oldGroups=this.groups;this.groups={},this.groupList=[],this.allowedValues&&this.allowedValues[0]?(this.allowedValues[0].forEach((function(value){_this5.createGroup(value,0,oldGroups)})),rows.forEach((function(row){_this5.assignRowToExistingGroup(row,oldGroups)}))):rows.forEach((function(row){_this5.assignRowToGroup(row,oldGroups)}))}},{key:"createGroup",value:function createGroup(groupID,level,oldGroups){var groupKey=level+"_"+groupID,group;oldGroups=oldGroups||[],group=new Group(this,!1,level,groupID,this.groupIDLookups[0].field,this.headerGenerator[0],oldGroups[groupKey]),this.groups[groupKey]=group,this.groupList.push(group)}},{key:"assignRowToExistingGroup",value:function assignRowToExistingGroup(row,oldGroups){var groupID,groupKey="0_"+this.groupIDLookups[0].func(row.getData());this.groups[groupKey]&&this.groups[groupKey].addRow(row)}},{key:"assignRowToGroup",value:function assignRowToGroup(row,oldGroups){var groupID=this.groupIDLookups[0].func(row.getData()),newGroupNeeded=!this.groups["0_"+groupID];return newGroupNeeded&&this.createGroup(groupID,0,oldGroups),this.groups["0_"+groupID].addRow(row),!newGroupNeeded}},{key:"reassignRowToGroup",value:function reassignRowToGroup(row){if("row"===row.type){var oldRowGroup=row.modules.group,oldGroupPath=oldRowGroup.getPath(),newGroupPath=this.getExpectedPath(row),samePath;(samePath=oldGroupPath.length==newGroupPath.length&&oldGroupPath.every((function(element,index){return element===newGroupPath[index]})))||(oldRowGroup.removeRow(row),this.assignRowToGroup(row,this.groups),this.refreshData(!0))}}},{key:"getExpectedPath",value:function getExpectedPath(row){var groupPath=[],rowData=row.getData();return this.groupIDLookups.forEach((function(groupId){groupPath.push(groupId.func(rowData))})),groupPath}},{key:"updateGroupRows",value:function updateGroupRows(force){var output=[];return this.groupList.forEach((function(group){output=output.concat(group.getHeadersAndRows())})),force&&this.refreshData(!0,this.displayHandler),output}},{key:"scrollHeaders",value:function scrollHeaders(left){"virtual"===this.table.options.renderHorizontal&&(left-=this.table.columnManager.renderer.vDomPadLeft),left+="px",this.groupList.forEach((function(group){group.scrollHeader(left)}))}},{key:"removeGroup",value:function removeGroup(group){var groupKey=group.level+"_"+group.key,index;this.groups[groupKey]&&(delete this.groups[groupKey],(index=this.groupList.indexOf(group))>-1&&this.groupList.splice(index,1))}},{key:"checkBasicModeGroupHeaderWidth",value:function checkBasicModeGroupHeaderWidth(){var _this6=this,element=this.table.rowManager.tableElement,onlyGroupHeaders=!0;this.table.rowManager.getDisplayRows().forEach((function(row,index){_this6.table.rowManager.styleRow(row,index),element.appendChild(row.getElement()),row.initialize(!0),"group"!==row.type&&(onlyGroupHeaders=!1)})),element.style.minWidth=onlyGroupHeaders?this.table.columnManager.getWidth()+"px":""}}]),GroupRows}(Module);GroupRows.moduleName="groupRows";var defaultUndoers={cellEdit:function cellEdit(action){action.component.setValueProcessData(action.data.oldValue),action.component.cellRendered()},rowAdd:function rowAdd(action){action.component.deleteActual()},rowDelete:function rowDelete(action){var newRow=this.table.rowManager.addRowActual(action.data.data,action.data.pos,action.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(action.component,newRow)},rowMove:function rowMove(action){this.table.rowManager.moveRowActual(action.component,this.table.rowManager.rows[action.data.posFrom],!action.data.after),this.table.rowManager.redraw()}},defaultRedoers={cellEdit:function cellEdit(action){action.component.setValueProcessData(action.data.newValue),action.component.cellRendered()},rowAdd:function rowAdd(action){var newRow=this.table.rowManager.addRowActual(action.data.data,action.data.pos,action.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(action.component,newRow)},rowDelete:function rowDelete(action){action.component.deleteActual()},rowMove:function rowMove(action){this.table.rowManager.moveRowActual(action.component,this.table.rowManager.rows[action.data.posTo],action.data.after),this.table.rowManager.redraw()}},History=function(_Module){_inherits(History,_Module);var _super=_createSuper(History);function History(table){var _this;return _classCallCheck(this,History),(_this=_super.call(this,table)).history=[],_this.index=-1,_this.registerTableOption("history",!1),_this}return _createClass(History,[{key:"initialize",value:function initialize(){this.table.options.history&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("cell-delete",this.clearComponentHistory.bind(this)),this.subscribe("row-delete",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clear.bind(this)),this.subscribe("row-added",this.rowAdded.bind(this)),this.subscribe("row-move",this.rowMoved.bind(this))),this.registerTableFunction("undo",this.undo.bind(this)),this.registerTableFunction("redo",this.redo.bind(this)),this.registerTableFunction("getHistoryUndoSize",this.getHistoryUndoSize.bind(this)),this.registerTableFunction("getHistoryRedoSize",this.getHistoryRedoSize.bind(this)),this.registerTableFunction("clearHistory",this.clear.bind(this))}},{key:"rowMoved",value:function rowMoved(from,to,after){this.action("rowMove",from,{posFrom:from.getPosition(),posTo:to.getPosition(),to:to,after:after})}},{key:"rowAdded",value:function rowAdded(row,data,pos,index){this.action("rowAdd",row,{data:data,pos:pos,index:index})}},{key:"rowDeleted",value:function rowDeleted(row){var index,rows;this.table.options.groupBy?(index=(rows=row.getComponent().getGroup()._getSelf().rows).indexOf(row))&&(index=rows[index-1]):(index=row.table.rowManager.getRowIndex(row))&&(index=row.table.rowManager.rows[index-1]),this.action("rowDelete",row,{data:row.getData(),pos:!index,index:index})}},{key:"cellUpdated",value:function cellUpdated(cell){this.action("cellEdit",cell,{oldValue:cell.oldValue,newValue:cell.value})}},{key:"clear",value:function clear(){this.history=[],this.index=-1}},{key:"action",value:function action(type,component,data){this.history=this.history.slice(0,this.index+1),this.history.push({type:type,component:component,data:data}),this.index++}},{key:"getHistoryUndoSize",value:function getHistoryUndoSize(){return this.index+1}},{key:"getHistoryRedoSize",value:function getHistoryRedoSize(){return this.history.length-(this.index+1)}},{key:"clearComponentHistory",value:function clearComponentHistory(component){var index=this.history.findIndex((function(item){return item.component===component}));index>-1&&(this.history.splice(index,1),index<=this.index&&this.index--,this.clearComponentHistory(component))}},{key:"undo",value:function undo(){if(this.index>-1){var action=this.history[this.index];return History.undoers[action.type].call(this,action),this.index--,this.dispatchExternal("historyUndo",action.type,action.component.getComponent(),action.data),!0}return console.warn("History Undo Error - No more history to undo"),!1}},{key:"redo",value:function redo(){if(this.history.length-1>this.index){this.index++;var action=this.history[this.index];return History.redoers[action.type].call(this,action),this.dispatchExternal("historyRedo",action.type,action.component.getComponent(),action.data),!0}return console.warn("History Redo Error - No more history to redo"),!1}},{key:"_rebindRow",value:function _rebindRow(oldRow,newRow){this.history.forEach((function(action){if(action.component instanceof Row)action.component===oldRow&&(action.component=newRow);else if(action.component instanceof Cell&&action.component.row===oldRow){var field=action.component.column.getField();field&&(action.component=newRow.getCell(field))}}))}}]),History}(Module);History.moduleName="history",History.undoers=defaultUndoers,History.redoers=defaultRedoers;var HtmlTableImport=function(_Module){_inherits(HtmlTableImport,_Module);var _super=_createSuper(HtmlTableImport);function HtmlTableImport(table){var _this;return _classCallCheck(this,HtmlTableImport),(_this=_super.call(this,table)).fieldIndex=[],_this.hasIndex=!1,_this}return _createClass(HtmlTableImport,[{key:"initialize",value:function initialize(){this.tableElementCheck()}},{key:"tableElementCheck",value:function tableElementCheck(){this.table.originalElement&&"TABLE"===this.table.originalElement.tagName&&(this.table.originalElement.childNodes.length?this.parseTable():console.warn("Unable to parse data from empty table tag, Tabulator should be initialized on a div tag unless importing data from a table element."))}},{key:"parseTable",value:function parseTable(){var element=this.table.originalElement,options=this.table.options,headers=element.getElementsByTagName("th"),rows=element.getElementsByTagName("tbody")[0],data=[];this.hasIndex=!1,this.dispatchExternal("htmlImporting"),rows=rows?rows.getElementsByTagName("tr"):[],this._extractOptions(element,options),headers.length?this._extractHeaders(headers,rows):this._generateBlankHeaders(headers,rows);for(var index=0;index<rows.length;index++){var row,cells=rows[index].getElementsByTagName("td"),item={};this.hasIndex||(item[options.index]=index);for(var i=0;i<cells.length;i++){var cell=cells[i];void 0!==this.fieldIndex[i]&&(item[this.fieldIndex[i]]=cell.innerHTML)}data.push(item)}options.data=data,this.dispatchExternal("htmlImported")}},{key:"_extractOptions",value:function _extractOptions(element,options,defaultOptions){var attributes=element.attributes,optionsArr=defaultOptions?Object.keys(defaultOptions):Object.keys(options),optionsList={};for(var index in optionsArr.forEach((function(item){optionsList[item.toLowerCase()]=item})),attributes){var attrib=attributes[index],name;attrib&&"object"==_typeof(attrib)&&attrib.name&&0===attrib.name.indexOf("tabulator-")&&(name=attrib.name.replace("tabulator-",""),void 0!==optionsList[name]&&(options[optionsList[name]]=this._attribValue(attrib.value)))}}},{key:"_attribValue",value:function _attribValue(value){return"true"===value||"false"!==value&&value}},{key:"_findCol",value:function _findCol(title){var match;return this.table.options.columns.find((function(column){return column.title===title}))||!1}},{key:"_extractHeaders",value:function _extractHeaders(headers,rows){for(var index=0;index<headers.length;index++){var header=headers[index],exists=!1,col=this._findCol(header.textContent),width;col?exists=!0:col={title:header.textContent.trim()},col.field||(col.field=header.textContent.trim().toLowerCase().replace(" ","_")),(width=header.getAttribute("width"))&&!col.width&&(col.width=width),this._extractOptions(header,col,this.table.columnManager.optionsList.registeredDefaults),this.fieldIndex[index]=col.field,col.field==this.table.options.index&&(this.hasIndex=!0),exists||this.table.options.columns.push(col)}}},{key:"_generateBlankHeaders",value:function _generateBlankHeaders(headers,rows){for(var index=0;index<headers.length;index++){var header=headers[index],col={title:"",field:"col"+index};this.fieldIndex[index]=col.field;var width=header.getAttribute("width");width&&(col.width=width),this.table.options.columns.push(col)}}}]),HtmlTableImport}(Module);function csvImporter(input){for(var data=[],row=0,col=0,inQuote=!1,index=0;index<input.length;index++){var _char=input[index],nextChar=input[index+1];data[row]||(data[row]=[]),data[row][col]||(data[row][col]=""),'"'==_char&&inQuote&&'"'==nextChar?(data[row][col]+=_char,index++):'"'!=_char?","!=_char||inQuote?"\r"!=_char||"\n"!=nextChar||inQuote?"\r"!=_char&&"\n"!=_char||inQuote?data[row][col]+=_char:(col=0,row++):(col=0,row++,index++):col++:inQuote=!inQuote}return data}function json$1(input){try{return JSON.parse(input)}catch(e){return console.warn("JSON Import Error - File contents is invalid JSON",e),Promise.reject()}}function arrayImporter(input){return input}HtmlTableImport.moduleName="htmlTableImport";var defaultImporters={csv:csvImporter,json:json$1,array:arrayImporter},Import=function(_Module){_inherits(Import,_Module);var _super=_createSuper(Import);function Import(table){var _this;return _classCallCheck(this,Import),(_this=_super.call(this,table)).registerTableOption("importFormat"),_this.registerTableOption("importReader","text"),_this}return _createClass(Import,[{key:"initialize",value:function initialize(){this.registerTableFunction("import",this.importFromFile.bind(this)),this.table.options.importFormat&&(this.subscribe("data-loading",this.loadDataCheck.bind(this),10),this.subscribe("data-load",this.loadData.bind(this),10))}},{key:"loadDataCheck",value:function loadDataCheck(data){return this.table.options.importFormat&&("string"==typeof data||Array.isArray(data)&&data.length&&Array.isArray(data))}},{key:"loadData",value:function loadData(data,params,config,silent,previousData){return this.importData(this.lookupImporter(),data).then(this.structureData.bind(this)).catch((function(err){return console.error("Import Error:",err||"Unable to import data"),Promise.reject(err)}))}},{key:"lookupImporter",value:function lookupImporter(importFormat){var importer;return importFormat||(importFormat=this.table.options.importFormat),(importer="string"==typeof importFormat?Import.importers[importFormat]:importFormat)||console.error("Import Error - Importer not found:",importFormat),importer}},{key:"importFromFile",value:function importFromFile(importFormat,extension){var importer=this.lookupImporter(importFormat);if(importer)return this.pickFile(extension).then(this.importData.bind(this,importer)).then(this.structureData.bind(this)).then(this.setData.bind(this)).catch((function(err){return console.error("Import Error:",err||"Unable to import file"),Promise.reject(err)}))}},{key:"pickFile",value:function pickFile(extensions){var _this2=this;return new Promise((function(resolve,reject){var input=document.createElement("input");input.type="file",input.accept=extensions,input.addEventListener("change",(function(e){var file=input.files[0],reader=new FileReader;switch(_this2.table.options.importReader){case"buffer":reader.readAsArrayBuffer(file);break;case"binary":reader.readAsBinaryString(file);break;case"url":reader.readAsDataURL(file);break;case"text":default:reader.readAsText(file)}reader.onload=function(e){resolve(reader.result)},reader.onerror=function(e){console.warn("File Load Error - Unable to read file"),reject()}})),input.click()}))}},{key:"importData",value:function importData(importer,fileContents){var data=importer.call(this.table,fileContents);return data instanceof Promise?data:data?Promise.resolve(data):Promise.reject()}},{key:"structureData",value:function structureData(parsedData){var data=[];return Array.isArray(parsedData)&&parsedData.length&&Array.isArray(parsedData[0])?data=this.table.options.autoColumns?this.structureArrayToObject(parsedData):this.structureArrayToColumns(parsedData):parsedData}},{key:"structureArrayToObject",value:function structureArrayToObject(parsedData){var columns=parsedData.shift(),data;return parsedData.map((function(values){var row={};return columns.forEach((function(key,i){row[key]=values[i]})),row}))}},{key:"structureArrayToColumns",value:function structureArrayToColumns(parsedData){var data=[],columns=this.table.getColumns();return columns[0]&&parsedData[0][0]&&columns[0].getDefinition().title===parsedData[0][0]&&parsedData.shift(),parsedData.forEach((function(rowData){var row={};rowData.forEach((function(value,index){var column=columns[index];column&&(row[column.getField()]=value)})),data.push(row)})),data}},{key:"setData",value:function setData(data){return this.table.setData(data)}}]),Import}(Module);Import.moduleName="import",Import.importers=defaultImporters;var Interaction=function(_Module){_inherits(Interaction,_Module);var _super=_createSuper(Interaction);function Interaction(table){var _this;return _classCallCheck(this,Interaction),(_this=_super.call(this,table)).eventMap={rowClick:"row-click",rowDblClick:"row-dblclick",rowContext:"row-contextmenu",rowMouseEnter:"row-mouseenter",rowMouseLeave:"row-mouseleave",rowMouseOver:"row-mouseover",rowMouseOut:"row-mouseout",rowMouseMove:"row-mousemove",rowTap:"row",rowDblTap:"row",rowTapHold:"row",cellClick:"cell-click",cellDblClick:"cell-dblclick",cellContext:"cell-contextmenu",cellMouseEnter:"cell-mouseenter",cellMouseLeave:"cell-mouseleave",cellMouseOver:"cell-mouseover",cellMouseOut:"cell-mouseout",cellMouseMove:"cell-mousemove",cellTap:"cell",cellDblTap:"cell",cellTapHold:"cell",headerClick:"column-click",headerDblClick:"column-dblclick",headerContext:"column-contextmenu",headerMouseEnter:"column-mouseenter",headerMouseLeave:"column-mouseleave",headerMouseOver:"column-mouseover",headerMouseOut:"column-mouseout",headerMouseMove:"column-mousemove",headerTap:"column",headerDblTap:"column",headerTapHold:"column",groupClick:"group-click",groupDblClick:"group-dblclick",groupContext:"group-contextmenu",groupMouseEnter:"group-mouseenter",groupMouseLeave:"group-mouseleave",groupMouseOver:"group-mouseover",groupMouseOut:"group-mouseout",groupMouseMove:"group-mousemove",groupTap:"group",groupDblTap:"group",groupTapHold:"group"},_this.subscribers={},_this.touchSubscribers={},_this.columnSubscribers={},_this.touchWatchers={row:{tap:null,tapDbl:null,tapHold:null},cell:{tap:null,tapDbl:null,tapHold:null},column:{tap:null,tapDbl:null,tapHold:null},group:{tap:null,tapDbl:null,tapHold:null}},_this.registerColumnOption("headerClick"),_this.registerColumnOption("headerDblClick"),_this.registerColumnOption("headerContext"),_this.registerColumnOption("headerMouseEnter"),_this.registerColumnOption("headerMouseLeave"),_this.registerColumnOption("headerMouseOver"),_this.registerColumnOption("headerMouseOut"),_this.registerColumnOption("headerMouseMove"),_this.registerColumnOption("headerTap"),_this.registerColumnOption("headerDblTap"),_this.registerColumnOption("headerTapHold"),_this.registerColumnOption("cellClick"),_this.registerColumnOption("cellDblClick"),_this.registerColumnOption("cellContext"),_this.registerColumnOption("cellMouseEnter"),_this.registerColumnOption("cellMouseLeave"),_this.registerColumnOption("cellMouseOver"),_this.registerColumnOption("cellMouseOut"),_this.registerColumnOption("cellMouseMove"),_this.registerColumnOption("cellTap"),_this.registerColumnOption("cellDblTap"),_this.registerColumnOption("cellTapHold"),_this}return _createClass(Interaction,[{key:"initialize",value:function initialize(){this.initializeExternalEvents(),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("cell-dblclick",this.cellContentsSelectionFixer.bind(this))}},{key:"cellContentsSelectionFixer",value:function cellContentsSelectionFixer(e,cell){var range;if(!this.table.modExists("edit")||this.table.modules.edit.currentCell!==this){e.preventDefault();try{document.selection?((range=document.body.createTextRange()).moveToElementText(cell.getElement()),range.select()):window.getSelection&&((range=document.createRange()).selectNode(cell.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(range))}catch(e){}}}},{key:"initializeExternalEvents",value:function initializeExternalEvents(){for(var key in this.eventMap)this.subscriptionChangeExternal(key,this.subscriptionChanged.bind(this,key))}},{key:"subscriptionChanged",value:function subscriptionChanged(key,added){added?this.subscribers[key]||(this.eventMap[key].includes("-")?(this.subscribers[key]=this.handle.bind(this,key),this.subscribe(this.eventMap[key],this.subscribers[key])):this.subscribeTouchEvents(key)):this.eventMap[key].includes("-")?!this.subscribers[key]||this.columnSubscribers[key]||this.subscribedExternal(key)||(this.unsubscribe(this.eventMap[key],this.subscribers[key]),delete this.subscribers[key]):this.unsubscribeTouchEvents(key)}},{key:"subscribeTouchEvents",value:function subscribeTouchEvents(key){var type=this.eventMap[key];this.touchSubscribers[type+"-touchstart"]||(this.touchSubscribers[type+"-touchstart"]=this.handleTouch.bind(this,type,"start"),this.touchSubscribers[type+"-touchend"]=this.handleTouch.bind(this,type,"end"),this.subscribe(type+"-touchstart",this.touchSubscribers[type+"-touchstart"]),this.subscribe(type+"-touchend",this.touchSubscribers[type+"-touchend"])),this.subscribers[key]=!0}},{key:"unsubscribeTouchEvents",value:function unsubscribeTouchEvents(key){var noTouch=!0,type=this.eventMap[key];if(this.subscribers[key]&&!this.subscribedExternal(key)){for(var i in delete this.subscribers[key],this.eventMap)this.eventMap[i]===type&&this.subscribers[i]&&(noTouch=!1);noTouch&&(this.unsubscribe(type+"-touchstart",this.touchSubscribers[type+"-touchstart"]),this.unsubscribe(type+"-touchend",this.touchSubscribers[type+"-touchend"]),delete this.touchSubscribers[type+"-touchstart"],delete this.touchSubscribers[type+"-touchend"])}}},{key:"initializeColumn",value:function initializeColumn(column){var def=column.definition;for(var key in this.eventMap)def[key]&&(this.subscriptionChanged(key,!0),this.columnSubscribers[key]||(this.columnSubscribers[key]=[]),this.columnSubscribers[key].push(column))}},{key:"handle",value:function handle(action,e,component){this.dispatchEvent(action,e,component)}},{key:"handleTouch",value:function handleTouch(type,action,e,component){var _this2=this,watchers=this.touchWatchers[type];switch("column"===type&&(type="header"),action){case"start":watchers.tap=!0,clearTimeout(watchers.tapHold),watchers.tapHold=setTimeout((function(){clearTimeout(watchers.tapHold),watchers.tapHold=null,watchers.tap=null,clearTimeout(watchers.tapDbl),watchers.tapDbl=null,_this2.dispatchEvent(type+"TapHold",e,component)}),1e3);break;case"end":watchers.tap&&(watchers.tap=null,this.dispatchEvent(type+"Tap",e,component)),watchers.tapDbl?(clearTimeout(watchers.tapDbl),watchers.tapDbl=null,this.dispatchEvent(type+"DblTap",e,component)):watchers.tapDbl=setTimeout((function(){clearTimeout(watchers.tapDbl),watchers.tapDbl=null}),300),clearTimeout(watchers.tapHold),watchers.tapHold=null}}},{key:"dispatchEvent",value:function dispatchEvent(action,e,component){var componentObj=component.getComponent(),callback;this.columnSubscribers[action]&&(component instanceof Cell?callback=component.column.definition[action]:component instanceof Column&&(callback=component.definition[action]),callback&&callback(e,componentObj)),this.dispatchExternal(action,e,componentObj)}}]),Interaction}(Module);Interaction.moduleName="interaction";var defaultBindings={navPrev:"shift + 9",navNext:9,navUp:38,navDown:40,scrollPageUp:33,scrollPageDown:34,scrollToStart:36,scrollToEnd:35,undo:["ctrl + 90","meta + 90"],redo:["ctrl + 89","meta + 89"],copyToClipboard:["ctrl + 67","meta + 89"]},defaultActions={keyBlock:function keyBlock(e){e.stopPropagation(),e.preventDefault()},scrollPageUp:function scrollPageUp(e){var rowManager=this.table.rowManager,newPos=rowManager.scrollTop-rowManager.element.clientHeight;e.preventDefault(),rowManager.displayRowsCount&&(newPos>=0?rowManager.element.scrollTop=newPos:rowManager.scrollToRow(rowManager.getDisplayRows()[0])),this.table.element.focus()},scrollPageDown:function scrollPageDown(e){var rowManager=this.table.rowManager,newPos=rowManager.scrollTop+rowManager.element.clientHeight,scrollMax=rowManager.element.scrollHeight;e.preventDefault(),rowManager.displayRowsCount&&(newPos<=scrollMax?rowManager.element.scrollTop=newPos:rowManager.scrollToRow(rowManager.getDisplayRows()[rowManager.displayRowsCount-1])),this.table.element.focus()},scrollToStart:function scrollToStart(e){var rowManager=this.table.rowManager;e.preventDefault(),rowManager.displayRowsCount&&rowManager.scrollToRow(rowManager.getDisplayRows()[0]),this.table.element.focus()},scrollToEnd:function scrollToEnd(e){var rowManager=this.table.rowManager;e.preventDefault(),rowManager.displayRowsCount&&rowManager.scrollToRow(rowManager.getDisplayRows()[rowManager.displayRowsCount-1]),this.table.element.focus()},navPrev:function navPrev(e){this.dispatch("keybinding-nav-prev",e)},navNext:function navNext(e){this.dispatch("keybinding-nav-next",e)},navLeft:function navLeft(e){this.dispatch("keybinding-nav-left",e)},navRight:function navRight(e){this.dispatch("keybinding-nav-right",e)},navUp:function navUp(e){this.dispatch("keybinding-nav-up",e)},navDown:function navDown(e){this.dispatch("keybinding-nav-down",e)},undo:function undo(e){var cell=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&((cell=this.table.modules.edit.currentCell)||(e.preventDefault(),this.table.modules.history.undo()))},redo:function redo(e){var cell=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&((cell=this.table.modules.edit.currentCell)||(e.preventDefault(),this.table.modules.history.redo()))},copyToClipboard:function copyToClipboard(e){this.table.modules.edit.currentCell||this.table.modExists("clipboard",!0)&&this.table.modules.clipboard.copy(!1,!0)}},Keybindings=function(_Module){_inherits(Keybindings,_Module);var _super=_createSuper(Keybindings);function Keybindings(table){var _this;return _classCallCheck(this,Keybindings),(_this=_super.call(this,table)).watchKeys=null,_this.pressedKeys=null,_this.keyupBinding=!1,_this.keydownBinding=!1,_this.registerTableOption("keybindings",{}),_this.registerTableOption("tabEndNewRow",!1),_this}return _createClass(Keybindings,[{key:"initialize",value:function initialize(){var bindings=this.table.options.keybindings,mergedBindings={};this.watchKeys={},this.pressedKeys=[],!1!==bindings&&(Object.assign(mergedBindings,Keybindings.bindings),Object.assign(mergedBindings,bindings),this.mapBindings(mergedBindings),this.bindEvents()),this.subscribe("table-destroy",this.clearBindings.bind(this))}},{key:"mapBindings",value:function mapBindings(bindings){var _this2=this,_loop=function _loop(key){Keybindings.actions[key]?bindings[key]&&("object"!==_typeof(bindings[key])&&(bindings[key]=[bindings[key]]),bindings[key].forEach((function(binding){var bindingList;(Array.isArray(binding)?binding:[binding]).forEach((function(item){_this2.mapBinding(key,item)}))}))):console.warn("Key Binding Error - no such action:",key)};for(var key in bindings)_loop(key)}},{key:"mapBinding",value:function mapBinding(action,symbolsList){var _this3=this,binding={action:Keybindings.actions[action],keys:[],ctrl:!1,shift:!1,meta:!1},symbols;symbolsList.toString().toLowerCase().split(" ").join("").split("+").forEach((function(symbol){switch(symbol){case"ctrl":binding.ctrl=!0;break;case"shift":binding.shift=!0;break;case"meta":binding.meta=!0;break;default:symbol=isNaN(symbol)?symbol.toUpperCase().charCodeAt(0):parseInt(symbol),binding.keys.push(symbol),_this3.watchKeys[symbol]||(_this3.watchKeys[symbol]=[]),_this3.watchKeys[symbol].push(binding)}}))}},{key:"bindEvents",value:function bindEvents(){var self=this;this.keyupBinding=function(e){var code=e.keyCode,bindings=self.watchKeys[code];bindings&&(self.pressedKeys.push(code),bindings.forEach((function(binding){self.checkBinding(e,binding)})))},this.keydownBinding=function(e){var code=e.keyCode,bindings;if(self.watchKeys[code]){var index=self.pressedKeys.indexOf(code);index>-1&&self.pressedKeys.splice(index,1)}},this.table.element.addEventListener("keydown",this.keyupBinding),this.table.element.addEventListener("keyup",this.keydownBinding)}},{key:"clearBindings",value:function clearBindings(){this.keyupBinding&&this.table.element.removeEventListener("keydown",this.keyupBinding),this.keydownBinding&&this.table.element.removeEventListener("keyup",this.keydownBinding)}},{key:"checkBinding",value:function checkBinding(e,binding){var _this4=this,match=!0;return e.ctrlKey==binding.ctrl&&e.shiftKey==binding.shift&&e.metaKey==binding.meta&&(binding.keys.forEach((function(key){var index;-1==_this4.pressedKeys.indexOf(key)&&(match=!1)})),match&&binding.action.call(this,e),!0)}}]),Keybindings}(Module);Keybindings.moduleName="keybindings",Keybindings.bindings=defaultBindings,Keybindings.actions=defaultActions;var Menu=function(_Module){_inherits(Menu,_Module);var _super=_createSuper(Menu);function Menu(table){var _this;return _classCallCheck(this,Menu),(_this=_super.call(this,table)).menuContainer=null,_this.nestedMenuBlock=!1,_this.currentComponent=null,_this.rootPopup=null,_this.columnSubscribers={},_this.registerTableOption("menuContainer",void 0),_this.registerTableOption("rowContextMenu",!1),_this.registerTableOption("rowClickMenu",!1),_this.registerTableOption("groupContextMenu",!1),_this.registerTableOption("groupClickMenu",!1),_this.registerColumnOption("headerContextMenu"),_this.registerColumnOption("headerClickMenu"),_this.registerColumnOption("headerMenu"),_this.registerColumnOption("headerMenuIcon"),_this.registerColumnOption("contextMenu"),_this.registerColumnOption("clickMenu"),_this}return _createClass(Menu,[{key:"initialize",value:function initialize(){this.deprecatedOptionsCheck(),this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}},{key:"deprecatedOptionsCheck",value:function deprecatedOptionsCheck(){this.deprecationCheck("menuContainer","popupContainer")||(this.table.options.popupContainer=this.table.options.menuContainer)}},{key:"initializeRowWatchers",value:function initializeRowWatchers(){this.table.options.rowContextMenu&&(this.subscribe("row-contextmenu",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu)),this.table.on("rowTapHold",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu))),this.table.options.rowClickMenu&&this.subscribe("row-click",this.loadMenuEvent.bind(this,this.table.options.rowClickMenu))}},{key:"initializeGroupWatchers",value:function initializeGroupWatchers(){this.table.options.groupContextMenu&&(this.subscribe("group-contextmenu",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu)),this.table.on("groupTapHold",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu))),this.table.options.groupClickMenu&&this.subscribe("group-click",this.loadMenuEvent.bind(this,this.table.options.groupClickMenu))}},{key:"initializeColumn",value:function initializeColumn(column){var def=column.definition;def.headerContextMenu&&!this.columnSubscribers.headerContextMenu&&(this.columnSubscribers.headerContextMenu=this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextMenu),this.table.on("headerTapHold",this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"))),def.headerClickMenu&&!this.columnSubscribers.headerClickMenu&&(this.columnSubscribers.headerClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerClickMenu"),this.subscribe("column-click",this.columnSubscribers.headerClickMenu)),def.headerMenu&&this.initializeColumnHeaderMenu(column),def.contextMenu&&!this.columnSubscribers.contextMenu&&(this.columnSubscribers.contextMenu=this.loadMenuTableCellEvent.bind(this,"contextMenu"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextMenu),this.table.on("cellTapHold",this.loadMenuTableCellEvent.bind(this,"contextMenu"))),def.clickMenu&&!this.columnSubscribers.clickMenu&&(this.columnSubscribers.clickMenu=this.loadMenuTableCellEvent.bind(this,"clickMenu"),this.subscribe("cell-click",this.columnSubscribers.clickMenu))}},{key:"initializeColumnHeaderMenu",value:function initializeColumnHeaderMenu(column){var _this2=this,icon=column.definition.headerMenuIcon,headerMenuEl;(headerMenuEl=document.createElement("span")).classList.add("tabulator-header-popup-button"),icon?("function"==typeof icon&&(icon=icon(column.getComponent())),icon instanceof HTMLElement?headerMenuEl.appendChild(icon):headerMenuEl.innerHTML=icon):headerMenuEl.innerHTML="&vellip;",headerMenuEl.addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault(),_this2.loadMenuEvent(column.definition.headerMenu,e,column)})),column.titleElement.insertBefore(headerMenuEl,column.titleElement.firstChild)}},{key:"loadMenuTableCellEvent",value:function loadMenuTableCellEvent(option,e,cell){cell._cell&&(cell=cell._cell),cell.column.definition[option]&&this.loadMenuEvent(cell.column.definition[option],e,cell)}},{key:"loadMenuTableColumnEvent",value:function loadMenuTableColumnEvent(option,e,column){column._column&&(column=column._column),column.definition[option]&&this.loadMenuEvent(column.definition[option],e,column)}},{key:"loadMenuEvent",value:function loadMenuEvent(menu,e,component){component._group?component=component._group:component._row&&(component=component._row),menu="function"==typeof menu?menu.call(this.table,e,component.getComponent()):menu,this.loadMenu(e,component,menu)}},{key:"loadMenu",value:function loadMenu(e,component,menu,parentEl,parentPopup){var _this3=this,touch=!(e instanceof MouseEvent),menuEl=document.createElement("div"),popup;if(menuEl.classList.add("tabulator-menu"),touch||e.preventDefault(),menu&&menu.length){if(parentEl)popup=parentPopup.child(menuEl);else{if(this.nestedMenuBlock){if(this.rootPopup)return}else this.nestedMenuBlock=setTimeout((function(){_this3.nestedMenuBlock=!1}),100);this.rootPopup&&this.rootPopup.hide(),this.rootPopup=popup=this.popup(menuEl)}menu.forEach((function(item){var itemEl=document.createElement("div"),label=item.label,disabled=item.disabled;item.separator?itemEl.classList.add("tabulator-menu-separator"):(itemEl.classList.add("tabulator-menu-item"),"function"==typeof label&&(label=label.call(_this3.table,component.getComponent())),label instanceof Node?itemEl.appendChild(label):itemEl.innerHTML=label,"function"==typeof disabled&&(disabled=disabled.call(_this3.table,component.getComponent())),disabled?(itemEl.classList.add("tabulator-menu-item-disabled"),itemEl.addEventListener("click",(function(e){e.stopPropagation()}))):item.menu&&item.menu.length?itemEl.addEventListener("click",(function(e){e.stopPropagation(),_this3.loadMenu(e,component,item.menu,itemEl,popup)})):item.action&&itemEl.addEventListener("click",(function(e){item.action(e,component.getComponent())})),item.menu&&item.menu.length&&itemEl.classList.add("tabulator-menu-item-submenu")),menuEl.appendChild(itemEl)})),menuEl.addEventListener("click",(function(e){_this3.rootPopup.hide()})),popup.show(parentEl||e),popup===this.rootPopup&&(this.rootPopup.hideOnBlur((function(){_this3.rootPopup=null,_this3.currentComponent&&(_this3.dispatchExternal("menuClosed",_this3.currentComponent.getComponent()),_this3.currentComponent=null)})),this.currentComponent=component,this.dispatchExternal("menuOpened",component.getComponent()))}}}]),Menu}(Module);Menu.moduleName="menu";var MoveColumns=function(_Module){_inherits(MoveColumns,_Module);var _super=_createSuper(MoveColumns);function MoveColumns(table){var _this;return _classCallCheck(this,MoveColumns),(_this=_super.call(this,table)).placeholderElement=_this.createPlaceholderElement(),_this.hoverElement=!1,_this.checkTimeout=!1,_this.checkPeriod=250,_this.moving=!1,_this.toCol=!1,_this.toColAfter=!1,_this.startX=0,_this.autoScrollMargin=40,_this.autoScrollStep=5,_this.autoScrollTimeout=!1,_this.touchMove=!1,_this.moveHover=_this.moveHover.bind(_assertThisInitialized(_this)),_this.endMove=_this.endMove.bind(_assertThisInitialized(_this)),_this.registerTableOption("movableColumns",!1),_this}return _createClass(MoveColumns,[{key:"createPlaceholderElement",value:function createPlaceholderElement(){var el=document.createElement("div");return el.classList.add("tabulator-col"),el.classList.add("tabulator-col-placeholder"),el}},{key:"initialize",value:function initialize(){this.table.options.movableColumns&&this.subscribe("column-init",this.initializeColumn.bind(this))}},{key:"initializeColumn",value:function initializeColumn(column){var self=this,config={},colEl;column.modules.frozen||column.isGroup||(colEl=column.getElement(),config.mousemove=function(e){column.parent===self.moving.parent&&((self.touchMove?e.touches[0].pageX:e.pageX)-Helpers.elOffset(colEl).left+self.table.columnManager.element.scrollLeft>column.getWidth()/2?self.toCol===column&&self.toColAfter||(colEl.parentNode.insertBefore(self.placeholderElement,colEl.nextSibling),self.moveColumn(column,!0)):(self.toCol!==column||self.toColAfter)&&(colEl.parentNode.insertBefore(self.placeholderElement,colEl),self.moveColumn(column,!1)))}.bind(self),colEl.addEventListener("mousedown",(function(e){self.touchMove=!1,1===e.which&&(self.checkTimeout=setTimeout((function(){self.startMove(e,column)}),self.checkPeriod))})),colEl.addEventListener("mouseup",(function(e){1===e.which&&self.checkTimeout&&clearTimeout(self.checkTimeout)})),self.bindTouchEvents(column)),column.modules.moveColumn=config}},{key:"bindTouchEvents",value:function bindTouchEvents(column){var _this2=this,colEl=column.getElement(),startXMove=!1,nextCol,prevCol,nextColWidth,prevColWidth,nextColWidthLast,prevColWidthLast;colEl.addEventListener("touchstart",(function(e){_this2.checkTimeout=setTimeout((function(){_this2.touchMove=!0,nextCol=column.nextColumn(),nextColWidth=nextCol?nextCol.getWidth()/2:0,prevCol=column.prevColumn(),prevColWidth=prevCol?prevCol.getWidth()/2:0,nextColWidthLast=0,prevColWidthLast=0,startXMove=!1,_this2.startMove(e,column)}),_this2.checkPeriod)}),{passive:!0}),colEl.addEventListener("touchmove",(function(e){var diff,moveToCol;_this2.moving&&(_this2.moveHover(e),startXMove||(startXMove=e.touches[0].pageX),(diff=e.touches[0].pageX-startXMove)>0?nextCol&&diff-nextColWidthLast>nextColWidth&&(moveToCol=nextCol)!==column&&(startXMove=e.touches[0].pageX,moveToCol.getElement().parentNode.insertBefore(_this2.placeholderElement,moveToCol.getElement().nextSibling),_this2.moveColumn(moveToCol,!0)):prevCol&&-diff-prevColWidthLast>prevColWidth&&(moveToCol=prevCol)!==column&&(startXMove=e.touches[0].pageX,moveToCol.getElement().parentNode.insertBefore(_this2.placeholderElement,moveToCol.getElement()),_this2.moveColumn(moveToCol,!1)),moveToCol&&(nextCol=moveToCol.nextColumn(),nextColWidthLast=nextColWidth,nextColWidth=nextCol?nextCol.getWidth()/2:0,prevCol=moveToCol.prevColumn(),prevColWidthLast=prevColWidth,prevColWidth=prevCol?prevCol.getWidth()/2:0))}),{passive:!0}),colEl.addEventListener("touchend",(function(e){_this2.checkTimeout&&clearTimeout(_this2.checkTimeout),_this2.moving&&_this2.endMove(e)}))}},{key:"startMove",value:function startMove(e,column){var element=column.getElement(),headerElement=this.table.columnManager.getElement(),headersElement=this.table.columnManager.getHeadersElement();this.moving=column,this.startX=(this.touchMove?e.touches[0].pageX:e.pageX)-Helpers.elOffset(element).left,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=column.getWidth()+"px",this.placeholderElement.style.height=column.getHeight()+"px",element.parentNode.insertBefore(this.placeholderElement,element),element.parentNode.removeChild(element),this.hoverElement=element.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),this.table.columnManager.getElement().appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.bottom=headerElement.clientHeight-headersElement.offsetHeight+"px",this.touchMove||(this._bindMouseMove(),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove)),this.moveHover(e)}},{key:"_bindMouseMove",value:function _bindMouseMove(){this.table.columnManager.columnsByIndex.forEach((function(column){column.modules.moveColumn.mousemove&&column.getElement().addEventListener("mousemove",column.modules.moveColumn.mousemove)}))}},{key:"_unbindMouseMove",value:function _unbindMouseMove(){this.table.columnManager.columnsByIndex.forEach((function(column){column.modules.moveColumn.mousemove&&column.getElement().removeEventListener("mousemove",column.modules.moveColumn.mousemove)}))}},{key:"moveColumn",value:function moveColumn(column,after){var movingCells=this.moving.getCells();this.toCol=column,this.toColAfter=after,after?column.getCells().forEach((function(cell,i){var cellEl=cell.getElement(!0);cellEl.parentNode&&movingCells[i]&&cellEl.parentNode.insertBefore(movingCells[i].getElement(),cellEl.nextSibling)})):column.getCells().forEach((function(cell,i){var cellEl=cell.getElement(!0);cellEl.parentNode&&movingCells[i]&&cellEl.parentNode.insertBefore(movingCells[i].getElement(),cellEl)}))}},{key:"endMove",value:function endMove(e){(1===e.which||this.touchMove)&&(this._unbindMouseMove(),this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toCol&&this.table.columnManager.moveColumnActual(this.moving,this.toCol,this.toColAfter),this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.touchMove||(document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove)))}},{key:"moveHover",value:function moveHover(e){var _this3=this,columnHolder=this.table.columnManager.getElement(),scrollLeft=columnHolder.scrollLeft,xPos=(this.touchMove?e.touches[0].pageX:e.pageX)-Helpers.elOffset(columnHolder).left+scrollLeft,scrollPos;this.hoverElement.style.left=xPos-this.startX+"px",xPos-scrollLeft<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout((function(){scrollPos=Math.max(0,scrollLeft-5),_this3.table.rowManager.getElement().scrollLeft=scrollPos,_this3.autoScrollTimeout=!1}),1))),scrollLeft+columnHolder.clientWidth-xPos<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout((function(){scrollPos=Math.min(columnHolder.clientWidth,scrollLeft+5),_this3.table.rowManager.getElement().scrollLeft=scrollPos,_this3.autoScrollTimeout=!1}),1)))}}]),MoveColumns}(Module);MoveColumns.moduleName="moveColumn";var MoveRows=function(_Module){_inherits(MoveRows,_Module);var _super=_createSuper(MoveRows);function MoveRows(table){var _this;return _classCallCheck(this,MoveRows),(_this=_super.call(this,table)).placeholderElement=_this.createPlaceholderElement(),_this.hoverElement=!1,_this.checkTimeout=!1,_this.checkPeriod=150,_this.moving=!1,_this.toRow=!1,_this.toRowAfter=!1,_this.hasHandle=!1,_this.startY=0,_this.startX=0,_this.moveHover=_this.moveHover.bind(_assertThisInitialized(_this)),_this.endMove=_this.endMove.bind(_assertThisInitialized(_this)),_this.tableRowDropEvent=!1,_this.touchMove=!1,_this.connection=!1,_this.connectionSelectorsTables=!1,_this.connectionSelectorsElements=!1,_this.connectionElements=[],_this.connections=[],_this.connectedTable=!1,_this.connectedRow=!1,_this.registerTableOption("movableRows",!1),_this.registerTableOption("movableRowsConnectedTables",!1),_this.registerTableOption("movableRowsConnectedElements",!1),_this.registerTableOption("movableRowsSender",!1),_this.registerTableOption("movableRowsReceiver","insert"),_this.registerColumnOption("rowHandle"),_this}return _createClass(MoveRows,[{key:"createPlaceholderElement",value:function createPlaceholderElement(){var el=document.createElement("div");return el.classList.add("tabulator-row"),el.classList.add("tabulator-row-placeholder"),el}},{key:"initialize",value:function initialize(){this.table.options.movableRows&&(this.connectionSelectorsTables=this.table.options.movableRowsConnectedTables,this.connectionSelectorsElements=this.table.options.movableRowsConnectedElements,this.connection=this.connectionSelectorsTables||this.connectionSelectorsElements,this.subscribe("cell-init",this.initializeCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)))}},{key:"initializeGroupHeader",value:function initializeGroupHeader(group){var self=this,config={};config.mouseup=function(e){self.tableRowDrop(e,group)}.bind(self),config.mousemove=function(e){var rowEl;e.pageY-Helpers.elOffset(group.element).top+self.table.rowManager.element.scrollTop>group.getHeight()/2?self.toRow===group&&self.toRowAfter||((rowEl=group.getElement()).parentNode.insertBefore(self.placeholderElement,rowEl.nextSibling),self.moveRow(group,!0)):(self.toRow!==group||self.toRowAfter)&&(rowEl=group.getElement()).previousSibling&&(rowEl.parentNode.insertBefore(self.placeholderElement,rowEl),self.moveRow(group,!1))}.bind(self),group.modules.moveRow=config}},{key:"initializeRow",value:function initializeRow(row){var self=this,config={},rowEl;config.mouseup=function(e){self.tableRowDrop(e,row)}.bind(self),config.mousemove=function(e){var rowEl=row.getElement();e.pageY-Helpers.elOffset(rowEl).top+self.table.rowManager.element.scrollTop>row.getHeight()/2?self.toRow===row&&self.toRowAfter||(rowEl.parentNode.insertBefore(self.placeholderElement,rowEl.nextSibling),self.moveRow(row,!0)):(self.toRow!==row||self.toRowAfter)&&(rowEl.parentNode.insertBefore(self.placeholderElement,rowEl),self.moveRow(row,!1))}.bind(self),this.hasHandle||((rowEl=row.getElement()).addEventListener("mousedown",(function(e){1===e.which&&(self.checkTimeout=setTimeout((function(){self.startMove(e,row)}),self.checkPeriod))})),rowEl.addEventListener("mouseup",(function(e){1===e.which&&self.checkTimeout&&clearTimeout(self.checkTimeout)})),this.bindTouchEvents(row,row.getElement())),row.modules.moveRow=config}},{key:"initializeColumn",value:function initializeColumn(column){column.definition.rowHandle&&!1!==this.table.options.movableRows&&(this.hasHandle=!0)}},{key:"initializeCell",value:function initializeCell(cell){if(cell.column.definition.rowHandle&&!1!==this.table.options.movableRows){var self=this,cellEl=cell.getElement(!0);cellEl.addEventListener("mousedown",(function(e){1===e.which&&(self.checkTimeout=setTimeout((function(){self.startMove(e,cell.row)}),self.checkPeriod))})),cellEl.addEventListener("mouseup",(function(e){1===e.which&&self.checkTimeout&&clearTimeout(self.checkTimeout)})),this.bindTouchEvents(cell.row,cellEl)}}},{key:"bindTouchEvents",value:function bindTouchEvents(row,element){var _this2=this,startYMove=!1,nextRow,prevRow,nextRowHeight,prevRowHeight,nextRowHeightLast,prevRowHeightLast;element.addEventListener("touchstart",(function(e){_this2.checkTimeout=setTimeout((function(){_this2.touchMove=!0,nextRow=row.nextRow(),nextRowHeight=nextRow?nextRow.getHeight()/2:0,prevRow=row.prevRow(),prevRowHeight=prevRow?prevRow.getHeight()/2:0,nextRowHeightLast=0,prevRowHeightLast=0,startYMove=!1,_this2.startMove(e,row)}),_this2.checkPeriod)}),{passive:!0}),this.moving,this.toRow,this.toRowAfter,element.addEventListener("touchmove",(function(e){var diff,moveToRow;_this2.moving&&(e.preventDefault(),_this2.moveHover(e),startYMove||(startYMove=e.touches[0].pageY),(diff=e.touches[0].pageY-startYMove)>0?nextRow&&diff-nextRowHeightLast>nextRowHeight&&(moveToRow=nextRow)!==row&&(startYMove=e.touches[0].pageY,moveToRow.getElement().parentNode.insertBefore(_this2.placeholderElement,moveToRow.getElement().nextSibling),_this2.moveRow(moveToRow,!0)):prevRow&&-diff-prevRowHeightLast>prevRowHeight&&(moveToRow=prevRow)!==row&&(startYMove=e.touches[0].pageY,moveToRow.getElement().parentNode.insertBefore(_this2.placeholderElement,moveToRow.getElement()),_this2.moveRow(moveToRow,!1)),moveToRow&&(nextRow=moveToRow.nextRow(),nextRowHeightLast=nextRowHeight,nextRowHeight=nextRow?nextRow.getHeight()/2:0,prevRow=moveToRow.prevRow(),prevRowHeightLast=prevRowHeight,prevRowHeight=prevRow?prevRow.getHeight()/2:0))})),element.addEventListener("touchend",(function(e){_this2.checkTimeout&&clearTimeout(_this2.checkTimeout),_this2.moving&&(_this2.endMove(e),_this2.touchMove=!1)}))}},{key:"_bindMouseMove",value:function _bindMouseMove(){this.table.rowManager.getDisplayRows().forEach((function(row){("row"===row.type||"group"===row.type)&&row.modules.moveRow&&row.modules.moveRow.mousemove&&row.getElement().addEventListener("mousemove",row.modules.moveRow.mousemove)}))}},{key:"_unbindMouseMove",value:function _unbindMouseMove(){this.table.rowManager.getDisplayRows().forEach((function(row){("row"===row.type||"group"===row.type)&&row.modules.moveRow&&row.modules.moveRow.mousemove&&row.getElement().removeEventListener("mousemove",row.modules.moveRow.mousemove)}))}},{key:"startMove",value:function startMove(e,row){var element=row.getElement();this.setStartPosition(e,row),this.moving=row,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=row.getWidth()+"px",this.placeholderElement.style.height=row.getHeight()+"px",this.connection?(this.table.element.classList.add("tabulator-movingrow-sending"),this.connectToTables(row)):(element.parentNode.insertBefore(this.placeholderElement,element),element.parentNode.removeChild(element)),this.hoverElement=element.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),this.connection?(document.body.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this.hoverElement.style.width=this.table.element.clientWidth+"px",this.hoverElement.style.whiteSpace="nowrap",this.hoverElement.style.overflow="hidden",this.hoverElement.style.pointerEvents="none"):(this.table.rowManager.getTableElement().appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this._bindMouseMove()),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove),this.dispatchExternal("rowMoving",row.getComponent()),this.moveHover(e)}},{key:"setStartPosition",value:function setStartPosition(e,row){var pageX=this.touchMove?e.touches[0].pageX:e.pageX,pageY=this.touchMove?e.touches[0].pageY:e.pageY,element,position;element=row.getElement(),this.connection?(position=element.getBoundingClientRect(),this.startX=position.left-pageX+window.pageXOffset,this.startY=position.top-pageY+window.pageYOffset):this.startY=pageY-element.getBoundingClientRect().top}},{key:"endMove",value:function endMove(e){e&&1!==e.which&&!this.touchMove||(this._unbindMouseMove(),this.connection||(this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement)),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toRow?this.table.rowManager.moveRow(this.moving,this.toRow,this.toRowAfter):this.dispatchExternal("rowMoveCancelled",this.moving.getComponent()),this.moving=!1,this.toRow=!1,this.toRowAfter=!1,document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove),this.connection&&(this.table.element.classList.remove("tabulator-movingrow-sending"),this.disconnectFromTables()))}},{key:"moveRow",value:function moveRow(row,after){this.toRow=row,this.toRowAfter=after}},{key:"moveHover",value:function moveHover(e){this.connection?this.moveHoverConnections.call(this,e):this.moveHoverTable.call(this,e)}},{key:"moveHoverTable",value:function moveHoverTable(e){var rowHolder=this.table.rowManager.getElement(),scrollTop=rowHolder.scrollTop,yPos=(this.touchMove?e.touches[0].pageY:e.pageY)-rowHolder.getBoundingClientRect().top+scrollTop;this.hoverElement.style.top=Math.min(yPos-this.startY,this.table.rowManager.element.scrollHeight-this.hoverElement.offsetHeight)+"px"}},{key:"moveHoverConnections",value:function moveHoverConnections(e){this.hoverElement.style.left=this.startX+(this.touchMove?e.touches[0].pageX:e.pageX)+"px",this.hoverElement.style.top=this.startY+(this.touchMove?e.touches[0].pageY:e.pageY)+"px"}},{key:"elementRowDrop",value:function elementRowDrop(e,element,row){this.dispatchExternal("movableRowsElementDrop",e,element,!!row&&row.getComponent())}},{key:"connectToTables",value:function connectToTables(row){var _this3=this,connectionTables;this.connectionSelectorsTables&&(connectionTables=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStart",connectionTables),this.commsSend(this.connectionSelectorsTables,"moveRow","connect",{row:row})),this.connectionSelectorsElements&&(this.connectionElements=[],Array.isArray(this.connectionSelectorsElements)||(this.connectionSelectorsElements=[this.connectionSelectorsElements]),this.connectionSelectorsElements.forEach((function(query){"string"==typeof query?_this3.connectionElements=_this3.connectionElements.concat(Array.prototype.slice.call(document.querySelectorAll(query))):_this3.connectionElements.push(query)})),this.connectionElements.forEach((function(element){var dropEvent=function dropEvent(e){_this3.elementRowDrop(e,element,_this3.moving)};element.addEventListener("mouseup",dropEvent),element.tabulatorElementDropEvent=dropEvent,element.classList.add("tabulator-movingrow-receiving")})))}},{key:"disconnectFromTables",value:function disconnectFromTables(){var connectionTables;this.connectionSelectorsTables&&(connectionTables=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStop",connectionTables),this.commsSend(this.connectionSelectorsTables,"moveRow","disconnect")),this.connectionElements.forEach((function(element){element.classList.remove("tabulator-movingrow-receiving"),element.removeEventListener("mouseup",element.tabulatorElementDropEvent),delete element.tabulatorElementDropEvent}))}},{key:"connect",value:function connect(table,row){return this.connectedTable?(console.warn("Move Row Error - Table cannot accept connection, already connected to table:",this.connectedTable),!1):(this.connectedTable=table,this.connectedRow=row,this.table.element.classList.add("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach((function(row){"row"===row.type&&row.modules.moveRow&&row.modules.moveRow.mouseup&&row.getElement().addEventListener("mouseup",row.modules.moveRow.mouseup)})),this.tableRowDropEvent=this.tableRowDrop.bind(this),this.table.element.addEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStart",row,table),!0)}},{key:"disconnect",value:function disconnect(table){table===this.connectedTable?(this.connectedTable=!1,this.connectedRow=!1,this.table.element.classList.remove("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach((function(row){"row"===row.type&&row.modules.moveRow&&row.modules.moveRow.mouseup&&row.getElement().removeEventListener("mouseup",row.modules.moveRow.mouseup)})),this.table.element.removeEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStop",table)):console.warn("Move Row Error - trying to disconnect from non connected table")}},{key:"dropComplete",value:function dropComplete(table,row,success){var sender=!1;if(success){switch(_typeof(this.table.options.movableRowsSender)){case"string":sender=this.senders[this.table.options.movableRowsSender];break;case"function":sender=this.table.options.movableRowsSender}sender?sender.call(this,this.moving?this.moving.getComponent():void 0,row?row.getComponent():void 0,table):this.table.options.movableRowsSender&&console.warn("Mover Row Error - no matching sender found:",this.table.options.movableRowsSender),this.dispatchExternal("movableRowsSent",this.moving.getComponent(),row?row.getComponent():void 0,table)}else this.dispatchExternal("movableRowsSentFailed",this.moving.getComponent(),row?row.getComponent():void 0,table);this.endMove()}},{key:"tableRowDrop",value:function tableRowDrop(e,row){var receiver=!1,success=!1;switch(e.stopImmediatePropagation(),_typeof(this.table.options.movableRowsReceiver)){case"string":receiver=this.receivers[this.table.options.movableRowsReceiver];break;case"function":receiver=this.table.options.movableRowsReceiver}receiver?success=receiver.call(this,this.connectedRow.getComponent(),row?row.getComponent():void 0,this.connectedTable):console.warn("Mover Row Error - no matching receiver found:",this.table.options.movableRowsReceiver),success?this.dispatchExternal("movableRowsReceived",this.connectedRow.getComponent(),row?row.getComponent():void 0,this.connectedTable):this.dispatchExternal("movableRowsReceivedFailed",this.connectedRow.getComponent(),row?row.getComponent():void 0,this.connectedTable),this.commsSend(this.connectedTable,"moveRow","dropcomplete",{row:row,success:success})}},{key:"commsReceived",value:function commsReceived(table,action,data){switch(action){case"connect":return this.connect(table,data.row);case"disconnect":return this.disconnect(table);case"dropcomplete":return this.dropComplete(table,data.row,data.success)}}}]),MoveRows}(Module);MoveRows.prototype.receivers={insert:function insert(fromRow,toRow,fromTable){return this.table.addRow(fromRow.getData(),void 0,toRow),!0},add:function add(fromRow,toRow,fromTable){return this.table.addRow(fromRow.getData()),!0},update:function update(fromRow,toRow,fromTable){return!!toRow&&(toRow.update(fromRow.getData()),!0)},replace:function replace(fromRow,toRow,fromTable){return!!toRow&&(this.table.addRow(fromRow.getData(),void 0,toRow),toRow.delete(),!0)}},MoveRows.prototype.senders={delete:function _delete(fromRow,toRow,toTable){fromRow.delete()}},MoveRows.moduleName="moveRow";var defaultMutators={},Mutator=function(_Module){_inherits(Mutator,_Module);var _super=_createSuper(Mutator);function Mutator(table){var _this;return _classCallCheck(this,Mutator),(_this=_super.call(this,table)).allowedTypes=["","data","edit","clipboard"],_this.enabled=!0,_this.registerColumnOption("mutator"),_this.registerColumnOption("mutatorParams"),_this.registerColumnOption("mutatorData"),_this.registerColumnOption("mutatorDataParams"),_this.registerColumnOption("mutatorEdit"),_this.registerColumnOption("mutatorEditParams"),_this.registerColumnOption("mutatorClipboard"),_this.registerColumnOption("mutatorClipboardParams"),_this.registerColumnOption("mutateLink"),_this}return _createClass(Mutator,[{key:"initialize",value:function initialize(){this.subscribe("cell-value-changing",this.transformCell.bind(this)),this.subscribe("cell-value-changed",this.mutateLink.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-init-before",this.rowDataChanged.bind(this)),this.subscribe("row-data-changing",this.rowDataChanged.bind(this))}},{key:"rowDataChanged",value:function rowDataChanged(row,tempData,updatedData){return this.transformRow(tempData,"data",updatedData)}},{key:"initializeColumn",value:function initializeColumn(column){var _this2=this,match=!1,config={};this.allowedTypes.forEach((function(type){var key="mutator"+(type.charAt(0).toUpperCase()+type.slice(1)),mutator;column.definition[key]&&(mutator=_this2.lookupMutator(column.definition[key]))&&(match=!0,config[key]={mutator:mutator,params:column.definition[key+"Params"]||{}})})),match&&(column.modules.mutate=config)}},{key:"lookupMutator",value:function lookupMutator(value){var mutator=!1;switch(_typeof(value)){case"string":Mutator.mutators[value]?mutator=Mutator.mutators[value]:console.warn("Mutator Error - No such mutator found, ignoring: ",value);break;case"function":mutator=value}return mutator}},{key:"transformRow",value:function transformRow(data,type,updatedData){var key="mutator"+(type.charAt(0).toUpperCase()+type.slice(1)),value;return this.enabled&&this.table.columnManager.traverse((function(column){var mutator,params,component;column.modules.mutate&&(mutator=column.modules.mutate[key]||column.modules.mutate.mutator||!1)&&(value=column.getFieldValue(void 0!==updatedData?updatedData:data),"data"!=type&&void 0===value||(component=column.getComponent(),params="function"==typeof mutator.params?mutator.params(value,data,type,component):mutator.params,column.setFieldValue(data,mutator.mutator(value,data,type,params,component))))})),data}},{key:"transformCell",value:function transformCell(cell,value){if(cell.column.modules.mutate){var mutator=cell.column.modules.mutate.mutatorEdit||cell.column.modules.mutate.mutator||!1,tempData={};if(mutator)return tempData=Object.assign(tempData,cell.row.getData()),cell.column.setFieldValue(tempData,value),mutator.mutator(value,tempData,"edit",mutator.params,cell.getComponent())}return value}},{key:"mutateLink",value:function mutateLink(cell){var links=cell.column.definition.mutateLink;links&&(Array.isArray(links)||(links=[links]),links.forEach((function(link){var linkCell=cell.row.getCell(link);linkCell&&linkCell.setValue(linkCell.getValue(),!0,!0)})))}},{key:"enable",value:function enable(){this.enabled=!0}},{key:"disable",value:function disable(){this.enabled=!1}}]),Mutator}(Module);function rows(pageSize,currentRow,currentPage,totalRows,totalPages){var el=document.createElement("span"),showingEl=document.createElement("span"),valueEl=document.createElement("span"),ofEl=document.createElement("span"),totalEl=document.createElement("span"),rowsEl=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",(function(value){showingEl.innerHTML=value})),this.table.modules.localize.langBind("pagination|counter|of",(function(value){ofEl.innerHTML=value})),this.table.modules.localize.langBind("pagination|counter|rows",(function(value){rowsEl.innerHTML=value})),totalRows?(valueEl.innerHTML=" "+currentRow+"-"+Math.min(currentRow+pageSize-1,totalRows)+" ",totalEl.innerHTML=" "+totalRows+" ",el.appendChild(showingEl),el.appendChild(valueEl),el.appendChild(ofEl),el.appendChild(totalEl),el.appendChild(rowsEl)):(valueEl.innerHTML=" 0 ",el.appendChild(showingEl),el.appendChild(valueEl),el.appendChild(rowsEl)),el}function pages(pageSize,currentRow,currentPage,totalRows,totalPages){var el=document.createElement("span"),showingEl=document.createElement("span"),valueEl=document.createElement("span"),ofEl=document.createElement("span"),totalEl=document.createElement("span"),rowsEl=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",(function(value){showingEl.innerHTML=value})),valueEl.innerHTML=" "+currentPage+" ",this.table.modules.localize.langBind("pagination|counter|of",(function(value){ofEl.innerHTML=value})),totalEl.innerHTML=" "+totalPages+" ",this.table.modules.localize.langBind("pagination|counter|pages",(function(value){rowsEl.innerHTML=value})),el.appendChild(showingEl),el.appendChild(valueEl),el.appendChild(ofEl),el.appendChild(totalEl),el.appendChild(rowsEl),el}Mutator.moduleName="mutator",Mutator.mutators=defaultMutators;var defaultPageCounters={rows:rows,pages:pages},Page=function(_Module){_inherits(Page,_Module);var _super=_createSuper(Page);function Page(table){var _this;return _classCallCheck(this,Page),(_this=_super.call(this,table)).mode="local",_this.progressiveLoad=!1,_this.element=null,_this.pageCounterElement=null,_this.pageCounter=null,_this.size=0,_this.page=1,_this.count=5,_this.max=1,_this.remoteRowCountEstimate=null,_this.displayIndex=0,_this.initialLoad=!0,_this.dataChanging=!1,_this.pageSizes=[],_this.registerTableOption("pagination",!1),_this.registerTableOption("paginationMode","local"),_this.registerTableOption("paginationSize",!1),_this.registerTableOption("paginationInitialPage",1),_this.registerTableOption("paginationCounter",!1),_this.registerTableOption("paginationCounterElement",!1),_this.registerTableOption("paginationButtonCount",5),_this.registerTableOption("paginationSizeSelector",!1),_this.registerTableOption("paginationElement",!1),_this.registerTableOption("paginationAddRow","page"),_this.registerTableOption("progressiveLoad",!1),_this.registerTableOption("progressiveLoadDelay",0),_this.registerTableOption("progressiveLoadScrollMargin",0),_this.registerTableFunction("setMaxPage",_this.setMaxPage.bind(_assertThisInitialized(_this))),_this.registerTableFunction("setPage",_this.setPage.bind(_assertThisInitialized(_this))),_this.registerTableFunction("setPageToRow",_this.userSetPageToRow.bind(_assertThisInitialized(_this))),_this.registerTableFunction("setPageSize",_this.userSetPageSize.bind(_assertThisInitialized(_this))),_this.registerTableFunction("getPageSize",_this.getPageSize.bind(_assertThisInitialized(_this))),_this.registerTableFunction("previousPage",_this.previousPage.bind(_assertThisInitialized(_this))),_this.registerTableFunction("nextPage",_this.nextPage.bind(_assertThisInitialized(_this))),_this.registerTableFunction("getPage",_this.getPage.bind(_assertThisInitialized(_this))),_this.registerTableFunction("getPageMax",_this.getPageMax.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("row","pageTo",_this.setPageToRow.bind(_assertThisInitialized(_this))),_this}return _createClass(Page,[{key:"initialize",value:function initialize(){this.table.options.pagination?(this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("footer-redraw",this.footerRedraw.bind(this)),"page"==this.table.options.paginationAddRow&&this.subscribe("row-adding-position",this.rowAddingPosition.bind(this)),"remote"===this.table.options.paginationMode&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this))),this.table.options.progressiveLoad&&console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time"),this.registerDisplayHandler(this.restOnRenderBefore.bind(this),40),this.registerDisplayHandler(this.getRows.bind(this),50),this.createElements(),this.initializePageCounter(),this.initializePaginator()):this.table.options.progressiveLoad&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.initializeProgressive(this.table.options.progressiveLoad),"scroll"===this.table.options.progressiveLoad&&this.subscribe("scroll-vertical",this.scrollVertical.bind(this)))}},{key:"rowAddingPosition",value:function rowAddingPosition(row,top){var rowManager=this.table.rowManager,displayRows=rowManager.getDisplayRows(),index;return top?displayRows.length?index=displayRows[0]:rowManager.activeRows.length&&(index=rowManager.activeRows[rowManager.activeRows.length-1],top=!1):displayRows.length&&(index=displayRows[displayRows.length-1],top=!(displayRows.length<this.size)),{index:index,top:top}}},{key:"calculatePageSizes",value:function calculatePageSizes(){var testElRow,testElCell;this.table.options.paginationSize?this.size=this.table.options.paginationSize:((testElRow=document.createElement("div")).classList.add("tabulator-row"),testElRow.style.visibility="hidden",(testElCell=document.createElement("div")).classList.add("tabulator-cell"),testElCell.innerHTML="Page Row Test",testElRow.appendChild(testElCell),this.table.rowManager.getTableElement().appendChild(testElRow),this.size=Math.floor(this.table.rowManager.getElement().clientHeight/testElRow.offsetHeight),this.table.rowManager.getTableElement().removeChild(testElRow)),this.dispatchExternal("pageSizeChanged",this.size),this.generatePageSizeSelectList()}},{key:"initialLoadComplete",value:function initialLoadComplete(){this.initialLoad=!1}},{key:"remotePageParams",value:function remotePageParams(data,config,silent,params){return this.initialLoad||(this.progressiveLoad&&!silent||!this.progressiveLoad&&!this.dataChanging)&&this.reset(!0),params.page=this.page,this.size&&(params.size=this.size),params}},{key:"userSetPageToRow",value:function userSetPageToRow(row){return this.table.options.pagination&&(row=this.rowManager.findRow(row))?this.setPageToRow(row):Promise.reject()}},{key:"userSetPageSize",value:function userSetPageSize(size){return!!this.table.options.pagination&&(this.setPageSize(size),this.setPage(1))}},{key:"scrollVertical",value:function scrollVertical(top,dir){var element,diff,margin;dir||this.table.dataLoader.loading||(diff=(element=this.table.rowManager.getElement()).scrollHeight-element.clientHeight-top)<(margin=this.table.options.progressiveLoadScrollMargin||2*element.clientHeight)&&this.nextPage().catch((function(){}))}},{key:"restOnRenderBefore",value:function restOnRenderBefore(rows,renderInPosition){return renderInPosition||"local"===this.mode&&this.reset(),rows}},{key:"rowsUpdated",value:function rowsUpdated(){this.refreshData(!0,"all")}},{key:"createElements",value:function createElements(){var button;this.element=document.createElement("span"),this.element.classList.add("tabulator-paginator"),this.pagesElement=document.createElement("span"),this.pagesElement.classList.add("tabulator-pages"),(button=document.createElement("button")).classList.add("tabulator-page"),button.setAttribute("type","button"),button.setAttribute("role","button"),button.setAttribute("aria-label",""),button.setAttribute("title",""),this.firstBut=button.cloneNode(!0),this.firstBut.setAttribute("data-page","first"),this.prevBut=button.cloneNode(!0),this.prevBut.setAttribute("data-page","prev"),this.nextBut=button.cloneNode(!0),this.nextBut.setAttribute("data-page","next"),this.lastBut=button.cloneNode(!0),this.lastBut.setAttribute("data-page","last"),this.table.options.paginationSizeSelector&&(this.pageSizeSelect=document.createElement("select"),this.pageSizeSelect.classList.add("tabulator-page-size"))}},{key:"generatePageSizeSelectList",value:function generatePageSizeSelectList(){var _this2=this,pageSizes=[];if(this.pageSizeSelect){if(Array.isArray(this.table.options.paginationSizeSelector))pageSizes=this.table.options.paginationSizeSelector,this.pageSizes=pageSizes,-1==this.pageSizes.indexOf(this.size)&&pageSizes.unshift(this.size);else if(-1==this.pageSizes.indexOf(this.size)){pageSizes=[];for(var i=1;i<5;i++)pageSizes.push(this.size*i);this.pageSizes=pageSizes}else pageSizes=this.pageSizes;for(;this.pageSizeSelect.firstChild;)this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild);pageSizes.forEach((function(item){var itemEl=document.createElement("option");itemEl.value=item,!0===item?_this2.langBind("pagination|all",(function(value){itemEl.innerHTML=value})):itemEl.innerHTML=item,_this2.pageSizeSelect.appendChild(itemEl)})),this.pageSizeSelect.value=this.size}}},{key:"initializePageCounter",value:function initializePageCounter(){var counter=this.table.options.paginationCounter,pageCounter=null;counter&&((pageCounter="function"==typeof counter?counter:Page.pageCounters[counter])?(this.pageCounter=pageCounter,this.pageCounterElement=document.createElement("span"),this.pageCounterElement.classList.add("tabulator-page-counter")):console.warn("Pagination Error - No such page counter found: ",counter))}},{key:"initializePaginator",value:function initializePaginator(hidden){var _this3=this,pageSelectLabel,paginationCounterHolder;hidden||(this.langBind("pagination|first",(function(value){_this3.firstBut.innerHTML=value})),this.langBind("pagination|first_title",(function(value){_this3.firstBut.setAttribute("aria-label",value),_this3.firstBut.setAttribute("title",value)})),this.langBind("pagination|prev",(function(value){_this3.prevBut.innerHTML=value})),this.langBind("pagination|prev_title",(function(value){_this3.prevBut.setAttribute("aria-label",value),_this3.prevBut.setAttribute("title",value)})),this.langBind("pagination|next",(function(value){_this3.nextBut.innerHTML=value})),this.langBind("pagination|next_title",(function(value){_this3.nextBut.setAttribute("aria-label",value),_this3.nextBut.setAttribute("title",value)})),this.langBind("pagination|last",(function(value){_this3.lastBut.innerHTML=value})),this.langBind("pagination|last_title",(function(value){_this3.lastBut.setAttribute("aria-label",value),_this3.lastBut.setAttribute("title",value)})),this.firstBut.addEventListener("click",(function(){_this3.setPage(1)})),this.prevBut.addEventListener("click",(function(){_this3.previousPage()})),this.nextBut.addEventListener("click",(function(){_this3.nextPage()})),this.lastBut.addEventListener("click",(function(){_this3.setPage(_this3.max)})),this.table.options.paginationElement&&(this.element=this.table.options.paginationElement),this.pageSizeSelect&&(pageSelectLabel=document.createElement("label"),this.langBind("pagination|page_size",(function(value){_this3.pageSizeSelect.setAttribute("aria-label",value),_this3.pageSizeSelect.setAttribute("title",value),pageSelectLabel.innerHTML=value})),this.element.appendChild(pageSelectLabel),this.element.appendChild(this.pageSizeSelect),this.pageSizeSelect.addEventListener("change",(function(e){_this3.setPageSize("true"==_this3.pageSizeSelect.value||_this3.pageSizeSelect.value),_this3.setPage(1)}))),this.element.appendChild(this.firstBut),this.element.appendChild(this.prevBut),this.element.appendChild(this.pagesElement),this.element.appendChild(this.nextBut),this.element.appendChild(this.lastBut),this.table.options.paginationElement||(this.table.options.paginationCounter&&(this.table.options.paginationCounterElement?this.table.options.paginationCounterElement instanceof HTMLElement?this.table.options.paginationCounterElement.appendChild(this.pageCounterElement):"string"==typeof this.table.options.paginationCounterElement&&((paginationCounterHolder=document.querySelector(this.table.options.paginationCounterElement))?paginationCounterHolder.appendChild(this.pageCounterElement):console.warn("Pagination Error - Unable to find element matching paginationCounterElement selector:",this.table.options.paginationCounterElement)):this.footerAppend(this.pageCounterElement)),this.footerAppend(this.element)),this.page=this.table.options.paginationInitialPage,this.count=this.table.options.paginationButtonCount),this.mode=this.table.options.paginationMode}},{key:"initializeProgressive",value:function initializeProgressive(mode){this.initializePaginator(!0),this.mode="progressive_"+mode,this.progressiveLoad=!0}},{key:"trackChanges",value:function trackChanges(){this.dispatch("page-changed")}},{key:"setDisplayIndex",value:function setDisplayIndex(index){this.displayIndex=index}},{key:"getDisplayIndex",value:function getDisplayIndex(){return this.displayIndex}},{key:"setMaxRows",value:function setMaxRows(rowCount){this.max=rowCount?!0===this.size?1:Math.ceil(rowCount/this.size):1,this.page>this.max&&(this.page=this.max)}},{key:"reset",value:function reset(force){this.initialLoad||("local"==this.mode||force)&&(this.page=1)}},{key:"setMaxPage",value:function setMaxPage(max){max=parseInt(max),this.max=max||1,this.page>this.max&&(this.page=this.max,this.trigger())}},{key:"setPage",value:function setPage(page){switch(page){case"first":return this.setPage(1);case"prev":return this.previousPage();case"next":return this.nextPage();case"last":return this.setPage(this.max)}return(page=parseInt(page))>0&&page<=this.max||"local"!==this.mode?(this.page=page,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Requested page is out of range of 1 - "+this.max+":",page),Promise.reject())}},{key:"setPageToRow",value:function setPageToRow(row){var rows,index=this.table.rowManager.getDisplayRows(this.displayIndex-1).indexOf(row);if(index>-1){var page=!0===this.size?1:Math.ceil((index+1)/this.size);return this.setPage(page)}return console.warn("Pagination Error - Requested row is not visible"),Promise.reject()}},{key:"setPageSize",value:function setPageSize(size){!0!==size&&(size=parseInt(size)),size>0&&(this.size=size,this.dispatchExternal("pageSizeChanged",size)),this.pageSizeSelect&&this.generatePageSizeSelectList(),this.trackChanges()}},{key:"_setPageCounter",value:function _setPageCounter(totalRows,size,currentRow){var content;if(this.pageCounter)switch("remote"===this.mode&&(size=this.size,currentRow=(this.page-1)*this.size+1,totalRows=this.remoteRowCountEstimate),_typeof(content=this.pageCounter.call(this,size,currentRow,this.page,totalRows,this.max))){case"object":if(content instanceof Node){for(;this.pageCounterElement.firstChild;)this.pageCounterElement.removeChild(this.pageCounterElement.firstChild);this.pageCounterElement.appendChild(content)}else this.pageCounterElement.innerHTML="",null!=content&&console.warn("Page Counter Error - Page Counter has returned a type of object, the only valid page counter object return is an instance of Node, the page counter returned:",content);break;case"undefined":this.pageCounterElement.innerHTML="";break;default:this.pageCounterElement.innerHTML=content}}},{key:"_setPageButtons",value:function _setPageButtons(){for(var leftSize=Math.floor((this.count-1)/2),rightSize=Math.ceil((this.count-1)/2),min=this.max-this.page+leftSize+1<this.count?this.max-this.count+1:Math.max(this.page-leftSize,1),max=this.page<=rightSize?Math.min(this.count,this.max):Math.min(this.page+rightSize,this.max);this.pagesElement.firstChild;)this.pagesElement.removeChild(this.pagesElement.firstChild);1==this.page?(this.firstBut.disabled=!0,this.prevBut.disabled=!0):(this.firstBut.disabled=!1,this.prevBut.disabled=!1),this.page==this.max?(this.lastBut.disabled=!0,this.nextBut.disabled=!0):(this.lastBut.disabled=!1,this.nextBut.disabled=!1);for(var i=min;i<=max;i++)i>0&&i<=this.max&&this.pagesElement.appendChild(this._generatePageButton(i));this.footerRedraw()}},{key:"_generatePageButton",value:function _generatePageButton(page){var _this4=this,button=document.createElement("button");return button.classList.add("tabulator-page"),page==this.page&&button.classList.add("active"),button.setAttribute("type","button"),button.setAttribute("role","button"),this.langBind("pagination|page_title",(function(value){button.setAttribute("aria-label",value+" "+page),button.setAttribute("title",value+" "+page)})),button.setAttribute("data-page",page),button.textContent=page,button.addEventListener("click",(function(e){_this4.setPage(page)})),button}},{key:"previousPage",value:function previousPage(){return this.page>1?(this.page--,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Previous page would be less than page 1:",0),Promise.reject())}},{key:"nextPage",value:function nextPage(){return this.page<this.max?(this.page++,this.trackChanges(),this.trigger()):(this.progressiveLoad||console.warn("Pagination Error - Next page would be greater than maximum page of "+this.max+":",this.max+1),Promise.reject())}},{key:"getPage",value:function getPage(){return this.page}},{key:"getPageMax",value:function getPageMax(){return this.max}},{key:"getPageSize",value:function getPageSize(size){return this.size}},{key:"getMode",value:function getMode(){return this.mode}},{key:"getRows",value:function getRows(data){var actualRowPageSize=0,output,start,end,actualStartRow,actualRows=data.filter((function(row){return"row"===row.type}));if("local"==this.mode){output=[],this.setMaxRows(data.length),!0===this.size?(start=0,end=data.length):end=(start=this.size*(this.page-1))+parseInt(this.size),this._setPageButtons();for(var i=start;i<end;i++){var row=data[i];row&&(output.push(row),"row"===row.type&&(actualStartRow||(actualStartRow=row),actualRowPageSize++))}return this._setPageCounter(actualRows.length,actualRowPageSize,actualStartRow?actualRows.indexOf(actualStartRow)+1:0),output}return this._setPageButtons(),this._setPageCounter(actualRows.length),data.slice(0)}},{key:"trigger",value:function trigger(){var _this5=this,left;switch(this.mode){case"local":return left=this.table.rowManager.scrollLeft,this.refreshData(),this.table.rowManager.scrollHorizontal(left),this.dispatchExternal("pageLoaded",this.getPage()),Promise.resolve();case"remote":return this.dataChanging=!0,this.reloadData(null).finally((function(){_this5.dataChanging=!1}));case"progressive_load":case"progressive_scroll":return this.reloadData(null,!0);default:return console.warn("Pagination Error - no such pagination mode:",this.mode),Promise.reject()}}},{key:"_parseRemoteData",value:function _parseRemoteData(data){var _this6=this,margin;if(void 0===data.last_page&&console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").last_page||"last_page")+"' property"),data.data){if(this.max=parseInt(data.last_page)||1,this.remoteRowCountEstimate=void 0!==data.last_row?data.last_row:data.last_page*this.size-(this.page==data.last_page?this.size-data.data.length:0),this.progressiveLoad){switch(this.mode){case"progressive_load":1==this.page?this.table.rowManager.setData(data.data,!1,1==this.page):this.table.rowManager.addRows(data.data),this.page<this.max&&setTimeout((function(){_this6.nextPage()}),this.table.options.progressiveLoadDelay);break;case"progressive_scroll":data=1===this.page?data.data:this.table.rowManager.getData().concat(data.data),this.table.rowManager.setData(data,1!==this.page,1==this.page),margin=this.table.options.progressiveLoadScrollMargin||2*this.table.rowManager.element.clientHeight,this.table.rowManager.element.scrollHeight<=this.table.rowManager.element.clientHeight+margin&&this.page<this.max&&setTimeout((function(){_this6.nextPage()}))}return!1}this.dispatchExternal("pageLoaded",this.getPage())}else console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").data||"data")+"' property");return data.data}},{key:"footerRedraw",value:function footerRedraw(){var footer=this.table.footerManager.containerElement;Math.ceil(footer.clientWidth)-footer.scrollWidth<0?this.pagesElement.style.display="none":(this.pagesElement.style.display="",Math.ceil(footer.clientWidth)-footer.scrollWidth<0&&(this.pagesElement.style.display="none"))}}]),Page}(Module);Page.moduleName="page",Page.pageCounters=defaultPageCounters;var defaultReaders={local:function local(id,type){var data=localStorage.getItem(id+"-"+type);return!!data&&JSON.parse(data)},cookie:function cookie(id,type){var cookie=document.cookie,key=id+"-"+type,cookiePos=cookie.indexOf(key+"="),end,data;return cookiePos>-1&&(cookie=cookie.slice(cookiePos),(end=cookie.indexOf(";"))>-1&&(cookie=cookie.slice(0,end)),data=cookie.replace(key+"=","")),!!data&&JSON.parse(data)}},defaultWriters={local:function local(id,type,data){localStorage.setItem(id+"-"+type,JSON.stringify(data))},cookie:function cookie(id,type,data){var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1e4),document.cookie=id+"-"+type+"="+JSON.stringify(data)+"; expires="+expireDate.toUTCString()}},Persistence=function(_Module){_inherits(Persistence,_Module);var _super=_createSuper(Persistence);function Persistence(table){var _this;return _classCallCheck(this,Persistence),(_this=_super.call(this,table)).mode="",_this.id="",_this.defWatcherBlock=!1,_this.config={},_this.readFunc=!1,_this.writeFunc=!1,_this.registerTableOption("persistence",!1),_this.registerTableOption("persistenceID",""),_this.registerTableOption("persistenceMode",!0),_this.registerTableOption("persistenceReaderFunc",!1),_this.registerTableOption("persistenceWriterFunc",!1),_this}return _createClass(Persistence,[{key:"localStorageTest",value:function localStorageTest(){var testKey="_tabulator_test";try{return window.localStorage.setItem(testKey,testKey),window.localStorage.removeItem(testKey),!0}catch(e){return!1}}},{key:"initialize",value:function initialize(){if(this.table.options.persistence){var mode=this.table.options.persistenceMode,id=this.table.options.persistenceID,retrievedData;this.mode=!0!==mode?mode:this.localStorageTest()?"local":"cookie",this.table.options.persistenceReaderFunc?"function"==typeof this.table.options.persistenceReaderFunc?this.readFunc=this.table.options.persistenceReaderFunc:Persistence.readers[this.table.options.persistenceReaderFunc]?this.readFunc=Persistence.readers[this.table.options.persistenceReaderFunc]:console.warn("Persistence Read Error - invalid reader set",this.table.options.persistenceReaderFunc):Persistence.readers[this.mode]?this.readFunc=Persistence.readers[this.mode]:console.warn("Persistence Read Error - invalid reader set",this.mode),this.table.options.persistenceWriterFunc?"function"==typeof this.table.options.persistenceWriterFunc?this.writeFunc=this.table.options.persistenceWriterFunc:Persistence.writers[this.table.options.persistenceWriterFunc]?this.writeFunc=Persistence.writers[this.table.options.persistenceWriterFunc]:console.warn("Persistence Write Error - invalid reader set",this.table.options.persistenceWriterFunc):Persistence.writers[this.mode]?this.writeFunc=Persistence.writers[this.mode]:console.warn("Persistence Write Error - invalid writer set",this.mode),this.id="tabulator-"+(id||this.table.element.getAttribute("id")||""),this.config={sort:!0===this.table.options.persistence||this.table.options.persistence.sort,filter:!0===this.table.options.persistence||this.table.options.persistence.filter,group:!0===this.table.options.persistence||this.table.options.persistence.group,page:!0===this.table.options.persistence||this.table.options.persistence.page,columns:!0===this.table.options.persistence?["title","width","visible"]:this.table.options.persistence.columns},this.config.page&&(retrievedData=this.retrieveData("page"))&&(void 0===retrievedData.paginationSize||!0!==this.config.page&&!this.config.page.size||(this.table.options.paginationSize=retrievedData.paginationSize),void 0===retrievedData.paginationInitialPage||!0!==this.config.page&&!this.config.page.page||(this.table.options.paginationInitialPage=retrievedData.paginationInitialPage)),this.config.group&&(retrievedData=this.retrieveData("group"))&&(void 0===retrievedData.groupBy||!0!==this.config.group&&!this.config.group.groupBy||(this.table.options.groupBy=retrievedData.groupBy),void 0===retrievedData.groupStartOpen||!0!==this.config.group&&!this.config.group.groupStartOpen||(this.table.options.groupStartOpen=retrievedData.groupStartOpen),void 0===retrievedData.groupHeader||!0!==this.config.group&&!this.config.group.groupHeader||(this.table.options.groupHeader=retrievedData.groupHeader)),this.config.columns&&(this.table.options.columns=this.load("columns",this.table.options.columns),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-show",this.save.bind(this,"columns")),this.subscribe("column-hide",this.save.bind(this,"columns")),this.subscribe("column-moved",this.save.bind(this,"columns"))),this.subscribe("table-built",this.tableBuilt.bind(this),0),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("filter-changed",this.eventSave.bind(this,"filter")),this.subscribe("sort-changed",this.eventSave.bind(this,"sort")),this.subscribe("group-changed",this.eventSave.bind(this,"group")),this.subscribe("page-changed",this.eventSave.bind(this,"page")),this.subscribe("column-resized",this.eventSave.bind(this,"columns")),this.subscribe("layout-refreshed",this.eventSave.bind(this,"columns"))}this.registerTableFunction("getColumnLayout",this.getColumnLayout.bind(this)),this.registerTableFunction("setColumnLayout",this.setColumnLayout.bind(this))}},{key:"eventSave",value:function eventSave(type){this.config[type]&&this.save(type)}},{key:"tableBuilt",value:function tableBuilt(){var sorters,filters;this.config.sort&&!1==!(sorters=this.load("sort"))&&(this.table.options.initialSort=sorters),this.config.filter&&!1==!(filters=this.load("filter"))&&(this.table.options.initialFilter=filters)}},{key:"tableRedraw",value:function tableRedraw(force){force&&this.config.columns&&this.save("columns")}},{key:"getColumnLayout",value:function getColumnLayout(){return this.parseColumns(this.table.columnManager.getColumns())}},{key:"setColumnLayout",value:function setColumnLayout(layout){return this.table.columnManager.setColumns(this.mergeDefinition(this.table.options.columns,layout)),!0}},{key:"initializeColumn",value:function initializeColumn(column){var def,keys;this.config.columns&&(this.defWatcherBlock=!0,def=column.getDefinition(),(keys=!0===this.config.columns?Object.keys(def):this.config.columns).forEach((function(key){var props=Object.getOwnPropertyDescriptor(def,key),value=def[key];props&&Object.defineProperty(def,key,{set:function set(newValue){value=newValue,this.defWatcherBlock||this.save("columns"),props.set&&props.set(newValue)},get:function get(){return props.get&&props.get(),value}})})),this.defWatcherBlock=!1)}},{key:"load",value:function load(type,current){var data=this.retrieveData(type);return current&&(data=data?this.mergeDefinition(current,data):current),data}},{key:"retrieveData",value:function retrieveData(type){return!!this.readFunc&&this.readFunc(this.id,type)}},{key:"mergeDefinition",value:function mergeDefinition(oldCols,newCols){var _this2=this,output=[];return(newCols=newCols||[]).forEach((function(column,to){var from=_this2._findColumn(oldCols,column),keys;from&&(!0===_this2.config.columns||null==_this2.config.columns?(keys=Object.keys(from)).push("width"):keys=_this2.config.columns,keys.forEach((function(key){"columns"!==key&&void 0!==column[key]&&(from[key]=column[key])})),from.columns&&(from.columns=_this2.mergeDefinition(from.columns,column.columns)),output.push(from))})),oldCols.forEach((function(column,i){var from;_this2._findColumn(newCols,column)||(output.length>i?output.splice(i,0,column):output.push(column))})),output}},{key:"_findColumn",value:function _findColumn(columns,subject){var type=subject.columns?"group":subject.field?"field":"object";return columns.find((function(col){switch(type){case"group":return col.title===subject.title&&col.columns.length===subject.columns.length;case"field":return col.field===subject.field;case"object":return col===subject}}))}},{key:"save",value:function save(type){var data={};switch(type){case"columns":data=this.parseColumns(this.table.columnManager.getColumns());break;case"filter":data=this.table.modules.filter.getFilters();break;case"sort":data=this.validateSorters(this.table.modules.sort.getSort());break;case"group":data=this.getGroupConfig();break;case"page":data=this.getPageConfig()}this.writeFunc&&this.writeFunc(this.id,type,data)}},{key:"validateSorters",value:function validateSorters(data){return data.forEach((function(item){item.column=item.field,delete item.field})),data}},{key:"getGroupConfig",value:function getGroupConfig(){var data={};return this.config.group&&((!0===this.config.group||this.config.group.groupBy)&&(data.groupBy=this.table.options.groupBy),(!0===this.config.group||this.config.group.groupStartOpen)&&(data.groupStartOpen=this.table.options.groupStartOpen),(!0===this.config.group||this.config.group.groupHeader)&&(data.groupHeader=this.table.options.groupHeader)),data}},{key:"getPageConfig",value:function getPageConfig(){var data={};return this.config.page&&((!0===this.config.page||this.config.page.size)&&(data.paginationSize=this.table.modules.page.getPageSize()),(!0===this.config.page||this.config.page.page)&&(data.paginationInitialPage=this.table.modules.page.getPage())),data}},{key:"parseColumns",value:function parseColumns(columns){var _this3=this,definitions=[],excludedKeys=["headerContextMenu","headerMenu","contextMenu","clickMenu"];return columns.forEach((function(column){var defStore={},colDef=column.getDefinition(),keys;column.isGroup?(defStore.title=colDef.title,defStore.columns=_this3.parseColumns(column.getColumns())):(defStore.field=column.getField(),!0===_this3.config.columns||null==_this3.config.columns?((keys=Object.keys(colDef)).push("width"),keys.push("visible")):keys=_this3.config.columns,keys.forEach((function(key){switch(key){case"width":defStore.width=column.getWidth();break;case"visible":defStore.visible=column.visible;break;default:"function"!=typeof colDef[key]&&-1===excludedKeys.indexOf(key)&&(defStore[key]=colDef[key])}}))),definitions.push(defStore)})),definitions}}]),Persistence}(Module);Persistence.moduleName="persistence",Persistence.moduleInitOrder=-10,Persistence.readers=defaultReaders,Persistence.writers=defaultWriters;var Popup$1=function(_Module){_inherits(Popup,_Module);var _super=_createSuper(Popup);function Popup(table){var _this;return _classCallCheck(this,Popup),(_this=_super.call(this,table)).columnSubscribers={},_this.registerTableOption("rowContextPopup",!1),_this.registerTableOption("rowClickPopup",!1),_this.registerTableOption("groupContextPopup",!1),_this.registerTableOption("groupClickPopup",!1),_this.registerColumnOption("headerContextPopup"),_this.registerColumnOption("headerClickPopup"),_this.registerColumnOption("headerPopup"),_this.registerColumnOption("headerPopupIcon"),_this.registerColumnOption("contextPopup"),_this.registerColumnOption("clickPopup"),_this}return _createClass(Popup,[{key:"initialize",value:function initialize(){this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}},{key:"initializeRowWatchers",value:function initializeRowWatchers(){this.table.options.rowContextPopup&&(this.subscribe("row-contextmenu",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup)),this.table.on("rowTapHold",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup))),this.table.options.rowClickPopup&&this.subscribe("row-click",this.loadPopupEvent.bind(this,this.table.options.rowClickPopup))}},{key:"initializeGroupWatchers",value:function initializeGroupWatchers(){this.table.options.groupContextPopup&&(this.subscribe("group-contextmenu",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup)),this.table.on("groupTapHold",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup))),this.table.options.groupClickPopup&&this.subscribe("group-click",this.loadPopupEvent.bind(this,this.table.options.groupClickPopup))}},{key:"initializeColumn",value:function initializeColumn(column){var def=column.definition;def.headerContextPopup&&!this.columnSubscribers.headerContextPopup&&(this.columnSubscribers.headerContextPopup=this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextPopup),this.table.on("headerTapHold",this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"))),def.headerClickPopup&&!this.columnSubscribers.headerClickPopup&&(this.columnSubscribers.headerClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerClickPopup"),this.subscribe("column-click",this.columnSubscribers.headerClickPopup)),def.headerPopup&&this.initializeColumnHeaderPopup(column),def.contextPopup&&!this.columnSubscribers.contextPopup&&(this.columnSubscribers.contextPopup=this.loadPopupTableCellEvent.bind(this,"contextPopup"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextPopup),this.table.on("cellTapHold",this.loadPopupTableCellEvent.bind(this,"contextPopup"))),def.clickPopup&&!this.columnSubscribers.clickPopup&&(this.columnSubscribers.clickPopup=this.loadPopupTableCellEvent.bind(this,"clickPopup"),this.subscribe("cell-click",this.columnSubscribers.clickPopup))}},{key:"initializeColumnHeaderPopup",value:function initializeColumnHeaderPopup(column){var _this2=this,icon=column.definition.headerPopupIcon,headerPopupEl;(headerPopupEl=document.createElement("span")).classList.add("tabulator-header-popup-button"),icon?("function"==typeof icon&&(icon=icon(column.getComponent())),icon instanceof HTMLElement?headerPopupEl.appendChild(icon):headerPopupEl.innerHTML=icon):headerPopupEl.innerHTML="&vellip;",headerPopupEl.addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault(),_this2.loadPopupEvent(column.definition.headerPopup,e,column)})),column.titleElement.insertBefore(headerPopupEl,column.titleElement.firstChild)}},{key:"loadPopupTableCellEvent",value:function loadPopupTableCellEvent(option,e,cell){cell._cell&&(cell=cell._cell),cell.column.definition[option]&&this.loadPopupEvent(cell.column.definition[option],e,cell)}},{key:"loadPopupTableColumnEvent",value:function loadPopupTableColumnEvent(option,e,column){column._column&&(column=column._column),column.definition[option]&&this.loadPopupEvent(column.definition[option],e,column)}},{key:"loadPopupEvent",value:function loadPopupEvent(contents,e,component){var renderedCallback;function onRendered(callback){renderedCallback=callback}component._group?component=component._group:component._row&&(component=component._row),contents="function"==typeof contents?contents.call(this.table,e,component.getComponent(),onRendered):contents,this.loadPopup(e,component,contents,renderedCallback)}},{key:"loadPopup",value:function loadPopup(e,component,contents,renderedCallback){var _this3=this,touch=!(e instanceof MouseEvent),contentsEl,popup;contents instanceof HTMLElement?contentsEl=contents:(contentsEl=document.createElement("div")).innerHTML=contents,contentsEl.classList.add("tabulator-popup"),contentsEl.addEventListener("click",(function(e){e.stopPropagation()})),touch||e.preventDefault(),popup=this.popup(contentsEl),"function"==typeof renderedCallback&&popup.renderCallback(renderedCallback),popup.show(e).hideOnBlur((function(){_this3.dispatchExternal("popupClosed",component.getComponent())})),this.dispatchExternal("popupOpened",component.getComponent())}}]),Popup}(Module);Popup$1.moduleName="popup";var Print=function(_Module){_inherits(Print,_Module);var _super=_createSuper(Print);function Print(table){var _this;return _classCallCheck(this,Print),(_this=_super.call(this,table)).element=!1,_this.manualBlock=!1,_this.registerTableOption("printAsHtml",!1),_this.registerTableOption("printFormatter",!1),_this.registerTableOption("printHeader",!1),_this.registerTableOption("printFooter",!1),_this.registerTableOption("printStyled",!0),_this.registerTableOption("printRowRange","visible"),_this.registerTableOption("printConfig",{}),_this.registerColumnOption("print"),_this.registerColumnOption("titlePrint"),_this}return _createClass(Print,[{key:"initialize",value:function initialize(){this.table.options.printAsHtml&&(window.addEventListener("beforeprint",this.replaceTable.bind(this)),window.addEventListener("afterprint",this.cleanup.bind(this))),this.registerTableFunction("print",this.printFullscreen.bind(this))}},{key:"replaceTable",value:function replaceTable(){this.manualBlock||(this.element=document.createElement("div"),this.element.classList.add("tabulator-print-table"),this.element.appendChild(this.table.modules.export.generateTable(this.table.options.printConfig,this.table.options.printStyled,this.table.options.printRowRange,"print")),this.table.element.style.display="none",this.table.element.parentNode.insertBefore(this.element,this.table.element))}},{key:"cleanup",value:function cleanup(){document.body.classList.remove("tabulator-print-fullscreen-hide"),this.element&&this.element.parentNode&&(this.element.parentNode.removeChild(this.element),this.table.element.style.display="")}},{key:"printFullscreen",value:function printFullscreen(visible,style,config){var scrollX=window.scrollX,scrollY=window.scrollY,headerEl=document.createElement("div"),footerEl=document.createElement("div"),tableEl=this.table.modules.export.generateTable(void 0!==config?config:this.table.options.printConfig,void 0!==style?style:this.table.options.printStyled,visible||this.table.options.printRowRange,"print"),headerContent,footerContent;this.manualBlock=!0,this.element=document.createElement("div"),this.element.classList.add("tabulator-print-fullscreen"),this.table.options.printHeader&&(headerEl.classList.add("tabulator-print-header"),"string"==typeof(headerContent="function"==typeof this.table.options.printHeader?this.table.options.printHeader.call(this.table):this.table.options.printHeader)?headerEl.innerHTML=headerContent:headerEl.appendChild(headerContent),this.element.appendChild(headerEl)),this.element.appendChild(tableEl),this.table.options.printFooter&&(footerEl.classList.add("tabulator-print-footer"),"string"==typeof(footerContent="function"==typeof this.table.options.printFooter?this.table.options.printFooter.call(this.table):this.table.options.printFooter)?footerEl.innerHTML=footerContent:footerEl.appendChild(footerContent),this.element.appendChild(footerEl)),document.body.classList.add("tabulator-print-fullscreen-hide"),document.body.appendChild(this.element),this.table.options.printFormatter&&this.table.options.printFormatter(this.element,tableEl),window.print(),this.cleanup(),window.scrollTo(scrollX,scrollY),this.manualBlock=!1}}]),Print}(Module);Print.moduleName="print";var ReactiveData=function(_Module){_inherits(ReactiveData,_Module);var _super=_createSuper(ReactiveData);function ReactiveData(table){var _this;return _classCallCheck(this,ReactiveData),(_this=_super.call(this,table)).data=!1,_this.blocked=!1,_this.origFuncs={},_this.currentVersion=0,_this.registerTableOption("reactiveData",!1),_this}return _createClass(ReactiveData,[{key:"initialize",value:function initialize(){this.table.options.reactiveData&&(this.subscribe("cell-value-save-before",this.block.bind(this,"cellsave")),this.subscribe("cell-value-save-after",this.unblock.bind(this,"cellsave")),this.subscribe("row-data-save-before",this.block.bind(this,"rowsave")),this.subscribe("row-data-save-after",this.unblock.bind(this,"rowsave")),this.subscribe("row-data-init-after",this.watchRow.bind(this)),this.subscribe("data-processing",this.watchData.bind(this)),this.subscribe("table-destroy",this.unwatchData.bind(this)))}},{key:"watchData",value:function watchData(data){var self=this,version;this.currentVersion++,version=this.currentVersion,this.unwatchData(),this.data=data,this.origFuncs.push=data.push,Object.defineProperty(this.data,"push",{enumerable:!1,configurable:!0,value:function value(){var args=Array.from(arguments),result;return self.blocked||version!==self.currentVersion||(self.block("data-push"),args.forEach((function(arg){self.table.rowManager.addRowActual(arg,!1)})),result=self.origFuncs.push.apply(data,arguments),self.unblock("data-push")),result}}),this.origFuncs.unshift=data.unshift,Object.defineProperty(this.data,"unshift",{enumerable:!1,configurable:!0,value:function value(){var args=Array.from(arguments),result;return self.blocked||version!==self.currentVersion||(self.block("data-unshift"),args.forEach((function(arg){self.table.rowManager.addRowActual(arg,!0)})),result=self.origFuncs.unshift.apply(data,arguments),self.unblock("data-unshift")),result}}),this.origFuncs.shift=data.shift,Object.defineProperty(this.data,"shift",{enumerable:!1,configurable:!0,value:function value(){var row,result;return self.blocked||version!==self.currentVersion||(self.block("data-shift"),self.data.length&&(row=self.table.rowManager.getRowFromDataObject(self.data[0]))&&row.deleteActual(),result=self.origFuncs.shift.call(data),self.unblock("data-shift")),result}}),this.origFuncs.pop=data.pop,Object.defineProperty(this.data,"pop",{enumerable:!1,configurable:!0,value:function value(){var row,result;return self.blocked||version!==self.currentVersion||(self.block("data-pop"),self.data.length&&(row=self.table.rowManager.getRowFromDataObject(self.data[self.data.length-1]))&&row.deleteActual(),result=self.origFuncs.pop.call(data),self.unblock("data-pop")),result}}),this.origFuncs.splice=data.splice,Object.defineProperty(this.data,"splice",{enumerable:!1,configurable:!0,value:function value(){var args=Array.from(arguments),start=args[0]<0?data.length+args[0]:args[0],end=args[1],newRows=!!args[2]&&args.slice(2),startRow,result;if(!self.blocked&&version===self.currentVersion){if(self.block("data-splice"),newRows&&((startRow=!!data[start]&&self.table.rowManager.getRowFromDataObject(data[start]))?newRows.forEach((function(rowData){self.table.rowManager.addRowActual(rowData,!0,startRow,!0)})):(newRows=newRows.slice().reverse()).forEach((function(rowData){self.table.rowManager.addRowActual(rowData,!0,!1,!0)}))),0!==end){var oldRows=data.slice(start,void 0===args[1]?args[1]:start+end);oldRows.forEach((function(rowData,i){var row=self.table.rowManager.getRowFromDataObject(rowData);row&&row.deleteActual(i!==oldRows.length-1)}))}(newRows||0!==end)&&self.table.rowManager.reRenderInPosition(),result=self.origFuncs.splice.apply(data,arguments),self.unblock("data-splice")}return result}})}},{key:"unwatchData",value:function unwatchData(){if(!1!==this.data)for(var key in this.origFuncs)Object.defineProperty(this.data,key,{enumerable:!0,configurable:!0,writable:!0,value:this.origFuncs.key})}},{key:"watchRow",value:function watchRow(row){var data=row.getData();for(var key in data)this.watchKey(row,data,key);this.table.options.dataTree&&this.watchTreeChildren(row)}},{key:"watchTreeChildren",value:function watchTreeChildren(row){var _arguments=arguments,_this2=this,self=this,childField=row.getData()[this.table.options.dataTreeChildField],origFuncs={};childField&&(origFuncs.push=childField.push,Object.defineProperty(childField,"push",{enumerable:!1,configurable:!0,value:function value(){if(!self.blocked){self.block("tree-push");var result=origFuncs.push.apply(childField,_arguments);_this2.rebuildTree(row),self.unblock("tree-push")}return result}}),origFuncs.unshift=childField.unshift,Object.defineProperty(childField,"unshift",{enumerable:!1,configurable:!0,value:function value(){if(!self.blocked){self.block("tree-unshift");var result=origFuncs.unshift.apply(childField,_arguments);_this2.rebuildTree(row),self.unblock("tree-unshift")}return result}}),origFuncs.shift=childField.shift,Object.defineProperty(childField,"shift",{enumerable:!1,configurable:!0,value:function value(){if(!self.blocked){self.block("tree-shift");var result=origFuncs.shift.call(childField);_this2.rebuildTree(row),self.unblock("tree-shift")}return result}}),origFuncs.pop=childField.pop,Object.defineProperty(childField,"pop",{enumerable:!1,configurable:!0,value:function value(){if(!self.blocked){self.block("tree-pop");var result=origFuncs.pop.call(childField);_this2.rebuildTree(row),self.unblock("tree-pop")}return result}}),origFuncs.splice=childField.splice,Object.defineProperty(childField,"splice",{enumerable:!1,configurable:!0,value:function value(){if(!self.blocked){self.block("tree-splice");var result=origFuncs.splice.apply(childField,_arguments);_this2.rebuildTree(row),self.unblock("tree-splice")}return result}}))}},{key:"rebuildTree",value:function rebuildTree(row){this.table.modules.dataTree.initializeRow(row),this.table.modules.dataTree.layoutRow(row),this.table.rowManager.refreshActiveData("tree",!1,!0)}},{key:"watchKey",value:function watchKey(row,data,key){var self=this,props=Object.getOwnPropertyDescriptor(data,key),value=data[key],version=this.currentVersion;Object.defineProperty(data,key,{set:function set(newValue){if(value=newValue,!self.blocked&&version===self.currentVersion){self.block("key");var update={};update[key]=newValue,row.updateData(update),self.unblock("key")}props.set&&props.set(newValue)},get:function get(){return props.get&&props.get(),value}})}},{key:"unwatchRow",value:function unwatchRow(row){var data=row.getData();for(var key in data)Object.defineProperty(data,key,{value:data[key]})}},{key:"block",value:function block(key){this.blocked||(this.blocked=key)}},{key:"unblock",value:function unblock(key){this.blocked===key&&(this.blocked=!1)}}]),ReactiveData}(Module);ReactiveData.moduleName="reactiveData";var ResizeColumns=function(_Module){_inherits(ResizeColumns,_Module);var _super=_createSuper(ResizeColumns);function ResizeColumns(table){var _this;return _classCallCheck(this,ResizeColumns),(_this=_super.call(this,table)).startColumn=!1,_this.startX=!1,_this.startWidth=!1,_this.latestX=!1,_this.handle=null,_this.initialNextColumn=null,_this.nextColumn=null,_this.initialized=!1,_this.registerColumnOption("resizable",!0),_this.registerTableOption("resizableColumnFit",!1),_this}return _createClass(ResizeColumns,[{key:"initialize",value:function initialize(){this.subscribe("column-rendered",this.layoutColumnHeader.bind(this))}},{key:"initializeEventWatchers",value:function initializeEventWatchers(){this.initialized||(this.subscribe("cell-rendered",this.layoutCellHandles.bind(this)),this.subscribe("cell-delete",this.deInitializeComponent.bind(this)),this.subscribe("cell-height",this.resizeHandle.bind(this)),this.subscribe("column-moved",this.columnLayoutUpdated.bind(this)),this.subscribe("column-hide",this.deInitializeColumn.bind(this)),this.subscribe("column-show",this.columnLayoutUpdated.bind(this)),this.subscribe("column-width",this.columnWidthUpdated.bind(this)),this.subscribe("column-delete",this.deInitializeComponent.bind(this)),this.subscribe("column-height",this.resizeHandle.bind(this)),this.initialized=!0)}},{key:"layoutCellHandles",value:function layoutCellHandles(cell){"row"===cell.row.type&&(this.deInitializeComponent(cell),this.initializeColumn("cell",cell,cell.column,cell.element))}},{key:"layoutColumnHeader",value:function layoutColumnHeader(column){column.definition.resizable&&(this.initializeEventWatchers(),this.deInitializeComponent(column),this.initializeColumn("header",column,column,column.element))}},{key:"columnLayoutUpdated",value:function columnLayoutUpdated(column){var prev=column.prevColumn();this.reinitializeColumn(column),prev&&this.reinitializeColumn(prev)}},{key:"columnWidthUpdated",value:function columnWidthUpdated(column){var _this2=this;column.modules.frozen&&(this.table.modules.frozenColumns.leftColumns.includes(column)?this.table.modules.frozenColumns.leftColumns.forEach((function(col){_this2.reinitializeColumn(col)})):this.table.modules.frozenColumns.rightColumns.includes(column)&&this.table.modules.frozenColumns.rightColumns.forEach((function(col){_this2.reinitializeColumn(col)})))}},{key:"reinitializeColumn",value:function reinitializeColumn(column){var frozenOffset=!!column.modules.frozen&&column.modules.frozen.marginValue+column.getWidth()+"px";column.cells.forEach((function(cell){cell.modules.resize&&cell.modules.resize.handleEl&&(frozenOffset&&(cell.modules.resize.handleEl.style.left=frozenOffset),cell.element.after(cell.modules.resize.handleEl))})),column.modules.resize&&column.modules.resize.handleEl&&(frozenOffset&&(column.modules.resize.handleEl.style.left=frozenOffset),column.element.after(column.modules.resize.handleEl))}},{key:"initializeColumn",value:function initializeColumn(type,component,column,element){var self=this,variableHeight=!1,mode=column.definition.resizable,config={},nearestColumn=column.getLastColumn();if("header"===type&&(config={variableHeight:variableHeight="textarea"==column.definition.formatter||column.definition.variableHeight}),(!0===mode||mode==type)&&this._checkResizability(nearestColumn)){var handle=document.createElement("span");handle.className="tabulator-col-resize-handle",handle.addEventListener("click",(function(e){e.stopPropagation()}));var handleDown=function handleDown(e){self.startColumn=column,self.initialNextColumn=self.nextColumn=nearestColumn.nextColumn(),self._mouseDown(e,nearestColumn,handle)};handle.addEventListener("mousedown",handleDown),handle.addEventListener("touchstart",handleDown,{passive:!0}),handle.addEventListener("dblclick",(function(e){var oldWidth=nearestColumn.getWidth();e.stopPropagation(),nearestColumn.reinitializeWidth(!0),oldWidth!==nearestColumn.getWidth()&&(self.dispatch("column-resized",nearestColumn),self.table.externalEvents.dispatch("columnResized",nearestColumn.getComponent()))})),column.modules.frozen&&(handle.style.position="absolute",handle.style.left=column.modules.frozen.marginValue+column.getWidth()+"px"),config.handleEl=handle,element.parentNode&&column.visible&&element.after(handle)}component.modules.resize=config}},{key:"deInitializeColumn",value:function deInitializeColumn(column){var _this3=this;this.deInitializeComponent(column),column.cells.forEach((function(cell){_this3.deInitializeComponent(cell)}))}},{key:"deInitializeComponent",value:function deInitializeComponent(component){var handleEl;component.modules.resize&&(handleEl=component.modules.resize.handleEl)&&handleEl.parentElement&&handleEl.parentElement.removeChild(handleEl)}},{key:"resizeHandle",value:function resizeHandle(component,height){component.modules.resize&&component.modules.resize.handleEl&&(component.modules.resize.handleEl.style.height=height)}},{key:"_checkResizability",value:function _checkResizability(column){return column.definition.resizable}},{key:"_mouseDown",value:function _mouseDown(e,column,handle){var self=this;function mouseMove(e){var x=void 0===e.screenX?e.touches[0].screenX:e.screenX,startDiff=x-self.startX,moveDiff=x-self.latestX,blockedBefore,blockedAfter;if(self.latestX=x,self.table.rtl&&(startDiff=-startDiff,moveDiff=-moveDiff),blockedBefore=column.width==column.minWidth||column.width==column.maxWidth,column.setWidth(self.startWidth+startDiff),blockedAfter=column.width==column.minWidth||column.width==column.maxWidth,moveDiff<0&&(self.nextColumn=self.initialNextColumn),self.table.options.resizableColumnFit&&self.nextColumn&&(!blockedBefore||!blockedAfter)){var colWidth=self.nextColumn.getWidth();moveDiff>0&&colWidth<=self.nextColumn.minWidth&&(self.nextColumn=self.nextColumn.nextColumn()),self.nextColumn&&self.nextColumn.setWidth(self.nextColumn.getWidth()-moveDiff)}self.table.columnManager.rerenderColumns(!0),!self.table.browserSlow&&column.modules.resize&&column.modules.resize.variableHeight&&column.checkCellHeights()}function mouseUp(e){self.startColumn.modules.edit&&(self.startColumn.modules.edit.blocked=!1),self.table.browserSlow&&column.modules.resize&&column.modules.resize.variableHeight&&column.checkCellHeights(),document.body.removeEventListener("mouseup",mouseUp),document.body.removeEventListener("mousemove",mouseMove),handle.removeEventListener("touchmove",mouseMove),handle.removeEventListener("touchend",mouseUp),self.table.element.classList.remove("tabulator-block-select"),self.startWidth!==column.getWidth()&&(self.dispatch("column-resized",column),self.table.externalEvents.dispatch("columnResized",column.getComponent()))}self.table.element.classList.add("tabulator-block-select"),e.stopPropagation(),self.startColumn.modules.edit&&(self.startColumn.modules.edit.blocked=!0),self.startX=void 0===e.screenX?e.touches[0].screenX:e.screenX,self.latestX=self.startX,self.startWidth=column.getWidth(),document.body.addEventListener("mousemove",mouseMove),document.body.addEventListener("mouseup",mouseUp),handle.addEventListener("touchmove",mouseMove,{passive:!0}),handle.addEventListener("touchend",mouseUp)}}]),ResizeColumns}(Module);ResizeColumns.moduleName="resizeColumns";var ResizeRows=function(_Module){_inherits(ResizeRows,_Module);var _super=_createSuper(ResizeRows);function ResizeRows(table){var _this;return _classCallCheck(this,ResizeRows),(_this=_super.call(this,table)).startColumn=!1,_this.startY=!1,_this.startHeight=!1,_this.handle=null,_this.prevHandle=null,_this.registerTableOption("resizableRows",!1),_this}return _createClass(ResizeRows,[{key:"initialize",value:function initialize(){this.table.options.resizableRows&&this.subscribe("row-layout-after",this.initializeRow.bind(this))}},{key:"initializeRow",value:function initializeRow(row){var self=this,rowEl=row.getElement(),handle=document.createElement("div");handle.className="tabulator-row-resize-handle";var prevHandle=document.createElement("div");prevHandle.className="tabulator-row-resize-handle prev",handle.addEventListener("click",(function(e){e.stopPropagation()}));var handleDown=function handleDown(e){self.startRow=row,self._mouseDown(e,row,handle)};handle.addEventListener("mousedown",handleDown),handle.addEventListener("touchstart",handleDown,{passive:!0}),prevHandle.addEventListener("click",(function(e){e.stopPropagation()}));var prevHandleDown=function prevHandleDown(e){var prevRow=self.table.rowManager.prevDisplayRow(row);prevRow&&(self.startRow=prevRow,self._mouseDown(e,prevRow,prevHandle))};prevHandle.addEventListener("mousedown",prevHandleDown),prevHandle.addEventListener("touchstart",prevHandleDown,{passive:!0}),rowEl.appendChild(handle),rowEl.appendChild(prevHandle)}},{key:"_mouseDown",value:function _mouseDown(e,row,handle){var self=this;function mouseMove(e){row.setHeight(self.startHeight+((void 0===e.screenY?e.touches[0].screenY:e.screenY)-self.startY))}function mouseUp(e){document.body.removeEventListener("mouseup",mouseMove),document.body.removeEventListener("mousemove",mouseMove),handle.removeEventListener("touchmove",mouseMove),handle.removeEventListener("touchend",mouseUp),self.table.element.classList.remove("tabulator-block-select"),self.dispatchExternal("rowResized",row.getComponent())}self.table.element.classList.add("tabulator-block-select"),e.stopPropagation(),self.startY=void 0===e.screenY?e.touches[0].screenY:e.screenY,self.startHeight=row.getHeight(),document.body.addEventListener("mousemove",mouseMove),document.body.addEventListener("mouseup",mouseUp),handle.addEventListener("touchmove",mouseMove,{passive:!0}),handle.addEventListener("touchend",mouseUp)}}]),ResizeRows}(Module);ResizeRows.moduleName="resizeRows";var ResizeTable=function(_Module){_inherits(ResizeTable,_Module);var _super=_createSuper(ResizeTable);function ResizeTable(table){var _this;return _classCallCheck(this,ResizeTable),(_this=_super.call(this,table)).binding=!1,_this.visibilityObserver=!1,_this.resizeObserver=!1,_this.containerObserver=!1,_this.tableHeight=0,_this.tableWidth=0,_this.containerHeight=0,_this.containerWidth=0,_this.autoResize=!1,_this.visible=!1,_this.initialized=!1,_this.initialRedraw=!1,_this.registerTableOption("autoResize",!0),_this}return _createClass(ResizeTable,[{key:"initialize",value:function initialize(){var _this2=this;if(this.table.options.autoResize){var table=this.table,tableStyle;this.tableHeight=table.element.clientHeight,this.tableWidth=table.element.clientWidth,table.element.parentNode&&(this.containerHeight=table.element.parentNode.clientHeight,this.containerWidth=table.element.parentNode.clientWidth),"undefined"!=typeof IntersectionObserver&&"undefined"!=typeof ResizeObserver&&"virtual"===table.rowManager.getRenderMode()?(this.initializeVisibilityObserver(),this.autoResize=!0,this.resizeObserver=new ResizeObserver((function(entry){if(!table.browserMobile||table.browserMobile&&!table.modules.edit.currentCell){var nodeHeight=Math.floor(entry[0].contentRect.height),nodeWidth=Math.floor(entry[0].contentRect.width);_this2.tableHeight==nodeHeight&&_this2.tableWidth==nodeWidth||(_this2.tableHeight=nodeHeight,_this2.tableWidth=nodeWidth,table.element.parentNode&&(_this2.containerHeight=table.element.parentNode.clientHeight,_this2.containerWidth=table.element.parentNode.clientWidth),_this2.redrawTable())}})),this.resizeObserver.observe(table.element),tableStyle=window.getComputedStyle(table.element),this.table.element.parentNode&&!this.table.rowManager.fixedHeight&&(tableStyle.getPropertyValue("max-height")||tableStyle.getPropertyValue("min-height"))&&(this.containerObserver=new ResizeObserver((function(entry){if(!table.browserMobile||table.browserMobile&&!table.modules.edit.currentCell){var nodeHeight=Math.floor(entry[0].contentRect.height),nodeWidth=Math.floor(entry[0].contentRect.width);_this2.containerHeight==nodeHeight&&_this2.containerWidth==nodeWidth||(_this2.containerHeight=nodeHeight,_this2.containerWidth=nodeWidth,_this2.tableHeight=table.element.clientHeight,_this2.tableWidth=table.element.clientWidth),_this2.redrawTable()}})),this.containerObserver.observe(this.table.element.parentNode)),this.subscribe("table-resize",this.tableResized.bind(this))):(this.binding=function(){(!table.browserMobile||table.browserMobile&&!table.modules.edit.currentCell)&&(table.columnManager.rerenderColumns(!0),table.redraw())},window.addEventListener("resize",this.binding)),this.subscribe("table-destroy",this.clearBindings.bind(this))}}},{key:"initializeVisibilityObserver",value:function initializeVisibilityObserver(){var _this3=this;this.visibilityObserver=new IntersectionObserver((function(entries){_this3.visible=entries[0].isIntersecting,_this3.initialized||(_this3.initialized=!0,_this3.initialRedraw=!_this3.visible),_this3.visible&&(_this3.redrawTable(_this3.initialRedraw),_this3.initialRedraw=!1)})),this.visibilityObserver.observe(this.table.element)}},{key:"redrawTable",value:function redrawTable(force){this.initialized&&this.visible&&(this.table.columnManager.rerenderColumns(!0),this.table.redraw(force))}},{key:"tableResized",value:function tableResized(){this.table.rowManager.redraw()}},{key:"clearBindings",value:function clearBindings(){this.binding&&window.removeEventListener("resize",this.binding),this.resizeObserver&&this.resizeObserver.unobserve(this.table.element),this.visibilityObserver&&this.visibilityObserver.unobserve(this.table.element),this.containerObserver&&this.containerObserver.unobserve(this.table.element.parentNode)}}]),ResizeTable}(Module);ResizeTable.moduleName="resizeTable";var ResponsiveLayout=function(_Module){_inherits(ResponsiveLayout,_Module);var _super=_createSuper(ResponsiveLayout);function ResponsiveLayout(table){var _this;return _classCallCheck(this,ResponsiveLayout),(_this=_super.call(this,table)).columns=[],_this.hiddenColumns=[],_this.mode="",_this.index=0,_this.collapseFormatter=[],_this.collapseStartOpen=!0,_this.collapseHandleColumn=!1,_this.registerTableOption("responsiveLayout",!1),_this.registerTableOption("responsiveLayoutCollapseStartOpen",!0),_this.registerTableOption("responsiveLayoutCollapseUseFormatters",!0),_this.registerTableOption("responsiveLayoutCollapseFormatter",!1),_this.registerColumnOption("responsive"),_this}return _createClass(ResponsiveLayout,[{key:"initialize",value:function initialize(){this.table.options.responsiveLayout&&(this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-show",this.updateColumnVisibility.bind(this)),this.subscribe("column-hide",this.updateColumnVisibility.bind(this)),this.subscribe("columns-loaded",this.initializeResponsivity.bind(this)),this.subscribe("column-moved",this.initializeResponsivity.bind(this)),this.subscribe("column-add",this.initializeResponsivity.bind(this)),this.subscribe("column-delete",this.initializeResponsivity.bind(this)),this.subscribe("table-redrawing",this.tableRedraw.bind(this)),"collapse"===this.table.options.responsiveLayout&&(this.subscribe("row-data-changed",this.generateCollapsedRowContent.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout",this.layoutRow.bind(this))))}},{key:"tableRedraw",value:function tableRedraw(force){-1===["fitColumns","fitDataStretch"].indexOf(this.layoutMode())&&(force||this.update())}},{key:"initializeResponsivity",value:function initializeResponsivity(){var _this2=this,columns=[];this.mode=this.table.options.responsiveLayout,this.collapseFormatter=this.table.options.responsiveLayoutCollapseFormatter||this.formatCollapsedData,this.collapseStartOpen=this.table.options.responsiveLayoutCollapseStartOpen,this.hiddenColumns=[],this.table.columnManager.columnsByIndex.forEach((function(column,i){column.modules.responsive&&column.modules.responsive.order&&column.modules.responsive.visible&&(column.modules.responsive.index=i,columns.push(column),column.visible||"collapse"!==_this2.mode||_this2.hiddenColumns.push(column))})),columns=(columns=columns.reverse()).sort((function(a,b){var diff;return b.modules.responsive.order-a.modules.responsive.order||b.modules.responsive.index-a.modules.responsive.index})),this.columns=columns,"collapse"===this.mode&&this.generateCollapsedContent();var _iterator=_createForOfIteratorHelper(this.table.columnManager.columnsByIndex),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var col=_step.value;if("responsiveCollapse"==col.definition.formatter){this.collapseHandleColumn=col;break}}}catch(err){_iterator.e(err)}finally{_iterator.f()}this.collapseHandleColumn&&(this.hiddenColumns.length?this.collapseHandleColumn.show():this.collapseHandleColumn.hide())}},{key:"initializeColumn",value:function initializeColumn(column){var def=column.getDefinition();column.modules.responsive={order:void 0===def.responsive?1:def.responsive,visible:!1!==def.visible}}},{key:"initializeRow",value:function initializeRow(row){var el;"calc"!==row.type&&((el=document.createElement("div")).classList.add("tabulator-responsive-collapse"),row.modules.responsiveLayout={element:el,open:this.collapseStartOpen},this.collapseStartOpen||(el.style.display="none"))}},{key:"layoutRow",value:function layoutRow(row){var rowEl=row.getElement();row.modules.responsiveLayout&&(rowEl.appendChild(row.modules.responsiveLayout.element),this.generateCollapsedRowContent(row))}},{key:"updateColumnVisibility",value:function updateColumnVisibility(column,responsiveToggle){!responsiveToggle&&column.modules.responsive&&(column.modules.responsive.visible=column.visible,this.initializeResponsivity())}},{key:"hideColumn",value:function hideColumn(column){var colCount=this.hiddenColumns.length;column.hide(!1,!0),"collapse"===this.mode&&(this.hiddenColumns.unshift(column),this.generateCollapsedContent(),this.collapseHandleColumn&&!colCount&&this.collapseHandleColumn.show())}},{key:"showColumn",value:function showColumn(column){var index;column.show(!1,!0),column.setWidth(column.getWidth()),"collapse"===this.mode&&((index=this.hiddenColumns.indexOf(column))>-1&&this.hiddenColumns.splice(index,1),this.generateCollapsedContent(),this.collapseHandleColumn&&!this.hiddenColumns.length&&this.collapseHandleColumn.hide())}},{key:"update",value:function update(){for(var self=this,working=!0;working;){var width="fitColumns"==this.table.modules.layout.getMode()?this.table.columnManager.getFlexBaseWidth():this.table.columnManager.getWidth(),diff=(this.table.options.headerVisible?this.table.columnManager.element.clientWidth:this.table.element.clientWidth)-width;if(diff<0){var column=this.columns[this.index];column?(this.hideColumn(column),this.index++):working=!1}else{var _column=this.columns[this.index-1];_column&&diff>0&&diff>=_column.getWidth()?(this.showColumn(_column),this.index--):working=!1}this.table.rowManager.activeRowsCount||this.table.rowManager.renderEmptyScroll()}}},{key:"generateCollapsedContent",value:function generateCollapsedContent(){var self=this,rows;this.table.rowManager.getDisplayRows().forEach((function(row){self.generateCollapsedRowContent(row)}))}},{key:"generateCollapsedRowContent",value:function generateCollapsedRowContent(row){var el,contents;if(row.modules.responsiveLayout){for(el=row.modules.responsiveLayout.element;el.firstChild;)el.removeChild(el.firstChild);(contents=this.collapseFormatter(this.generateCollapsedRowData(row)))&&el.appendChild(contents)}}},{key:"generateCollapsedRowData",value:function generateCollapsedRowData(row){var self=this,data=row.getData(),output=[],mockCellComponent;return this.hiddenColumns.forEach((function(column){var value=column.getFieldValue(data);if(column.definition.title&&column.field)if(column.modules.format&&self.table.options.responsiveLayoutCollapseUseFormatters){var onRendered=function onRendered(callback){callback()};mockCellComponent={value:!1,data:{},getValue:function getValue(){return value},getData:function getData(){return data},getElement:function getElement(){return document.createElement("div")},getRow:function getRow(){return row.getComponent()},getColumn:function getColumn(){return column.getComponent()}},output.push({field:column.field,title:column.definition.title,value:column.modules.format.formatter.call(self.table.modules.format,mockCellComponent,column.modules.format.params,onRendered)})}else output.push({field:column.field,title:column.definition.title,value:value})})),output}},{key:"formatCollapsedData",value:function formatCollapsedData(data){var list=document.createElement("table");return data.forEach((function(item){var row=document.createElement("tr"),titleData=document.createElement("td"),valueData=document.createElement("td"),node_content,titleHighlight=document.createElement("strong");titleData.appendChild(titleHighlight),this.langBind("columns|"+item.field,(function(text){titleHighlight.innerHTML=text||item.title})),item.value instanceof Node?((node_content=document.createElement("div")).appendChild(item.value),valueData.appendChild(node_content)):valueData.innerHTML=item.value,row.appendChild(titleData),row.appendChild(valueData),list.appendChild(row)}),this),Object.keys(data).length?list:""}}]),ResponsiveLayout}(Module);ResponsiveLayout.moduleName="responsiveLayout";var SelectRow=function(_Module){_inherits(SelectRow,_Module);var _super=_createSuper(SelectRow);function SelectRow(table){var _this;return _classCallCheck(this,SelectRow),(_this=_super.call(this,table)).selecting=!1,_this.lastClickedRow=!1,_this.selectPrev=[],_this.selectedRows=[],_this.headerCheckboxElement=null,_this.registerTableOption("selectable","highlight"),_this.registerTableOption("selectableRangeMode","drag"),_this.registerTableOption("selectableRollingSelection",!0),_this.registerTableOption("selectablePersistence",!0),_this.registerTableOption("selectableCheck",(function(data,row){return!0})),_this.registerTableFunction("selectRow",_this.selectRows.bind(_assertThisInitialized(_this))),_this.registerTableFunction("deselectRow",_this.deselectRows.bind(_assertThisInitialized(_this))),_this.registerTableFunction("toggleSelectRow",_this.toggleRow.bind(_assertThisInitialized(_this))),_this.registerTableFunction("getSelectedRows",_this.getSelectedRows.bind(_assertThisInitialized(_this))),_this.registerTableFunction("getSelectedData",_this.getSelectedData.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("row","select",_this.selectRows.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("row","deselect",_this.deselectRows.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("row","toggleSelect",_this.toggleRow.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("row","isSelected",_this.isRowSelected.bind(_assertThisInitialized(_this))),_this}return _createClass(SelectRow,[{key:"initialize",value:function initialize(){!1!==this.table.options.selectable&&(this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-deleting",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clearSelectionData.bind(this)),this.subscribe("rows-retrieve",this.rowRetrieve.bind(this)),this.table.options.selectable&&!this.table.options.selectablePersistence&&this.subscribe("data-refreshing",this.deselectRows.bind(this)))}},{key:"rowRetrieve",value:function rowRetrieve(type,prevValue){return"selected"===type?this.selectedRows:prevValue}},{key:"rowDeleted",value:function rowDeleted(row){this._deselectRow(row,!0)}},{key:"clearSelectionData",value:function clearSelectionData(silent){this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],!0!==silent&&this._rowSelectionChanged()}},{key:"initializeRow",value:function initializeRow(row){var self=this,element=row.getElement(),endSelect=function endSelect(){setTimeout((function(){self.selecting=!1}),50),document.body.removeEventListener("mouseup",endSelect)};row.modules.select={selected:!1},self.table.options.selectableCheck.call(this.table,row.getComponent())?(element.classList.add("tabulator-selectable"),element.classList.remove("tabulator-unselectable"),self.table.options.selectable&&"highlight"!=self.table.options.selectable&&("click"===self.table.options.selectableRangeMode?element.addEventListener("click",this.handleComplexRowClick.bind(this,row)):(element.addEventListener("click",(function(e){self.table.modExists("edit")&&self.table.modules.edit.getCurrentCell()||self.table._clearSelection(),self.selecting||self.toggleRow(row)})),element.addEventListener("mousedown",(function(e){if(e.shiftKey)return self.table._clearSelection(),self.selecting=!0,self.selectPrev=[],document.body.addEventListener("mouseup",endSelect),document.body.addEventListener("keyup",endSelect),self.toggleRow(row),!1})),element.addEventListener("mouseenter",(function(e){self.selecting&&(self.table._clearSelection(),self.toggleRow(row),self.selectPrev[1]==row&&self.toggleRow(self.selectPrev[0]))})),element.addEventListener("mouseout",(function(e){self.selecting&&(self.table._clearSelection(),self.selectPrev.unshift(row))}))))):(element.classList.add("tabulator-unselectable"),element.classList.remove("tabulator-selectable"))}},{key:"handleComplexRowClick",value:function handleComplexRowClick(row,e){var _this2=this;if(e.shiftKey){this.table._clearSelection(),this.lastClickedRow=this.lastClickedRow||row;var lastClickedRowIdx=this.table.rowManager.getDisplayRowIndex(this.lastClickedRow),rowIdx=this.table.rowManager.getDisplayRowIndex(row),fromRowIdx=lastClickedRowIdx<=rowIdx?lastClickedRowIdx:rowIdx,toRowIdx=lastClickedRowIdx>=rowIdx?lastClickedRowIdx:rowIdx,rows,toggledRows=this.table.rowManager.getDisplayRows().slice(0).splice(fromRowIdx,toRowIdx-fromRowIdx+1);e.ctrlKey||e.metaKey?(toggledRows.forEach((function(toggledRow){toggledRow!==_this2.lastClickedRow&&(!0===_this2.table.options.selectable||_this2.isRowSelected(row)?_this2.toggleRow(toggledRow):_this2.selectedRows.length<_this2.table.options.selectable&&_this2.toggleRow(toggledRow))})),this.lastClickedRow=row):(this.deselectRows(void 0,!0),!0!==this.table.options.selectable&&toggledRows.length>this.table.options.selectable&&(toggledRows=toggledRows.slice(0,this.table.options.selectable)),this.selectRows(toggledRows)),this.table._clearSelection()}else e.ctrlKey||e.metaKey?(this.toggleRow(row),this.lastClickedRow=row):(this.deselectRows(void 0,!0),this.selectRows(row),this.lastClickedRow=row)}},{key:"toggleRow",value:function toggleRow(row){this.table.options.selectableCheck.call(this.table,row.getComponent())&&(row.modules.select&&row.modules.select.selected?this._deselectRow(row):this._selectRow(row))}},{key:"selectRows",value:function selectRows(rows){var _this3=this,rowMatch;switch(_typeof(rows)){case"undefined":this.table.rowManager.rows.forEach((function(row){_this3._selectRow(row,!0,!0)})),this._rowSelectionChanged();break;case"string":(rowMatch=this.table.rowManager.findRow(rows))?this._selectRow(rowMatch,!0,!0):this.table.rowManager.getRows(rows).forEach((function(row){_this3._selectRow(row,!0,!0)})),this._rowSelectionChanged();break;default:Array.isArray(rows)?(rows.forEach((function(row){_this3._selectRow(row,!0,!0)})),this._rowSelectionChanged()):this._selectRow(rows,!1,!0)}}},{key:"_selectRow",value:function _selectRow(rowInfo,silent,force){if(!isNaN(this.table.options.selectable)&&!0!==this.table.options.selectable&&!force&&this.selectedRows.length>=this.table.options.selectable){if(!this.table.options.selectableRollingSelection)return!1;this._deselectRow(this.selectedRows[0])}var row=this.table.rowManager.findRow(rowInfo);row?-1==this.selectedRows.indexOf(row)&&(row.getElement().classList.add("tabulator-selected"),row.modules.select||(row.modules.select={}),row.modules.select.selected=!0,row.modules.select.checkboxEl&&(row.modules.select.checkboxEl.checked=!0),this.selectedRows.push(row),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(row,!0),this.dispatchExternal("rowSelected",row.getComponent()),this._rowSelectionChanged(silent)):silent||console.warn("Selection Error - No such row found, ignoring selection:"+rowInfo)}},{key:"isRowSelected",value:function isRowSelected(row){return-1!==this.selectedRows.indexOf(row)}},{key:"deselectRows",value:function deselectRows(rows,silent){var self=this,rowCount;if(void 0===rows){rowCount=self.selectedRows.length;for(var i=0;i<rowCount;i++)self._deselectRow(self.selectedRows[0],!0);rowCount&&self._rowSelectionChanged(silent)}else Array.isArray(rows)?(rows.forEach((function(row){self._deselectRow(row,!0)})),self._rowSelectionChanged(silent)):self._deselectRow(rows,silent)}},{key:"_deselectRow",value:function _deselectRow(rowInfo,silent){var self=this,row=this.table.rowManager.findRow(rowInfo),index;row?(index=this.selectedRows.findIndex((function(selectedRow){return selectedRow==row})))>-1&&(row.getElement().classList.remove("tabulator-selected"),row.modules.select||(row.modules.select={}),row.modules.select.selected=!1,row.modules.select.checkboxEl&&(row.modules.select.checkboxEl.checked=!1),this.selectedRows.splice(index,1),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(row,!1),this.dispatchExternal("rowDeselected",row.getComponent()),this._rowSelectionChanged(silent)):silent||console.warn("Deselection Error - No such row found, ignoring selection:"+rowInfo)}},{key:"getSelectedData",value:function getSelectedData(){var data=[];return this.selectedRows.forEach((function(row){data.push(row.getData())})),data}},{key:"getSelectedRows",value:function getSelectedRows(){var rows=[];return this.selectedRows.forEach((function(row){rows.push(row.getComponent())})),rows}},{key:"_rowSelectionChanged",value:function _rowSelectionChanged(silent){this.headerCheckboxElement&&(0===this.selectedRows.length?(this.headerCheckboxElement.checked=!1,this.headerCheckboxElement.indeterminate=!1):this.table.rowManager.rows.length===this.selectedRows.length?(this.headerCheckboxElement.checked=!0,this.headerCheckboxElement.indeterminate=!1):(this.headerCheckboxElement.indeterminate=!0,this.headerCheckboxElement.checked=!1)),silent||this.dispatchExternal("rowSelectionChanged",this.getSelectedData(),this.getSelectedRows())}},{key:"registerRowSelectCheckbox",value:function registerRowSelectCheckbox(row,element){row._row.modules.select||(row._row.modules.select={}),row._row.modules.select.checkboxEl=element}},{key:"registerHeaderSelectCheckbox",value:function registerHeaderSelectCheckbox(element){this.headerCheckboxElement=element}},{key:"childRowSelection",value:function childRowSelection(row,select){var children=this.table.modules.dataTree.getChildren(row,!0);if(select){var _iterator=_createForOfIteratorHelper(children),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var child=_step.value;this._selectRow(child,!0)}}catch(err){_iterator.e(err)}finally{_iterator.f()}}else{var _iterator2=_createForOfIteratorHelper(children),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _child=_step2.value;this._deselectRow(_child,!0)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}}}]),SelectRow}(Module);function number$1(a,b,aRow,bRow,column,dir,params){var alignEmptyValues=params.alignEmptyValues,decimal=params.decimalSeparator,thousand=params.thousandSeparator,emptyAlign=0;if(a=String(a),b=String(b),thousand&&(a=a.split(thousand).join(""),b=b.split(thousand).join("")),decimal&&(a=a.split(decimal).join("."),b=b.split(decimal).join(".")),a=parseFloat(a),b=parseFloat(b),isNaN(a))emptyAlign=isNaN(b)?0:-1;else{if(!isNaN(b))return a-b;emptyAlign=1}return("top"===alignEmptyValues&&"desc"===dir||"bottom"===alignEmptyValues&&"asc"===dir)&&(emptyAlign*=-1),emptyAlign}function string(a,b,aRow,bRow,column,dir,params){var alignEmptyValues=params.alignEmptyValues,emptyAlign=0,locale;if(a){if(b){switch(_typeof(params.locale)){case"boolean":params.locale&&(locale=this.langLocale());break;case"string":locale=params.locale}return String(a).toLowerCase().localeCompare(String(b).toLowerCase(),locale)}emptyAlign=1}else emptyAlign=b?-1:0;return("top"===alignEmptyValues&&"desc"===dir||"bottom"===alignEmptyValues&&"asc"===dir)&&(emptyAlign*=-1),emptyAlign}function datetime$2(a,b,aRow,bRow,column,dir,params){var DT=window.DateTime||luxon.DateTime,format=params.format||"dd/MM/yyyy HH:mm:ss",alignEmptyValues=params.alignEmptyValues,emptyAlign=0;if(void 0!==DT){if(DT.isDateTime(a)||(a="iso"===format?DT.fromISO(String(a)):DT.fromFormat(String(a),format)),DT.isDateTime(b)||(b="iso"===format?DT.fromISO(String(b)):DT.fromFormat(String(b),format)),a.isValid){if(b.isValid)return a-b;emptyAlign=1}else emptyAlign=b.isValid?-1:0;return("top"===alignEmptyValues&&"desc"===dir||"bottom"===alignEmptyValues&&"asc"===dir)&&(emptyAlign*=-1),emptyAlign}console.error("Sort Error - 'datetime' sorter is dependant on luxon.js")}function date$1(a,b,aRow,bRow,column,dir,params){return params.format||(params.format="dd/MM/yyyy"),datetime$2.call(this,a,b,aRow,bRow,column,dir,params)}function time$1(a,b,aRow,bRow,column,dir,params){return params.format||(params.format="HH:mm"),datetime$2.call(this,a,b,aRow,bRow,column,dir,params)}function _boolean(a,b,aRow,bRow,column,dir,params){var el1,el2;return(!0===a||"true"===a||"True"===a||1===a?1:0)-(!0===b||"true"===b||"True"===b||1===b?1:0)}function array(a,b,aRow,bRow,column,dir,params){var type=params.type||"length",alignEmptyValues=params.alignEmptyValues,emptyAlign=0;function calc(value){var result;switch(type){case"length":result=value.length;break;case"sum":result=value.reduce((function(c,d){return c+d}));break;case"max":result=Math.max.apply(null,value);break;case"min":result=Math.min.apply(null,value);break;case"avg":result=value.reduce((function(c,d){return c+d}))/value.length}return result}if(Array.isArray(a)){if(Array.isArray(b))return calc(b)-calc(a);emptyAlign=1}else emptyAlign=Array.isArray(b)?-1:0;return("top"===alignEmptyValues&&"desc"===dir||"bottom"===alignEmptyValues&&"asc"===dir)&&(emptyAlign*=-1),emptyAlign}function exists(a,b,aRow,bRow,column,dir,params){var el1,el2;return(void 0===a?0:1)-(void 0===b?0:1)}function alphanum(as,bs,aRow,bRow,column,dir,params){var a,b,a1,b1,i=0,L,rx=/(\d+)|(\D+)/g,rd=/\d/,alignEmptyValues=params.alignEmptyValues,emptyAlign=0;if(as||0===as){if(bs||0===bs){if(isFinite(as)&&isFinite(bs))return as-bs;if((a=String(as).toLowerCase())===(b=String(bs).toLowerCase()))return 0;if(!rd.test(a)||!rd.test(b))return a>b?1:-1;for(a=a.match(rx),b=b.match(rx),L=a.length>b.length?b.length:a.length;i<L;)if((a1=a[i])!==(b1=b[i++]))return isFinite(a1)&&isFinite(b1)?("0"===a1.charAt(0)&&(a1="."+a1),"0"===b1.charAt(0)&&(b1="."+b1),a1-b1):a1>b1?1:-1;return a.length>b.length}emptyAlign=1}else emptyAlign=bs||0===bs?-1:0;return("top"===alignEmptyValues&&"desc"===dir||"bottom"===alignEmptyValues&&"asc"===dir)&&(emptyAlign*=-1),emptyAlign}SelectRow.moduleName="selectRow";var defaultSorters={number:number$1,string:string,date:date$1,time:time$1,datetime:datetime$2,boolean:_boolean,array:array,exists:exists,alphanum:alphanum},Sort=function(_Module){_inherits(Sort,_Module);var _super=_createSuper(Sort);function Sort(table){var _this;return _classCallCheck(this,Sort),(_this=_super.call(this,table)).sortList=[],_this.changed=!1,_this.registerTableOption("sortMode","local"),_this.registerTableOption("initialSort",!1),_this.registerTableOption("columnHeaderSortMulti",!0),_this.registerTableOption("sortOrderReverse",!1),_this.registerTableOption("headerSortElement","<div class='tabulator-arrow'></div>"),_this.registerColumnOption("sorter"),_this.registerColumnOption("sorterParams"),_this.registerColumnOption("headerSort",!0),_this.registerColumnOption("headerSortStartingDir"),_this.registerColumnOption("headerSortTristate"),_this}return _createClass(Sort,[{key:"initialize",value:function initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.registerDataHandler(this.sort.bind(this),20),this.registerTableFunction("setSort",this.userSetSort.bind(this)),this.registerTableFunction("getSorters",this.getSort.bind(this)),this.registerTableFunction("clearSort",this.clearSort.bind(this)),"remote"===this.table.options.sortMode&&this.subscribe("data-params",this.remoteSortParams.bind(this))}},{key:"tableBuilt",value:function tableBuilt(){this.table.options.initialSort&&this.setSort(this.table.options.initialSort)}},{key:"remoteSortParams",value:function remoteSortParams(data,config,silent,params){var sorters=this.getSort();return sorters.forEach((function(item){delete item.column})),params.sort=sorters,params}},{key:"userSetSort",value:function userSetSort(sortList,dir){this.setSort(sortList,dir),this.refreshSort()}},{key:"clearSort",value:function clearSort(){this.clear(),this.refreshSort()}},{key:"initializeColumn",value:function initializeColumn(column){var _this2=this,sorter=!1,colEl,arrowEl;switch(_typeof(column.definition.sorter)){case"string":Sort.sorters[column.definition.sorter]?sorter=Sort.sorters[column.definition.sorter]:console.warn("Sort Error - No such sorter found: ",column.definition.sorter);break;case"function":sorter=column.definition.sorter}if(column.modules.sort={sorter:sorter,dir:"none",params:column.definition.sorterParams||{},startingDir:column.definition.headerSortStartingDir||"asc",tristate:column.definition.headerSortTristate},!1!==column.definition.headerSort){switch((colEl=column.getElement()).classList.add("tabulator-sortable"),(arrowEl=document.createElement("div")).classList.add("tabulator-col-sorter"),this.table.options.headerSortElement){case"function":break;case"object":arrowEl.appendChild(this.table.options.headerSortElement);break;default:arrowEl.innerHTML=this.table.options.headerSortElement}column.titleHolderElement.appendChild(arrowEl),column.modules.sort.element=arrowEl,this.setColumnHeaderSortIcon(column,"none"),colEl.addEventListener("click",(function(e){var dir="",sorters=[],match=!1;if(column.modules.sort){if(column.modules.sort.tristate)dir="none"==column.modules.sort.dir?column.modules.sort.startingDir:column.modules.sort.dir==column.modules.sort.startingDir?"asc"==column.modules.sort.dir?"desc":"asc":"none";else switch(column.modules.sort.dir){case"asc":dir="desc";break;case"desc":dir="asc";break;default:dir=column.modules.sort.startingDir}_this2.table.options.columnHeaderSortMulti&&(e.shiftKey||e.ctrlKey)?((match=(sorters=_this2.getSort()).findIndex((function(sorter){return sorter.field===column.getField()})))>-1?(sorters[match].dir=dir,match!=sorters.length-1&&(match=sorters.splice(match,1)[0],"none"!=dir&&sorters.push(match))):"none"!=dir&&sorters.push({column:column,dir:dir}),_this2.setSort(sorters)):"none"==dir?_this2.clear():_this2.setSort(column,dir),_this2.refreshSort()}}))}}},{key:"refreshSort",value:function refreshSort(){"remote"===this.table.options.sortMode?this.reloadData(null,!1,!1):this.refreshData(!0)}},{key:"hasChanged",value:function hasChanged(){var changed=this.changed;return this.changed=!1,changed}},{key:"getSort",value:function getSort(){var self=this,sorters=[];return this.sortList.forEach((function(item){item.column&&sorters.push({column:item.column.getComponent(),field:item.column.getField(),dir:item.dir})})),sorters}},{key:"setSort",value:function setSort(sortList,dir){var self=this,newSortList=[];Array.isArray(sortList)||(sortList=[{column:sortList,dir:dir}]),sortList.forEach((function(item){var column;(column=self.table.columnManager.findColumn(item.column))?(item.column=column,newSortList.push(item),self.changed=!0):console.warn("Sort Warning - Sort field does not exist and is being ignored: ",item.column)})),self.sortList=newSortList,this.dispatch("sort-changed")}},{key:"clear",value:function clear(){this.setSort([])}},{key:"findSorter",value:function findSorter(column){var row=this.table.rowManager.activeRows[0],sorter="string",field,value;if(row&&(row=row.getData(),field=column.getField()))switch(_typeof(value=column.getFieldValue(row))){case"undefined":sorter="string";break;case"boolean":sorter="boolean";break;default:isNaN(value)||""===value?value.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)&&(sorter="alphanum"):sorter="number"}return Sort.sorters[sorter]}},{key:"sort",value:function sort(data){var self=this,sortList=this.table.options.sortOrderReverse?self.sortList.slice().reverse():self.sortList,sortListActual=[],rowComponents=[];return this.subscribedExternal("dataSorting")&&this.dispatchExternal("dataSorting",self.getSort()),self.clearColumnHeaders(),"remote"!==this.table.options.sortMode?(sortList.forEach((function(item,i){var sortObj;item.column&&((sortObj=item.column.modules.sort)&&(sortObj.sorter||(sortObj.sorter=self.findSorter(item.column)),item.params="function"==typeof sortObj.params?sortObj.params(item.column.getComponent(),item.dir):sortObj.params,sortListActual.push(item)),self.setColumnHeader(item.column,item.dir))})),sortListActual.length&&self._sortItems(data,sortListActual)):sortList.forEach((function(item,i){self.setColumnHeader(item.column,item.dir)})),this.subscribedExternal("dataSorted")&&(data.forEach((function(row){rowComponents.push(row.getComponent())})),this.dispatchExternal("dataSorted",self.getSort(),rowComponents)),data}},{key:"clearColumnHeaders",value:function clearColumnHeaders(){var _this3=this;this.table.columnManager.getRealColumns().forEach((function(column){column.modules.sort&&(column.modules.sort.dir="none",column.getElement().setAttribute("aria-sort","none"),_this3.setColumnHeaderSortIcon(column,"none"))}))}},{key:"setColumnHeader",value:function setColumnHeader(column,dir){column.modules.sort.dir=dir,column.getElement().setAttribute("aria-sort","asc"===dir?"ascending":"descending"),this.setColumnHeaderSortIcon(column,dir)}},{key:"setColumnHeaderSortIcon",value:function setColumnHeaderSortIcon(column,dir){var sortEl=column.modules.sort.element,arrowEl;if("function"==typeof this.table.options.headerSortElement){for(;sortEl.firstChild;)sortEl.removeChild(sortEl.firstChild);"object"===_typeof(arrowEl=this.table.options.headerSortElement.call(this.table,column.getComponent(),dir))?sortEl.appendChild(arrowEl):sortEl.innerHTML=arrowEl}}},{key:"_sortItems",value:function _sortItems(data,sortList){var _this4=this,sorterCount=sortList.length-1;data.sort((function(a,b){for(var result,i=sorterCount;i>=0;i--){var sortItem=sortList[i];if(0!==(result=_this4._sortRow(a,b,sortItem.column,sortItem.dir,sortItem.params)))break}return result}))}},{key:"_sortRow",value:function _sortRow(a,b,column,dir,params){var el1Comp,el2Comp,el1="asc"==dir?a:b,el2="asc"==dir?b:a;return a=void 0!==(a=column.getFieldValue(el1.getData()))?a:"",b=void 0!==(b=column.getFieldValue(el2.getData()))?b:"",el1Comp=el1.getComponent(),el2Comp=el2.getComponent(),column.modules.sort.sorter.call(this,a,b,el1Comp,el2Comp,column.getComponent(),dir,params)}}]),Sort}(Module);Sort.moduleName="sort",Sort.sorters=defaultSorters;var Tooltip=function(_Module){_inherits(Tooltip,_Module);var _super=_createSuper(Tooltip);function Tooltip(table){var _this;return _classCallCheck(this,Tooltip),(_this=_super.call(this,table)).tooltipSubscriber=null,_this.headerSubscriber=null,_this.timeout=null,_this.popupInstance=null,_this.registerTableOption("tooltipGenerationMode",void 0),_this.registerTableOption("tooltipDelay",300),_this.registerColumnOption("tooltip"),_this.registerColumnOption("headerTooltip"),_this}return _createClass(Tooltip,[{key:"initialize",value:function initialize(){this.deprecatedOptionsCheck(),this.subscribe("column-init",this.initializeColumn.bind(this))}},{key:"deprecatedOptionsCheck",value:function deprecatedOptionsCheck(){this.deprecationCheckMsg("tooltipGenerationMode","This option is no longer needed as tooltips are always generated on hover now")}},{key:"initializeColumn",value:function initializeColumn(column){column.definition.headerTooltip&&!this.headerSubscriber&&(this.headerSubscriber=!0,this.subscribe("column-mousemove",this.mousemoveCheck.bind(this,"headerTooltip")),this.subscribe("column-mouseout",this.mouseoutCheck.bind(this,"headerTooltip"))),column.definition.tooltip&&!this.tooltipSubscriber&&(this.tooltipSubscriber=!0,this.subscribe("cell-mousemove",this.mousemoveCheck.bind(this,"tooltip")),this.subscribe("cell-mouseout",this.mouseoutCheck.bind(this,"tooltip")))}},{key:"mousemoveCheck",value:function mousemoveCheck(action,e,component){var tooltip="tooltip"===action?component.column.definition.tooltip:component.definition.headerTooltip;tooltip&&(this.clearPopup(),this.timeout=setTimeout(this.loadTooltip.bind(this,e,component,tooltip),this.table.options.tooltipDelay))}},{key:"mouseoutCheck",value:function mouseoutCheck(action,e,component){this.popupInstance||this.clearPopup()}},{key:"clearPopup",value:function clearPopup(action,e,component){clearTimeout(this.timeout),this.timeout=null,this.popupInstance&&this.popupInstance.hide()}},{key:"loadTooltip",value:function loadTooltip(e,component,tooltip){var _this2=this,contentsEl,renderedCallback,coords;function onRendered(callback){renderedCallback=callback}"function"==typeof tooltip&&(tooltip=tooltip(e,component.getComponent(),onRendered)),tooltip instanceof HTMLElement?contentsEl=tooltip:(contentsEl=document.createElement("div"),!0===tooltip&&(component instanceof Cell?tooltip=component.value:component.definition.field?this.langBind("columns|"+component.definition.field,(function(value){contentsEl.innerHTML=tooltip=value||component.definition.title})):tooltip=component.definition.title),contentsEl.innerHTML=tooltip),(tooltip||0===tooltip||!1===tooltip)&&(contentsEl.classList.add("tabulator-tooltip"),contentsEl.addEventListener("mousemove",(function(e){return e.preventDefault()})),this.popupInstance=this.popup(contentsEl),"function"==typeof renderedCallback&&this.popupInstance.renderCallback(renderedCallback),coords=this.popupInstance.containerEventCoords(e),this.popupInstance.show(coords.x+15,coords.y+15).hideOnBlur((function(){_this2.dispatchExternal("TooltipClosed",component.getComponent()),_this2.popupInstance=null})),this.dispatchExternal("TooltipOpened",component.getComponent()))}}]),Tooltip}(Module);Tooltip.moduleName="tooltip";var defaultValidators={integer:function integer(cell,value,parameters){return""===value||null==value||(value=Number(value),!isNaN(value)&&isFinite(value)&&Math.floor(value)===value)},float:function float(cell,value,parameters){return""===value||null==value||(value=Number(value),!isNaN(value)&&isFinite(value)&&value%1!=0)},numeric:function numeric(cell,value,parameters){return""===value||null==value||!isNaN(value)},string:function string(cell,value,parameters){return""===value||null==value||isNaN(value)},max:function max(cell,value,parameters){return""===value||null==value||parseFloat(value)<=parameters},min:function min(cell,value,parameters){return""===value||null==value||parseFloat(value)>=parameters},starts:function starts(cell,value,parameters){return""===value||null==value||String(value).toLowerCase().startsWith(String(parameters).toLowerCase())},ends:function ends(cell,value,parameters){return""===value||null==value||String(value).toLowerCase().endsWith(String(parameters).toLowerCase())},minLength:function minLength(cell,value,parameters){return""===value||null==value||String(value).length>=parameters},maxLength:function maxLength(cell,value,parameters){return""===value||null==value||String(value).length<=parameters},in:function _in(cell,value,parameters){return""===value||null==value||("string"==typeof parameters&&(parameters=parameters.split("|")),parameters.indexOf(value)>-1)},regex:function regex(cell,value,parameters){return""===value||null==value||new RegExp(parameters).test(value);var reg},unique:function unique(cell,value,parameters){if(""===value||null==value)return!0;var unique=!0,cellData=cell.getData(),column=cell.getColumn()._getSelf();return this.table.rowManager.rows.forEach((function(row){var data=row.getData();data!==cellData&&value==column.getFieldValue(data)&&(unique=!1)})),unique},required:function required(cell,value,parameters){return""!==value&&null!=value}},Validate=function(_Module){_inherits(Validate,_Module);var _super=_createSuper(Validate);function Validate(table){var _this;return _classCallCheck(this,Validate),(_this=_super.call(this,table)).invalidCells=[],_this.registerTableOption("validationMode","blocking"),_this.registerColumnOption("validator"),_this.registerTableFunction("getInvalidCells",_this.getInvalidCells.bind(_assertThisInitialized(_this))),_this.registerTableFunction("clearCellValidation",_this.userClearCellValidation.bind(_assertThisInitialized(_this))),_this.registerTableFunction("validate",_this.userValidate.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("cell","isValid",_this.cellIsValid.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("cell","clearValidation",_this.clearValidation.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("cell","validate",_this.cellValidate.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("column","validate",_this.columnValidate.bind(_assertThisInitialized(_this))),_this.registerComponentFunction("row","validate",_this.rowValidate.bind(_assertThisInitialized(_this))),_this}return _createClass(Validate,[{key:"initialize",value:function initialize(){this.subscribe("cell-delete",this.clearValidation.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("edit-success",this.editValidate.bind(this)),this.subscribe("edit-editor-clear",this.editorClear.bind(this)),this.subscribe("edit-edited-clear",this.editedClear.bind(this))}},{key:"editValidate",value:function editValidate(cell,value,previousValue){var _this2=this,valid="manual"===this.table.options.validationMode||this.validate(cell.column.modules.validate,cell,value);return!0!==valid&&setTimeout((function(){cell.getElement().classList.add("tabulator-validation-fail"),_this2.dispatchExternal("validationFailed",cell.getComponent(),value,valid)})),valid}},{key:"editorClear",value:function editorClear(cell,cancelled){cancelled&&cell.column.modules.validate&&this.cellValidate(cell),cell.getElement().classList.remove("tabulator-validation-fail")}},{key:"editedClear",value:function editedClear(cell){cell.modules.validate&&(cell.modules.validate.invalid=!1)}},{key:"cellIsValid",value:function cellIsValid(cell){return cell.modules.validate&&cell.modules.validate.invalid||!0}},{key:"cellValidate",value:function cellValidate(cell){return this.validate(cell.column.modules.validate,cell,cell.getValue())}},{key:"columnValidate",value:function columnValidate(column){var _this3=this,invalid=[];return column.cells.forEach((function(cell){!0!==_this3.cellValidate(cell)&&invalid.push(cell.getComponent())})),!invalid.length||invalid}},{key:"rowValidate",value:function rowValidate(row){var _this4=this,invalid=[];return row.cells.forEach((function(cell){!0!==_this4.cellValidate(cell)&&invalid.push(cell.getComponent())})),!invalid.length||invalid}},{key:"userClearCellValidation",value:function userClearCellValidation(cells){var _this5=this;cells||(cells=this.getInvalidCells()),Array.isArray(cells)||(cells=[cells]),cells.forEach((function(cell){_this5.clearValidation(cell._getSelf())}))}},{key:"userValidate",value:function userValidate(cells){var output=[];return this.table.rowManager.rows.forEach((function(row){var valid=(row=row.getComponent()).validate();!0!==valid&&(output=output.concat(valid))})),!output.length||output}},{key:"initializeColumnCheck",value:function initializeColumnCheck(column){void 0!==column.definition.validator&&this.initializeColumn(column)}},{key:"initializeColumn",value:function initializeColumn(column){var self=this,config=[],validator;column.definition.validator&&(Array.isArray(column.definition.validator)?column.definition.validator.forEach((function(item){(validator=self._extractValidator(item))&&config.push(validator)})):(validator=this._extractValidator(column.definition.validator))&&config.push(validator),column.modules.validate=!!config.length&&config)}},{key:"_extractValidator",value:function _extractValidator(value){var type,params,pos;switch(_typeof(value)){case"string":return(pos=value.indexOf(":"))>-1?(type=value.substring(0,pos),params=value.substring(pos+1)):type=value,this._buildValidator(type,params);case"function":return this._buildValidator(value);case"object":return this._buildValidator(value.type,value.parameters)}}},{key:"_buildValidator",value:function _buildValidator(type,params){var func="function"==typeof type?type:Validate.validators[type];return func?{type:"function"==typeof type?"function":type,func:func,params:params}:(console.warn("Validator Setup Error - No matching validator found:",type),!1)}},{key:"validate",value:function validate(validators,cell,value){var self=this,failedValidators=[],invalidIndex=this.invalidCells.indexOf(cell);return validators&&validators.forEach((function(item){item.func.call(self,cell.getComponent(),value,item.params)||failedValidators.push({type:item.type,parameters:item.params})})),cell.modules.validate||(cell.modules.validate={}),failedValidators.length?(cell.modules.validate.invalid=failedValidators,"manual"!==this.table.options.validationMode&&cell.getElement().classList.add("tabulator-validation-fail"),-1==invalidIndex&&this.invalidCells.push(cell)):(cell.modules.validate.invalid=!1,cell.getElement().classList.remove("tabulator-validation-fail"),invalidIndex>-1&&this.invalidCells.splice(invalidIndex,1)),!failedValidators.length||failedValidators}},{key:"getInvalidCells",value:function getInvalidCells(){var output=[];return this.invalidCells.forEach((function(cell){output.push(cell.getComponent())})),output}},{key:"clearValidation",value:function clearValidation(cell){var invalidIndex;cell.modules.validate&&cell.modules.validate.invalid&&(cell.getElement().classList.remove("tabulator-validation-fail"),cell.modules.validate.invalid=!1,(invalidIndex=this.invalidCells.indexOf(cell))>-1&&this.invalidCells.splice(invalidIndex,1))}}]),Validate}(Module);Validate.moduleName="validate",Validate.validators=defaultValidators;var modules=Object.freeze({__proto__:null,AccessorModule:Accessor,AjaxModule:Ajax,ClipboardModule:Clipboard,ColumnCalcsModule:ColumnCalcs,DataTreeModule:DataTree,DownloadModule:Download,EditModule:Edit$1,ExportModule:Export,FilterModule:Filter,FormatModule:Format,FrozenColumnsModule:FrozenColumns,FrozenRowsModule:FrozenRows,GroupRowsModule:GroupRows,HistoryModule:History,HtmlTableImportModule:HtmlTableImport,ImportModule:Import,InteractionModule:Interaction,KeybindingsModule:Keybindings,MenuModule:Menu,MoveColumnsModule:MoveColumns,MoveRowsModule:MoveRows,MutatorModule:Mutator,PageModule:Page,PersistenceModule:Persistence,PopupModule:Popup$1,PrintModule:Print,ReactiveDataModule:ReactiveData,ResizeColumnsModule:ResizeColumns,ResizeRowsModule:ResizeRows,ResizeTableModule:ResizeTable,ResponsiveLayoutModule:ResponsiveLayout,SelectRowModule:SelectRow,SortModule:Sort,TooltipModule:Tooltip,ValidateModule:Validate}),TabulatorFull=function(_Tabulator){_inherits(TabulatorFull,_Tabulator);var _super=_createSuper(TabulatorFull);function TabulatorFull(){return _classCallCheck(this,TabulatorFull),_super.apply(this,arguments)}return TabulatorFull}(Tabulator);return new ModuleBinder(TabulatorFull,modules),TabulatorFull}));