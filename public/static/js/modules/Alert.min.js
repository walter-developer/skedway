import{CONSTANTS}from"/static/js/constants/Constants.js";import SessionStorage from"/static/js/modules/SessionStorage.min.js";export default class Alert{timeout=7e3;messages={};sessionkey="popveiculos-alerts";getCountMessages(){let self=this;return self.messages?Object.keys(self.messages).length:0}deleteMessage(key){let self=this;return void 0!==self.messages[key]&&delete self.messages[key],self}getMessage(key){let self=this;return void 0!==self.messages[key]?self.messages[key]:null}getFirstMessage(){let self=this;if(self.messages&&Object.keys(self.messages).length>0){let firstKey=Object.keys(self.messages)[0];return self.messages[firstKey]}return null}getFirstKeyMessage(){let self=this;if(self.messages&&Object.keys(self.messages).length>0){let firstKey;return Object.keys(self.messages)[0]}return null}generateNewId(){let self=this,randon,timestamp,listMsgLength,newId;return(Math.random()+"-"+(new Date).getTime()+"-"+Object.keys(this.messages).length).replace(/[^0-9\-]/g,"")}timeout(time){let self=this;return this.timeout=time,this}success(message){let self=this,id=this.generateNewId();return this.messages[id]={id:id,text:message,type:1,class:"alert-html-success"},this}warning(message){let self=this,id=this.generateNewId();return this.messages[id]={id:id,text:message,type:2,class:"alert-html-warning"},this}error(message){let self=this,id=this.generateNewId();return this.messages[id]={id:id,text:message,type:3,class:"alert-html-danger"},this}confirm(message,caseyes=null,caseno=null){let self=this,id=this.generateNewId();return this.messages[id]={id:id,text:message,type:4,caseyes:caseyes,caseno:caseno,class:"alert-html-warning"},this}loading(message,timeout=0){let self=this,id=this.generateNewId();return this.messages[id]={id:id,text:message,type:5,class:"alert-html-warning",timeout:timeout},this}redirect(url){let self=this,session=new SessionStorage,datasession=btoa(JSON.stringify(this.messages,(function(key,value){return"function"==typeof value?value.toString():value})));return session.set(this.sessionkey,{session:datasession}),window.location.href=url}showMessageSession(){try{let self=this,session=new SessionStorage,fila=session.get(self.sessionkey);session.delete(self.sessionkey),fila=fila&&"object"==typeof fila&&Object.keys(fila).length>0&&null!=typeof fila.session?JSON.parse(atob(fila.session),(function(key,value){if("string"==typeof value&&0===value.toString().indexOf("function")){let functionTemplate=`(${value})`;return eval(functionTemplate)}return value})):{},self.messages=fila,self.show()}catch(e){return console.log(e),alert("Um erro ocorreu ("+e+"), informe o setor de TI responsável!"),this}}show(){let self=this;try{if(self.getCountMessages()<=0)return this;let body=$("body"),newalert=self.html(),firstkey=self.getFirstKeyMessage(),firstmsg=self.getMessage(firstkey);self.deleteMessage(firstkey);let confirm=4==firstmsg.type,loading=5==firstmsg.type;return confirm=!1,newalert=newalert.replaceAll("##alert-html-id##",firstmsg.id),newalert=newalert.replaceAll("##alert-type-class##",firstmsg.class),newalert=newalert.replaceAll("##alert-msg##",firstmsg.text),newalert=newalert.replaceAll("##hidden-close##",confirm?"hidden":""),newalert=newalert.replaceAll("##hidden-yes##",confirm?"":"hidden"),newalert=newalert.replaceAll("##hidden-no##",confirm?"":"hidden"),newalert=newalert.replaceAll("##hidden-loading##",loading?"":"hidden"),body.find("alert-html").length<=0&&body.append(' <alert-html class="col-12"></alert-html>'),body.find("alert-html").prepend(newalert),[1,2,3].indexOf(firstmsg.type)>-1&&self.hidden("#alert-html-"+firstmsg.id,self.timeout),body.find("alert-html").find("#alert-html-close-"+firstkey).on("click",firstmsg,(function(event){self.hidden("#alert-html-"+event.data.id)})),body.find("alert-html").find("#alert-html-confirm-yes-"+firstkey).on("click",firstmsg,(function(event){"function"==typeof event.data.caseyes&&event.data.caseyes(self),self.hidden("#alert-html-"+event.data.id)})),body.find("alert-html").find("#alert-html-confirm-no-"+firstkey).on("click",firstmsg,(function(event){"function"==typeof event.data.caseno&&event.data.caseno(self),self.hidden("#alert-html-"+event.data.id)})),self.getCountMessages()>0?self.show():self}catch(e){return alert("Um erro ocorreu ("+e+"), informe o setor de TI responsável!"),this}}hidden(id,timeout=0){try{setTimeout((function(){let el;($(id).is("alert-html-item")?$(id).off():$(id).off().parents("alert-html-item")).fadeOut("slow",(function(){let elAlert=$(this).parents("alert-html"),elAlertLength=elAlert.find("alert-html-item").length,elAlertIten;return $(this).remove(),elAlertLength<=1&&elAlert.remove(),!0}))}),timeout)}catch(e){alert("Um erro ocorreu, informe o setor de TI responsável!")}}hiddenBackend(){let self=this,body;$("body").find("alert-html").find("alert-html-item[backend]").each((function(){let newid=self.generateNewId();$(this).attr("id","alert-html-"+newid),self.hidden("#alert-html-"+newid,self.timeout),$(this).find("alert-html-close").on("click",(function(){$(this).attr("id","alert-html-close-"+newid),self.hidden("#alert-html-close-"+newid)}))}))}html(){let htmlAlert="";return htmlAlert+='<alert-html-item id="alert-html-##alert-html-id##" data-id="##alert-html-id##" class="##alert-type-class##">',htmlAlert+='<alert-html-load  id="alert-html-load-##alert-html-id##" ##hidden-loading##>',htmlAlert+='<img width="25" height="25" src="'+CONSTANTS.LOADING+'">',htmlAlert+="</alert-html-load>",htmlAlert+="<alert-html-message>",htmlAlert+="<span>##alert-msg##<br></span>",htmlAlert+="</alert-html-message>",htmlAlert+='<alert-html-confirm-yes  id="alert-html-confirm-yes-##alert-html-id##" tabindex="1" role="button" ##hidden-yes##>',htmlAlert+="<span>Confirmar</span>",htmlAlert+="</alert-html-confirm-yes>",htmlAlert+='<alert-html-confirm-no   id="alert-html-confirm-no-##alert-html-id##" tabindex="2" role="button" ##hidden-no##>',htmlAlert+="<span>Cancelar</span>",htmlAlert+="</alert-html-confirm-no>",htmlAlert+='<alert-html-close id="alert-html-close-##alert-html-id##" tabindex="0" role="button" ##hidden-close##>',htmlAlert+="X",htmlAlert+="</alert-html-close>",htmlAlert+="</alert-html-item>",htmlAlert}}